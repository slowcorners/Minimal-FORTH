                                                      ; ----------------------------------------------------------------------
                                                      ; M i n i m a l - F O R T H
                                                      ;
                                                      ; A minimal FORTH for the Minimal-CPU.
                                                      ;
                                                      ; Date:         2021-03-24
                                                      ; Version:      0.1
                                                      ; Adaptation:   Nils "slowcorners" Kullberg
                                                      ; License:      MIT Open Source Initiative
                                                      ;
                                                      ;
                                                      ; FIG-FORTH WAS ORIGINALLY DEVELOPED BY:
                                                      ; FORTH INTEREST GROUP / FORTH IMPLEMENTATION TEAM
                                                      ; P.O.BOX 1105
                                                      ; SAN CARLOS, CA. 94701
                                                      ;
                                                      ; THIS COMPILER EXISTS THANKS TO ALL THE WONDERFUL PEOPLE OF THE
                                                      ; FORTH INTEREST GROUP. IT IS THEIR DEDICATION AND GENEROSITY WHICH
                                                      ; STILL TODAY MAKES THESE NEW ADAPTATIONS POSSIBLE.
                                                      ;
                                                      ; MAY THIS COMPILER BE A SMALL TRIBUTE TO ALL THOSE INDIVIDUALS OF THE
                                                      ; FORTH INTEREST GROUP AS WELL AS SLU4 WHOSE COUNTLESS HOURS AND
                                                      ; INGENIOUS DETAILS HAVE MADE THE MINIMAL-CPU COME INTO EXISTENCE.
                                                      ;
                                                      ; NILS "SLOWCORNERS" KULLBERG
                                                      ; LUND, SWEDEN
                                                      ; MARCH 2021, IN THE MIDDLE OF THE COVID-19 PANDEMIC
                                                      ;
                                                      ; ----------------------------------------------------------------------
                                                      
                                                              ORG     0x8000
                                                              
                                                      
                                                      ; INCLUDE         defs.asm
                                                      
                                                      CH_BSP  EQU     8
                                                      CH_LF   EQU     10
                                                      CH_CR   EQU     13
                                                      CH_DEL  EQU     127
                                                      
                                                      ; INCLUDE         boot-table.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; BOOT TABLE
                                                      
8000 14 BA 95                                         ORIGIN: JPA     CENT            ;  0: COLD start
8003 00                                                       NOP
8004 14 CC 95                                                 JPA     WENT            ;  4: WARM start
8007 00                                                       NOP
8008 00 00                                                    DW      0               ;  8: Processor type in radix 36
800A 00 00                                                    DW      0               ; 10: Revision
800C FA 9C                                                    DW      HFORTH          ; 12: Pointer to latest word defined
800E 7F 00                                                    DW      CH_DEL          ; 14: Backspace character
8010 8E F6                                                    DW      XUP             ; 16: Pointer to initial user area
8012 B9 F5                                                    DW      XSP             ; 18: Initial data stack pointer
8014 8D F6                                                    DW      XRP             ; 20: Initial return stack pointer
8016 BA F5                                                    DW      XTIB            ; 22: Pointer to terminal input buffer
8018 1F 00                                                    DW      31              ; 24: Maximum FORTH word name length
801A 00 00                                                    DW      0               ; 26: Initial WARNING mode
801C 0C 9D                                                    DW      XDP             ; 28: Initial FENCE
801E 0C 9D                                                    DW      XDP             ; 30: Initial HERE
8020 0A 9D                                                    DW      XXVOC           ; 32: Pointer to initial VOC-LINK
8022 DF F6                                                    DW      DSKBF           ; 34: Initial FIRST
8024 E7 FE                                                    DW      ENDBF           ; 36: Initial LIMIT
8026 00 00                                                    DW      0               ; 38: unused
8028 00 00                                                    DW      0               ; 40: unused
                                                      
                                                      ; INCLUDE         helpers.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; HELPER FUNCTIONS
                                                      ;
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (IP)+
                                                      
802A 1D E8 FE                                         _LIT:   LDR     IP
802D 16 F2 FE                                                 STA     R1.0
8030 2E E8 FE                                                 INW     IP
8033 1D E8 FE                                                 LDR     IP
8036 16 F3 FE                                                 STA     R1.1
8039 2E E8 FE                                                 INW     IP
803C 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       IP = IP + (IP)+
                                                      
803D 1D E8 FE                                         _BRAN:  LDR     IP
8040 16 F2 FE                                                 STA     R1.0
8043 2E E8 FE                                                 INW     IP
8046 1D E8 FE                                                 LDR     IP
8049 16 F3 FE                                                 STA     R1.1
804C 2F E8 FE                                                 DEW     IP
804F 15 F2 FE                                                 LDA     R1.0
8052 28 E8 FE                                                 ADB     IP.0
8055 15 F3 FE                                                 LDA     R1.1
8058 2A E9 FE                                                 ACB     IP.1
805B 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (SP) "half function"
                                                      
805C 1D EC FE                                         _GET1_: LDR     SP
805F 16 F2 FE                                                 STA     R1.0
8062 2E EC FE                                                 INW     SP
8065 1D EC FE                                                 LDR     SP
8068 16 F3 FE                                                 STA     R1.1
806B 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (SP)
                                                      
806C 38 5C 80                                         _GET1:  JPS     _GET1_
806F 2F EC FE                                                 DEW     SP
8072 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (SP)+
                                                      
8073 38 5C 80                                         _POP1:  JPS     _GET1_
8076 2E EC FE                                                 INW     SP
8079 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1X = (SP)+
                                                      
807A 1D EC FE                                         _DPOP1: LDR     SP
807D 16 F2 FE                                                 STA     R1.0
8080 2E EC FE                                                 INW     SP
8083 1D EC FE                                                 LDR     SP
8086 16 F3 FE                                                 STA     R1.1
8089 2E EC FE                                                 INW     SP
808C 1D EC FE                                                 LDR     SP
808F 16 F4 FE                                                 STA     R1.2
8092 2E EC FE                                                 INW     SP
8095 1D EC FE                                                 LDR     SP
8098 16 F5 FE                                                 STA     R1.3
809B 2E EC FE                                                 INW     SP
809E 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R2 = (SP) "half function"
                                                      
809F 1D EC FE                                         _GET2_: LDR     SP
80A2 16 F6 FE                                                 STA     R2.0
80A5 2E EC FE                                                 INW     SP
80A8 1D EC FE                                                 LDR     SP
80AB 16 F7 FE                                                 STA     R2.1
80AE 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R2 = (SP)
                                                      
80AF 38 9F 80                                         _GET2:  JPS     _GET2_
80B2 2F EC FE                                                 DEW     SP
80B5 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (SP)+
                                                      
80B6 38 9F 80                                         _POP2:  JPS     _GET2_
80B9 2E EC FE                                                 INW     SP
80BC 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R2X = (SP)+
                                                      
80BD 1D EC FE                                         _DPOP2: LDR     SP
80C0 16 F6 FE                                                 STA     R2.0
80C3 2E EC FE                                                 INW     SP
80C6 1D EC FE                                                 LDR     SP
80C9 16 F7 FE                                                 STA     R2.1
80CC 2E EC FE                                                 INW     SP
80CF 1D EC FE                                                 LDR     SP
80D2 16 F8 FE                                                 STA     R2.2
80D5 2E EC FE                                                 INW     SP
80D8 1D EC FE                                                 LDR     SP
80DB 16 F9 FE                                                 STA     R2.3
80DE 2E EC FE                                                 INW     SP
80E1 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3 = (SP) "half function"
                                                      
80E2 1D EC FE                                         _GET3_: LDR     SP
80E5 16 FA FE                                                 STA     R3.0
80E8 2E EC FE                                                 INW     SP
80EB 1D EC FE                                                 LDR     SP
80EE 16 FB FE                                                 STA     R3.1
80F1 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3 = (SP)
                                                      
80F2 38 E2 80                                         _GET3:  JPS     _GET3_
80F5 2F EC FE                                                 DEW     SP
80F8 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3 = (SP)+
                                                      
80F9 38 E2 80                                         _POP3:  JPS     _GET3_
80FC 2E EC FE                                                 INW     SP
80FF 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R2 = (SP)+
                                                      ;       R1 = (SP)+
                                                      
8100 38 B6 80                                         _POP21: JPS     _POP2
8103 38 73 80                                                 JPS     _POP1
8106 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (RP) "half function"
                                                      
8107 1D EE FE                                         _RGET1_: LDR    RP
810A 16 F2 FE                                                 STA     R1.0
810D 2E EE FE                                                 INW     RP
8110 1D EE FE                                                 LDR     RP
8113 16 F3 FE                                                 STA     R1.1
8116 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (RP)
                                                      
8117 38 07 81                                         _RGET1: JPS     _RGET1_
811A 2F EE FE                                                 DEW     RP
811D 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (RP)+
                                                      
811E 38 07 81                                         _RPOP1: JPS     _RGET1_
8121 2E EE FE                                                 INW     RP
8124 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R2 = (RP) "half function"
                                                      
8125 1D EE FE                                         _RGET2_: LDR    RP
8128 16 F6 FE                                                 STA     R2.0
812B 2E EE FE                                                 INW     RP
812E 1D EE FE                                                 LDR     RP
8131 16 F7 FE                                                 STA     R2.1
8134 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R2 = (RP)
                                                      
8135 38 25 81                                         _RGET2: JPS     _RGET2_
8138 2F EE FE                                                 DEW     RP
813B 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (RP)
                                                      
813C 38 25 81                                         _RPOP2: JPS     _RGET2_
813F 2E EE FE                                                 INW     RP
8142 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3 = (RP) "half function"
                                                      
8143 1D EE FE                                         _RGET3_: LDR    RP
8146 16 FA FE                                                 STA     R3.0
8149 2E EE FE                                                 INW     RP
814C 1D EE FE                                                 LDR     RP
814F 16 FB FE                                                 STA     R3.1
8152 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3 = (RP)
                                                      
8153 38 43 81                                         _RGET3: JPS     _RGET3_
8156 2F EE FE                                                 DEW     RP
8159 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3 = (RP)
                                                      
815A 38 43 81                                         _RPOP3: JPS     _RGET3_
815D 2E EE FE                                                 INW     RP
8160 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (SP) = R1 "half function"
                                                      
8161 15 F3 FE                                         _PUT1_: LDA     R1.1
8164 1E EC FE                                                 STR     SP
8167 2F EC FE                                                 DEW     SP
816A 15 F2 FE                                                 LDA     R1.0
816D 1E EC FE                                                 STR     SP
8170 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (SP) = R1
                                                      
8171 2E EC FE                                         _PUT1:  INW     SP
8174 38 61 81                                                 JPS     _PUT1_
8177 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       -(SP) = R1
                                                      
8178 2F EC FE                                         _PUSH1: DEW     SP
817B 38 61 81                                                 JPS     _PUT1_
817E 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (SP) = R2 "half function"
                                                      
817F 15 F7 FE                                         _PUT2_: LDA     R2.1
8182 1E EC FE                                                 STR     SP
8185 2F EC FE                                                 DEW     SP
8188 15 F6 FE                                                 LDA     R2.0
818B 1E EC FE                                                 STR     SP
818E 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (SP) = R2
                                                      
818F 2E EC FE                                         _PUT2:  INW     SP
8192 38 7F 81                                                 JPS     _PUT2_
8195 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       -(SP) = R2
                                                      
8196 2F EC FE                                         _PUSH2: DEW     SP
8199 38 7F 81                                                 JPS     _PUT2_
819C 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (SP) = R3 "half function"
                                                      
819D 15 FB FE                                         _PUT3_: LDA     R3.1
81A0 1E EC FE                                                 STR     SP
81A3 2F EC FE                                                 DEW     SP
81A6 15 FA FE                                                 LDA     R3.0
81A9 1E EC FE                                                 STR     SP
81AC 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (SP) = R3
                                                      
81AD 2E EC FE                                         _PUT3:  INW     SP
81B0 38 9D 81                                                 JPS     _PUT3_
81B3 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       -(SP) = R3
                                                      
81B4 2F EC FE                                         _PUSH3: DEW     SP
81B7 38 9D 81                                                 JPS     _PUT3_
81BA 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (RP) = R1 "half function"
                                                      
81BB 15 F3 FE                                         _RPUT1_: LDA    R1.1
81BE 1E EE FE                                                 STR     RP
81C1 2F EE FE                                                 DEW     RP
81C4 15 F2 FE                                                 LDA     R1.0
81C7 1E EE FE                                                 STR     RP
81CA 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (RP) = R1
                                                      
81CB 2E EE FE                                         _RPUT1: INW     RP
81CE 38 BB 81                                                 JPS     _RPUT1_
81D1 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       -(RP) = R1
                                                      
81D2 2F EE FE                                         _RPUSH1: DEW    RP
81D5 38 BB 81                                                 JPS     _RPUT1_
81D8 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (RP) = R2 "half function"
                                                      
81D9 15 F7 FE                                         _RPUT2_: LDA    R2.1
81DC 1E EE FE                                                 STR     RP
81DF 2F EE FE                                                 DEW     RP
81E2 15 F6 FE                                                 LDA     R2.0
81E5 1E EE FE                                                 STR     RP
81E8 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (RP) = R2
                                                      
81E9 2E EE FE                                         _RPUT2: INW     RP
81EC 38 D9 81                                                 JPS     _RPUT2_
81EF 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       -(RP) = R2
                                                      
81F0 2F EE FE                                         _RPUSH2: DEW    RP
81F3 38 D9 81                                                 JPS     _RPUT2_
81F6 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (RP) = R3 "half function"
                                                      
81F7 15 FB FE                                         _RPUT3_: LDA    R3.1
81FA 1E EE FE                                                 STR     RP
81FD 2F EE FE                                                 DEW     RP
8200 15 FA FE                                                 LDA     R3.0
8203 1E EE FE                                                 STR     RP
8206 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (RP) = R3
                                                      
8207 2E EE FE                                         _RPUT3: INW     RP
820A 38 F7 81                                                 JPS     _RPUT3_
820D 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       -(RP) = R3
                                                      
820E 2F EE FE                                         _RPUSH3: DEW    RP
8211 38 F7 81                                                 JPS     _RPUT3_
8214 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = R1 + R2
                                                      
8215 15 F6 FE                                         _ADD16: LDA     R2.0
8218 28 F2 FE                                                 ADB     R1.0
821B 15 F7 FE                                                 LDA     R2.1
821E 2A F3 FE                                                 ACB     R1.1
8221 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1X = R1X + R2X
                                                      
8222 15 F6 FE                                         _ADD32: LDA     R2.0
8225 28 F2 FE                                                 ADB     R1.0
8228 15 F7 FE                                                 LDA     R2.1
822B 2A F3 FE                                                 ACB     R1.1
822E 15 F8 FE                                                 LDA     R2.2
8231 2A F4 FE                                                 ACB     R1.2
8234 15 F9 FE                                                 LDA     R2.3
8237 2A F5 FE                                                 ACB     R1.3
823A 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (R3)
                                                      
823B 1D FA FE                                         _LD16:  LDR     R3
823E 16 F2 FE                                                 STA     R1.0
8241 2E FA FE                                                 INW     R3
8244 1D FA FE                                                 LDR     R3
8247 16 F3 FE                                                 STA     R1.1
824A 2F FA FE                                                 DEW     R3
824D 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (R3) = R1
                                                      
824E 15 F2 FE                                         _ST16:  LDA     R1.0
8251 1E FA FE                                                 STR     R3
8254 2E FA FE                                                 INW     R3
8257 15 F3 FE                                                 LDA     R1.1
825A 1E FA FE                                                 STR     R3
825D 2F FA FE                                                 DEW     R3
8260 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1.0 = R1.0 & R2.0
                                                      
8261 0E 08                                            _AND8:  LDI     8               ; Load bit counter
8263 16 FE FE                                                 STA     BC              ; :
8266 15 F6 FE                                         _AND81: LDA     R2.0            ; Load second operand
8269 05                                                       LSL                     ; Shift 2b7 into C
826A 16 F6 FE                                                 STA     R2.0            ; Store shifted second operand
826D 15 F2 FE                                                 LDA     R1.0            ; Load first operand
8270 3C 79 82                                                 BCC     _AND82          ; If C is clear: Shift in a zero
                                                              ; 2b7 is set
8273 11 00                                                    CPI     0               ; Is first operand < 0, i.e. is 1b7 set?
8275 3F 79 82                                                 BMI     _AND82           ; N is set: 1b7 is set
                                                              ; 1b7 is clear
8278 03                                                       CLC                     ; 1b7 is clear: Clear C
8279 06                                               _AND82: ROL                     ; Shift C into result
827A 16 F2 FE                                                 STA     R1.0            ; Store first operand/result
827D 27 FE FE                                                 DEB     BC              ; All bits done?
8280 3A 66 82                                                 BNE     _AND81          ;   NO: Do one more
8283 39                                                       RTS                     ;   YES: All done
                                                      
                                                      ; ------------------------------
                                                      ;       R1.0 = R1.0 | R2.0
                                                      
8284 0E 08                                            _OR8:   LDI     8               ; Load bit counter
8286 16 FE FE                                                 STA     BC              ; :
8289 15 F6 FE                                         _OR810: LDA     R2.0            ; Load second operand
828C 05                                                       LSL                     ; Shift 2b7 into C
828D 16 F6 FE                                                 STA     R2.0            ; Store shifted second operand
8290 15 F2 FE                                                 LDA     R1.0            ; Load first operand
8293 3D 9C 82                                                 BCS     _OR820          ; If C is set, shift it into result
                                                              ; 2b7 is clear
8296 11 00                                                    CPI     0               ; Is first operand < 0, i.e. is 1b7 set?
8298 3F 9C 82                                                 BMI     _OR820          ; N is clear: 1b7 is clear
                                                              ; 1b7 is clear
829B 03                                                       CLC                     ; Neither bit is set: Clear C 
829C 06                                               _OR820: ROL                     ; Shift C into result
829D 16 F2 FE                                                 STA     R1.0            ; Store first operand/result
82A0 27 FE FE                                                 DEB     BC              ; All bits done?
82A3 3A 89 82                                                 BNE     _OR810          ;   NO: Do one more
82A6 39                                                       RTS                     ;   YES: All done
                                                      
                                                      ; ------------------------------
                                                      ;       R1.0 = R1.0 ^ R2.0
                                                      
82A7 0E 08                                            _XOR8:  LDI     8               ; Load bit counter
82A9 16 FE FE                                                 STA     BC              ; :
82AC 15 F6 FE                                         _XOR81: LDA     R2.0            ; Get second operand
82AF 05                                                       LSL                     ; Shift b7 into C
82B0 16 F6 FE                                                 STA     R2.0            ; Store shifted second operand
82B3 15 F2 FE                                                 LDA     R1.0            ; Load first operand
82B6 3D C1 82                                                 BCS     _XOR82          ; C is set, check 1b7 for zero
                                                              ; 2b7 is clear
82B9 11 00                                                    CPI     0               ; Is first operand < 0, i.e. is b7 set?
82BB 3F C7 82                                                 BMI     _XOR84          ; 1b7 is set and 2b7 is clear, shift in C which is set
82BE 14 C6 82                                                 JPA     _XOR83          ; 1b7 and 2b7 are both zero, clear C and shift in 
                                                              ; 2b7 is set, check 1b7 for zero
82C1 11 00                                            _XOR82: CPI     0
82C3 3E C7 82                                                 BPL     _XOR84          ; If 1b7 is zero, shift in C which is set
82C6 03                                               _XOR83: CLC                     ; 1b7 and 2b7 are equal, shift in a zero
82C7 06                                               _XOR84: ROL                     ; Shift whatever is in C into result
82C8 16 F2 FE                                                 STA     R1.0            ; Store first operand/result
82CB 27 FE FE                                                 DEB     BC              ; All bits done?
82CE 3A AC 82                                                 BNE     _XOR81          ;   NO: Do one more
82D1 39                                                       RTS                     ;   YES: All done
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = ~R1
                                                      
82D2 15 F5 FE                                         _NOT32: LDA     R1.3            ; Negate MSB
82D5 0B                                                       NEG                     ; Two-complement negation
82D6 10 01                                                    SBI     1               ; Adjust to bitwise not
82D8 16 F5 FE                                                 STA     R1.3            ; Store negated MSB
82DB 15 F4 FE                                                 LDA     R1.2            ; Negate byte2
82DE 0B                                                       NEG                     ; Two-complement negation
82DF 10 01                                                    SBI     1               ; Adjust to bitwise not
82E1 16 F4 FE                                                 STA     R1.2            ; Store negated byte2
82E4 15 F3 FE                                         _NOT16: LDA     R1.1            ; Negate byte1
82E7 0B                                                       NEG                     ; Two-complement negation
82E8 10 01                                                    SBI     1               ; Adjust to bitwise not
82EA 16 F3 FE                                                 STA     R1.1            ; Store negated byte1
82ED 15 F2 FE                                                 LDA     R1.0            ; Negate LSB
82F0 0B                                                       NEG                     ; Two-complement negation
82F1 10 01                                                    SBI     1               ; Adjust to bitwise not
82F3 16 F2 FE                                                 STA     R1.0            ; Store negated LSB
82F6 39                                                       RTS                     ; Done
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = -R1
                                                      
82F7 38 E4 82                                         _NEG16: JPS     _NOT16          ; Bitwise NOT R1
82FA 0E 01                                                    LDI     1               ; Add one to make it 2-complement
82FC 28 F2 FE                                                 ADB     R1.0            ; :
82FF 0E 00                                                    LDI     0               ; :
8301 2A F3 FE                                                 ACB     R1.1            ; :
8304 39                                                       RTS                     ; Done
                                                      
                                                      ; ------------------------------
                                                      ;       R1X = -R1X
                                                      
8305 38 D2 82                                         _NEG32: JPS     _NOT32          ; Bitwise NOT R1X
8308 0E 01                                                    LDI     1               ; Add one to make it 2-complement
830A 28 F2 FE                                                 ADB     R1.0            ; :
830D 0D                                                       DEC                     ; :
830E 2A F3 FE                                                 ACB     R1.1            ; :
8311 2A F4 FE                                                 ACB     R1.2            ; :
8314 2A F5 FE                                                 ACB     R1.3            ; :
8317 39                                                       RTS                     ; Done
                                                      
                                                      ; ------------------------------
                                                      ;       R1 <-> R2
                                                      
8318 38 78 81                                         _XCH16: JPS     _PUSH1          ; Temp = R1
831B 15 F6 FE                                                 LDA     R2.0            ; R1 = R2
831E 16 F2 FE                                                 STA     R1.0            ; :
8321 15 F7 FE                                                 LDA     R2.1            ; :
8324 16 F3 FE                                                 STA     R1.1            ; :
8327 38 B6 80                                                 JPS     _POP2           ; R2 = Temp
832A 39                                                       RTS                     ; Done
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (R1)
                                                      
832B 1D F2 FE                                         _AT:    LDR     R1              ; Get LSB
832E 16 F4 FE                                                 STA     R1.2            ; ... Store temp
8331 2E F2 FE                                                 INW     R1              ; Bump
8334 1D F2 FE                                                 LDR     R1              ; Get MSB
8337 16 F5 FE                                                 STA     R1.3            ; ... Store temp
833A 15 F4 FE                                                 LDA     R1.2            ; Get temp LSB
833D 16 F2 FE                                                 STA     R1.0            ; ... Store
8340 15 F5 FE                                                 LDA     R1.3            ; Get temp MSB
8343 16 F3 FE                                                 STA     R1.1            ; ... Store
8346 39                                                       RTS                     ; Done
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; TEMP DEBUG FUNCTIONS FOR BRINGING UP THE SYSTEM
                                                      ;
                                                      
8347 00                                               DBG:    DB      0
8348 00                                               OUTC:   DB      0
                                                      
8349 15 48 83                                         _LNYB:  LDA     OUTC
834C 05                                                       LSL
834D 05                                                       LSL
834E 05                                                       LSL
834F 05                                                       LSL
8350 14 56 83                                                 JPA     _HNYB1
8353 15 48 83                                         _HNYB:  LDA     OUTC
8356 07                                               _HNYB1: LSR
8357 07                                                       LSR
8358 07                                                       LSR
8359 07                                                       LSR
835A 16 48 83                                                 STA     OUTC
835D 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       "OUTW"
                                                      
835E 00                                               _OWAIT: NOP
835F 00                                                       NOP
8360 00                                                       NOP
8361 00                                                       NOP
8362 00                                                       NOP
8363 00                                                       NOP
8364 00                                                       NOP
8365 00                                                       NOP
8366 00                                                       NOP
8367 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       "OUTHX"
                                                      
8368 15 48 83                                         _OUTHX: LDA     OUTC
836B 11 0A                                                    CPI     10
836D 3F 78 83                                                 BMI     _OUTH1
8370 10 0A                                                    SBI     10
8372 0F 41                                                    ADI     'A'
8374 02                                                       OUT
8375 14 5E 83                                                 JPA     _OWAIT
8378 0F 30                                            _OUTH1: ADI     '0'
837A 02                                                       OUT
837B 14 5E 83                                                 JPA     _OWAIT
                                                      
                                                      ; ------------------------------
                                                      ;       "DEBUG"
                                                      
                                                      DEBUG:
837E 0E 0D                                                    LDI     0x0D
8380 02                                                       OUT
8381 38 5E 83                                                 JPS     _OWAIT
8384 0E 0A                                                    LDI     0x0A
8386 02                                                       OUT
8387 38 5E 83                                                 JPS     _OWAIT
838A 15 E9 FE                                                 LDA     IP.1
838D 16 48 83                                                 STA     OUTC
8390 38 53 83                                                 JPS     _HNYB
8393 38 68 83                                                 JPS     _OUTHX
8396 15 E9 FE                                                 LDA     IP.1
8399 16 48 83                                                 STA     OUTC
839C 38 49 83                                                 JPS     _LNYB
839F 38 68 83                                                 JPS     _OUTHX
83A2 15 E8 FE                                                 LDA     IP.0
83A5 16 48 83                                                 STA     OUTC
83A8 38 53 83                                                 JPS     _HNYB
83AB 38 68 83                                                 JPS     _OUTHX
83AE 15 E8 FE                                                 LDA     IP.0
83B1 16 48 83                                                 STA     OUTC
83B4 38 49 83                                                 JPS     _LNYB
83B7 38 68 83                                                 JPS     _OUTHX
83BA 0E 3E                                                    LDI     '>'
83BC 02                                                       OUT
83BD 38 5E 83                                                 JPS     _OWAIT
83C0 0E 20                                                    LDI     32
83C2 02                                                       OUT
83C3 0A                                               KWAIT:  INP
83C4 11 FF                                                    CPI     0xFF
83C6 3B C3 83                                                 BEQ     KWAIT
83C9 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;
                                                      
83CA CC 83                                            _DEB:   DW      _DEB0
83CC 0E 01                                            _DEB0:  LDI     1
83CE 16 47 83                                                 STA     DBG
83D1 14 29 85                                                 JPA     NEXT
                                                      
83D4 D6 83                                            _HALT:  DW      _HALT0
83D6 14 D6 83                                         _HALT0: JPA     _HALT0
                                                      
                                                      ; ------------------------------
                                                      ;       +ORIGIN
                                                      ; NOTE: Index number in R2
                                                      
83D9 0E 00                                            _PORIG: LDI     <ORIGIN         ; R1 = ORIGIN address
83DB 16 F2 FE                                                 STA     R1.0            ; :
83DE 0E 80                                                    LDI     >ORIGIN         ; :
83E0 16 F3 FE                                                 STA     R1.1            ; :
83E3 15 F6 FE                                                 LDA     R2.0            ; Get index number
83E6 30 F2 FE                                                 ADW     R1              ; Compute addr
83E9 39                                                       RTS                     ; Done
                                                      
                                                      ; ------------------------------
                                                      ;       _USER
                                                      ; NOTE: Index number in R2
                                                      
83EA 15 F0 FE                                         _USER:  LDA     UP.0            ; R1 = UP
83ED 16 F2 FE                                                 STA     R1.0            ; :
83F0 15 F1 FE                                                 LDA     UP.1            ; :
83F3 16 F3 FE                                                 STA     R1.1            ; :
83F6 15 F6 FE                                                 LDA     R2.0            ; Get index number
83F9 30 F2 FE                                                 ADW     R1              ; Compute addr
83FC 39                                                       RTS                     ; Done
                                                      
                                                      ; ------------------------------
                                                      ;       _SWAP8
                                                      ; Swaps R1.1 <-> R1.0
                                                      ;       R2.1 <-> R2.0
                                                      
83FD 15 F2 FE                                         _SWAP8: LDA     R1.0
8400 16 FF FE                                                 STA     TMP
8403 15 F3 FE                                                 LDA     R1.1
8406 16 F2 FE                                                 STA     R1.0
8409 15 FF FE                                                 LDA     TMP
840C 16 F3 FE                                                 STA     R1.1
840F 15 F6 FE                                                 LDA     R2.0
8412 16 FF FE                                                 STA     TMP
8415 15 F7 FE                                                 LDA     R2.1
8418 16 F6 FE                                                 STA     R2.0
841B 15 FF FE                                                 LDA     TMP
841E 16 F7 FE                                                 STA     R2.1
8421 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = R1 & R2
                                                      
8422 38 61 82                                         _AND16: JPS     _AND8
8425 38 FD 83                                                 JPS     _SWAP8
8428 38 61 82                                                 JPS     _AND8
842B 38 FD 83                                                 JPS     _SWAP8
842E 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = R1 | R2
                                                      
842F 38 84 82                                         _OR16:  JPS     _OR8
8432 38 FD 83                                                 JPS     _SWAP8
8435 38 84 82                                                 JPS     _OR8
8438 38 FD 83                                                 JPS     _SWAP8
843B 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = R1 ^ R2
                                                      
843C 38 A7 82                                         _XOR16: JPS     _XOR8
843F 38 FD 83                                                 JPS     _SWAP8
8442 38 A7 82                                                 JPS     _XOR8
8445 38 FD 83                                                 JPS     _SWAP8
8448 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1X = R1X * R2X
                                                      
8449 0E 00                                            _UMULT: LDI     0               ; R1H = 0
844B 16 F4 FE                                                 STA     R1.2
844E 16 F5 FE                                                 STA     R1.3
8451 16 F8 FE                                                 STA     R2.2            ; R2H = 0
8454 16 F9 FE                                                 STA     R2.3
8457 16 FC FE                                                 STA     R3.2            ; R3H = 0
845A 16 FD FE                                                 STA     R3.3
                                                      
845D 15 F2 FE                                                 LDA     R1.0            ; R3L = R1L
8460 16 FA FE                                                 STA     R3.0
8463 15 F3 FE                                                 LDA     R1.1
8466 16 FB FE                                                 STA     R3.1
                                                      
8469 0E 00                                                    LDI     0               ; R1L = 0
846B 16 F2 FE                                                 STA     R1.0
846E 16 F3 FE                                                 STA     R1.1
                                                      
8471 0E 10                                                    LDI     16              ; Set bit counter
8473 16 FE FE                                                 STA     BC
                                                      
8476 15 FB FE                                         _UMU10: LDA     R3.1            ; R3L = R3L >> 1
8479 07                                                       LSR
847A 16 FB FE                                                 STA     R3.1
847D 15 FA FE                                                 LDA     R3.0
8480 08                                                       ROR
8481 16 FA FE                                                 STA     R3.0
8484 3C 8A 84                                                 BCC     _UMU20
                                                      
8487 38 22 82                                                 JPS     _ADD32          ; R1X = R1X + R2X
                                                      
848A 15 F6 FE                                         _UMU20: LDA     R2.0            ; R2X = R2X << 1
848D 05                                                       LSL
848E 16 F6 FE                                                 STA     R2.0
8491 15 F7 FE                                                 LDA     R2.1
8494 06                                                       ROL
8495 16 F7 FE                                                 STA     R2.1
8498 15 F8 FE                                                 LDA     R2.2
849B 06                                                       ROL
849C 16 F8 FE                                                 STA     R2.2
849F 15 F9 FE                                                 LDA     R2.3
84A2 06                                                       ROL
84A3 16 F9 FE                                                 STA     R2.3
                                                      
84A6 27 FE FE                                                 DEB     BC
84A9 3A 76 84                                                 BNE     _UMU10
84AC 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1X / R2L
                                                      ;       R1H: Quotient
                                                      ;       R1L: Remainder
                                                      
84AD 0E 10                                            _UDIV:  LDI     16              ; Set bit counter
84AF 16 FE FE                                                 STA     BC              ; :
                                                              
84B2 15 F2 FE                                         _UDI10: LDA     R1.0            ; R1X = R1X << 1
84B5 05                                                       LSL                     ; :
84B6 16 F2 FE                                                 STA     R1.0            ; :
84B9 15 F3 FE                                                 LDA     R1.1            ; :
84BC 06                                                       ROL                     ; :
84BD 16 F3 FE                                                 STA     R1.1            ; :
84C0 15 F4 FE                                                 LDA     R1.2            ; :
84C3 06                                                       ROL                     ; :
84C4 16 F4 FE                                                 STA     R1.2            ; :
84C7 15 F5 FE                                                 LDA     R1.3            ; :
84CA 06                                                       ROL                     ; :
84CB 16 F5 FE                                                 STA     R1.3            ; :
                                                      
84CE 15 F4 FE                                                 LDA     R1.2            ; R3H = R1H
84D1 16 FC FE                                                 STA     R3.2            ; :
84D4 15 F5 FE                                                 LDA     R1.3            ; :
84D7 16 FD FE                                                 STA     R3.3            ; :
                                                              
84DA 15 FC FE                                                 LDA     R3.2            ; R3H = R3H - R2L
84DD 18 F6 FE                                                 SBA     R2.0            ; :
84E0 16 FC FE                                                 STA     R3.2            ; :
84E3 15 FD FE                                                 LDA     R3.3            ; :
84E6 1B F7 FE                                                 SCA     R2.1            ; :
84E9 16 FD FE                                                 STA     R3.3            ; :
                                                              
84EC 3C FE 84                                                 BCC     _UDI20
                                                              
84EF 15 FC FE                                                 LDA     R3.2            ; R1H = R3H
84F2 16 F4 FE                                                 STA     R1.2            ; :
84F5 15 FD FE                                                 LDA     R3.3            ; :
84F8 16 F5 FE                                                 STA     R1.3            ; :
                                                              
84FB 2E F2 FE                                                 INW     R1.0            ; R1L++
                                                              
84FE 27 FE FE                                         _UDI20: DEB     BC              ; All bits done?
8501 3A B2 84                                                 BNE     _UDI10          ; NO: Loop again
                                                              
8504 39                                                       RTS
                                                      
                                                      ; INCLUDE         inner.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; INNER INTERPRETER
                                                      
8505 2F EC FE                                         IPUSH:  DEW     SP              ; -(SP) = R1H
8508 15 F5 FE                                                 LDA     R1.3
850B 1E EC FE                                                 STR     SP
850E 2F EC FE                                                 DEW     SP
8511 15 F4 FE                                                 LDA     R1.2
8514 1E EC FE                                                 STR     SP
8517 2F EC FE                                         PUSH:   DEW     SP              ; -(SP) = R1L
851A 15 F3 FE                                                 LDA     R1.1
851D 1E EC FE                                                 STR     SP
8520 2F EC FE                                                 DEW     SP
8523 15 F2 FE                                                 LDA     R1.0
8526 1E EC FE                                                 STR     SP
8529 1D E8 FE                                         NEXT:   LDR     IP              ; WA = (IP)+
852C 16 EA FE                                                 STA     WA.0
852F 2E E8 FE                                                 INW     IP
8532 1D E8 FE                                                 LDR     IP
8535 16 EB FE                                                 STA     WA.1
8538 2E E8 FE                                                 INW     IP
853B 1D EA FE                                         NEXT10: LDR     WA              ; R1 = (WA)+
853E 16 F2 FE                                                 STA     R1.0
8541 2E EA FE                                                 INW     WA
8544 1D EA FE                                                 LDR     WA
8547 16 F3 FE                                                 STA     R1.1
854A 2E EA FE                                                 INW     WA
854D 15 47 83                                                 LDA     DBG
8550 11 00                                                    CPI     0
8552 3B 58 85                                                 BEQ     NEXT11
8555 38 7E 83                                                 JPS     DEBUG
8558 1C F2 FE                                         NEXT11: JPR     R1              ; jump @(R1)
                                                      
                                                      ; ------------------------------
                                                      ;       Push TRUE and FALSE
                                                      
855B 2C F2 FE                                         PUSHT:  CLW     R1              ; A zero
855E 2F F2 FE                                                 DEW     R1              ; Make it into a -1 i.e. TRUE flag
8561 14 17 85                                                 JPA     PUSH
                                                      
8564 2C F2 FE                                         PUSHF:  CLW     R1              ; A zero
8567 14 17 85                                                 JPA     PUSH
                                                      
                                                      ; ------------------------------
                                                      ;       Push R1X, MSB as TOS
                                                      
856A 2F EC FE                                         DPUSH:  DEW     SP              ; -(SP) = R1X
856D 15 F3 FE                                                 LDA     R1.1
8570 1E EC FE                                                 STR     SP
8573 2F EC FE                                                 DEW     SP
8576 15 F2 FE                                                 LDA     R1.0
8579 1E EC FE                                                 STR     SP
857C 2F EC FE                                                 DEW     SP
857F 15 F5 FE                                                 LDA     R1.3
8582 1E EC FE                                                 STR     SP
8585 2F EC FE                                                 DEW     SP
8588 15 F4 FE                                                 LDA     R1.2
858B 1E EC FE                                                 STR     SP
858E 14 29 85                                                 JPA     NEXT
                                                      
                                                      ; INCLUDE         primaries.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; FORTH PRIMARIES
                                                      ;
                                                      
8591 83 4C 49 D4                                      HLIT:   DB      ^3 "LI" ^'T'                            ; ***** LIT
8595 00 00                                                    DW      0
8597 99 85                                            LIT:    DW      LIT0
8599 38 2A 80                                         LIT0:   JPS     _LIT            ; R1 = (IP)+
859C 14 17 85                                                 JPA     PUSH            ; -(SP) = R1; NEXT
                                                      
859F 87 45 58 45 43 55 54 C5                          HEXEC:  DB      ^7 "EXECUT" ^'E'                        ; ***** EXECUTE
85A7 91 85                                                    DW      HLIT
85A9 AB 85                                            EXEC:   DW      EXEC0
85AB 1D EC FE                                         EXEC0:  LDR     SP              ; WA = (SP)+
85AE 16 EA FE                                                 STA     WA.0
85B1 2E EC FE                                                 INW     SP
85B4 1D EC FE                                                 LDR     SP
85B7 16 EB FE                                                 STA     WA.1
85BA 2E EC FE                                                 INW     SP
85BD 14 3B 85                                                 JPA     NEXT10          ; jump @(WA)+
                                                      
85C0 86 42 52 41 4E 43 C8                             HBRAN:  DB      ^6 "BRANC" ^'H'                         ; ***** BRANCH
85C7 9F 85                                                    DW      HEXEC
85C9 CB 85                                            BRAN:   DW      BRAN0
85CB 38 3D 80                                         BRAN0:  JPS     _BRAN           ; IP = IP + (IP)
85CE 14 29 85                                                 JPA     NEXT
                                                      
85D1 87 30 42 52 41 4E 43 C8                          HZBRAN: DB      ^7 "0BRANC" ^'H'                        ; ***** 0BRANCH
85D9 C0 85                                                    DW      HBRAN
85DB DD 85                                            ZBRAN:  DW      ZBRAN0
85DD 1D EC FE                                         ZBRAN0: LDR     SP
85E0 11 00                                                    CPI     0               ; Low byte non-zero?
85E2 3A F6 85                                                 BNE     ZBRA10          ; YES: Do not branch
85E5 2E EC FE                                                 INW     SP
85E8 1D EC FE                                                 LDR     SP
85EB 11 00                                                    CPI     0               ; High byte non-zero?
85ED 3A F9 85                                                 BNE     ZBRA20          ; YES: Do not branch
85F0 2E EC FE                                                 INW     SP
85F3 14 CB 85                                                 JPA     BRAN0           ; IP = IP + (IP); NEXT
85F6 2E EC FE                                         ZBRA10: INW     SP
85F9 2E EC FE                                         ZBRA20: INW     SP
85FC 2E E8 FE                                                 INW     IP              ; Just skip jump offset
85FF 2E E8 FE                                                 INW     IP
8602 14 29 85                                                 JPA     NEXT
                                                      
8605 87 28 2B 4C 4F 4F 50 A9                          HXPLOO: DB      ^7 "(+LOOP" ^')'                        ; ***** (+LOOP)
860D D1 85                                                    DW      HZBRAN
860F 11 86                                            XPLOO:  DW      XPLOO0
8611 38 AF 80                                         XPLOO0: JPS     _GET2           ; R2 = (SP) [only copying increment]
8614 38 1E 81                                                 JPS     _RPOP1          ; R1 = (RP)+
8617 38 15 82                                                 JPS     _ADD16          ; R1 = counter'
861A 38 35 81                                                 JPS     _RGET2          ; R2 = limit
861D 38 D2 81                                                 JPS     _RPUSH1         ; -(RP) = R1'
8620 38 F9 80                                                 JPS     _POP3           ; R3 = (SP)+ [now popping incr]
8623 15 FB FE                                                 LDA     R3.1            ; Is increment negative?
8626 11 00                                                    CPI     0               ; :
8628 3E 2E 86                                                 BPL     XPLO10
                                                              ; Handle negative increment
862B 38 18 83                                                 JPS     _XCH16          ; R1 <-> R2
                                                              ; Compare counter to limit
862E 15 F3 FE                                         XPLO10: LDA     R1.1            ; Compare MSB
8631 19 F7 FE                                                 CPA     R2.1            ; :
8634 3F CB 85                                                 BMI     BRAN0           ; R2 is greater, continue looping
8637 3B 3D 86                                                 BEQ     XPLO20          ; MSBs are equal, check LSBs
863A 14 46 86                                                 JPA     XPLO30          ; R1 is greater, stop looping
                                                              ; MSBs are equal
863D 15 F2 FE                                         XPLO20: LDA     R1.0            ; Compare LSB
8640 19 F6 FE                                                 CPA     R2.0            
8643 3F CB 85                                                 BMI     BRAN0           ; R2 is greater, continue looping
                                                              ; Limit reached, cleanup rstack and stop looping
8646 0E 04                                            XPLO30: LDI     4               ; Drop loop counter ...
8648 30 EE FE                                                 ADW     RP              ; ... and loop limit
864B 0E 02                                                    LDI     2               ; Skip branch offset
864D 30 E8 FE                                                 ADW     IP              ; :
8650 14 29 85                                                 JPA     NEXT
                                                      
8653 86 28 4C 4F 4F 50 A9                             HXLOOP: DB      ^6 "(LOOP" ^')'                         ; ***** (LOOP)
865A 05 86                                                    DW      HXPLOO
865C 5E 86                                            XLOOP:  DW      XLOOP0
865E 2C F2 FE                                         XLOOP0: CLW     R1              ; Push a one
8661 2E F2 FE                                                 INW     R1              ; :
8664 38 78 81                                                 JPS     _PUSH1          ; :
8667 14 11 86                                                 JPA     XPLOO0          ; (+LOOP)
                                                      
866A 84 28 44 4F A9                                   HXDO:   DB      ^4 "(DO" ^')'                           ; ***** (DO)
866F 53 86                                                    DW      HXLOOP
8671 73 86                                            XDO:    DW      XDO0
8673 38 00 81                                         XDO0:   JPS     _POP21          ; Loop counter, limit
8676 38 D2 81                                                 JPS     _RPUSH1         ; Push limit onto rstack
8679 38 F0 81                                                 JPS     _RPUSH2         ; Push loop counter onto rstack
867C 14 29 85                                                 JPA     NEXT
                                                      
867F 81 C9                                            HI:     DB      ^1 ^'I'                                 ; ***** I
8681 6A 86                                                    DW      HXDO
8683 85 86                                            I:      DW      I0
8685 38 17 81                                         I0:     JPS     _RGET1          ; Get loop counter
8688 14 17 85                                                 JPA     PUSH            ; Push it onto dstack
                                                      
868B 85 44 49 47 49 D4                                HDIGIT: DB      ^5 "DIGI" ^'T'                          ; ***** DIGIT
8691 7F 86                                                    DW      HI
8693 95 86                                            DIGIT:  DW      DIGIT0
8695 38 00 81                                         DIGIT0: JPS     _POP21          ; R2 = base, R1 = char
8698 15 F2 FE                                                 LDA     R1.0            ; Get character into A
869B 10 30                                                    SBI     '0'             ; Assume '0' - '9'
869D 3F B9 86                                                 BMI     DIGI88          ; Oops! Negative
86A0 11 0A                                                    CPI     10              ; Greater than 9?
86A2 3F A7 86                                                 BMI     DIGI10          ; No, it is 0 - 9
                                                              ; 'A' - 'Z' case
86A5 10 07                                                    SBI     7               ; ch -= ('A' - '0') + 10
86A7 19 F6 FE                                         DIGI10: CPA     R2.0            ; Greater than base?
86AA 3F B0 86                                                 BMI     DIGI77
86AD 14 B9 86                                                 JPA     DIGI88
86B0 16 F2 FE                                         DIGI77: STA     R1.0            ; Store binary value
86B3 38 78 81                                                 JPS     _PUSH1          ; Push the value
86B6 14 5B 85                                                 JPA     PUSHT           ; Push TRUE; NEXT
86B9 14 64 85                                         DIGI88: JPA     PUSHF           ; Push FALSE; NEXT
                                                      
86BC 86 28 46 49 4E 44 A9                             HPFIND: DB      ^6 "(FIND" ^')'                         ; ***** (FIND)
86C3 8B 86                                                    DW      HDIGIT
86C5 C7 86                                            PFIND:  DW      PFIND0
86C7 38 73 80                                         PFIND0: JPS     _POP1           ; NFA
86CA 38 F9 80                                                 JPS     _POP3           ; String address
86CD 15 FA FE                                         PFIN10: LDA     R3.0            ; R2 = R3 (string address)
86D0 16 F6 FE                                                 STA     R2.0            ; :
86D3 15 FB FE                                                 LDA     R3.1            ; :
86D6 16 F7 FE                                                 STA     R2.1            ; :
                                                              ; Fast comparison of length bytes
86D9 1D F2 FE                                                 LDR     R1              ; Get lByte
86DC 16 F4 FE                                                 STA     R1.2            ; ... Store as potential result
86DF 05                                                       LSL                     ; lByte &= 0x3F
86E0 05                                                       LSL                     ; :
86E1 07                                                       LSR                     ; :
86E2 07                                                       LSR                     ; :
86E3 16 F8 FE                                                 STA     R2.2            ; R2.2 is counter for string match
86E6 21 F6 FE                                                 CPR     R2              ; lByte == string length?
86E9 3A 08 87                                                 BNE     PFIN25
                                                              ; Length bytes match, check names
86EC 2E F2 FE                                         PFIN20: INW     R1              ; Bump pointers
86EF 2E F6 FE                                                 INW     R2              ; :
86F2 1D F2 FE                                                 LDR     R1              ; Get char from dictionary
86F5 05                                                       LSL                     ; char &= 0x7F
86F6 07                                                       LSR
86F7 21 F6 FE                                                 CPR     R2              ; Is it a match with search string?
86FA 3A 0B 87                                                 BNE     PFIN30          ; NO: Look at next header in dictionary
86FD 27 F8 FE                                                 DEB     R2.2            ; Decrement character counter
8700 11 00                                                    CPI     0               ; :
8702 3B 2C 87                                                 BEQ     PFIN77          ; YES: This is the word we are looking for
8705 14 EC 86                                                 JPA     PFIN20          ; Match so far, try next char
                                                              ; Step to next header in dictionary
8708 2E F2 FE                                         PFIN25: INW     R1              ; Bump NFA pointer to actual characters
870B 2E F2 FE                                         PFIN30: INW     R1              ; Bump NFA pointer
870E 27 F8 FE                                                 DEB     R2.2            ; Decrement character counter
8711 11 00                                                    CPI     0               ; End of name field?
8713 3A 0B 87                                                 BNE     PFIN30          ; NO: Step to next char
8716 38 2B 83                                                 JPS     _AT             ; R1 = (R1)
8719 15 F3 FE                                                 LDA     R1.1            ; At end of dictionary?
871C 11 00                                                    CPI     0               ; :
871E 3A CD 86                                                 BNE     PFIN10          ; NO: Try this word for match
8721 15 F2 FE                                                 LDA     R1.0            ; :
8724 11 00                                                    CPI     0               ; :
8726 3A CD 86                                                 BNE     PFIN10          ; NO: Try this word for match
                                                              ; Word not found, return a single FALSE
8729 14 64 85                                         PFIN88: JPA     PUSHF           ; Done
                                                              ; Word found, return PFA, lByte, TRUE
872C 0E 05                                            PFIN77: LDI     5               ; Bump ptr to PFA
872E 30 F2 FE                                                 ADW     R1              ; :
8731 38 78 81                                                 JPS     _PUSH1          ; Push PFA
8734 15 F4 FE                                                 LDA     R1.2            ; Get stored length byte
8737 16 F2 FE                                                 STA     R1.0            ; :
873A 24 F3 FE                                                 CLB     R1.1            ; Clear MSB
873D 38 78 81                                                 JPS     _PUSH1          ; Push length byte
8740 14 5B 85                                                 JPA     PUSHT           ; Done
                                                      
8743 87 45 4E 43 4C 4F 53 C5                          HENCL:  DB      ^7 "ENCLOS" ^'E'                        ; ***** ENCLOSE
874B BC 86                                                    DW      HPFIND
874D 4F 87                                            ENCL:   DW      ENCL0
874F 38 F9 80                                         ENCL0:  JPS     _POP3           ; Get delimiter char
8752 38 6C 80                                                 JPS     _GET1           ; Get addr of input
8755 2C F6 FE                                                 CLW     R2              ; Initialize char index
                                                              ; Scan preceeding delimiters
8758 1D F2 FE                                         ENCL10: LDR     R1              ; Get char from input
875B 11 00                                                    CPI     0               ; Is it <NUL>?
875D 3B 95 87                                                 BEQ     ENCL50          ; YES: <NUL> before first non-delimiter
8760 19 FA FE                                                 CPA     R3.0            ; Is it a delimiter?
8763 3A 6F 87                                                 BNE     ENCL20          ; NO: We have the start of next token
8766 2E F2 FE                                                 INW     R1              ; Bump to next char ...
8769 26 F6 FE                                                 INB     R2.0            ; ... also increase index
876C 14 58 87                                                 JPA     ENCL10          ; Go back to look at next char
                                                              ; Start of token
876F 38 96 81                                         ENCL20: JPS     _PUSH2          ; Push result n1 (first char of token)
8772 1D F2 FE                                         ENCL30: LDR     R1              ; Get char from input
8775 11 00                                                    CPI     0               ; Is it <NUL>?
8777 3B A4 87                                                 BEQ     ENCL60          ; YES: <NUL> found
877A 19 FA FE                                                 CPA     R3.0            ; Is it a delimiter?
877D 3B 89 87                                                 BEQ     ENCL40          ; YES: We have the end of the token
8780 2E F2 FE                                                 INW     R1              ; Bump to next char ...
8783 26 F6 FE                                                 INB     R2.0            ; ... also increase index
8786 14 72 87                                                 JPA     ENCL30          ; Go back to look at next char
                                                              ; End of token
8789 38 96 81                                         ENCL40: JPS     _PUSH2          ; Push result n2 (ending delimiter)
878C 26 F6 FE                                                 INB     R2.0            ; Also push n3 ...
878F 38 96 81                                                 JPS     _PUSH2          ; : ... (index to first non-scanned char)
8792 14 29 85                                                 JPA     NEXT            ; Done
                                                              ; <NUL> appears before token
8795 26 F6 FE                                         ENCL50: INB     R2.0            ; Push i + 1
8798 38 96 81                                                 JPS     _PUSH2          ; :
879B 27 F6 FE                                                 DEB     R2.0            ; Push i
879E 38 96 81                                                 JPS     _PUSH2          ; : ... indicating <NUL> before token
87A1 14 29 85                                                 JPA     NEXT            ; Done
                                                              ; Token ends with a <NUL>
87A4 38 96 81                                         ENCL60: JPS     _PUSH2          ; Push i twice to indicate ...
87A7 38 96 81                                                 JPS     _PUSH2          ; : ... that token ends in a <NUL>
87AA 14 29 85                                                 JPA     NEXT            ; Done
                                                      
87AD 84 45 4D 49 D4                                   HEMIT:  DB      ^4 "EMI" ^'T'                           ; ***** EMIT
87B2 43 87                                                    DW      HENCL
87B4 B6 87                                            EMIT:   DW      EMIT0
87B6 38 73 80                                         EMIT0:  JPS     _POP1           ; Get character
87B9 15 F2 FE                                                 LDA     R1.0            ; Send char to terminal
87BC 02                                                       OUT                     ;
87BD 14 29 85                                                 JPA     NEXT            ; Done
                                                      
87C0 83 4B 45 D9                                      HKEY:   DB      ^3 "KE" ^'Y'                            ; ***** KEY
87C4 AD 87                                                    DW      HEMIT
87C6 C8 87                                            KEY:    DW      KEY0
87C8 0A                                               KEY0:   INP                     ; Get char form terminal
87C9 11 FF                                                    CPI     0xFF            ; Did we get a character?
87CB 3B C8 87                                                 BEQ     KEY0            ; NO: Try again
87CE 16 F2 FE                                                 STA     R1.0            ; YES: Push character
87D1 24 F3 FE                                                 CLB     R1.1            ; :
87D4 14 17 85                                                 JPA     PUSH            ; Push R1; NEXT
                                                      
87D7 89 3F 54 45 52 4D 49 4E 41 CC                    HQTERM: DB      ^9 "?TERMINA" ^'L'                      ; ***** ?TERMINAL
87E1 C0 87                                                    DW      HKEY
87E3 E5 87                                            QTERM:  DW      QTERM0
87E5 2C F2 FE                                         QTERM0: CLW     R1              ; Default FALSE to return
87E8 0A                                                       INP                     ; Get char from terminal
87E9 11 FF                                                    CPI     0xFF            ; Did we get a character?
87EB 3B F1 87                                                 BEQ     QTER10          ; NO: Return FALSE
87EE 2F F2 FE                                                 DEW     R1              ; Make default FALSE into TRUE
87F1 14 17 85                                         QTER10: JPA     PUSH            ; Push R1; NEXT
                                                      
87F4 82 43 D2                                         HCR:    DB      ^2 "C" ^'R'                             ; ***** CR
87F7 D7 87                                                    DW      HQTERM
87F9 E9 8A 97 85 0D 00 B4 87 97 85 0A 00 B4 87 25 89  CR:     DW      DOCOL LIT 13 EMIT LIT 10 EMIT SEMIS
                                                      
8809 83 52 2F D7                                      HRW:    DB      ^3 "R/" ^'W'                            ; ***** R/W
880D F4 87                                                    DW      HCR
880F 11 88                                            RW:     DW      RW0
8811 38 F9 80                                         RW0:    JPS     _POP3           ; 1:read 0:write
8814 38 00 81                                                 JPS     _POP21          ; R2:block# R1:addr
8817 14 29 85                                                 JPA     NEXT
                                                      
881A 85 43 4D 4F 56 C5                                HCMOVE: DB      ^5 "CMOV" ^'E'                          ; ***** CMOVE
8820 09 88                                                    DW      HRW
8822 24 88                                            CMOVE:  DW      CMOVE0
8824 38 F9 80                                         CMOVE0: JPS     _POP3           ; R3 = count
8827 38 00 81                                                 JPS     _POP21          ; R2 = dst, R1 = src
882A 1D F2 FE                                         CMOV10: LDR     R1              ; Get byte from source
882D 1E F6 FE                                                 STR     R2              ; Store to destination
8830 2E F2 FE                                                 INW     R1              ; Bump source pointer
8833 2E F6 FE                                                 INW     R2              ; Bump destination pointer
8836 2F FA FE                                                 DEW     R3              ; Decrement count
8839 3A 3F 88                                                 BNE     CMOV20          ; Count zero: We are done
883C 14 2A 88                                                 JPA     CMOV10          ; Count non-zero: Next byte
883F 14 29 85                                         CMOV20: JPA     NEXT            ; Done
                                                      
8842 82 55 AA                                         HUSTAR: DB      ^2 "U" ^'*'                             ; ***** U*
8845 1A 88                                                    DW      HCMOVE
8847 49 88                                            USTAR:  DW      USTAR0
8849 38 00 81                                         USTAR0: JPS     _POP21          ; R2 = oper2, R1 = oper1
884C 38 49 84                                                 JPS     _UMULT          ; u32 = u16 * u16
884F 14 6A 85                                                 JPA     DPUSH           ; Done
                                                      
8852 82 55 AF                                         HUSLAS: DB      ^2 "U" ^'/'                             ; ***** U/
8855 42 88                                                    DW      HUSTAR
8857 59 88                                            USLAS:  DW      USLAS0
8859 38 00 81                                         USLAS0: JPS     _POP21          ; R2 = divisor, R1 = dividend-hi
885C 15 F2 FE                                                 LDA     R1.0            ; Move high part to R1.2 and R1.3
885F 16 F4 FE                                                 STA     R1.2            ; :
8862 15 F3 FE                                                 LDA     R1.1            ; :
8865 16 F5 FE                                                 STA     R1.3            ; :
8868 38 73 80                                                 JPS     _POP1           ; dividend, low 16b
886B 38 AD 84                                                 JPS     _UDIV           ; u32 / u16 --> quot_u16, rem_u16
886E 14 05 85                                                 JPA     IPUSH           ; Push R1H; Push R1L; NEXT
                                                      
8871 83 41 4E C4                                      HAND:   DB      ^3 "AN" ^'D'                            ; ***** AND
8875 52 88                                                    DW      HUSLAS
8877 79 88                                            AND:    DW      AND0
8879 38 00 81                                         AND0:   JPS     _POP21          ; R2 = oper2, R1 = oper1
887C 38 22 84                                                 JPS     _AND16          ; R1 = R1 & R2
887F 14 17 85                                                 JPA     PUSH            ; Done
                                                      
8882 82 4F D2                                         HOR:    DB      ^2 "O" ^'R'                             ; ***** OR
8885 71 88                                                    DW      HAND
8887 89 88                                            OR:     DW      OR0
8889 38 00 81                                         OR0:    JPS     _POP21          ; R2 = oper2, R1 = oper1
888C 38 2F 84                                                 JPS     _OR16           ; R1 = R1 | R2
888F 14 17 85                                                 JPA     PUSH            ; Done
                                                      
8892 83 58 4F D2                                      HXOR:   DB      ^3 "XO" ^'R'                            ; ***** XOR
8896 82 88                                                    DW      HOR
8898 9A 88                                            XOR:    DW      XOR0
889A 38 00 81                                         XOR0:   JPS     _POP21          ; R2 = oper2, R1 = oper1
889D 38 3C 84                                                 JPS     _XOR16          ; R1 = R1 ^ R2
88A0 14 17 85                                                 JPA     PUSH            ; Done
                                                      
88A3 83 53 50 C0                                      HSPAT:  DB      ^3 "SP" ^'@'                            ; ***** SP@
88A7 92 88                                                    DW      HXOR
88A9 AB 88                                            SPAT:   DW      SPAT0
88AB 15 EC FE                                         SPAT0:  LDA     SP.0            ; Get stack pointer
88AE 16 F2 FE                                                 STA     R1.0            ; : into R1
88B1 15 ED FE                                                 LDA     SP.1            ; :
88B4 16 F3 FE                                                 STA     R1.1            ; :
88B7 14 17 85                                                 JPA     PUSH            ; Push R1; NEXT
                                                      
88BA 83 53 50 A1                                      HSPSTO: DB      ^3 "SP" ^'!'                            ; ***** SP!
88BE A3 88                                                    DW      HSPAT
88C0 C2 88                                            SPSTO:  DW      SPSTO0
88C2 0E 12                                            SPSTO0: LDI     18              ; Index of SP0
88C4 16 F6 FE                                                 STA     R2.0            ; : in boot table
88C7 38 D9 83                                                 JPS     _PORIG          ; R1 = &bootTable[R2]
88CA 38 2B 83                                                 JPS     _AT             ; R1 = (R1)
88CD 15 F2 FE                                                 LDA     R1.0            ; SP = R1
88D0 16 EC FE                                                 STA     SP.0            ; :
88D3 15 F3 FE                                                 LDA     R1.1            ; :
88D6 16 ED FE                                                 STA     SP.1            ; :
88D9 14 29 85                                                 JPA     NEXT            ; Done
                                                      
88DC 83 52 50 A1                                      HRPSTO: DB      ^3 "RP" ^'!'                            ; ***** RP!
88E0 BA 88                                                    DW      HSPSTO
88E2 E4 88                                            RPSTO:  DW      RPSTO0
88E4 0E 14                                            RPSTO0: LDI     20              ; Index of SP0
88E6 16 F6 FE                                                 STA     R2.0            ; : in boot table
88E9 38 D9 83                                                 JPS     _PORIG          ; R1 = &bootTable[R2]
88EC 38 2B 83                                                 JPS     _AT             ; R1 = XRP
88EF 15 F2 FE                                                 LDA     R1.0            ; SP = R1
88F2 16 EE FE                                                 STA     RP.0            ; :
88F5 15 F3 FE                                                 LDA     R1.1            ; :
88F8 16 EF FE                                                 STA     RP.1            ; :
88FB 14 29 85                                                 JPA     NEXT            ; Done
                                                      
88FE 83 55 50 A1                                      HUPSTO: DB      ^3 "UP" ^'!'                            ; ***** UP!
8902 DC 88                                                    DW      HRPSTO
8904 06 89                                            UPSTO:  DW      UPSTO0
8906 0E 10                                            UPSTO0: LDI     16              ; Index of UP0
8908 16 F6 FE                                                 STA     R2.0            ; : in boot table
890B 38 D9 83                                                 JPS     _PORIG          ; R1 = &bootTable[R2]
890E 38 2B 83                                                 JPS     _AT             ; R1 = XUP
8911 15 F2 FE                                                 LDA     R1.0            ; UP = R1
8914 16 F0 FE                                                 STA     UP.0            ; :
8917 15 F3 FE                                                 LDA     R1.1            ; :
891A 16 F1 FE                                                 STA     UP.1            ; :
891D 14 29 85                                                 JPA     NEXT            ; Done
                                                      
8920 82 3B D3                                         HSEMIS: DB      ^2 ";" ^'S'                             ; ***** ;S
8923 DC 88                                                    DW      HRPSTO
8925 27 89                                            SEMIS:  DW      SEMIS0
8927 1D EE FE                                         SEMIS0: LDR     RP              ; IP = (RP)+
892A 16 E8 FE                                                 STA     IP.0            ; :
892D 2E EE FE                                                 INW     RP              ; :
8930 1D EE FE                                                 LDR     RP              ; :
8933 16 E9 FE                                                 STA     IP.1            ; :
8936 2E EE FE                                                 INW     RP              ; :
8939 14 29 85                                                 JPA     NEXT            ; Done
                                                      
893C 85 4C 45 41 56 C5                                HLEAVE: DB      ^5 "LEAV" ^'E'                          ; ***** LEAVE
8942 20 89                                                    DW      HSEMIS
8944 46 89                                            LEAVE:  DW      LEAVE0
8946 38 1E 81                                         LEAVE0: JPS     _RPOP1          ; 2(RP) = (RP)
8949 38 CB 81                                                 JPS     _RPUT1          ; :
894C 38 D2 81                                                 JPS     _RPUSH1         ; :
894F 14 29 85                                                 JPA     NEXT
                                                      
8952 82 3E D2                                         HTOR:   DB      ^2 ">" ^'R'                             ; ***** >R
8955 3C 89                                                    DW      HLEAVE
8957 59 89                                            TOR:    DW      TOR0
8959 38 73 80                                         TOR0:   JPS     _POP1           ; -(RP) = (SP)+
895C 38 D2 81                                                 JPS     _RPUSH1         ; :
895F 14 29 85                                                 JPA     NEXT
                                                      
8962 82 52 BE                                         HFROMR: DB      ^2 "R" ^'>'                             ; ***** R>
8965 52 89                                                    DW      HTOR
8967 69 89                                            FROMR:  DW      FROMR0
8969 38 1E 81                                         FROMR0: JPS     _RPOP1          ; -(SP) = (RP)+
896C 14 17 85                                                 JPA     PUSH            ; :
                                                      
896F 81 D2                                            HR:     DB      ^1 ^'R'                                 ; ***** R
8971 62 89                                                    DW      HFROMR
8973 75 89                                            R:      DW      R0
8975 38 17 81                                         R0:     JPS     _RGET1          ; -(SP) = (RP)
8978 14 17 85                                                 JPA     PUSH            ; :
                                                      
897B 82 30 BD                                         HZEQU:  DB      ^2 "0" ^'='                             ; ***** 0=
897E 6F 89                                                    DW      HR
8980 82 89                                            ZEQU:   DW      ZEQU0
8982 1D EC FE                                         ZEQU0:  LDR     SP              ; Get low byte
8985 11 00                                                    CPI     0               ; Is it zero?
8987 3A 9B 89                                                 BNE     ZEQU10          ; NO: Return FALSE
898A 2E EC FE                                                 INW     SP              ; YES: Have to inspect
898D 1D EC FE                                                 LDR     SP              ; : high byte as well
8990 11 00                                                    CPI     0               ; Is it zero?
8992 3A 9E 89                                                 BNE     ZEQU20          ; NO: Return FALSE
8995 2E EC FE                                                 INW     SP              ; Make POP complete
8998 14 5B 85                                                 JPA     PUSHT           ; YES: Return TRUE
899B 2E EC FE                                         ZEQU10: INW     SP              ; POP argument off dstack
899E 2E EC FE                                         ZEQU20: INW     SP              ; : Make POP complete
89A1 14 64 85                                                 JPA     PUSHF           ; Return FALSE
                                                      
89A4 82 30 BC                                         HZLESS: DB      ^2 "0" ^'<'                             ; ***** 0<
89A7 7B 89                                                    DW      HZEQU
89A9 AB 89                                            ZLESS:  DW      ZLESS0
89AB 2E EC FE                                         ZLESS0: INW     SP              ; Inspect high byte only
89AE 1D EC FE                                                 LDR     SP              ; Get high byte
89B1 11 00                                                    CPI     0               ; Is high byte negative?
89B3 3F BC 89                                                 BMI     ZLES10          ; YES: Return TRUE
89B6 2E EC FE                                                 INW     SP              ; NO: POP high byte also
89B9 14 64 85                                                 JPA     PUSHF           ; Return FALSE
89BC 2E EC FE                                         ZLES10: INW     SP              ; POP high byte also
89BF 14 5B 85                                                 JPA     PUSHT           ; Return TRUE
                                                      
89C2 81 AB                                            HPLUS:  DB      ^1 ^'+'                                 ; ***** +
89C4 A4 89                                                    DW      HZLESS
89C6 C8 89                                            PLUS:   DW      PLUS0
89C8 38 00 81                                         PLUS0:  JPS     _POP21          ; R2 = oper2, R1 = oper1
89CB 38 15 82                                                 JPS     _ADD16          ; R1 = R1 + R2
89CE 14 17 85                                                 JPA     PUSH            ; -(SP) = R1; NEXT
                                                      
89D1 82 44 AB                                         HDPLUS: DB      ^2 "D" ^'+'                             ; ***** D+
89D4 C2 89                                                    DW      HPLUS
89D6 D8 89                                            DPLUS:  DW      DPLUS0
89D8 38 BD 80                                         DPLUS0: JPS     _DPOP2          ; Get second operand
89DB 38 7A 80                                                 JPS     _DPOP1          ; Get first operand
89DE 38 22 82                                                 JPS     _ADD32          ; R1X = R1X + R2X
89E1 14 6A 85                                                 JPA     DPUSH           ; -(SP) = R1X; NEXT
                                                      
89E4 85 4D 49 4E 55 D3                                HMINUS: DB      ^5 "MINU" ^'S'                          ; ***** MINUS
89EA D1 89                                                    DW      HDPLUS
89EC EE 89                                            MINUS:  DW      MINUS0
89EE 38 73 80                                         MINUS0: JPS     _POP1           ; Get operand
89F1 38 F7 82                                                 JPS     _NEG16          ; Negate
89F4 14 17 85                                                 JPA     PUSH
                                                      
89F7 86 44 4D 49 4E 55 D3                             HDMINU: DB      ^6 "DMINU" ^'S'                         ; ***** DMINUS
89FE E4 89                                                    DW      HMINUS
8A00 02 8A                                            DMINU:  DW      DMINU0
8A02 38 7A 80                                         DMINU0: JPS     _DPOP1          ; Get operand
8A05 38 05 83                                                 JPS     _NEG32          ; Negate
8A08 14 6A 85                                                 JPA     DPUSH
                                                      
8A0B 84 4F 56 45 D2                                   HOVER:  DB      ^4 "OVE" ^'R'                           ; **** OVER
8A10 F7 89                                                    DW      HDMINU
8A12 14 8A                                            OVER:   DW      OVER0
8A14 38 B6 80                                         OVER0:  JPS     _POP2           ; n1 n2 -- n1 n2 n1
8A17 38 6C 80                                                 JPS     _GET1           ; :
8A1A 38 96 81                                                 JPS     _PUSH2          ; :
8A1D 14 17 85                                                 JPA     PUSH            ; :
                                                      
8A20 84 44 52 4F D0                                   HDROP:  DB      ^4 "DRO" ^'P'                           ; **** DROP
8A25 0B 8A                                                    DW      HOVER
8A27 29 8A                                            DROP:   DW      DROP0
8A29 2E EC FE                                         DROP0:  INW     SP              ; n1 --
8A2C 2E EC FE                                                 INW     SP              ; :
8A2F 14 29 85                                                 JPA     NEXT            ; Done
                                                      
8A32 84 53 57 41 D0                                   HSWAP:  DB      ^4 "SWA" ^'P'                           ; **** SWAP
8A37 20 8A                                                    DW      HDROP
8A39 14 8A                                            SWAP:   DW      OVER0
8A3B 38 00 81                                         SWAP0:  JPS     _POP21          ; n1 n2 -- n2 n1
8A3E 38 96 81                                                 JPS     _PUSH2          ; :
8A41 14 17 85                                                 JPA     PUSH            ; :
                                                      
8A44 83 44 55 D0                                      HDUP:   DB      ^3 "DU" ^'P'                            ; **** DUP
8A48 32 8A                                                    DW      HSWAP
8A4A 4C 8A                                            DUP:    DW      DUP0
8A4C 38 6C 80                                         DUP0:   JPS     _GET1           ; n1 -- n1 n1
8A4F 14 17 85                                                 JPA     PUSH            ; :
                                                      
8A52 82 2B A1                                         HPSTOR: DB      ^2 "+" ^'!'                             ; ***** +!
8A55 44 8A                                                    DW      HDUP
8A57 58                                               PSTOR:  DB      PSTOR0
8A58 38 F9 80                                         PSTOR0: JPS     _POP3           ; R3 = addr
8A5B 38 B6 80                                                 JPS     _POP2           ; R2 = incr
8A5E 38 3B 82                                                 JPS     _LD16           ; R1 = (R3)
8A61 38 15 82                                                 JPS     _ADD16          ; R1 = R1 + R2
8A64 38 4E 82                                                 JPS     _ST16           ; (R3) = R1
8A67 14 29 85                                                 JPA     NEXT            ; Done
                                                      
8A6A 86 54 4F 47 47 4C C5                             HTOGGL: DB      ^6 "TOGGL" ^'E'                         ; ***** TOGGLE
8A71 52 8A                                                    DW      HPSTOR
8A73 75 8A                                            TOGGL:  DW      TOGGL0
8A75 38 B6 80                                         TOGGL0: JPS     _POP2           ; R2 = bit mask
8A78 38 F9 80                                                 JPS     _POP3           ; R3 = addr
8A7B 38 3B 82                                                 JPS     _LD16           ; R1 = (R3)
8A7E 38 3C 84                                                 JPS     _XOR16          ; R1 = R1 ^ R2
8A81 38 4E 82                                                 JPS     _ST16           ; (R3) = R1
8A84 14 29 85                                                 JPA     NEXT            ; Done
                                                      
8A87 81 C0                                            HAT:    DB      ^1 ^'@'                                 ; ***** @
8A89 6A 8A                                                    DW      HTOGGL
8A8B 8D 8A                                            AT:     DW      AT0
8A8D 38 F9 80                                         AT0:    JPS     _POP3           ; R3 = addr
8A90 38 3B 82                                                 JPS     _LD16           ; R1 = (R3)
8A93 14 17 85                                                 JPA     PUSH            ; -(SP) = R1; NEXT
                                                      
8A96 82 43 C0                                         HCAT:   DB      ^2 "C" ^'@'                             ; ***** C@
8A99 87 8A                                                    DW      HAT
8A9B 9D 8A                                            CAT:    DW      CAT0
8A9D 2C F2 FE                                         CAT0:   CLW     R1              ; R1 = 0
8AA0 38 F9 80                                                 JPS     _POP3           ; R3 = addr
8AA3 1D FA FE                                                 LDR     R3              ; A = (R3)
8AA6 16 F2 FE                                                 STA     R1.0            ; R1 = A
8AA9 14 17 85                                                 JPA     PUSH            ; -(SP) = R1; NEXT
                                                      
8AAC 81 A1                                            HSTORE: DB      ^1 ^'!'                                 ; ***** !
8AAE 96 8A                                                    DW      HCAT
8AB0 B2 8A                                            STORE:  DW      STORE0
8AB2 38 F9 80                                         STORE0: JPS     _POP3           ; R3 = addr
8AB5 38 73 80                                                 JPS     _POP1           ; R1 = data
8AB8 38 4E 82                                                 JPS     _ST16           ; (R3) = R1
8ABB 14 29 85                                                 JPA     NEXT            ; Done
                                                      
8ABE 82 43 A1                                         HCSTOR: DB      ^2 "C" ^'!'                             ; ***** C!
8AC1 AC 8A                                                    DW      HSTORE
8AC3 C5 8A                                            CSTOR:  DW      CSTOR0
8AC5 38 00 81                                         CSTOR0: JPS     _POP21          ; R2 = addr, R1 = data
8AC8 15 F2 FE                                                 LDA     R1.0            ; A = R1.0
8ACB 1E F6 FE                                                 STR     R2              ; (R3) = A
8ACE 14 29 85                                                 JPA     NEXT            ; Done
                                                      
                                                      ; INCLUDE         precompiled.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; PRECOMPILED FORTH WORDS
                                                      ;
                                                      
8AD1 C1 BA                                            HCOLON: DB      ^^1 ^':'                                ; ***** :
8AD3 BE 8A                                                    DW      HCSTOR
8AD5 E9 8A 89 8E 44 8E AC 8C 8B 8A 9E 8C B0 8A        COLON:  DW      DOCOL QEXEC SCSP CURR AT CONT STORE
8AE3 AF 93 0E 8F 75 8F                                        DW      CREAT RBRAC PSCOD
8AE9 2F EE FE                                         DOCOL:  DEW     RP              ; -(RP) = IP
8AEC 15 E9 FE                                                 LDA     IP.1            ; :
8AEF 1E EE FE                                                 STR     RP              ; :
8AF2 2F EE FE                                                 DEW     RP              ; :
8AF5 15 E8 FE                                                 LDA     IP.0            ; :
8AF8 1E EE FE                                                 STR     RP              ; :
8AFB 15 EA FE                                                 LDA     WA.0            ; IP = WA
8AFE 16 E8 FE                                                 STA     IP.0            ; :
8B01 15 EB FE                                                 LDA     WA.1            ; :
8B04 16 E9 FE                                                 STA     IP.1            ; :
8B07 14 29 85                                                 JPA     NEXT
                                                      
8B0A C1 BB                                            HSEMI:  DB      ^^1 ^';'                                ; ***** ;
8B0C D1 8A                                                    DW      HCOLON
8B0E B3 8E EA 8E 25 89 23 8F 00 8F 25 89              SEMI:   DW      QCSP COMP SEMIS SMUDG LBRAC SEMIS
                                                      
8B1A 88 43 4F 4E 53 54 41 4E D4                       HCON:   DB      ^8 "CONSTAN" ^'T'                       ; ***** CONSTANT
8B23 0A 8B                                                    DW      HSEMI
8B25 E9 8A AF 93 23 8F 4A 8D 75 8F                    CON:    DW      DOCOL CREAT SMUDG COMMA PSCOD
8B2F 1D EA FE                                         DOCON:  LDR     WA              ; -(SP) = (WA)
8B32 16 F2 FE                                                 STA     R1.0            ; :
8B35 2E EA FE                                                 INW     WA              ; :
8B38 1D EA FE                                                 LDR     WA              ; :
8B3B 16 F3 FE                                                 STA     R1.1            ; :
8B3E 2F EA FE                                                 DEW     WA              ; :
8B41 14 17 85                                                 JPA     PUSH            ; Done
                                                      
8B44 88 56 41 52 49 41 42 4C C5                       HVAR:   DB      ^8 "VARIABL" ^'E'                       ; ***** VARIABLE
8B4D 1A 8B                                                    DW      HCON
8B4F E9 8A 25 8B 75 8F                                VAR:    DW      DOCOL CON PSCOD
8B55 2F EC FE                                         DOVAR:  DEW     SP              ; -(SP) = WA
8B58 15 EB FE                                                 LDA     WA.1            ; :
8B5B 1E EC FE                                                 STR     SP              ; :
8B5E 2F EC FE                                                 DEW     SP              ; :
8B61 15 EA FE                                                 LDA     WA.0            ; :
8B64 1E EC FE                                                 STR     SP              ; :
8B67 14 29 85                                                 JPA     NEXT            ; Done
                                                      
8B6A 84 55 53 45 D2                                   HUSER:  DB      ^4 "USE" ^'R'                           ; ***** USER
8B6F 44 8B                                                    DW      HVAR
8B71 E9 8A 25 8B 75 8F                                USER:   DW      DOCOL CON PSCOD
8B77 38 73 80                                         DOUSE:  JPS     _POP1           ; Get index
8B7A 15 F2 FE                                                 LDA     R1.0            ; Compute UP[index]
8B7D 17 F0 FE                                                 ADA     UP.0            ; :
8B80 16 F2 FE                                                 STA     R1.0            ; :
8B83 15 F3 FE                                                 LDA     R1.1            ; :
8B86 1A F1 FE                                                 ACA     UP.1            ; :
8B89 16 F3 FE                                                 STA     R1.1            ; :
8B8C 14 17 85                                                 JPA     PUSH            ; Push address; NEXT
                                                      
                                                      ; ------------------------------
                                                      ; PRECOMPILED CONSTANTS
                                                      
8B8F 81 B0                                            HZERO:  DB      ^1 ^'0'                                 ; ***** 0
8B91 6A 8B                                                    DW      HUSER
8B93 2F 8B 00 00                                      ZERO:   DW      DOCON 0
                                                      
8B97 81 B1                                            HONE:   DB      ^1 ^'1'                                 ; ***** 1
8B99 8F 8B                                                    DW      HZERO
8B9B 2F 8B 01 00                                      ONE:    DW      DOCON 1
                                                      
8B9F 81 B2                                            HTWO:   DB      ^1 ^'2'                                 ; ***** 2
8BA1 97 8B                                                    DW      HONE
8BA3 2F 8B 02 00                                      TWO:    DW      DOCON 2
                                                      
8BA7 81 B3                                            HTHREE: DB      ^1 ^'3'                                 ; ***** 3
8BA9 9F 8B                                                    DW      HTWO
8BAB 2F 8B 03 00                                      THREE:  DW      DOCON 3
                                                      
8BAF 82 42 CC                                         HBL:    DB      ^2 "B" ^'L'                             ; ***** BL
8BB2 A7 8B                                                    DW      HTHREE
8BB4 2F 8B 20 00                                      BL:     DW      DOCON 32
                                                      
8BB8 83 43 2F CC                                      HCL:    DB      ^3 "C/" ^'L'                            ; ***** C/L
8BBC AF 8B                                                    DW      HBL
8BBE 2F 8B 50 00                                      CL:     DW      DOCON 80
                                                      
8BC2 85 42 2F 42 55 C6                                HBBUF:  DB      ^5 "B/BU" ^'F'                          ; ***** B/BUF
8BC8 B8 8B                                                    DW      HCL
8BCA 2F 8B 00 04                                      BBUF:   DW      DOCON 1024
                                                      
8BCE 85 42 2F 53 43 D2                                HBSCR:  DB      ^5 "B/SC" ^'R'                          ; ***** B/SCR
8BD4 C2 8B                                                    DW      HBBUF
8BD6 2F 8B 01 00                                      BSCR:   DW      DOCON 1
                                                      
8BDA 87 2B 4F 52 49 47 49 CE                          HPORIG: DB      ^7 "+ORIGI" ^'N'                        ; ***** +ORIGIN
8BE2 CE 8B                                                    DW      HBSCR
8BE4 E9 8A 97 85 00 80 C6 89 25 89                    PORIG:  DW      DOCOL LIT ORIGIN PLUS SEMIS
                                                      
                                                      ; ------------------------------
                                                      ; USER VARIABLES
                                                      
8BEE 82 53 B0                                         HSZERO: DB      ^2 "S" ^'0'                             ; ***** S0
8BF1 DA 8B                                                    DW      HPORIG
8BF3 77 8B 06 00                                      SZERO:  DW      DOUSE 6
                                                      
8BF7 82 52 B0                                         HRZERO: DB      ^2 "R" ^'0'                             ; ***** R0
8BFA EE 8B                                                    DW      HSZERO
8BFC 77 8B 08 00                                      RZERO:  DW      DOUSE 8
                                                      
8C00 83 54 49 C2                                      HTIB:   DB      ^3 "TI" ^'B'                            ; ***** TIB
8C04 F7 8B                                                    DW      HRZERO
8C06 77 8B 0A 00                                      TIB:    DW      DOUSE 10
                                                      
8C0A 85 57 49 44 54 C8                                HWIDTH: DB      ^5 "WIDT" ^'H'                          ; ***** WIDTH
8C10 00 8C                                                    DW      HTIB
8C12 77 8B 0C 00                                      WIDTH:  DW      DOUSE 12
                                                      
8C16 87 57 41 52 4E 49 4E C7                          HWARN:  DB      ^7 "WARNIN" ^'G'                        ; ***** WARNING
8C1E 0A 8C                                                    DW      HWIDTH
8C20 77 8B 0E 00                                      WARN:   DW      DOUSE 14
                                                      
8C24 85 46 45 4E 43 C5                                HFENCE: DB      ^5 "FENC" ^'E'                          ; ***** FENCE
8C2A 16 8C                                                    DW      HWARN
8C2C 77 8B 10 00                                      FENCE:  DW      DOUSE 16
                                                      
8C30 82 44 D0                                         HDP:    DB      ^2 "D" ^'P'                             ; ***** DP
8C33 24 8C                                                    DW      HFENCE
8C35 77 8B 12 00                                      DP:     DW      DOUSE 18
                                                      
8C39 88 56 4F 43 2D 4C 49 4E CB                       HVOCL:  DB      ^8 "VOC-LIN" ^'K'                       ; ***** VOC-LINK
8C42 30 8C                                                    DW      HDP
8C44 77 8B 14 00                                      VOCL:   DW      DOUSE 20
                                                      
8C48 85 46 49 52 53 D4                                HFIRST: DB      ^5 "FIRS" ^'T'                          ; ***** FIRST
8C4E 39 8C                                                    DW      HVOCL
8C50 77 8B 16 00                                      FIRST:  DW      DOUSE 22
                                                      
8C54 85 4C 49 4D 49 D4                                HLIMIT: DB      ^5 "LIMI" ^'T'                          ; ***** LIMIT
8C5A 48 8C                                                    DW      HFIRST
8C5C 77 8B 18 00                                      LIMIT:  DW      DOUSE 24
                                                      
8C60 83 42 4C CB                                      HBLK:   DB      ^3 "BL" ^'K'                            ; ***** BLK
8C64 54 8C                                                    DW      HLIMIT
8C66 77 8B 1E 00                                      BLK:    DW      DOUSE 30
                                                      
8C6A 82 49 C9                                         HIN:    DB      ^2 "I" ^'I'                             ; ***** IN
8C6D 60 8C                                                    DW      HBLK
8C6F 77 8B 20 00                                      IN:     DW      DOUSE 32
                                                      
8C73 83 4F 55 D4                                      HOUT:   DB      ^3 "OU" ^'T'                            ; ***** OUT
8C77 6A 8C                                                    DW      HIN
8C79 77 8B 22 00                                      OUT:    DW      DOUSE 34
                                                      
8C7D 83 53 43 D2                                      HSCR:   DB      ^3 "SC" ^'R'                            ; ***** SCR
8C81 73 8C                                                    DW      HOUT
8C83 77 8B 24 00                                      SCR:    DW      DOUSE 36
                                                      
8C87 86 4F 46 46 53 45 D4                             HOFFSE: DB      ^6 "OFFSE" ^'T'                         ; ***** OFFSET
8C8E 7D 8C                                                    DW      HSCR
8C90 77 8B 26 00                                      OFFSE:  DW      DOUSE 38
                                                      
8C94 87 43 4F 4E 54 45 58 D4                          HCONT:  DB      ^7 "CONTEX" ^'T'                        ; ***** CONTEXT
8C9C 87 8C                                                    DW      HOFFSE
8C9E 77 8B 28 00                                      CONT:   DW      DOUSE 40
                                                      
8CA2 87 43 55 52 52 45 4E D4                          HCURR:  DB      ^7 "CURREN" ^'T'                        ; ***** CURRENT
8CAA 94 8C                                                    DW      HCONT
8CAC 77 8B 2A 00                                      CURR:   DW      DOUSE 42
                                                      
8CB0 85 53 54 41 54 C5                                HSTATE: DB      ^5 "STAT" ^'E'                          ; ***** STATE
8CB6 A2 8C                                                    DW      HCURR
8CB8 77 8B 2C 00                                      STATE:  DW      DOUSE 44
                                                      
8CBC 84 42 41 53 C5                                   HBASE:  DB      ^4 "BAS" ^'E'                           ; ***** BASE
8CC1 B0 8C                                                    DW      HSTATE
8CC3 77 8B 2E 00                                      BASE:   DW      DOUSE 46
                                                      
8CC7 83 44 50 CC                                      HDPL:   DB      ^3 "DP" ^'L'                            ; ***** DPL
8CCB BC 8C                                                    DW      HBASE
8CCD 77 8B 32 00                                      DPL:    DW      DOUSE 50
                                                      
8CD1 83 46 4C C4                                      HFLD:   DB      ^3 "FL" ^'D'                            ; ***** FLD
8CD5 C7 8C                                                    DW      HDPL
8CD7 77 8B 34 00                                      FLD:    DW      DOUSE 52
                                                      
8CDB 83 43 53 D0                                      HCSP:   DB      ^3 "CS" ^'P'                            ; ***** CSP
8CDF D1 8C                                                    DW      HFLD
8CE1 77 8B 34 00                                      CSP:    DW      DOUSE 52
                                                      
8CE5 82 52 A3                                         HRNUM:  DB      ^2 "R" ^'#'                             ; ***** R#
8CE8 DB 8C                                                    DW      HCSP
8CEA 77 8B 36 00                                      RNUM:   DW      DOUSE 54
                                                      
8CEE 83 48 4C C4                                      HHLD:   DB      ^3 "HL" ^'D'                            ; ***** HLD
8CF2 E5 8C                                                    DW      HRNUM
8CF4 77 8B 38 00                                      HLD:    DW      DOUSE 56
                                                      
8CF8 83 55 53 C5                                      HUSE:   DB      ^3 "US" ^'E'                            ; ***** USE
8CFC EE 8C                                                    DW      HHLD
8CFE 77 8B 3A 00                                      USE:    DW      DOUSE 58
                                                      
8D02 84 50 52 45 D6                                   HPREV:  DB      ^4 "PRE" ^'V'                           ; ***** PREV
8D07 F8 8C                                                    DW      HUSE
8D09 77 8B 3C 00                                      PREV:   DW      DOUSE 60
                                                      
                                                      ; END OF USER VARIABLES
                                                      ; ------------------------------
                                                      
8D0D 82 31 AB                                         HONEP:  DB      ^2 "1" ^'+'                             ; ***** 1+
8D10 02 8D                                                    DW      HPREV
8D12 E9 8A 9B 8B C6 89 25 89                          ONEP:   DW      DOCOL ONE PLUS SEMIS
                                                      
8D1A 82 32 AB                                         HTWOP:  DB      ^2 "2" ^'+'                             ; ***** 2+
8D1D 02 8D                                                    DW      HPREV
8D1F E9 8A A3 8B C6 89 25 89                          TWOP:   DW      DOCOL TWO PLUS SEMIS
                                                      
8D27 84 48 45 52 C5                                   HHERE:  DB      ^4 "HER" ^'E'                           ; ***** HERE
8D2C 1A 8D                                                    DW      HTWOP
8D2E E9 8A 35 8C 8B 8A 25 89                          HERE:   DW      DOCOL DP AT SEMIS
                                                      
8D36 85 41 4C 4C 4F D4                                HALLOT: DB      ^5 "ALLO" ^'T'                          ; ***** ALLOT
8D3C 27 8D                                                    DW      HHERE
8D3E E9 8A 35 8C 57 8A 25 89                          ALLOT:  DW      DOCOL DP PSTOR SEMIS
                                                      
8D46 81 AC                                            HCOMMA: DB      ^1 ^','                                 ; ***** ,
8D48 36 8D                                                    DW      HALLOT
8D4A E9 8A 2E 8D B0 8A A3 8B 3E 8D 25 89              COMMA:  DW      DOCOL HERE STORE TWO ALLOT SEMIS
                                                      
8D56 81 AD                                            HSUB:   DB      ^1 ^'-'                                 ; ***** -
8D58 46 8D                                                    DW      HCOMMA
8D5A E9 8A EC 89 C6 89 25 89                          SUB:    DW      DOCOL MINUS PLUS SEMIS
                                                      
8D62 81 BD                                            HEQUAL: DB      ^1 ^'='                                 ; ***** =
8D64 56 8D                                                    DW      HSUB
8D66 E9 8A 5A 8D 80 89 25 89                          EQUAL:  DW      DOCOL SUB ZEQU SEMIS
                                                      
8D6E 81 BC                                            HLESS:  DB      ^1 ^'<'                                 ; ***** <
8D70 62 8D                                                    DW      HEQUAL
8D72 E9 8A 5A 8D A9 89 25 89                          LESS:   DW      DOCOL SUB ZLESS SEMIS
                                                      
8D7A 81 BE                                            HGREAT: DB      ^1 ^'>'                                 ; ***** >
8D7C 6E 8D                                                    DW      HLESS
8D7E E9 8A 39 8A 72 8D 25 89                          GREAT:  DW      DOCOL SWAP LESS SEMIS
                                                      
8D86 83 52 4F D4                                      HROT:   DB      ^3 "RO" ^'T'                            ; ***** ROT
8D8A 7A 8D                                                    DW      HGREAT
8D8C E9 8A 57 89 39 8A 67 89 39 8A 25 89              ROT:    DW      DOCOL TOR SWAP FROMR SWAP SEMIS
                                                      
8D98 85 53 50 41 43 C5                                HSPACE: DB      ^5 "SPAC" ^'E'                          ; ***** SPACE
8D9E 86 8D                                                    DW      HROT
8DA0 E9 8A B4 8B B4 87 25 89                          SPACE:  DW      DOCOL BL EMIT SEMIS
                                                      
8DA8 84 2D 44 55 D0                                   HDDUP:  DB      ^4 "-DU" ^'P'                           ; ***** -DUP
8DAD 98 8D                                                    DW      HSPACE
8DAF E9 8A 4A 8A DB 85 04 00                          DDUP:   DW      DOCOL DUP ZBRAN +DDU10
8DB7 4A 8A                                                    DW      DUP
8DB9 25 89                                            DDU10:  DW      SEMIS
                                                      
8DBB 88 54 52 41 56 45 52 53 C5                       HTRAV:  DB      ^8 "TRAVERS" ^'E'                       ; ***** TRAVERSE
8DC4 A8 8D                                                    DW      HDDUP
8DC6 E9 8A 39 8A                                      TRAV:   DW      DOCOL SWAP
8DCA 12 8A C6 89 97 85 FF 00                          TRAV10: DW      OVER PLUS LIT 0xFF
8DD2 12 8A 9B 8A 72 8D C9 85 F0 FF                            DW      OVER CAT LESS BRAN +TRAV10
8DDC 39 8A 27 8A 25 89                                        DW      SWAP DROP SEMIS
                                                      
8DE2 86 4C 41 54 45 53 D4                             HLATES: DB      ^6 "LATES" ^'T'                         ; ***** LATEST
8DE9 BB 8D                                                    DW      HTRAV
8DEB E9 8A AC 8C 8B 8A 8B 8A 25 89                    LATES:  DW      DOCOL CURR AT AT SEMIS
                                                      
8DF5 83 4C 46 C1                                      HLFA:   DB      ^3 "LF" ^'A'                            ; ***** LFA
8DF9 E2 8D                                                    DW      HLATES
8DFB E9 8A 97 85 04 00 5A 8D 25 89                    LFA:    DW      DOCOL LIT 4 SUB SEMIS
                                                      
8E05 83 43 46 C1                                      HCFA:   DB      ^3 "CF" ^'A'                            ; ***** CFA
8E09 F5 8D                                                    DW      HLFA
8E0B E9 8A A3 8B 5A 8D 25 89                          CFA:    DW      DOCOL TWO SUB SEMIS
                                                      
8E13 83 4E 46 C1                                      HNFA:   DB      ^3 "NF" ^'A'                            ; ***** NFA
8E17 05 8E                                                    DW      HCFA
8E19 E9 8A 97 85 05 00 5A 8D 97 85 FF FF C6 8D 25 89  NFA:    DW      DOCOL LIT 5 SUB LIT -1 TRAV SEMIS
                                                      
8E29 83 50 46 C1                                      HPFA:   DB      ^3 "PF" ^'A'                            ; ***** PFA
8E2D 13 8E                                                    DW      HNFA
8E2F E9 8A 9B 8B C6 8D 97 85 05 00 C6 89 25 89        PFA:    DW      DOCOL ONE TRAV LIT 5 PLUS SEMIS
                                                      
                                                      ; ------------------------------
                                                      ; COMPILE TIME CHECKS
                                                      
8E3D 84 21 43 53 D0                                   HSCSP:  DB      ^4 "!CS" ^'P'                           ; ***** !CSP
8E42 29 8E                                                    DW      HPFA
8E44 E9 8A A9 88 E1 8C B0 8A 25 89                    SCSP:   DW      DOCOL SPAT CSP STORE SEMIS
                                                      
8E4E 86 3F 45 52 52 4F D2                             HQERR:  DB      ^6 "?ERRO" ^'R'                         ; ***** ?ERROR
8E55 3D 8E                                                    DW      HSCSP
8E57 E9 8A 39 8A DB 85 08 00                          QERR:   DW      DOCOL SWAP ZBRAN +QERR10
8E5F 4A 93 C9 85 04 00                                        DW      ERROR BRAN +QERR20
8E65 27 8A                                            QERR10: DW      DROP
8E67 25 89                                            QERR20: DW      SEMIS
                                                      
8E69 85 3F 43 4F 4D D0                                HQCOMP: DB      ^5 "?COM" ^'P'                          ; ***** ?COMP
8E6F 4E 8E                                                    DW      HQERR
8E71 E9 8A B8 8C 8B 8A 80 89 97 85 11 00 57 8E 25 89  QCOMP:  DW      DOCOL STATE AT ZEQU LIT 17 QERR SEMIS
                                                      
8E81 85 3F 45 58 45 C3                                HQEXEC: DB      ^5 "?EXE" ^'C'                          ; ***** ?EXEC
8E87 69 8E                                                    DW      HQCOMP
8E89 E9 8A B8 8C 8B 8A 97 85 12 00 57 8E 25 89        QEXEC:  DW      DOCOL STATE AT LIT 18 QERR SEMIS
                                                      
8E97 86 3F 50 41 49 52 D3                             HQPAIR: DB      ^6 "?PAIR" ^'S'                         ; ***** ?PAIRS
8E9E 81 8E                                                    DW      HQEXEC
8EA0 E9 8A 5A 8D 97 85 13 00 57 8E 25 89              QPAIR:  DW      DOCOL SUB LIT 19 QERR SEMIS
                                                      
8EAC 84 3F 43 53 D0                                   HQCSP:  DB      ^4 "?CS" ^'P'                           ; ***** ?CSP
8EB1 97 8E                                                    DW      HQPAIR
8EB3 E9 8A A9 88 E1 8C 8B 8A 5A 8D                    QCSP:   DW      DOCOL SPAT CSP AT SUB
8EBD 97 85 14 00 57 8E 25 89                                  DW      LIT 20 QERR SEMIS
                                                      
8EC5 88 3F 4C 4F 41 44 49 4E C7                       HQLOAD: DB      ^8 "?LOADIN" ^'G'                       ; ***** ?LOADING
8ECE AC 8E                                                    DW      HQCSP
8ED0 E9 8A 66 8C 8B 8A 80 89 97 85 16 00 57 8E 25 89  QLOAD:  DW      DOCOL BLK AT ZEQU LIT 22 QERR SEMIS
                                                      
                                                      ; ------------------------------
                                                      ; COMPILER WORDS
                                                      
8EE0 87 43 4F 4D 50 49 4C C5                          HCOMP:  DB      ^7 "COMPIL" ^'E'                        ; ***** COMPILE
8EE8 C5 8E                                                    DW      HQLOAD
8EEA E9 8A 71 8E 67 89 4A 8A                          COMP:   DW      DOCOL QCOMP FROMR DUP
8EF2 1F 8D 57 89 8B 8A 4A 8D 25 89                            DW      TWOP TOR AT COMMA SEMIS
                                                      
8EFC C1 DB                                            HLBRAC: DB      ^^1 ^'['                                ; ***** [
8EFE E0 8E                                                    DW      HCOMP
8F00 E9 8A 93 8B B8 8C B0 8A 25 89                    LBRAC:  DW      DOCOL ZERO STATE STORE SEMIS
                                                      
8F0A 81 DD                                            HRBRAC: DB      ^1 ^']'                                 ; ***** ]
8F0C FC 8E                                                    DW      HLBRAC
8F0E E9 8A 97 85 C0 00 B8 8C B0 8A 25 89              RBRAC:  DW      DOCOL LIT 0xC0 STATE STORE SEMIS
                                                      
8F1A 86 53 4D 55 44 47 C5                             HSMUDG: DB      ^6 "SMUDG" ^'E'                         ; ***** SMUDGE
8F21 0A 8F                                                    DW      HRBRAC
8F23 E9 8A EB 8D 97 85 20 00 73 8A 25 89              SMUDG:  DW      DOCOL LATES LIT 0x20 TOGGL SEMIS
                                                      
8F2F 83 48 45 D8                                      HHEX:   DB      ^3 "HE" ^'X'                            ; ***** HEX
8F33 1A 8F                                                    DW      HSMUDG
8F35 E9 8A 97 85 10 00 C3 8C B0 8A 25 89              HEX:    DW      DOCOL LIT 16 BASE STORE SEMIS
                                                      
8F41 87 44 45 43 49 4D 41 CC                          HDEC:   DB      ^7 "DECIMA" ^'L'                        ; ***** DECIMAL
8F49 2F 8F                                                    DW      HHEX
8F4B E9 8A 97 85 0A 00 C3 8C B0 8A 25 89              DEC:    DW      DOCOL LIT 10 BASE STORE SEMIS
                                                      
8F57 85 4F 43 54 41 CC                                HOCTAL: DB      ^5 "OCTA" ^'L'                          ; ***** OCTAL
8F5D 41 8F                                                    DW      HDEC
8F5F E9 8A 97 85 08 00 C3 8C B0 8A 25 89              OCTAL:  DW      DOCOL LIT 8 BASE STORE SEMIS
                                                      
8F6B 87 28 3B 43 4F 44 45 A9                          HPSCOD: DB      ^7 "(;CODE" ^')'                        ; ***** (;CODE)
8F73 57 8F                                                    DW      HOCTAL
8F75 E9 8A 67 89 EB 8D 2F 8E 0B 8E B0 8A 25 89        PSCOD:  DW      DOCOL FROMR LATES PFA CFA STORE SEMIS
                                                      
8F83 87 3C 42 55 49 4C 44 D3                          HBUILD: DB      ^7 "<BUILD" ^'S'                        ; ***** <BUILDS
8F8B 6B 8F                                                    DW      HPSCOD
8F8D E9 8A 93 8B 25 8B 25 89                          BUILD:  DW      DOCOL ZERO CON SEMIS
                                                      
8F95 85 44 4F 45 53 BE                                HDOES:  DB      ^5 "DOES" ^'>'                          ; ***** DOES>
8F9B 83 8F                                                    DW      HBUILD
8F9D E9 8A 67 89 EB 8D 2F 8E B0 8A 75 8F              DOES:   DW      DOCOL FROMR LATES PFA STORE PSCOD
8FA9 2F EE FE                                         DODOE:  DEW     RP              ; -(RP) = IP
8FAC 15 E9 FE                                                 LDA     IP.1            ; :
8FAF 1E EE FE                                                 STR     RP              ; :
8FB2 2F EE FE                                                 DEW     RP              ; :
8FB5 15 E8 FE                                                 LDA     IP.0            ; :
8FB8 1E EE FE                                                 STR     RP              ; :
8FBB 1D EA FE                                                 LDR     WA              ; IP = (WA)+
8FBE 16 E8 FE                                                 STA     IP.0            ; :
8FC1 2E EA FE                                                 INW     WA              ; :
8FC4 1D EA FE                                                 LDR     WA              ; :
8FC7 16 E9 FE                                                 STA     IP.1            ; :
8FCA 2E EA FE                                                 INW     WA              ; :
8FCD 2F EC FE                                                 DEW     SP              ; -(SP) = WA
8FD0 15 EB FE                                                 LDA     WA.1            ; :
8FD3 1E EC FE                                                 STR     SP              ; :
8FD6 2F EC FE                                                 DEW     SP              ; :
8FD9 15 EA FE                                                 LDA     WA.0            ; :
8FDC 1E EC FE                                                 STR     SP              ; :
8FDF 14 29 85                                                 JPA     NEXT            ; Done
                                                      
                                                      ; ------------------------------
                                                      ; MISC WORDS RELATED TO PRINTING
                                                      
8FE2 85 43 4F 55 4E D4                                HCOUNT: DB      ^5 "COUN" ^'T'                          ; ***** COUNT
8FE8 95 8F                                                    DW      HDOES
8FEA E9 8A 4A 8A 12 8D 39 8A 9B 8A 25 89              COUNT:  DW      DOCOL DUP ONEP SWAP CAT SEMIS
                                                      
8FF6 84 54 59 50 C5                                   HTYPE:  DB      ^4 "TYP" ^'E'                           ; ***** TYPE
8FFB E2 8F                                                    DW      HCOUNT
8FFD E9 8A AF 8D DB 85 18 00                          TYPE:   DW      DOCOL DDUP ZBRAN +TYPE20
9005 12 8A C6 89 39 8A 71 86                                  DW      OVER PLUS SWAP XDO
900D 83 86 9B 8A B4 87 5C 86 F8 FF                    TYPE10: DW      I CAT EMIT XLOOP +TYPE10
9017 C9 85 04 00                                              DW      BRAN +TYPE30
901B 27 8A                                            TYPE20: DW      DROP
901D 25 89                                            TYPE30: DW      SEMIS
                                                      
901F 89 2D 54 52 41 49 4C 49 4E C7                    HDTRAI: DB      ^9 "-TRAILIN" ^'G'                      ; ***** -TRAILING
9029 F6 8F                                                    DW      HTYPE
902B E9 8A 4A 8A 93 8B 71 86                          DTRAI:  DW      DOCOL DUP ZERO XDO
9033 12 8A 12 8A C6 89 9B 8B 5A 8D                    DTRA10: DW      OVER OVER PLUS ONE SUB
903D 9B 8A B4 8B 5A 8D DB 85 08 00                            DW      CAT BL SUB ZBRAN +DTRA20
9047 44 89 C9 85 06 00                                        DW      LEAVE BRAN +DTRA30
904D 9B 8B 5A 8D                                      DTRA20: DW      ONE SUB
9051 5C 86 E0 FF                                      DTRA30: DW      XLOOP +DTRA10
9055 25 89                                                    DW      SEMIS
                                                      
9057 84 28 2E 22 A9                                   HPDOTQ: DB      ^4 "(." '"' ^')'                        ; ***** (.")
905C 1F 90                                                    DW      HDTRAI
905E E9 8A 73 89 EA 8F 4A 8A 12 8D                    PDOTQ:  DW      DOCOL R COUNT DUP ONEP
9068 67 89 C6 89 57 89 FD 8F 25 89                            DW      FROMR PLUS TOR TYPE SEMIS
                                                      
9072 C2 2E A2                                         HDOTQ:  DB      ^^2 "." ^'"'                            ; ***** ."
9075 57 90                                                    DW      HPDOTQ
9077 E9 8A 97 85 22 00 B8 8C 8B 8A DB 85 14 00        DOTQ:   DW      DOCOL LIT '"' STATE AT ZBRAN +DOTQ10
9085 EA 8E 5E 90 DC 91 2E 8D 9B 8A 12 8D                      DW      COMP PDOTQ WORD HERE CAT ONEP
9091 3E 8D C9 85 0A 00                                        DW      ALLOT BRAN +DOTQ20
9097 DC 91 2E 8D EA 8F FD 8F                          DOTQ10: DW      WORD HERE COUNT TYPE
909F 25 89                                            DOTQ20: DW      SEMIS
                                                      
                                                      ; ------------------------------
                                                      ; OUTER INTERPRETER
                                                      
90A1 86 45 58 50 45 43 D4                             HEXPEC: DB      ^6 "EXPEC" ^'T'                         ; ***** EXPECT
90A8 72 90                                                    DW      HDOTQ
90AA E9 8A 12 8A C6 89 12 8A 71 86                    EXPEC:  DW      DOCOL OVER PLUS OVER XDO
90B4 C6 87 4A 8A 97 85 0E 00 E4 8B                    EXPE10: DW      KEY DUP LIT 14 PORIG
90BE 8B 8A 66 8D DB 85 20 00                                  DW      AT EQUAL ZBRAN +EXPE20
90C6 27 8A 97 85 08 00 12 8A 83 86 66 8D 4A 8A 67 89          DW      DROP LIT 8 OVER I EQUAL DUP FROMR
90D6 A3 8B 5A 8D C6 89 57 89 5A 8D C9 85 28 00                DW      TWO SUB PLUS TOR SUB BRAN +EXPE50
90E4 4A 8A 97 85 0A 00 66 8D DB 85 0E 00              EXPE20: DW      DUP LIT 10 EQUAL ZBRAN +EXPE30
90F0 44 89 27 8A B4 8B 93 8B C9 85 04 00                      DW      LEAVE DROP BL ZERO BRAN +EXPE40
90FC 4A 8A                                            EXPE30: DW      DUP
90FE 83 86 C3 8A 93 8B 83 86 12 8D B0 8A              EXPE40: DW      I CSTOR ZERO I ONEP STORE
910A B4 87 5C 86 A6 FF                                EXPE50: DW      EMIT XLOOP +EXPE10
9110 27 8A 25 89                                              DW      DROP SEMIS
                                                      
9114 86 51 55 45 52 D9                                HQUERY: DB      ^6 "QUER" ^'Y'                          ; ***** QUERY
911A A1 90                                                    DW      HEXPEC
911C E9 8A 06 8C 8B 8A 97 85 50 00 AA 90              QUERY:  DW      DOCOL TIB AT LIT 80 EXPEC
9128 93 8B 6F 8C B0 8A 25 89                                  DW      ZERO IN STORE SEMIS
                                                      
9130 C1 80                                            HNULL:  DB      ^^1 ^0                                  ; ***** <the NULL word>
9132 14 91                                                    DW      HQUERY
9134 E9 8A 66 8C 8B 8A DB 85 26 00                    NULL:   DW      DOCOL BLK AT ZBRAN +NULL20
913E 9B 8B 66 8C 57 8A 93 8B 6F 8C B0 8A                      DW      ONE BLK PSTOR ZERO IN STORE
914A 66 8C 8B 8A D6 8B 41 97 80 89 DB 85 08 00                DW      BLK AT BSCR MOD ZEQU ZBRAN +NULL10
9158 89 8E 67 89 27 8A                                        DW      QEXEC FROMR DROP
915E C9 85 06 00                                      NULL10: DW      BRAN +NULL30
9162 67 89 27 8A                                      NULL20: DW      FROMR DROP
9166 25 89                                            NULL30: DW      SEMIS
                                                      
9168 84 46 49 4C CC                                   HFILL:  DB      ^4 "FIL" ^'L'                           ; ***** FILL
916D 30 91                                                    DW      HNULL
916F E9 8A CA 83 39 8A 57 89 12 8A C3 8A 4A 8A        FILL:   DW      DOCOL _DEB SWAP TOR OVER CSTOR DUP
917D 12 8D 67 89 9B 8B 5A 8D 22 88 25 89                      DW      ONEP FROMR ONE SUB CMOVE SEMIS
                                                      
9189 85 45 52 41 53 C5                                HERASE: DB      ^5 "ERAS" ^'E'                          ; ***** ERASE
918F 68 91                                                    DW      HFILL
9191 E9 8A 93 8B 6F 91 25 89                          ERASE:  DW      DOCOL ZERO FILL SEMIS
                                                      
9199 86 42 4C 41 4E 4B D3                             HBLANK: DB      ^6 "BLANK" ^'S'                         ; ***** BLANKS
91A0 89 91                                                    DW      HERASE
91A2 E9 8A B4 8B 6F 91 25 89                          BLANK:  DW      DOCOL BL FILL SEMIS
                                                      
91AA 84 48 4F 4C C4                                   HHOLD:  DB      ^4 "HOL" ^'D'                           ; ***** HOLD
91AF 99 91                                                    DW      HBLANK
91B1 E9 8A 97 85 FF FF F4 8C 57 8A                    HOLD:   DW      DOCOL LIT -1 HLD PSTOR
91BB F4 8C 8B 8A C3 8A 25 89                                  DW      HLD AT CSTOR SEMIS
                                                      
91C3 83 50 41 C4                                      HPAD:   DB      ^3 "PA" ^'D'                            ; ***** PAD
91C7 AA 91                                                    DW      HHOLD
91C9 E9 8A 2E 8D 97 85 54 00 C6 89 25 89              PAD:    DW      DOCOL HERE LIT 84 PLUS SEMIS
                                                      
91D5 84 57 4F 52 C4                                   HWORD:  DB      ^4 "WOR" ^'D'                           ; ***** WORD
91DA C3 91                                                    DW      HPAD
91DC E9 8A 66 8C 8B 8A DB 85 0C 00                    WORD:   DW      DOCOL BLK AT ZBRAN +WORD10
91E6 66 8C 8B 8A 89 98 C9 85 06 00                            DW      BLK AT BLOCK BRAN +WORD20
91F0 06 8C 8B 8A                                      WORD10: DW      TIB AT
91F4 6F 8C 8B 8A C6 89 39 8A 4D 87                    WORD20: DW      IN AT PLUS SWAP ENCL
91FE 2E 8D 97 85 22 00 A2 91 6F 8C                            DW      HERE LIT 34 BLANK IN
9208 57 8A 12 8A 5A 8D 57 89 73 89 2E 8D C3 8A C6 89          DW      PSTOR OVER SUB TOR R HERE CSTOR PLUS
9218 2E 8D 12 8D 67 89 22 88 25 89                            DW      HERE ONEP FROMR CMOVE SEMIS
                                                      
9222 88 28 4E 55 4D 42 45 52 A9                       HPNUMB: DB      ^8 "(NUMBER" ^')'                       ; ***** (NUMBER)
922B D5 91                                                    DW      HWORD
922D E9 8A                                            PNUMB:  DW      DOCOL
922F 12 8D 4A 8A 57 89 9B 8A                          PNUM10: DW      ONEP DUP TOR CAT
9237 C3 8C 8B 8A 93 86 DB 85 2C 00                            DW      BASE AT DIGIT ZBRAN +PNUM30
9241 39 8A C3 8C 8B 8A 47 88 27 8A 8C 8D C3 8C 8B 8A          DW      SWAP BASE AT USTAR DROP ROT BASE AT
9251 47 88 D6 89 CD 8C 8B 8A 12 8D DB 85 08 00                DW      USTAR DPLUS DPL AT ONEP ZBRAN +PNUM20
925F 9B 8B CD 8C 57 8A                                        DW      ONE DPL PSTOR
9265 67 89 C9 85 C6 FF                                PNUM20: DW      FROMR BRAN +PNUM10
926B 67 89 25 89                                      PNUM30: DW      FROMR SEMIS
                                                      
926F 86 4E 55 4D 42 45 D2                             HNUMB:  DB      ^6 "NUMBE" ^'R'                         ; ***** NUMBER
9276 22 92                                                    DW      HPNUMB
9278 E9 8A 93 8B 93 8B 8C 8D 4A 8A 12 8D 9B 8A        NUMB:   DW      DOCOL ZERO ZERO ROT DUP ONEP CAT
9286 97 85 2D 00 66 8D 4A 8A 57 89 C6 89 97 85 FF FF          DW      LIT '-' EQUAL DUP TOR PLUS LIT -1
9296 CD 8C B0 8A 2D 92 4A 8A                          NUMB10: DW      DPL STORE PNUMB DUP
929E 9B 8A B4 8B 5A 8D DB 85 16 00                            DW      CAT BL SUB ZBRAN +NUMB20
92A8 4A 8A 9B 8A 97 85 2E 00 5A 8D                            DW      DUP CAT LIT '.' SUB
92B2 93 8B 57 8E 93 8B C9 85 DC FF                            DW      ZERO QERR ZERO BRAN +NUMB10
92BC 27 8A 67 89 DB 85 04 00                          NUMB20: DW      DROP FROMR ZBRAN +NUMB30
92C4 00 8A                                                    DW      DMINU
92C6 25 89                                            NUMB30: DW      SEMIS
                                                      
92C8 85 2D 46 49 4E C4                                HDFIND: DB      ^5 "-FIN" ^'D'                          ; ***** -FIND
92CE 6F 92                                                    DW      HNUMB
92D0 E9 8A B4 8B DC 91 2E 8D EA 8F 00 93              DFIND:  DW      DOCOL BL WORD HERE COUNT UPPER
92DC 2E 8D 9E 8C 8B 8A 8B 8A C5 86                            DW      HERE CONT AT AT PFIND
92E6 4A 8A 80 89 DB 85 0A 00                                  DW      DUP ZEQU ZBRAN +DFIN10
92EE 27 8A 2E 8D EB 8D C5 86                                  DW      DROP HERE LATES PFIND
92F6 25 89                                            DFIN10: DW      SEMIS
                                                      
92F8 85 55 50 50 45 D2                                HUPPER: DB      ^5 "UPPE" ^'R'                          ; ***** UPPER
92FE C8 92                                                    DW      HDFIND
9300 E9 8A 12 8A C6 89 39 8A 71 86                    UPPER:  DW      DOCOL OVER PLUS SWAP XDO
930A 83 86 9B 8A 97 85 60 00 7E 8D                    UPPE10: DW      I CAT LIT 0x60 GREAT
9314 83 86 9B 8A 97 85 7B 00 72 8D                            DW      I CAT LIT 0x7B LESS
931E 77 88 DB 85 0A 00                                        DW      AND ZBRAN +UPPE20
9324 83 86 97 85 20 00 73 8A                                  DW      I LIT 0x20 TOGGL
932C 5C 86 DC FF                                      UPPE20: DW      XLOOP +UPPE10
9330 25 89                                                    DW      SEMIS
                                                      
9332 87 28 41 42 4F 52 54 A9                          HPABOR: DB      ^7 "(ABORT" ^')'                        ; ***** (ABORT)
933A F8 92                                                    DW      HUPPER
933C E9 8A 92 95 25 89                                PABOR:  DW      DOCOL ABORT SEMIS
                                                      
9342 85 45 52 52 4F D2                                HERROR: DB      ^5 "ERRO" ^'R'                          ; ***** ERROR
9348 32 93                                                    DW      HPABOR
934A E9 8A 20 8C 8B 8A A9 89 DB 85 04 00              ERROR:  DW      DOCOL WARN AT ZLESS ZBRAN +ERRO10
9356 3C 93                                                    DW      PABOR
9358 2E 8D EA 8F FD 8F 5E 90                          ERRO10: DW      HERE COUNT TYPE PDOTQ
9360 03 20 3F 20                                              DB      3 32 '?' 32
9364 1E 99 C0 88 6F 8C 8B 8A 66 8C 8B 8A 64 95 25 89          DW      MESS SPSTO IN AT BLK AT QUIT SEMIS
                                                      
9374 83 49 44 AE                                      HIDDOT: DB      ^3 "ID" ^'.'                            ; ***** ID.
9378 42 93                                                    DW      HERROR
937A E9 8A C9 91 B4 8B 97 85 5F 00 6F 91              IDDOT:  DW      DOCOL PAD BL LIT 95 FILL
9386 4A 8A 2F 8E FB 8D 12 8A 5A 8D C9 91 39 8A 22 88          DW      DUP PFA LFA OVER SUB PAD SWAP CMOVE
9396 C9 91 EA 8F 97 85 1F 00 77 88 FD 8F A0 8D 25 89          DW      PAD COUNT LIT 31 AND TYPE SPACE SEMIS
                                                      
93A6 86 43 52 45 41 54 C5                             HCREAT: DB      ^6 "CREAT" ^'E'                         ; ***** CREATE
93AD 74 93                                                    DW      HIDDOT
93AF E9 8A D0 92 DB 85 10 00                          CREAT:  DW      DOCOL DFIND ZBRAN +CREA10
93B7 27 8A 19 8E 7A 93 97 85 04 00 1E 99 A0 8D                DW      DROP NFA IDDOT LIT 4 MESS SPACE
93C5 2E 8D 4A 8A 9B 8A 12 8C 8B 8A A0 96 12 8D 3E 8D  CREA10: DW      HERE DUP CAT WIDTH AT MIN ONEP ALLOT
93D5 4A 8A 97 85 A0 00 73 8A 2E 8D 9B 8B 5A 8D                DW      DUP LIT 0xA0 TOGGL HERE ONE SUB
93E3 97 85 80 00 73 8A EB 8D 4A 8D AC 8C 8B 8A B0 8A          DW      LIT 0x80 TOGGL LATES COMMA CURR AT STORE
93F3 2E 8D 1F 8D 4A 8D 25 89                                  DW      HERE TWOP COMMA SEMIS
                                                      
93FB C9 5B 43 4F 4D 50 49 4C 45 DD                    HBCOMP: DB      ^^9 "[COMPILE" ^']'                     ; ***** [COMPILE]
9405 A6 93                                                    DW      HCREAT
9407 E9 8A D0 92 80 89 93 8B 57 8E                    BCOMP:  DW      DOCOL DFIND ZEQU ZERO QERR
9411 27 8A 0B 8E 4A 8D 25 89                                  DW      DROP CFA COMMA SEMIS
                                                      
9419 C7 4C 49 54 45 52 41 CC                          HLITER: DB      ^^7 "LITERA" ^'L'                       ; ***** LITERAL
9421 FB 93                                                    DW      HBCOMP
9423 E9 8A B8 8C 8B 8A DB 85 08 00                    LITER:  DW      DOCOL STATE AT ZBRAN +LITE10
942D EA 8E 97 85 4A 8D                                        DW      COMP LIT COMMA
9433 25 89                                            LITE10: DW      SEMIS
                                                      
9435 C8 44 4C 49 54 45 52 41 CC                       HDLITE: DB      ^^8 "DLITERA" ^'L'                      ; ***** DLITERAL
943E 19 94                                                    DW      HLITER
9440 E9 8A B8 8C 8B 8A DB 85 08 00                    DLITE:  DW      DOCOL STATE AT ZBRAN +DLIT10
944A 39 8A 23 94 23 94                                        DW      SWAP LITER LITER
9450 25 89                                            DLIT10: DW      SEMIS
                                                      
9452 82 55 BC                                         HULESS: DB      ^2 "U" ^'<'                             ; ***** U<
9455 35 94                                                    DW      HDLITE
9457 E9 8A 57 89 93 8B 67 89 93 8B 00 8A D6 89        ULESS:  DW      DOCOL TOR ZERO FROMR ZERO DMINU DPLUS
9465 39 8A 27 8A A9 89 25 89                                  DW      SWAP DROP ZLESS SEMIS
                                                      
946D 86 3F 53 54 41 43 CB                             HQSTAC: DB      ^6 "?STAC" ^'K'                         ; ***** ?STACK
9474 52 94                                                    DW      HULESS
9476 E9 8A F3 8B 8B 8A A3 8B 5A 8D A9 88 57 94        QSTAC:  DW      DOCOL SZERO AT TWO SUB SPAT ULESS
9484 9B 8B 57 8E A9 88 2E 8D 97 85 80 00                      DW      ONE QERR SPAT HERE LIT 128
9490 C6 89 57 94 A3 8B 57 8E 25 89                            DW      PLUS ULESS TWO QERR SEMIS
                                                      
949A 89 49 4E 54 45 52 50 52 45 D4                    HINTER: DB      ^9 "INTERPRE" ^'T'                      ; ***** INTERPRET
94A4 6D 94                                                    DW      HQSTAC
94A6 E9 8A CA 83                                      INTER:  DW      DOCOL _DEB
94AA D0 92 DB 85 1E 00                                INTE10: DW      DFIND ZBRAN +INTE40
94B0 B8 8C 8B 8A 72 8D DB 85 0A 00                            DW      STATE AT LESS ZBRAN +INTE20
94BA 0B 8E 4A 8D C9 85 0C 00                                  DW      CFA COMMA BRAN +INTE40
94C2 0B 8E A9 85                                      INTE20: DW      CFA EXEC
94C6 76 94 C9 85 1C 00                                INTE30: DW      QSTAC BRAN +INTE70
94CC 2E 8D 78 92 CD 8C 8B 8A 12 8D DB 85 08 00        INTE40: DW      HERE NUMB DPL AT ONEP ZBRAN +INTE50
94DA 40 94 C9 85 06 00                                        DW      DLITE BRAN +INTE60
94E0 27 8A 23 94                                      INTE50: DW      DROP LITER
94E4 76 94                                            INTE60: DW      QSTAC
94E6 C9 85 C2 FF                                      INTE70: DW      BRAN +INTE10
                                                      
94EA 89 49 4D 4D 45 44 49 41 54 C5                    HIMMED: DB      ^9 "IMMEDIAT" ^'E'                      ; ***** IMMEDIATE
94F4 9A 94                                                    DW      HINTER
94F6 E9 8A EB 8D 97 85 40 00 73 8A 25 89              IMMED:  DW      DOCOL LATES LIT 0x40 TOGGL SEMIS
                                                      
9502 8A 56 4F 43 41 42 55 4C 41 52 D9                 HVOCAB: DB      ^10 "VOCABULAR" ^'Y'                    ; ***** VOCABULARY
950D EA 94                                                    DW      HIMMED
950F E9 8A 8D 8F 81 A0 4A 8D AC 8C 8B 8A 0B 8E 4A 8D  VOCAB:  DW      DOCOL BUILD 0xa081 COMMA CURR AT CFA COMMA
951F 2E 8D 44 8C 8B 8A 4A 8D 44 8C B0 8A 9D 8F                DW      HERE VOCL AT COMMA VOCL STORE DOES
952D 1F 8D 9E 8C B0 8A 25 89                          DOVOC:  DW      TWOP CONT STORE SEMIS
                                                      
9535 8B 44 45 46 49 4E 49 54 49 4F 4E D3              HDEFIN: DB      ^11 "DEFINITION" ^'S'                   ; ***** DEFINITIONS
9541 02 95                                                    DW      HVOCAB
9543 E9 8A 9E 8C 8B 8A AC 8C B0 8A 25 89              DEFIN:  DW      DOCOL CONT AT CURR STORE SEMIS
                                                      
954F 81 A8                                            HPAREN: DB      ^1 ^'('                                 ; ***** (
9551 35 95                                                    DW      HDEFIN
9553 E9 8A 97 85 29 00 DC 91 25 89                    PAREN:  DW      DOCOL LIT ')' WORD SEMIS
                                                      
955D 84 51 55 49 D4                                   HQUIT:  DB      ^4 "QUI" ^'T'                           ; ***** QUIT
9562 4F 95                                                    DW      HPAREN
9564 E9 8A 93 8B 66 8C B0 8A 00 8F                    QUIT:   DW      DOCOL ZERO BLK STORE LBRAC
956E E2 88 F9 87 1C 91 A6 94 B8 8C 8B 8A              QUIT10: DW      RPSTO CR QUERY INTER STATE AT
957A 80 89 DB 85 08 00                                        DW      ZEQU ZBRAN +QUIT20
9580 5E 90                                                    DW      PDOTQ
9582 03 20 6F 6B                                              DB      3 32 "ok"
9586 C9 85 E6 FF                                      QUIT20: DW      BRAN +QUIT10
                                                      
958A 85 41 42 4F 52 D4                                HABORT: DB      ^5 "ABOR" ^'T'                          ; ***** ABORT
9590 5D 95                                                    DW      HQUIT
9592 E9 8A                                            ABORT:  DW      DOCOL
9594 E2 88 C0 88 4B 8F A0 8D F9 87 5E 90              ABOR10: DW      RPSTO SPSTO DEC SPACE CR PDOTQ
95A0 13 4D 69 6E 69 6D 61 6C 2D 46 4F 52 54 48                DB      19 "Minimal-FORTH"
95AE 20 76 20 30 2E 31                                        DB      32 "v" 32 "0.1"
95B4 02 9D 43 95 64 95                                        DW      FORTH DEFIN QUIT
                                                      
                                                      ; INCLUDE         coldwarm.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; COLD AND WARM START ENTRY POINTS
                                                      
95BA 0E FE                                            CENT:   LDI     0xFE            ; Initialize Minimal stack pointer
95BC 16 FF FF                                                 STA     0xFFFF          ; :
95BF 0E E7                                                    LDI     <COLD10         ; Start by executing COLD
95C1 16 E8 FE                                                 STA     IP.0            ; :
95C4 0E 95                                                    LDI     >COLD10         ; :
95C6 16 E9 FE                                                 STA     IP.1            ; :
95C9 14 29 85                                                 JPA     NEXT            ; ... and over to FORTH VM
                                                      
95CC 0E FE                                            WENT:   LDI     0xFE            ; Initialize Minimal stack pointer
95CE 16 FF FF                                                 STA     0xFFFF          ; :
95D1 0E 94                                                    LDI     <ABOR10         ; Start by executing ABORT
95D3 16 E8 FE                                                 STA     IP.0            ; :
95D6 0E 95                                                    LDI     >ABOR10         ; :
95D8 16 E9 FE                                                 STA     IP.1            ; :
95DB 14 29 85                                                 JPA     NEXT            ; ... and over to FORTH VM
                                                      
95DE 84 43 4F 4C C4                                   HCOLD:  DB      ^4 "COL" ^'D'                           ; ***** COLD
95E3 8A 95                                                    DW      HABORT
95E5 E9 8A                                            COLD:   DW      DOCOL
                                                      COLD10: ; Init FORTH registers
95E7 E2 88 C0 88 04 89                                        DW      RPSTO SPSTO UPSTO
                                                              ; Set FORTH vocabulary
95ED 97 85 0C 00 E4 8B 8B 8A                                  DW      LIT 12 PORIG AT
95F5 97 85 06 00 97 85 02 9D C6 89 B0 8A                      DW      LIT 6 LIT FORTH PLUS STORE
                                                              ; Init 12 items (24 bytes) in user area ...
                                                              ; ... with values from boot table
9601 97 85 12 00 E4 8B                                        DW      LIT 18 PORIG
9607 97 85 10 00 E4 8B 8B 8A 97 85 06 00 C6 89                DW      LIT 16 PORIG AT LIT 6 PLUS
9615 97 85 18 00 22 88                                        DW      LIT 24 CMOVE
                                                              ; Erase disk buffers
961B 97 85 22 00 E4 8B 8B 8A 97 85 24 00 E4 8B 8B 8A          DW      LIT 34 PORIG AT LIT 36 PORIG AT
962B 12 8A 5A 8D 91 91                                        DW      OVER SUB ERASE
                                                              ; Initialize some of the user variables
9631 93 8B 79 8C B0 8A                                        DW      ZERO OUT STORE
9637 50 8C 8B 8A FE 8C B0 8A                                  DW      FIRST AT USE STORE
963F 50 8C 8B 8A 09 8D B0 8A                                  DW      FIRST AT PREV STORE
                                                              ; Continue via ABORT
9647 92 95                                                    DW      ABORT
                                                      
                                                      
                                                      
                                                      ; INCLUDE         math.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; MATHEMATICS WORDS
                                                      
9649 84 53 2D 3E C4                                   HSTOD:  DB      ^4 "S->" ^'D'                           ; ***** S->D
964E DE 95                                                    DW      HCOLD
9650 E9 8A 4A 8A A9 89 EC 89 25 89                    STOD:   DW      DOCOL DUP ZLESS MINUS SEMIS
                                                      
965A 82 2B AD                                         HPM:    DB      ^2 "+" ^'-'                             ; ***** +-
965D 49 96                                                    DW      HSTOD
965F E9 8A A9 89 DB 85 04 00                          PM:     DW      DOCOL ZLESS ZBRAN +PM10
9667 EC 89                                                    DW      MINUS
9669 25 89                                            PM10:   DW      SEMIS
                                                      
966B 83 44 2B AD                                      HDPM:   DB      ^3 "D+" ^'-'                            ; ***** D+-
966F 5A 96                                                    DW      HPM
9671 E9 8A A9 89 DB 85 04 00                          DPM:    DW      DOCOL ZLESS ZBRAN +DPM10
9679 00 8A                                                    DW      DMINU
967B 25 89                                            DPM10:  DW      SEMIS
                                                      
967D 83 41 42 D3                                      HABS:   DB      ^3 "AB" ^'S'                            ; ***** ABS
9681 6B 96                                                    DW      HDPM
9683 E9 8A 4A 8A 5F 96 25 89                          ABS:    DW      DOCOL DUP PM SEMIS
                                                      
968B 84 44 41 42 D3                                   HDABS:  DB      ^4 "DAB" ^'S'                           ; ***** DABS
9690 7D 96                                                    DW      HABS
9692 E9 8A 4A 8A 71 96 25 89                          DABS:   DW      DOCOL DUP DPM SEMIS
                                                      
969A 83 4D 49 CE                                      HMIN:   DB      ^3 "MI" ^'N'                            ; ***** MIN
969E 8B 96                                                    DW      HDABS
96A0 E9 8A 12 8A 12 8A 7E 8D DB 85 04 00              MIN:    DW      DOCOL OVER OVER GREAT ZBRAN +MIN10
96AC 39 8A                                                    DW      SWAP
96AE 27 8A 25 89                                      MIN10:  DW      DROP SEMIS
                                                      
96B2 83 4D 41 D8                                      HMAX:   DB      ^3 "MA" ^'X'                            ; ***** MAX
96B6 9A 96                                                    DW      HMIN
96B8 E9 8A 12 8A 12 8A 72 8D DB 85 04 00              MAX:    DW      DOCOL OVER OVER LESS ZBRAN +MAX10
96C4 39 8A                                                    DW      SWAP
96C6 27 8A 25 89                                      MAX10:  DW      DROP SEMIS
                                                      
96CA 82 4D AA                                         HMSTAR: DB      ^2 "M" ^'*'                             ; ****** M*
96CD B2 96                                                    DW      HMAX
96CF E9 8A 12 8A 12 8A 98 88 57 89 83 96 39 8A 83 96  MSTAR:  DW      DOCOL OVER OVER XOR TOR ABS SWAP ABS
96DF 47 88 67 89 71 96 25 89                                  DW      USTAR FROMR DPM SEMIS
                                                      
96E7 82 4D AF                                         HMSLAS: DB      ^2 "M" ^'/'                             ; ***** M/
96EA CA 96                                                    DW      HMSTAR
96EC E9 8A 12 8A 57 89 57 89 92 96 73 89 83 96        MSLAS:  DW      DOCOL OVER TOR TOR DABS R ABS
96FA 57 88 67 89 73 89 98 88 5F 96 39 8A                      DW      USLAS FROMR R XOR PM SWAP
9706 67 89 5F 96 39 8A 25 89                                  DW      FROMR PM SWAP SEMIS
                                                      
970E 81 AA                                            HSTAR:  DB      ^1 ^'*'                                 ; ***** *
9710 E7 96                                                    DW      HMSLAS
9712 E9 8A CF 96 27 8A 25 89                          STAR:   DW      DOCOL MSTAR DROP SEMIS
                                                      
971A 84 2F 4D 4F C4                                   HSLMOD: DB      ^4 "/MO" ^'D'                           ; ***** /MOD
971F 0E 97                                                    DW      HSTAR
9721 E9 8A 57 89 50 96 67 89 EC 96 25 89              SLMOD:  DW      DOCOL TOR STOD FROMR MSLAS SEMIS
                                                      
972D 81 AF                                            HSLAS:  DB      ^1 ^'/'                                 ; ***** /
972F 1A 97                                                    DW      HSLMOD
9731 E9 8A 21 97 39 8A 27 8A 25 89                    SLASH:  DW      DOCOL SLMOD SWAP DROP SEMIS
                                                      
973B 83 4D 4F C4                                      HMOD:   DB      ^3 "MO" ^'D'                            ; ***** MOD
973F 2D 97                                                    DW      HSLAS
9741 E9 8A 21 97 27 8A 25 89                          MOD:    DW      DOCOL SLMOD DROP SEMIS
                                                      
9749 85 2A 2F 4D 4F C4                                HSSMOD: DB      ^5 "*/MO" ^'D'                          ; ***** */MOD
974F 3B 97                                                    DW      HMOD
9751 E9 8A 57 89 CF 96 67 89 EC 96 25 89              SSMOD:  DW      DOCOL TOR MSTAR FROMR MSLAS SEMIS
                                                      
975D 82 2A AF                                         HSSLA:  DB      ^2 "*" ^'/'                             ; ***** */
9760 49 97                                                    DW      HSSMOD
9762 E9 8A 51 97 39 8A 27 8A 25 89                    SSLA:   DW      DOCOL SSMOD SWAP DROP SEMIS
                                                      
976C 85 4D 2F 4D 4F C4                                HMSMOD: DB      ^5 "M/MO" ^'D'                          ; ***** M/MOD
9772 49 97                                                    DW      HSSMOD
9774 E9 8A 57 89 93 8B 73 89 57 88 67 89              MSMOD:  DW      DOCOL TOR ZERO R USLAS FROMR
9780 39 8A 57 89 57 88 67 89 25 89                            DW      SWAP TOR USLAS FROMR SEMIS
                                                      
                                                      ; INCLUDE         diskio.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; DISK I/O
                                                      
978A 84 2B 42 55 C6                                   HPBUF:  DB      ^4 "+BU" ^'F'                           ; ***** +BUF
978F 6C 97                                                    DW      HMSMOD
9791 E9 8A CA 8B 97 85 04 00 C6 89                    PBUF:   DW      DOCOL BBUF LIT 4 PLUS
979B 4A 8A 5C 8C 8B 8A 66 8D DB 85 08 00                      DW      DUP LIMIT AT EQUAL ZBRAN +PBUF10
97A7 27 8A 50 8C 8B 8A                                        DW      DROP FIRST AT
97AD 4A 8A 09 8D 8B 8A 5A 8D 25 89                    PBUF10: DW      DUP PREV AT SUB SEMIS
                                                      
97B7 86 55 50 44 41 54 C5                             HUPDAT: DB      ^6 "UPDAT" ^'E'                         ; ***** UPDATE
97BE 8A 97                                                    DW      HPBUF
97C0 E9 8A 09 8D 8B 8A 8B 8A 97 85 00 80              UPDAT:  DW      DOCOL PREV AT AT LIT 0x8000
97CC 87 88 09 8D 8B 8A B0 8A 25 89                            DW      OR PREV AT STORE SEMIS
                                                      
97D6 8D 45 4D 50 54 59 2D 42 55 46 46 45 52 D3        HMTBUF: DB      ^13 "EMPTY-BUFFER" ^'S'                 ; ***** EMPTY-BUFFERS
97E4 B7 97                                                    DW      HUPDAT
97E6 E9 8A 50 8C 8B 8A 5C 8C 8B 8A                    MTBUF:  DW      DOCOL FIRST AT LIMIT AT
97F0 12 8A 5A 8D 91 91 25 89                                  DW      OVER SUB ERASE SEMIS
                                                      
97F8 85 46 4C 55 53 C8                                HFLUSH: DB      ^5 "FLUS" ^'H'                          ; ***** FLUSH
97FE D6 97                                                    DW      HMTBUF
9800 E9 8A 5C 8C 8B 8A 50 8C 8B 8A 71 86              FLUSH:  DW      DOCOL LIMIT AT FIRST AT XDO
980C 83 86 8B 8A A9 89 DB 85 14 00                    FLUS10: DW      I AT ZLESS ZBRAN +FLUS20
9816 83 86 1F 8D 83 86 8B 8A 97 85 FF 7F                      DW      I TWOP I AT LIT 0x7FFF
9822 77 88 93 8B 0F 88                                        DW      AND ZERO RW
9828 CA 8B 97 85 04 00 C6 89 0F 86 DA FF              FLUS20: DW      BBUF LIT 4 PLUS XPLOO +FLUS10
9834 E6 97 25 89                                              DW      MTBUF SEMIS
                                                      
9838 86 42 55 46 46 45 D2                             HBUFFE: DB      ^6 "BUFFE" ^'R'                         ; ***** BUFFER
983F F8 97                                                    DW      HFLUSH
9841 E9 8A FE 8C 8B 8A 4A 8A 57 89                    BUFFE:  DW      DOCOL USE AT DUP TOR
984B 91 97 DB 85 FC FF                                BUFF10: DW      PBUF ZBRAN +BUFF10
9851 FE 8C B0 8A 73 89 8B 8A 72 8D DB 85 14 00                DW      USE STORE R AT LESS ZBRAN +BUFF20
985F 73 89 1F 8D 73 89 8B 8A 97 85 FF 7F                      DW      R TWOP R AT LIT 0x7FFF
986B 77 88 93 8B 0F 88                                        DW      AND ZERO RW
9871 73 89 B0 8A 73 89 09 8D B0 8A 67 89 1F 8D 25 89  BUFF20: DW      R STORE R PREV STORE FROMR TWOP SEMIS
                                                      
9881 85 42 4C 4F 43 CB                                HBLOCK: DB      ^5 "BLOC" ^'K'                          ; ***** BLOCK
9887 38 98                                                    DW      HBUFFE
9889 E9 8A 57 89 09 8D 8B 8A 4A 8A                    BLOCK:  DW      DOCOL TOR PREV AT DUP
9893 8B 8A 97 85 FF 7F 77 88 73 89 5A 8D DB 85 36 00          DW      AT LIT 0x7FFF AND R SUB ZBRAN +BLOC30
98A3 91 97 80 89 DB 85 14 00                          BLOC10: DW      PBUF ZEQU ZBRAN +BLOC20
98AB 27 8A 73 89 41 98 4A 8A 73 89                            DW      DROP R BUFFE DUP R
98B5 9B 8B 0F 88 A3 8B 5A 8D                                  DW      ONE RW TWO SUB
98BD 4A 8A 8B 8A 97 85 FF 7F 77 88 73 89              BLOC20: DW      DUP AT LIT 0x7FFF AND R
98C9 5A 8D 80 89 DB 85 D4 FF                                  DW      SUB ZEQU ZBRAN +BLOC10
98D1 4A 8A 09 8D B0 8A                                        DW      DUP PREV STORE
98D7 67 89 27 8A 1F 8D 25 89                          BLOC30: DW      FROMR DROP TWOP SEMIS
                                                      
98DF 86 28 4C 49 4E 45 A9                             HPLINE: DB      ^6 "(LINE" ^')'                         ; ***** (LINE)
98E6 81 98                                                    DW      HBLOCK
98E8 E9 8A 57 89 BE 8B CA 8B 51 97 67 89 D6 8B        PLINE:  DW      DOCOL TOR CL BBUF SSMOD FROMR BSCR
98F6 12 97 C6 89 89 98 C6 89 BE 8B 25 89                      DW      STAR PLUS BLOCK PLUS CL SEMIS
                                                      
9902 85 2E 4C 49 4E C5                                HDLINE: DB      ^5 ".LIN" ^'E'                          ; ***** .LINE
9908 DF 98                                                    DW      HPLINE
990A E9 8A E8 98 2B 90 FD 8F 25 89                    DLINE:  DW      DOCOL PLINE DTRAI TYPE SEMIS
                                                      
9914 87 4D 45 53 53 41 47 C5                          HMESS:  DB      ^7 "MESSAG" ^'E'                        ; ***** MESSAGE
991C 02 99                                                    DW      HDLINE
991E E9 8A 20 8C 8B 8A DB 85 1A 00                    MESS:   DW      DOCOL WARN AT ZBRAN +MESS20
9928 AF 8D DB 85 10 00                                        DW      DDUP ZBRAN +MESS10
992E 97 85 10 00 21 97 97 85 04 00 C6 89 0A 99                DW      LIT 16 SLMOD LIT 4 PLUS DLINE
993C C9 85 0D 00                                      MESS10: DW      BRAN +MESS30
9940 5E 90                                            MESS20: DW      PDOTQ
9942 06 4D 53 47 20 23 20                                     DB      6 "MSG" 32 '#' 32
9949 07 9C                                                    DW      DOT
994B 25 89                                            MESS30: DW      SEMIS
                                                      
994D 84 4C 4F 41 C4                                   HLOAD:  DB      ^4 "LOA" ^'D'                           ; ***** LOAD
9952 14 99                                                    DW      HMESS
9954 E9 8A 66 8C 8B 8A 57 89 6F 8C 8B 8A 57 89 93 8B  LOAD:   DW      DOCOL BLK AT TOR IN AT TOR ZERO IN
9964 6F 8C B0 8A D6 8B 12 97 66 8C B0 8A A6 94 67 89          DW      STORE BSCR STAR BLK STORE INTER FROMR
9974 6F 8C B0 8A 67 89 66 8C B0 8A 25 89                      DW      IN STORE FROMR BLK STORE SEMIS
                                                      
9980 83 2D 2D BE                                      HARROW: DB      ^3 "--" ^'>'                            ; ***** -->
9984 4D 99                                                    DW      HLOAD
9986 E9 8A D0 8E 93 8B 6F 8C B0 8A D6 8B 66 8C 8B 8A  ARROW:  DW      DOCOL QLOAD ZERO IN STORE BSCR BLK AT
9996 12 8A 41 97 5A 8D 66 8C 57 8A 25 89                      DW      OVER MOD SUB BLK PSTOR SEMIS
                                                      
                                                      ; INCLUDE         misc.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; MISCELLANEOUS HIGHER LEVEL
                                                      
99A2 81 A7                                            HTICK:  DB      ^1 ^39                                  ; ***** '
99A4 80 99                                                    DW      HARROW
99A6 E9 8A D0 92 80 89 93 8B 57 8E 27 8A 23 94 25 89  TICK:   DW      DOCOL DFIND ZEQU ZERO QERR DROP LITER SEMIS
                                                      
99B6 86 46 4F 52 47 45 D4                             HFORGE: DB      ^6 "FORGE" ^'T'                         ; ***** FORGET
99BD A2 99                                                    DW      HTICK
99BF E9 8A AC 8C 8B 8A 9E 8C 8B 8A 5A 8D 97 85 18 00  FORGE:  DW      DOCOL CURR AT CONT AT SUB LIT 24
99CF 57 8E A6 99 4A 8A 2C 8C 8B 8A 72 8D 97 85 15 00          DW      QERR TICK DUP FENCE AT LESS LIT 21
99DF 57 8E 4A 8A 19 8E 35 8C B0 8A FB 8D 8B 8A 9E 8C          DW      QERR DUP NFA DP STORE LFA AT CONT
99EF 8B 8A B0 8A 25 89                                        DW      AT STORE SEMIS
                                                      
99F5 84 42 41 43 CB                                   HBACK:  DB      ^4 "BAC" ^'K'                           ; ***** BACK
99FA B6 99                                                    DW      HFORGE
99FC E9 8A 2E 8D 5A 8D 4A 8D 25 89                    BACK:   DW      DOCOL HERE SUB COMMA SEMIS
                                                      
9A06 C5 42 45 47 49 CE                                HBEGIN: DB      ^^5 "BEGI" ^'N'                         ; ***** BEGIN
9A0C F5 99                                                    DW      HBACK
9A0E E9 8A 71 8E 2E 8D 9B 8B 25 89                    BEGIN:  DW      DOCOL QCOMP HERE ONE SEMIS
                                                      
9A18 C5 45 4E 44 49 C6                                HENDIF: DB      ^^5 "ENDI" ^'F'                         ; ***** ENDIF
9A1E 06 9A                                                    DW      HBEGIN
9A20 E9 8A 71 8E A3 8B A0 8E 2E 8D                    ENDIF:  DW      DOCOL QCOMP TWO QPAIR HERE
9A2A 12 8A 5A 8D 39 8A B0 8A 25 89                            DW      OVER SUB SWAP STORE SEMIS
                                                      
9A34 C4 54 48 45 CE                                   HTHEN:  DB      ^^4 "THE" ^'N'                          ; ***** THEN
9A39 18 9A                                                    DW      HENDIF
9A3B E9 8A 20 9A 25 89                                THEN:   DW      DOCOL ENDIF SEMIS
                                                      
9A41 C2 44 CF                                         HDO:    DB      ^^2 "D" ^'O'                            ; ***** DO
9A44 34 9A                                                    DW      HTHEN
9A46 E9 8A EA 8E 71 86 2E 8D 97 85 03 00 25 89        DO:     DW      DOCOL COMP XDO HERE LIT 3 SEMIS
                                                      
9A54 C4 4C 4F 4F D0                                   HLOOP:  DB      ^^4 "LOO" ^'P'                          ; ***** LOOP
9A59 41 9A                                                    DW      HDO
9A5B E9 8A 97 85 03 00 A0 8E EA 8E 5C 86 FC 99 25 89  LOOP:   DW      DOCOL LIT 3 QPAIR COMP XLOOP BACK SEMIS
                                                      
9A6B C5 2B 4C 4F 4F D0                                HPLOOP: DB      ^^5 "+LOO" ^'P'                         ; ***** +LOOP
9A71 54 9A                                                    DW      HLOOP
9A73 E9 8A 97 85 03 00 A0 8E EA 8E 0F 86 FC 99 25 89  PLOOP:  DW      DOCOL LIT 3 QPAIR COMP XPLOO BACK SEMIS
                                                      
9A83 C5 55 4E 54 49 CC                                HUNTIL: DB      ^^5 "UNTI" ^'L'                         ; ***** UNTIL
9A89 6B 9A                                                    DW      HPLOOP
9A8B E9 8A 9B 8B A0 8E EA 8E DB 85 FC 99 25 89        UNTIL:  DW      DOCOL ONE QPAIR COMP ZBRAN BACK SEMIS
                                                      
9A99 C3 45 4E C4                                      HEND:   DB      ^^3 "EN" ^'D'                           ; ***** ENDI
9A9D 83 9A                                                    DW      HUNTIL
9A9F E9 8A 8B 9A 25 89                                END:    DW      DOCOL UNTIL SEMIS
                                                      
9AA5 C5 41 47 41 49 CE                                HAGAIN: DB      ^^5 "AGAI" ^'N'                         ; ***** AGAIN
9AAB 99 9A                                                    DW      HEND
9AAD E9 8A 9B 8B A0 8E EA 8E C9 85 FC 99 25 89        AGAIN:  DW      DOCOL ONE QPAIR COMP BRAN BACK SEMIS
                                                      
9ABB C6 52 45 50 45 41 D4                             HREPEA: DB      ^^6 "REPEA" ^'T'                        ; ***** REPEAT
9AC2 A5 9A                                                    DW      HAGAIN
9AC4 E9 8A 57 89 57 89 AD 9A 67 89 67 89              REPEA:  DW      DOCOL TOR TOR AGAIN FROMR FROMR
9AD0 A3 8B 5A 8D 20 9A 25 89                                  DW      TWO SUB ENDIF SEMIS
                                                      
9AD8 C2 49 C6                                         HIF:    DB      ^^2 "I" ^'F'                            ; ***** IF
9ADB BB 9A                                                    DW      HREPEA
9ADD E9 8A EA 8E DB 85 2E 8D 93 8B 4A 8D A3 8B 25 89  IF:     DW      DOCOL COMP ZBRAN HERE ZERO COMMA TWO SEMIS
                                                      
9AED C4 45 4C 53 C5                                   HELSE:  DB      ^^4 "ELS" ^'E'                          ; ***** ELSE
9AF2 D8 9A                                                    DW      HIF
9AF4 E9 8A A3 8B A0 8E EA 8E C9 85 2E 8D A3 8B 4A 8D  ELSE:   DW      DOCOL TWO QPAIR COMP BRAN HERE TWO COMMA
9B04 39 8A A3 8B 20 9A A3 8B 25 89                            DW      SWAP TWO ENDIF TWO SEMIS
                                                      
9B0E C5 57 48 49 4C C5                                HWHILE: DB      ^^5 "WHIL" ^'E'                         ; ***** WHILE
9B14 ED 9A                                                    DW      HELSE
9B16 E9 8A DD 9A 1F 8D 25 89                          WHILE:  DW      DOCOL IF TWOP SEMIS
                                                      
9B1E 86 53 50 41 43 45 D3                             HSPACS: DB      ^6 "SPACE" ^'S'                         ; ***** SPACES
9B25 0E 9B                                                    DW      HWHILE
9B27 E9 8A 93 8B B8 96 AF 8D DB 85 0C 00              SPACS:  DW      DOCOL ZERO MAX DDUP ZBRAN +SPAC20
9B33 93 8B 71 86                                              DW      ZERO XDO
9B37 A0 8D 5C 86 FC FF                                SPAC10: DW      SPACE XLOOP +SPAC10
9B3D 25 89                                            SPAC20: DW      SEMIS
                                                      
9B3F 82 3C A3                                         HBDIGS: DB      ^2 "<" ^'#'                             ; ***** <#
9B42 1E 9B                                                    DW      HSPACS
9B44 E9 8A C9 91 F4 8C B0 8A 25 89                    BDIGS:  DW      DOCOL PAD HLD STORE SEMIS
                                                      
9B4E 82 23 BE                                         HEDIGS: DB      ^2 "#" ^'>'                             ; ***** #>
9B51 3F 9B                                                    DW      HBDIGS
9B53 E9 8A 27 8A 27 8A F4 8C 8B 8A                    EDIGS:  DW      DOCOL DROP DROP HLD AT
9B5D C9 91 12 8A 5A 8D 25 89                                  DW      PAD OVER SUB SEMIS
                                                      
9B65 84 53 49 47 CE                                   HSIGN:  DB      ^4 "SIG" ^'N'                           ; ***** SIGN
9B6A 4E 9B                                                    DW      HEDIGS
9B6C E9 8A 8C 8D A9 89 DB 85 08 00                    SIGN:   DW      DOCOL ROT ZLESS ZBRAN +SIGN10
9B76 97 85 2D 00 B1 91                                        DW      LIT '-' HOLD
9B7C 25 89                                            SIGN10: DW      SEMIS
                                                      
9B7E 81 A3                                            HDIG:   DB      ^1 ^'#'                                 ; ***** #
9B80 65 9B                                                    DW      HSIGN
9B82 E9 8A C3 8C 8B 8A 74 97 8C 8D                    DIG:    DW      DOCOL BASE AT MSMOD ROT
9B8C 97 85 09 00 12 8A 72 8D DB 85 08 00                      DW      LIT 9 OVER LESS ZBRAN +DIG10
9B98 97 85 07 00 C6 89                                        DW      LIT 7 PLUS
9B9E 97 85 30 00 C6 89 B1 91 25 89                    DIG10:  DW      LIT '0' PLUS HOLD SEMIS
                                                      
9BA8 82 23 D3                                         HDIGS:  DB      ^2 "#" ^'S'                             ; ***** #S
9BAB 7E 9B                                                    DW      HDIG
9BAD E9 8A                                            DIGS:   DW      DOCOL
9BAF 82 9B 12 8A 12 8A 87 88 80 89 DB 85 F4 FF        DIGS10: DW      DIG OVER OVER OR ZEQU ZBRAN +DIGS10
9BBD 25 89                                                    DW      SEMIS
                                                      
9BBF 83 44 2E D2                                      HDDOTR: DB      ^3 "D." ^'R'                            ; ***** D.R
9BC3 A8 9B                                                    DW      HDIGS
9BC5 E9 8A 57 89 39 8A 12 8A 92 96                    DDOTR:  DW      DOCOL TOR SWAP OVER DABS
9BCF 44 9B AD 9B 6C 9B 53 9B                                  DW      BDIGS DIGS SIGN EDIGS
9BD7 67 89 12 8A 5A 8D 27 9B FD 8F 25 89                      DW      FROMR OVER SUB SPACS TYPE SEMIS
                                                      
9BE3 82 2E D2                                         HDOTR:  DB      ^2 "." ^'R'                             ; ***** .R
9BE6 BF 9B                                                    DW      HDDOTR
9BE8 E9 8A 57 89 50 96 67 89 C5 9B 25 89              DOTR:   DW      DOCOL TOR STOD FROMR DDOTR SEMIS
                                                      
9BF4 82 44 AE                                         HDDOT:  DB      ^2 "D" ^'.'                             ; ***** D.
9BF7 E3 9B                                                    DW      HDOTR
9BF9 E9 8A 93 8B C5 9B A0 8D 25 89                    DDOT:   DW      DOCOL ZERO DDOTR SPACE SEMIS
                                                      
9C03 81 AE                                            HDOT:   DB      ^1 ^'.'                                 ; ***** .
9C05 F4 9B                                                    DW      HDDOT
9C07 E9 8A 50 96 F9 9B 25 89                          DOT:    DW      DOCOL STOD DDOT SEMIS
                                                      
9C0F 81 BF                                            HQUEST: DB      ^1 ^'?'                                 ; ***** ?
9C11 03 9C                                                    DW      HDOT
9C13 E9 8A 8B 8A 07 9C 25 89                          QUEST:  DW      DOCOL AT DOT SEMIS
                                                      
9C1B 82 55 AE                                         HUDOT:  DB      ^2 "U" ^'.'                             ; ***** U.
9C1E 0F 9C                                                    DW      HQUEST
9C20 E9 8A 93 8B F9 9B 25 89                          UDOT:   DW      DOCOL ZERO DDOT SEMIS
                                                      
                                                      ; ----------------------------------
                                                      ; UTILITY WORDS
                                                      
9C28 84 4C 49 53 D4                                   HLIST:  DB      ^4 "LIS" ^'T'                           ; ***** LIST
9C2D 1B 9C                                                    DW      HUDOT
9C2F E9 8A 4B 8F F9 87 4A 8A 83 8C B0 8A 5E 90        LIST:   DW      DOCOL DEC CR DUP SCR STORE PDOTQ
9C3D 06 53 43 52 20 23 20                                     DB      6 "SCR" 32 "#" 32
9C44 07 9C 97 85 10 00 93 8B 71 86                            DW      DOT LIT 16 ZERO XDO
9C4E F9 87 83 86 AB 8B E8 9B A0 8D                    LIST10: DW      CR I THREE DOTR SPACE
9C58 83 86 83 8C 8B 8A 0A 99 5C 86 EC FF                      DW      I SCR AT DLINE XLOOP +LIST10
9C64 F9 87 25 89                                              DW      CR SEMIS
                                                      
9C68 85 49 4E 44 45 D8                                HINDEX: DB      ^5 "INDE" ^'X'                          ; ***** INDEX
9C6E 28 9C                                                    DW      HLIST
9C70 E9 8A F9 87 12 8D 39 8A 71 86                    INDEX:  DW      DOCOL CR ONEP SWAP XDO
9C7A F9 87 83 86 AB 8B E8 9B A0 8D 93 8B 83 86 0A 99  INDE10: DW      CR I THREE DOTR SPACE ZERO I DLINE
9C8A E3 87 DB 85 04 00                                        DW      QTERM ZBRAN +INDE20
9C90 44 89                                                    DW      LEAVE
9C92 5C 86 E6 FF                                      INDE20: DW      XLOOP +INDE10
9C96 25 89                                                    DW      SEMIS
                                                      
9C98 85 56 4C 49 53 D4                                HVLIST: DB      ^5 "VLIS" ^'T'                          ; ***** VLIST
9C9E 68 9C                                                    DW      HINDEX
9CA0 E9 8A 97 85 80 00 79 8C B0 8A 9E 8C 8B 8A 8B 8A  VLIST:  DW      DOCOL LIT 128 OUT STORE CONT AT AT
9CB0 79 8C 8B 8A 97 85 50 00 7E 8D DB 85 0A 00        VLIS10: DW      OUT AT LIT 80 GREAT ZBRAN +VLIS20
9CBE F9 87 93 8B 79 8C B0 8A                                  DW      CR ZERO OUT STORE
9CC6 4A 8A 7A 93 A0 8D A0 8D 2F 8E FB 8D 8B 8A        VLIS20: DW      DUP IDDOT SPACE SPACE PFA LFA AT
9CD4 4A 8A 80 89 E3 87 87 88 DB 85 D2 FF                      DW      DUP ZEQU QTERM OR ZBRAN +VLIS10
9CE0 27 8A 25 89                                              DW      DROP SEMIS
                                                      
9CE4 C5 3B 43 4F 44 C5                                HSCODE: DB      ^^5 ";COD" ^'E'                         ; ***** ;CODE
9CEA 98 9C                                                    DW      HVLIST
9CEC E9 8A B3 8E EA 8E 75 8F 00 8F 23 8F 25 89        SCODE:  DW      DOCOL QCSP COMP PSCOD LBRAC SMUDG SEMIS
                                                      
9CFA C5 46 4F 52 54 C8                                HFORTH: DB      ^^5 "FORT" ^'H'                         ; ***** FORTH
9D00 E4 9C                                                    DW      HSCODE
9D02 A9 8F 2D 95 81 A0 FA 9C                          FORTH:  DW      DODOE DOVOC 0xA081 HFORTH
9D0A 00 00                                            XXVOC:  DW      0
                                                      
9D0C 00                                               XDP:    DB      0
                                                      
                                                      ; INCLUDE         uppermem.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; UPPER MEMORY AREA
                                                      
                                                              ORG     0xF5B9
                                                      
F5B9 00                                               XSP:    DB      0
F5BA 00                                               XTIB:   DB      0
                                                              DS      210             ; TIB:      84
F68D 00                                               XRP:    DB      0               ; RSTACK:  128
F68E 00                                               XUP:    DB      0
                                                              DS      80              ; Room for 40 variables
F6DF 00                                               DSKBF:  DB      0
                                                              DS      2055            ; 2 * 1028 bytes
FEE7 00                                               ENDBF:  DB      0
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; THE VIRTUAL FORTH MACHINE REGISTERS
                                                      
                                                      IP:                             ; Instruction Pointer
FEE8 00                                               IP.0:   DB      0
FEE9 00                                               IP.1:   DB      0
                                                      
                                                      WA:                             ; Word Address Register
FEEA 00                                               WA.0:   DB      0
FEEB 00                                               WA.1:   DB      0
                                                      
                                                      SP:                             ; Data stack pointer
FEEC 00                                               SP.0:   DB      0
FEED 00                                               SP.1:   DB      0
                                                      
                                                      RP:                             ; Return stack pointer
FEEE 00                                               RP.0:   DB      0
FEEF 00                                               RP.1:   DB      0
                                                      
                                                      UP:                             ; User area pointer
FEF0 00                                               UP.0:   DB      0
FEF1 00                                               UP.1:   DB      0
                                                      
                                                      R1:                             ; Working register R1
FEF2 00                                               R1.0:   DB      0
FEF3 00                                               R1.1:   DB      0
                                                      R1H:
FEF4 00                                               R1.2:   DB      0
FEF5 00                                               R1.3:   DB      0
                                                      
                                                      R2:                             ; Working register R2
FEF6 00                                               R2.0:   DB      0
FEF7 00                                               R2.1:   DB      0
                                                      R2H:
FEF8 00                                               R2.2:   DB      0
FEF9 00                                               R2.3:   DB      0
                                                      
                                                      R3:                             ; Working register R3
FEFA 00                                               R3.0:   DB      0
FEFB 00                                               R3.1:   DB      0
                                                      R3H:
FEFC 00                                               R3.2:   DB      0
FEFD 00                                               R3.3:   DB      0
                                                      
FEFE 00                                               BC:     DB      0               ; "Hidden" registers
FEFF 00                                               TMP:    DB      0               ; (used by _AND8 _OR8 _XOR8)
