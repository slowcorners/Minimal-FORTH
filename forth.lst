                                                      ; ----------------------------------------------------------------------
                                                      ; M i n i m a l - F O R T H
                                                      ;
                                                      ; A minimal FORTH for the Minimal-CPU.
                                                      ;
                                                      ; Date:         2021-03-24
                                                      ; Version:      0.1
                                                      ; Adaptation:   Nils "slowcorners" Kullberg
                                                      ; License:      MIT Open Source Initiative
                                                      ;
                                                      ;
                                                      ; FIG-FORTH WAS ORIGINALLY DEVELOPED BY:
                                                      ; FORTH INTEREST GROUP / FORTH IMPLEMENTATION TEAM
                                                      ; P.O.BOX 1105
                                                      ; SAN CARLOS, CA. 94701
                                                      ;
                                                      ; THIS COMPILER EXISTS THANKS TO ALL THE WONDERFUL PEOPLE OF THE
                                                      ; FORTH INTEREST GROUP. IT IS THEIR DEDICATION AND GENEROSITY WHICH
                                                      ; STILL TODAY MAKES THESE NEW ADAPTATIONS POSSIBLE.
                                                      ;
                                                      ; MAY THIS COMPILER BE A SMALL TRIBUTE TO ALL THOSE INDIVIDUALS OF THE
                                                      ; FORTH INTEREST GROUP AS WELL AS SLU4 WHOSE COUNTLESS HOURS AND
                                                      ; INGENIOUS DETAILS HAVE MADE THE MINIMAL-CPU COME INTO EXISTENCE.
                                                      ;
                                                      ; NILS "SLOWCORNERS" KULLBERG
                                                      ; LUND, SWEDEN
                                                      ; MARCH 2021, IN THE MIDDLE OF THE COVID-19 PANDEMIC
                                                      ;
                                                      ; ----------------------------------------------------------------------
                                                      
                                                              ORG     0x8000
                                                              
                                                      
                                                      ; INCLUDE         defs.asm
                                                      
                                                      CH_BEL  EQU     7
                                                      CH_BSP  EQU     8
                                                      CH_LF   EQU     10
                                                      CH_CR   EQU     13
                                                      CH_ESC  EQU     27
                                                      CH_BL   EQU     32
                                                      CH_DEL  EQU     127
                                                      
                                                      ; INCLUDE         boot-table.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; BOOT TABLE
                                                      
8000 14 4F 96                                         ORIGIN: JPA     CENT            ;  0: COLD start
8003 00                                                       NOP
8004 14 61 96                                                 JPA     WENT            ;  4: WARM start
8007 00                                                       NOP
8008 00 00                                                    DW      0               ;  8: Processor type in radix 36
800A 00 00                                                    DW      0               ; 10: Revision
800C FC 9D                                                    DW      HFORTH          ; 12: Pointer to latest word defined
800E 08 00                                                    DW      CH_BSP          ; 14: Backspace character
8010 8E F6                                                    DW      XUP             ; 16: Pointer to initial user area
8012 B9 F5                                                    DW      XSP             ; 18: Initial data stack pointer
8014 8D F6                                                    DW      XRP             ; 20: Initial return stack pointer
8016 BA F5                                                    DW      XTIB            ; 22: Pointer to terminal input buffer
8018 1F 00                                                    DW      31              ; 24: Maximum FORTH word name length
801A 00 00                                                    DW      0               ; 26: Initial WARNING mode
801C 0E 9E                                                    DW      XDP             ; 28: Initial FENCE
801E 0E 9E                                                    DW      XDP             ; 30: Initial HERE
8020 0C 9E                                                    DW      XXVOC           ; 32: Pointer to initial VOC-LINK
8022 DF F6                                                    DW      DSKBF           ; 34: Initial FIRST
8024 E7 FE                                                    DW      ENDBF           ; 36: Initial LIMIT
8026 00 00                                                    DW      0               ; 38: unused
8028 00 00                                                    DW      0               ; 40: unused
                                                      
                                                      ; INCLUDE         helpers.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; HELPER FUNCTIONS
                                                      ;
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (IP)+
                                                      
802A 1D E8 FE                                         _LIT:   LDR     IP
802D 16 F2 FE                                                 STA     R1.0
8030 2E E8 FE                                                 INW     IP
8033 1D E8 FE                                                 LDR     IP
8036 16 F3 FE                                                 STA     R1.1
8039 2E E8 FE                                                 INW     IP
803C 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       IP = IP + (IP)+
                                                      
803D 1D E8 FE                                         _BRAN:  LDR     IP
8040 16 F2 FE                                                 STA     R1.0
8043 2E E8 FE                                                 INW     IP
8046 1D E8 FE                                                 LDR     IP
8049 16 F3 FE                                                 STA     R1.1
804C 2F E8 FE                                                 DEW     IP
804F 15 F2 FE                                                 LDA     R1.0
8052 28 E8 FE                                                 ADB     IP.0
8055 15 F3 FE                                                 LDA     R1.1
8058 2A E9 FE                                                 ACB     IP.1
805B 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (SP) "half function"
                                                      
805C 1D EC FE                                         _GET1_: LDR     SP
805F 16 F2 FE                                                 STA     R1.0
8062 2E EC FE                                                 INW     SP
8065 1D EC FE                                                 LDR     SP
8068 16 F3 FE                                                 STA     R1.1
806B 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (SP)
                                                      
806C 38 5C 80                                         _GET1:  JPS     _GET1_
806F 2F EC FE                                                 DEW     SP
8072 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (SP)+
                                                      
8073 38 5C 80                                         _POP1:  JPS     _GET1_
8076 2E EC FE                                                 INW     SP
8079 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1X = (SP)+
                                                      
807A 1D EC FE                                         _DPOP1: LDR     SP
807D 16 F4 FE                                                 STA     R1.2
8080 2E EC FE                                                 INW     SP
8083 1D EC FE                                                 LDR     SP
8086 16 F5 FE                                                 STA     R1.3
8089 2E EC FE                                                 INW     SP
808C 1D EC FE                                                 LDR     SP
808F 16 F2 FE                                                 STA     R1.0
8092 2E EC FE                                                 INW     SP
8095 1D EC FE                                                 LDR     SP
8098 16 F3 FE                                                 STA     R1.1
809B 2E EC FE                                                 INW     SP
809E 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R2 = (SP) "half function"
                                                      
809F 1D EC FE                                         _GET2_: LDR     SP
80A2 16 F6 FE                                                 STA     R2.0
80A5 2E EC FE                                                 INW     SP
80A8 1D EC FE                                                 LDR     SP
80AB 16 F7 FE                                                 STA     R2.1
80AE 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R2 = (SP)
                                                      
80AF 38 9F 80                                         _GET2:  JPS     _GET2_
80B2 2F EC FE                                                 DEW     SP
80B5 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (SP)+
                                                      
80B6 38 9F 80                                         _POP2:  JPS     _GET2_
80B9 2E EC FE                                                 INW     SP
80BC 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R2X = (SP)+
                                                      
80BD 1D EC FE                                         _DPOP2: LDR     SP
80C0 16 F8 FE                                                 STA     R2.2
80C3 2E EC FE                                                 INW     SP
80C6 1D EC FE                                                 LDR     SP
80C9 16 F9 FE                                                 STA     R2.3
80CC 2E EC FE                                                 INW     SP
80CF 1D EC FE                                                 LDR     SP
80D2 16 F6 FE                                                 STA     R2.0
80D5 2E EC FE                                                 INW     SP
80D8 1D EC FE                                                 LDR     SP
80DB 16 F7 FE                                                 STA     R2.1
80DE 2E EC FE                                                 INW     SP
80E1 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3 = (SP) "half function"
                                                      
80E2 1D EC FE                                         _GET3_: LDR     SP
80E5 16 FA FE                                                 STA     R3.0
80E8 2E EC FE                                                 INW     SP
80EB 1D EC FE                                                 LDR     SP
80EE 16 FB FE                                                 STA     R3.1
80F1 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3 = (SP)
                                                      
80F2 38 E2 80                                         _GET3:  JPS     _GET3_
80F5 2F EC FE                                                 DEW     SP
80F8 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3 = (SP)+
                                                      
80F9 38 E2 80                                         _POP3:  JPS     _GET3_
80FC 2E EC FE                                                 INW     SP
80FF 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3 = (SP)+
                                                      ;       R2 = (SP)+
                                                      ;       R1 = (SP)+
                                                      
8100 38 F9 80                                         _POP321: JPS    _POP3
8103 38 B6 80                                         _POP21: JPS     _POP2
8106 38 73 80                                                 JPS     _POP1
8109 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (RP) "half function"
                                                      
810A 1D EE FE                                         _RGET1_: LDR    RP
810D 16 F2 FE                                                 STA     R1.0
8110 2E EE FE                                                 INW     RP
8113 1D EE FE                                                 LDR     RP
8116 16 F3 FE                                                 STA     R1.1
8119 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (RP)
                                                      
811A 38 0A 81                                         _RGET1: JPS     _RGET1_
811D 2F EE FE                                                 DEW     RP
8120 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (RP)+
                                                      
8121 38 0A 81                                         _RPOP1: JPS     _RGET1_
8124 2E EE FE                                                 INW     RP
8127 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R2 = (RP) "half function"
                                                      
8128 1D EE FE                                         _RGET2_: LDR    RP
812B 16 F6 FE                                                 STA     R2.0
812E 2E EE FE                                                 INW     RP
8131 1D EE FE                                                 LDR     RP
8134 16 F7 FE                                                 STA     R2.1
8137 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R2 = (RP)
                                                      
8138 38 28 81                                         _RGET2: JPS     _RGET2_
813B 2F EE FE                                                 DEW     RP
813E 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (RP)
                                                      
813F 38 28 81                                         _RPOP2: JPS     _RGET2_
8142 2E EE FE                                                 INW     RP
8145 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3 = (RP) "half function"
                                                      
8146 1D EE FE                                         _RGET3_: LDR    RP
8149 16 FA FE                                                 STA     R3.0
814C 2E EE FE                                                 INW     RP
814F 1D EE FE                                                 LDR     RP
8152 16 FB FE                                                 STA     R3.1
8155 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3 = (RP)
                                                      
8156 38 46 81                                         _RGET3: JPS     _RGET3_
8159 2F EE FE                                                 DEW     RP
815C 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3 = (RP)
                                                      
815D 38 46 81                                         _RPOP3: JPS     _RGET3_
8160 2E EE FE                                                 INW     RP
8163 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (SP) = R1 "half function"
                                                      
8164 15 F3 FE                                         _PUT1_: LDA     R1.1
8167 1E EC FE                                                 STR     SP
816A 2F EC FE                                                 DEW     SP
816D 15 F2 FE                                                 LDA     R1.0
8170 1E EC FE                                                 STR     SP
8173 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (SP) = R1
                                                      
8174 2E EC FE                                         _PUT1:  INW     SP
8177 38 64 81                                                 JPS     _PUT1_
817A 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       -(SP) = R1
                                                      
817B 2F EC FE                                         _PUSH1: DEW     SP
817E 38 64 81                                                 JPS     _PUT1_
8181 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (SP) = R2 "half function"
                                                      
8182 15 F7 FE                                         _PUT2_: LDA     R2.1
8185 1E EC FE                                                 STR     SP
8188 2F EC FE                                                 DEW     SP
818B 15 F6 FE                                                 LDA     R2.0
818E 1E EC FE                                                 STR     SP
8191 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (SP) = R2
                                                      
8192 2E EC FE                                         _PUT2:  INW     SP
8195 38 82 81                                                 JPS     _PUT2_
8198 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       -(SP) = R2
                                                      
8199 2F EC FE                                         _PUSH2: DEW     SP
819C 38 82 81                                                 JPS     _PUT2_
819F 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (SP) = R3 "half function"
                                                      
81A0 15 FB FE                                         _PUT3_: LDA     R3.1
81A3 1E EC FE                                                 STR     SP
81A6 2F EC FE                                                 DEW     SP
81A9 15 FA FE                                                 LDA     R3.0
81AC 1E EC FE                                                 STR     SP
81AF 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (SP) = R3
                                                      
81B0 2E EC FE                                         _PUT3:  INW     SP
81B3 38 A0 81                                                 JPS     _PUT3_
81B6 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       -(SP) = R3
                                                      
81B7 2F EC FE                                         _PUSH3: DEW     SP
81BA 38 A0 81                                                 JPS     _PUT3_
81BD 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (RP) = R1 "half function"
                                                      
81BE 15 F3 FE                                         _RPUT1_: LDA    R1.1
81C1 1E EE FE                                                 STR     RP
81C4 2F EE FE                                                 DEW     RP
81C7 15 F2 FE                                                 LDA     R1.0
81CA 1E EE FE                                                 STR     RP
81CD 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (RP) = R1
                                                      
81CE 2E EE FE                                         _RPUT1: INW     RP
81D1 38 BE 81                                                 JPS     _RPUT1_
81D4 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       -(RP) = R1
                                                      
81D5 2F EE FE                                         _RPUSH1: DEW    RP
81D8 38 BE 81                                                 JPS     _RPUT1_
81DB 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (RP) = R2 "half function"
                                                      
81DC 15 F7 FE                                         _RPUT2_: LDA    R2.1
81DF 1E EE FE                                                 STR     RP
81E2 2F EE FE                                                 DEW     RP
81E5 15 F6 FE                                                 LDA     R2.0
81E8 1E EE FE                                                 STR     RP
81EB 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (RP) = R2
                                                      
81EC 2E EE FE                                         _RPUT2: INW     RP
81EF 38 DC 81                                                 JPS     _RPUT2_
81F2 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       -(RP) = R2
                                                      
81F3 2F EE FE                                         _RPUSH2: DEW    RP
81F6 38 DC 81                                                 JPS     _RPUT2_
81F9 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (RP) = R3 "half function"
                                                      
81FA 15 FB FE                                         _RPUT3_: LDA    R3.1
81FD 1E EE FE                                                 STR     RP
8200 2F EE FE                                                 DEW     RP
8203 15 FA FE                                                 LDA     R3.0
8206 1E EE FE                                                 STR     RP
8209 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (RP) = R3
                                                      
820A 2E EE FE                                         _RPUT3: INW     RP
820D 38 FA 81                                                 JPS     _RPUT3_
8210 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       -(RP) = R3
                                                      
8211 2F EE FE                                         _RPUSH3: DEW    RP
8214 38 FA 81                                                 JPS     _RPUT3_
8217 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = R1 + R2
                                                      
8218 15 F2 FE                                         _ADD16: LDA     R1.0
821B 17 F6 FE                                                 ADA     R2.0
821E 16 F2 FE                                                 STA     R1.0
8221 15 F3 FE                                                 LDA     R1.1
8224 1A F7 FE                                                 ACA     R2.1
8227 16 F3 FE                                                 STA     R1.1
822A 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1X = R1X + R2X
                                                      
822B 15 F2 FE                                         _ADD32: LDA     R1.0
822E 17 F6 FE                                                 ADA     R2.0
8231 16 F2 FE                                                 STA     R1.0
8234 15 F3 FE                                                 LDA     R1.1
8237 1A F7 FE                                                 ACA     R2.1
823A 16 F3 FE                                                 STA     R1.1
823D 15 F4 FE                                                 LDA     R1.2
8240 1A F8 FE                                                 ACA     R2.2
8243 16 F4 FE                                                 STA     R1.2
8246 15 F5 FE                                                 LDA     R1.3
8249 1A F9 FE                                                 ACA     R2.3
824C 16 F5 FE                                                 STA     R1.3
824F 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (R1)
                                                      
8250 1D F2 FE                                         _AT:    LDR     R1              ; Get LSB
8253 16 F4 FE                                                 STA     R1.2            ; ... Store temp
8256 2E F2 FE                                                 INW     R1              ; Bump
8259 1D F2 FE                                                 LDR     R1              ; Get MSB
825C 16 F5 FE                                                 STA     R1.3            ; ... Store temp
825F 15 F4 FE                                                 LDA     R1.2            ; Get temp LSB
8262 16 F2 FE                                                 STA     R1.0            ; ... Store
8265 15 F5 FE                                                 LDA     R1.3            ; Get temp MSB
8268 16 F3 FE                                                 STA     R1.1            ; ... Store
826B 39                                                       RTS                     ; Done
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (R3)
                                                      
826C 1D FA FE                                         _LD16:  LDR     R3
826F 16 F2 FE                                                 STA     R1.0
8272 2E FA FE                                                 INW     R3
8275 1D FA FE                                                 LDR     R3
8278 16 F3 FE                                                 STA     R1.1
827B 2F FA FE                                                 DEW     R3
827E 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (R3) = R1
                                                      
827F 15 F2 FE                                         _ST16:  LDA     R1.0
8282 1E FA FE                                                 STR     R3
8285 2E FA FE                                                 INW     R3
8288 15 F3 FE                                                 LDA     R1.1
828B 1E FA FE                                                 STR     R3
828E 2F FA FE                                                 DEW     R3
8291 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1.0 = R1.0 & R2.0
                                                      
8292 0E 08                                            _AND8:  LDI     8               ; Load bit counter
8294 16 FE FE                                                 STA     BC              ; :
8297 15 F6 FE                                         _AND81: LDA     R2.0            ; Load second operand
829A 05                                                       LSL                     ; Shift 2b7 into C
829B 16 F6 FE                                                 STA     R2.0            ; Store shifted second operand
829E 15 F2 FE                                                 LDA     R1.0            ; Load first operand
82A1 3C AA 82                                                 BCC     _AND82          ; If C is clear: Shift in a zero
                                                              ; 2b7 is set
82A4 11 00                                                    CPI     0               ; Is first operand < 0, i.e. is 1b7 set?
82A6 3F AA 82                                                 BMI     _AND82           ; N is set: 1b7 is set
                                                              ; 1b7 is clear
82A9 03                                                       CLC                     ; 1b7 is clear: Clear C
82AA 06                                               _AND82: ROL                     ; Shift C into result
82AB 16 F2 FE                                                 STA     R1.0            ; Store first operand/result
82AE 27 FE FE                                                 DEB     BC              ; All bits done?
82B1 3A 97 82                                                 BNE     _AND81          ;   NO: Do one more
82B4 39                                                       RTS                     ;   YES: All done
                                                      
                                                      ; ------------------------------
                                                      ;       R1.0 = R1.0 | R2.0
                                                      
82B5 0E 08                                            _OR8:   LDI     8               ; Load bit counter
82B7 16 FE FE                                                 STA     BC              ; :
82BA 15 F6 FE                                         _OR810: LDA     R2.0            ; Load second operand
82BD 05                                                       LSL                     ; Shift 2b7 into C
82BE 16 F6 FE                                                 STA     R2.0            ; Store shifted second operand
82C1 15 F2 FE                                                 LDA     R1.0            ; Load first operand
82C4 3D CD 82                                                 BCS     _OR820          ; If C is set, shift it into result
                                                              ; 2b7 is clear
82C7 11 00                                                    CPI     0               ; Is first operand < 0, i.e. is 1b7 set?
82C9 3F CD 82                                                 BMI     _OR820          ; N is clear: 1b7 is clear
                                                              ; 1b7 is clear
82CC 03                                                       CLC                     ; Neither bit is set: Clear C 
82CD 06                                               _OR820: ROL                     ; Shift C into result
82CE 16 F2 FE                                                 STA     R1.0            ; Store first operand/result
82D1 27 FE FE                                                 DEB     BC              ; All bits done?
82D4 3A BA 82                                                 BNE     _OR810          ;   NO: Do one more
82D7 39                                                       RTS                     ;   YES: All done
                                                      
                                                      ; ------------------------------
                                                      ;       R1.0 = R1.0 ^ R2.0
                                                      
82D8 0E 08                                            _XOR8:  LDI     8               ; Load bit counter
82DA 16 FE FE                                                 STA     BC              ; :
82DD 15 F6 FE                                         _XOR81: LDA     R2.0            ; Get second operand
82E0 05                                                       LSL                     ; Shift b7 into C
82E1 16 F6 FE                                                 STA     R2.0            ; Store shifted second operand
82E4 15 F2 FE                                                 LDA     R1.0            ; Load first operand
82E7 3D F2 82                                                 BCS     _XOR82          ; C is set, check 1b7 for zero
                                                              ; 2b7 is clear
82EA 11 00                                                    CPI     0               ; Is first operand < 0, i.e. is b7 set?
82EC 3F F8 82                                                 BMI     _XOR84          ; 1b7 is set and 2b7 is clear, shift in C which is set
82EF 14 F7 82                                                 JPA     _XOR83          ; 1b7 and 2b7 are both zero, clear C and shift in 
                                                              ; 2b7 is set, check 1b7 for zero
82F2 11 00                                            _XOR82: CPI     0
82F4 3E F8 82                                                 BPL     _XOR84          ; If 1b7 is zero, shift in C which is set
82F7 03                                               _XOR83: CLC                     ; 1b7 and 2b7 are equal, shift in a zero
82F8 06                                               _XOR84: ROL                     ; Shift whatever is in C into result
82F9 16 F2 FE                                                 STA     R1.0            ; Store first operand/result
82FC 27 FE FE                                                 DEB     BC              ; All bits done?
82FF 3A DD 82                                                 BNE     _XOR81          ;   NO: Do one more
8302 39                                                       RTS                     ;   YES: All done
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = ~R1
                                                      
8303 15 F5 FE                                         _NOT32: LDA     R1.3            ; Negate MSB
8306 0B                                                       NEG                     ; Two-complement negation
8307 10 01                                                    SBI     1               ; Adjust to bitwise not
8309 16 F5 FE                                                 STA     R1.3            ; Store negated MSB
830C 15 F4 FE                                                 LDA     R1.2            ; Negate byte2
830F 0B                                                       NEG                     ; Two-complement negation
8310 10 01                                                    SBI     1               ; Adjust to bitwise not
8312 16 F4 FE                                                 STA     R1.2            ; Store negated byte2
8315 15 F3 FE                                         _NOT16: LDA     R1.1            ; Negate byte1
8318 0B                                                       NEG                     ; Two-complement negation
8319 10 01                                                    SBI     1               ; Adjust to bitwise not
831B 16 F3 FE                                                 STA     R1.1            ; Store negated byte1
831E 15 F2 FE                                                 LDA     R1.0            ; Negate LSB
8321 0B                                                       NEG                     ; Two-complement negation
8322 10 01                                                    SBI     1               ; Adjust to bitwise not
8324 16 F2 FE                                                 STA     R1.0            ; Store negated LSB
8327 39                                                       RTS                     ; Done
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = -R1
                                                      
8328 38 15 83                                         _NEG16: JPS     _NOT16          ; Bitwise NOT R1
832B 15 F2 FE                                                 LDA     R1.0            ; Add one to make it 2-complement
832E 0F 01                                                    ADI     1               ; :
8330 16 F2 FE                                                 STA     R1.0            ; :
8333 15 F3 FE                                                 LDA     R1.1            ; :
8336 12 00                                                    ACI     0               ; :
8338 16 F3 FE                                                 STA     R1.1            ; :
833B 39                                                       RTS                     ; Done
                                                      
                                                      ; ------------------------------
                                                      ;       R1X = -R1X
                                                      
833C 38 03 83                                         _NEG32: JPS     _NOT32          ; Bitwise NOT R1X
833F 15 F2 FE                                                 LDA     R1.0            ; Add one to make it 2-complement
8342 0F 01                                                    ADI     1               ; :
8344 16 F2 FE                                                 STA     R1.0            ; :
8347 15 F3 FE                                                 LDA     R1.1            ; :
834A 12 00                                                    ACI     0               ; :
834C 16 F3 FE                                                 STA     R1.1            ; :
834F 15 F4 FE                                                 LDA     R1.2            ; :
8352 12 00                                                    ACI     0               ; :
8354 16 F4 FE                                                 STA     R1.2            ; :
8357 15 F5 FE                                                 LDA     R1.3            ; :
835A 12 00                                                    ACI     0               ; :
835C 16 F5 FE                                                 STA     R1.3            ; :
835F 39                                                       RTS                     ; Done
                                                      
                                                      ; ------------------------------
                                                      ;       R1 <-> R2
                                                      
8360 38 7B 81                                         _XCH16: JPS     _PUSH1          ; Temp = R1
8363 15 F6 FE                                                 LDA     R2.0            ; R1 = R2
8366 16 F2 FE                                                 STA     R1.0            ; :
8369 15 F7 FE                                                 LDA     R2.1            ; :
836C 16 F3 FE                                                 STA     R1.1            ; :
836F 38 B6 80                                                 JPS     _POP2           ; R2 = Temp
8372 39                                                       RTS                     ; Done
                                                      
                                                      ; ------------------------------
                                                      ;       +ORIGIN
                                                      ; NOTE: Index number in R2
                                                      
8373 0E 00                                            _PORIG: LDI     <ORIGIN         ; R1 = ORIGIN address
8375 16 FA FE                                                 STA     R3.0            ; :
8378 0E 80                                                    LDI     >ORIGIN         ; :
837A 16 FB FE                                                 STA     R3.1            ; :
837D 15 F6 FE                                                 LDA     R2.0            ; Get index number
8380 30 FA FE                                                 ADW     R3              ; Compute addr
8383 39                                                       RTS                     ; Done
                                                      
                                                      ; ------------------------------
                                                      ;       _USER
                                                      ; NOTE: Index number in R2
                                                      
8384 15 F0 FE                                         _USER:  LDA     UP.0            ; R1 = UP
8387 16 FA FE                                                 STA     R3.0            ; :
838A 15 F1 FE                                                 LDA     UP.1            ; :
838D 16 FB FE                                                 STA     R3.1            ; :
8390 15 F6 FE                                                 LDA     R2.0            ; Get index number
8393 30 FA FE                                                 ADW     R3              ; Compute addr
8396 39                                                       RTS                     ; Done
                                                      
                                                      ; ------------------------------
                                                      ;       _SWAP8
                                                      ; Swaps R1.1 <-> R1.0
                                                      ;       R2.1 <-> R2.0
                                                      
8397 15 F2 FE                                         _SWAP8: LDA     R1.0
839A 16 FF FE                                                 STA     TMP
839D 15 F3 FE                                                 LDA     R1.1
83A0 16 F2 FE                                                 STA     R1.0
83A3 15 FF FE                                                 LDA     TMP
83A6 16 F3 FE                                                 STA     R1.1
83A9 15 F6 FE                                                 LDA     R2.0
83AC 16 FF FE                                                 STA     TMP
83AF 15 F7 FE                                                 LDA     R2.1
83B2 16 F6 FE                                                 STA     R2.0
83B5 15 FF FE                                                 LDA     TMP
83B8 16 F7 FE                                                 STA     R2.1
83BB 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = R1 & R2
                                                      
83BC 38 92 82                                         _AND16: JPS     _AND8
83BF 38 97 83                                                 JPS     _SWAP8
83C2 38 92 82                                                 JPS     _AND8
83C5 38 97 83                                                 JPS     _SWAP8
83C8 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = R1 | R2
                                                      
83C9 38 B5 82                                         _OR16:  JPS     _OR8
83CC 38 97 83                                                 JPS     _SWAP8
83CF 38 B5 82                                                 JPS     _OR8
83D2 38 97 83                                                 JPS     _SWAP8
83D5 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = R1 ^ R2
                                                      
83D6 38 D8 82                                         _XOR16: JPS     _XOR8
83D9 38 97 83                                                 JPS     _SWAP8
83DC 38 D8 82                                                 JPS     _XOR8
83DF 38 97 83                                                 JPS     _SWAP8
83E2 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3X = R1X * R2X
                                                      
83E3 0E 10                                            _UMULT: LDI     16              ; Set bit counter
83E5 16 FE FE                                                 STA     BC
83E8 0E 00                                                    LDI     0               ; R3X = 0
83EA 16 FA FE                                                 STA     R3.0            ; :
83ED 16 FB FE                                                 STA     R3.1            ; :
83F0 16 FC FE                                                 STA     R3.2            ; :
83F3 16 FD FE                                                 STA     R3.3            ; :
83F6 16 F4 FE                                                 STA     R1.2            ; R1H = 0
83F9 16 F5 FE                                                 STA     R1.3            ; :
83FC 15 F7 FE                                         _UMU10: LDA     R2.1            ; R2 >> 1
83FF 07                                                       LSR                     ; :
8400 16 F7 FE                                                 STA     R2.1            ; :
8403 15 F6 FE                                                 LDA     R2.0            ; :
8406 08                                                       ROR                     ; :
8407 16 F6 FE                                                 STA     R2.0            ; :
840A 3C 31 84                                                 BCC     _UMU20          ; No carry, no add
840D 15 FA FE                                                 LDA     R3.0            ; R3X = R3X + R1X
8410 17 F2 FE                                                 ADA     R1.0            ; :
8413 16 FA FE                                                 STA     R3.0            ; :
8416 15 FB FE                                                 LDA     R3.1            ; :
8419 1A F3 FE                                                 ACA     R1.1            ; :
841C 16 FB FE                                                 STA     R3.1            ; :
841F 15 FC FE                                                 LDA     R3.2            ; :
8422 1A F4 FE                                                 ACA     R1.2            ; :
8425 16 FC FE                                                 STA     R3.2            ; :
8428 15 FD FE                                                 LDA     R3.3            ; :
842B 1A F5 FE                                                 ACA     R1.3            ; :
842E 16 FD FE                                                 STA     R3.3            ; :
8431 15 F2 FE                                         _UMU20: LDA     R1.0            ; R1X << 1
8434 05                                                       LSL                     ; :
8435 16 F2 FE                                                 STA     R1.0            ; :
8438 15 F3 FE                                                 LDA     R1.1            ; :
843B 06                                                       ROL                     ; :
843C 16 F3 FE                                                 STA     R1.1            ; :
843F 15 F4 FE                                                 LDA     R1.2            ; :
8442 06                                                       ROL                     ; :
8443 16 F4 FE                                                 STA     R1.2            ; :
8446 15 F5 FE                                                 LDA     R1.3            ; :
8449 06                                                       ROL                     ; :
844A 16 F5 FE                                                 STA     R1.3            ; :
844D 27 FE FE                                                 DEB     BC              ; Decrement bit counter
8450 3A FC 83                                                 BNE     _UMU10          ; Not zero, more bits to go
8453 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1X / R2L
                                                      ;       R1H: Quotient
                                                      ;       R1L: Remainder
                                                      
8454 0E 10                                            _UDIV:  LDI     16              ; Set bit counter
8456 16 FE FE                                                 STA     BC              ; :
                                                              
8459 15 F2 FE                                         _UDI10: LDA     R1.0            ; R1X = R1X << 1
845C 05                                                       LSL                     ; :
845D 16 F2 FE                                                 STA     R1.0            ; :
8460 15 F3 FE                                                 LDA     R1.1            ; :
8463 06                                                       ROL                     ; :
8464 16 F3 FE                                                 STA     R1.1            ; :
8467 15 F4 FE                                                 LDA     R1.2            ; :
846A 06                                                       ROL                     ; :
846B 16 F4 FE                                                 STA     R1.2            ; :
846E 15 F5 FE                                                 LDA     R1.3            ; :
8471 06                                                       ROL                     ; :
8472 16 F5 FE                                                 STA     R1.3            ; :
                                                      
8475 15 F4 FE                                                 LDA     R1.2            ; R3H = R1H
8478 16 FC FE                                                 STA     R3.2            ; :
847B 15 F5 FE                                                 LDA     R1.3            ; :
847E 16 FD FE                                                 STA     R3.3            ; :
                                                              
8481 15 FC FE                                                 LDA     R3.2            ; R3H = R3H - R2L
8484 18 F6 FE                                                 SBA     R2.0            ; :
8487 16 FC FE                                                 STA     R3.2            ; :
848A 15 FD FE                                                 LDA     R3.3            ; :
848D 1B F7 FE                                                 SCA     R2.1            ; :
8490 16 FD FE                                                 STA     R3.3            ; :
                                                              
8493 3C A5 84                                                 BCC     _UDI20
                                                              
8496 15 FC FE                                                 LDA     R3.2            ; R1H = R3H
8499 16 F4 FE                                                 STA     R1.2            ; :
849C 15 FD FE                                                 LDA     R3.3            ; :
849F 16 F5 FE                                                 STA     R1.3            ; :
                                                              
84A2 2E F2 FE                                                 INW     R1.0            ; R1L++
                                                              
84A5 27 FE FE                                         _UDI20: DEB     BC              ; All bits done?
84A8 3A 59 84                                                 BNE     _UDI10          ; NO: Loop again
                                                              
84AB 39                                                       RTS
                                                      ; INCLUDE         debug.asm
                                                      
                                                      ; INCLUDE         inner.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; INNER INTERPRETER
                                                      
84AC 2F EC FE                                         IPUSH:  DEW     SP              ; -(SP) = R1H
84AF 15 F5 FE                                                 LDA     R1.3
84B2 1E EC FE                                                 STR     SP
84B5 2F EC FE                                                 DEW     SP
84B8 15 F4 FE                                                 LDA     R1.2
84BB 1E EC FE                                                 STR     SP
84BE 2F EC FE                                         PUSH:   DEW     SP              ; -(SP) = R1L
84C1 15 F3 FE                                                 LDA     R1.1
84C4 1E EC FE                                                 STR     SP
84C7 2F EC FE                                                 DEW     SP
84CA 15 F2 FE                                                 LDA     R1.0
84CD 1E EC FE                                                 STR     SP
84D0 1D E8 FE                                         NEXT:   LDR     IP              ; WA = (IP)+
84D3 16 EA FE                                                 STA     WA.0
84D6 2E E8 FE                                                 INW     IP
84D9 1D E8 FE                                                 LDR     IP
84DC 16 EB FE                                                 STA     WA.1
84DF 2E E8 FE                                                 INW     IP
84E2 1D EA FE                                         NEXT10: LDR     WA              ; BC/TMP = (WA)+
84E5 16 FE FE                                                 STA     BC
84E8 2E EA FE                                                 INW     WA
84EB 1D EA FE                                                 LDR     WA
84EE 16 FF FE                                                 STA     TMP
84F1 2E EA FE                                                 INW     WA
                                                      ;        LDA     DBG
                                                      ;        CPI     0
                                                      ;        BEQ     NEXT11
                                                      ;        JPS     DEBUG
84F4 1C FE FE                                         NEXT11: JPR     BC              ; jump @(BC/TMP)
                                                      
                                                      ; ------------------------------
                                                      ;       Push TRUE and FALSE
                                                      
84F7 2C F2 FE                                         PUSHT:  CLW     R1              ; A zero
84FA 2F F2 FE                                                 DEW     R1              ; Make it into a -1 i.e. TRUE flag
84FD 14 BE 84                                                 JPA     PUSH
                                                      
8500 2C F2 FE                                         PUSHF:  CLW     R1              ; A zero
8503 14 BE 84                                                 JPA     PUSH
                                                      
                                                      ; ------------------------------
                                                      ;       Push R1X, MSB as TOS
                                                      
8506 2F EC FE                                         DPUSH:  DEW     SP              ; -(SP) = R1X
8509 15 F3 FE                                                 LDA     R1.1
850C 1E EC FE                                                 STR     SP
850F 2F EC FE                                                 DEW     SP
8512 15 F2 FE                                                 LDA     R1.0
8515 1E EC FE                                                 STR     SP
8518 2F EC FE                                                 DEW     SP
851B 15 F5 FE                                                 LDA     R1.3
851E 1E EC FE                                                 STR     SP
8521 2F EC FE                                                 DEW     SP
8524 15 F4 FE                                                 LDA     R1.2
8527 1E EC FE                                                 STR     SP
852A 14 D0 84                                                 JPA     NEXT
                                                      
                                                      ; INCLUDE         primaries.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; FORTH PRIMARIES
                                                      ;
                                                      
852D 83 4C 49 D4                                      HLIT:   DB      ^3 "LI" ^'T'                            ; ***** LIT
8531 00 00                                                    DW      0
8533 35 85                                            LIT:    DW      LIT0
8535 38 2A 80                                         LIT0:   JPS     _LIT            ; R1 = (IP)+
8538 14 BE 84                                                 JPA     PUSH            ; -(SP) = R1; NEXT
                                                      
853B 87 45 58 45 43 55 54 C5                          HEXEC:  DB      ^7 "EXECUT" ^'E'                        ; ***** EXECUTE
8543 2D 85                                                    DW      HLIT
8545 47 85                                            EXEC:   DW      EXEC0
8547 1D EC FE                                         EXEC0:  LDR     SP              ; WA = (SP)+
854A 16 EA FE                                                 STA     WA.0
854D 2E EC FE                                                 INW     SP
8550 1D EC FE                                                 LDR     SP
8553 16 EB FE                                                 STA     WA.1
8556 2E EC FE                                                 INW     SP
8559 14 E2 84                                                 JPA     NEXT10          ; jump @(WA)+
                                                      
855C 86 42 52 41 4E 43 C8                             HBRAN:  DB      ^6 "BRANC" ^'H'                         ; ***** BRANCH
8563 3B 85                                                    DW      HEXEC
8565 67 85                                            BRAN:   DW      BRAN0
8567 38 3D 80                                         BRAN0:  JPS     _BRAN           ; IP = IP + (IP)
856A 14 D0 84                                                 JPA     NEXT
                                                      
856D 87 30 42 52 41 4E 43 C8                          HZBRAN: DB      ^7 "0BRANC" ^'H'                        ; ***** 0BRANCH
8575 5C 85                                                    DW      HBRAN
8577 79 85                                            ZBRAN:  DW      ZBRAN0
8579 1D EC FE                                         ZBRAN0: LDR     SP
857C 11 00                                                    CPI     0               ; Low byte non-zero?
857E 3A 92 85                                                 BNE     ZBRA10          ; YES: Do not branch
8581 2E EC FE                                                 INW     SP
8584 1D EC FE                                                 LDR     SP
8587 11 00                                                    CPI     0               ; High byte non-zero?
8589 3A 95 85                                                 BNE     ZBRA20          ; YES: Do not branch
858C 2E EC FE                                                 INW     SP
858F 14 67 85                                                 JPA     BRAN0           ; IP = IP + (IP); NEXT
8592 2E EC FE                                         ZBRA10: INW     SP
8595 2E EC FE                                         ZBRA20: INW     SP
8598 2E E8 FE                                                 INW     IP              ; Just skip jump offset
859B 2E E8 FE                                                 INW     IP
859E 14 D0 84                                                 JPA     NEXT
                                                      
85A1 87 28 2B 4C 4F 4F 50 A9                          HXPLOO: DB      ^7 "(+LOOP" ^')'                        ; ***** (+LOOP)
85A9 6D 85                                                    DW      HZBRAN
85AB AD 85                                            XPLOO:  DW      XPLOO0
85AD 38 AF 80                                         XPLOO0: JPS     _GET2           ; R2 = (SP) [only copying increment]
85B0 38 21 81                                                 JPS     _RPOP1          ; R1 = (RP)+
85B3 38 18 82                                                 JPS     _ADD16          ; R1 = counter'
85B6 38 38 81                                                 JPS     _RGET2          ; R2 = limit
85B9 38 D5 81                                                 JPS     _RPUSH1         ; -(RP) = R1'
85BC 38 F9 80                                                 JPS     _POP3           ; R3 = (SP)+ [now popping incr]
85BF 15 FB FE                                                 LDA     R3.1            ; Is increment negative?
85C2 11 00                                                    CPI     0               ; :
85C4 3E CA 85                                                 BPL     XPLO10
                                                              ; Handle negative increment
85C7 38 60 83                                                 JPS     _XCH16          ; R1 <-> R2
                                                              ; Compare counter to limit
85CA 15 F3 FE                                         XPLO10: LDA     R1.1            ; Compare MSB
85CD 19 F7 FE                                                 CPA     R2.1            ; :
85D0 3F 67 85                                                 BMI     BRAN0           ; R2 is greater, continue looping
85D3 3B D9 85                                                 BEQ     XPLO20          ; MSBs are equal, check LSBs
85D6 14 E2 85                                                 JPA     XPLO30          ; R1 is greater, stop looping
                                                              ; MSBs are equal
85D9 15 F2 FE                                         XPLO20: LDA     R1.0            ; Compare LSB
85DC 19 F6 FE                                                 CPA     R2.0            
85DF 3F 67 85                                                 BMI     BRAN0           ; R2 is greater, continue looping
                                                              ; Limit reached, cleanup rstack and stop looping
85E2 0E 04                                            XPLO30: LDI     4               ; Drop loop counter ...
85E4 30 EE FE                                                 ADW     RP              ; ... and loop limit
85E7 0E 02                                                    LDI     2               ; Skip branch offset
85E9 30 E8 FE                                                 ADW     IP              ; :
85EC 14 D0 84                                                 JPA     NEXT
                                                      
85EF 86 28 4C 4F 4F 50 A9                             HXLOOP: DB      ^6 "(LOOP" ^')'                         ; ***** (LOOP)
85F6 A1 85                                                    DW      HXPLOO
85F8 FA 85                                            XLOOP:  DW      XLOOP0
85FA 2C F2 FE                                         XLOOP0: CLW     R1              ; Push a one
85FD 2E F2 FE                                                 INW     R1              ; :
8600 38 7B 81                                                 JPS     _PUSH1          ; :
8603 14 AD 85                                                 JPA     XPLOO0          ; (+LOOP)
                                                      
8606 84 28 44 4F A9                                   HXDO:   DB      ^4 "(DO" ^')'                           ; ***** (DO)
860B EF 85                                                    DW      HXLOOP
860D 0F 86                                            XDO:    DW      XDO0
860F 38 03 81                                         XDO0:   JPS     _POP21          ; Loop counter, limit
8612 38 D5 81                                                 JPS     _RPUSH1         ; Push limit onto rstack
8615 38 F3 81                                                 JPS     _RPUSH2         ; Push loop counter onto rstack
8618 14 D0 84                                                 JPA     NEXT
                                                      
861B 81 C9                                            HI:     DB      ^1 ^'I'                                 ; ***** I
861D 06 86                                                    DW      HXDO
861F 21 86                                            I:      DW      I0
8621 38 1A 81                                         I0:     JPS     _RGET1          ; Get loop counter
8624 14 BE 84                                                 JPA     PUSH            ; Push it onto dstack
                                                      
8627 85 44 49 47 49 D4                                HDIGIT: DB      ^5 "DIGI" ^'T'                          ; ***** DIGIT
862D 1B 86                                                    DW      HI
862F 31 86                                            DIGIT:  DW      DIGIT0
8631 38 03 81                                         DIGIT0: JPS     _POP21          ; R2 = base, R1 = char
8634 15 F2 FE                                                 LDA     R1.0            ; Get character into A
8637 10 30                                                    SBI     '0'             ; Assume '0' - '9'
8639 3F 55 86                                                 BMI     DIGI88          ; Oops! Negative
863C 11 0A                                                    CPI     10              ; Greater than 9?
863E 3F 43 86                                                 BMI     DIGI10          ; No, it is 0 - 9
                                                              ; 'A' - 'Z' case
8641 10 07                                                    SBI     7               ; ch -= ('A' - '0') + 10
8643 19 F6 FE                                         DIGI10: CPA     R2.0            ; Greater than base?
8646 3F 4C 86                                                 BMI     DIGI77
8649 14 55 86                                                 JPA     DIGI88
864C 16 F2 FE                                         DIGI77: STA     R1.0            ; Store binary value
864F 38 7B 81                                                 JPS     _PUSH1          ; Push the value
8652 14 F7 84                                                 JPA     PUSHT           ; Push TRUE; NEXT
8655 14 00 85                                         DIGI88: JPA     PUSHF           ; Push FALSE; NEXT
                                                      
8658 86 28 46 49 4E 44 A9                             HPFIND: DB      ^6 "(FIND" ^')'                         ; ***** (FIND)
865F 27 86                                                    DW      HDIGIT
8661 63 86                                            PFIND:  DW      PFIND0
8663 38 73 80                                         PFIND0: JPS     _POP1           ; NFA
8666 38 F9 80                                                 JPS     _POP3           ; String address
8669 15 FA FE                                         PFIN10: LDA     R3.0            ; R2 = R3 (string address)
866C 16 F6 FE                                                 STA     R2.0            ; :
866F 15 FB FE                                                 LDA     R3.1            ; :
8672 16 F7 FE                                                 STA     R2.1            ; :
                                                              ; Fast comparison of length bytes
8675 1D F2 FE                                                 LDR     R1              ; Get lByte
8678 16 F4 FE                                                 STA     R1.2            ; ... Store as potential result
867B 05                                                       LSL                     ; lByte &= 0x3F
867C 05                                                       LSL                     ; :
867D 07                                                       LSR                     ; :
867E 07                                                       LSR                     ; :
867F 16 F8 FE                                                 STA     R2.2            ; R2.2 is counter for string match
8682 21 F6 FE                                                 CPR     R2              ; lByte == string length?
8685 3A A4 86                                                 BNE     PFIN25          ; NO: Move over to next header
                                                              ; Length bytes match, check names
8688 2E F2 FE                                         PFIN20: INW     R1              ; Bump pointers
868B 2E F6 FE                                                 INW     R2              ; :
868E 1D F2 FE                                                 LDR     R1              ; Get char from dictionary
8691 05                                                       LSL                     ; char &= 0x7F
8692 07                                                       LSR                     ; :
8693 21 F6 FE                                                 CPR     R2              ; Is it a match with search string?
8696 3A B0 86                                                 BNE     PFIN30          ; NO: Look at next header in dictionary
8699 27 F8 FE                                                 DEB     R2.2            ; YES: Decrement character counter
869C 11 00                                                    CPI     0               ; At end of string?
869E 3B D1 86                                                 BEQ     PFIN77          ; YES: This is the word we are looking for
86A1 14 88 86                                                 JPA     PFIN20          ; Match so far, try next char
                                                              ; Step to next header in dictionary
86A4 05                                               PFIN25: LSL                     ; Eliminate potential smudge bit
86A5 05                                                       LSL                     ; A = A & 0x1F
86A6 05                                                       LSL                     ; lByte consists of [^ISnnnnn]
86A7 07                                                       LSR                     ; :
86A8 07                                                       LSR                     ; :
86A9 07                                                       LSR                     ; :
86AA 16 F8 FE                                                 STA     R2.2            ; : also update char counter
86AD 2E F2 FE                                                 INW     R1              ; Bump NFA pointer to actual characters
86B0 2E F2 FE                                         PFIN30: INW     R1              ; Bump NFA pointer
86B3 27 F8 FE                                                 DEB     R2.2            ; Decrement character counter
86B6 11 00                                                    CPI     0               ; End of name field?
86B8 3A B0 86                                                 BNE     PFIN30          ; NO: Step to next char
86BB 38 50 82                                                 JPS     _AT             ; YES: R1 = (R1)
86BE 15 F3 FE                                                 LDA     R1.1            ; At end of dictionary?
86C1 11 00                                                    CPI     0               ; :
86C3 3A 69 86                                                 BNE     PFIN10          ; NO: Try this word for match
86C6 15 F2 FE                                                 LDA     R1.0            ; :
86C9 11 00                                                    CPI     0               ; :
86CB 3A 69 86                                                 BNE     PFIN10          ; NO: Try this word for match
                                                              ; Word not found, return a single FALSE
86CE 14 00 85                                         PFIN88: JPA     PUSHF           ; Done
                                                              ; Word found, return PFA, lByte, TRUE
86D1 0E 05                                            PFIN77: LDI     5               ; Bump ptr to PFA
86D3 30 F2 FE                                                 ADW     R1              ; :
86D6 38 7B 81                                                 JPS     _PUSH1          ; Push PFA
86D9 15 F4 FE                                                 LDA     R1.2            ; Get stored length byte
86DC 16 F2 FE                                                 STA     R1.0            ; :
86DF 24 F3 FE                                                 CLB     R1.1            ; Clear MSB
86E2 38 7B 81                                                 JPS     _PUSH1          ; Push length byte
86E5 14 F7 84                                                 JPA     PUSHT           ; Done
                                                      
86E8 87 45 4E 43 4C 4F 53 C5                          HENCL:  DB      ^7 "ENCLOS" ^'E'                        ; ***** ENCLOSE
86F0 58 86                                                    DW      HPFIND
86F2 F4 86                                            ENCL:   DW      ENCL0
86F4 38 F9 80                                         ENCL0:  JPS     _POP3           ; Get delimiter char
86F7 38 6C 80                                                 JPS     _GET1           ; Get addr of input
86FA 2C F6 FE                                                 CLW     R2              ; Initialize char index
                                                              ; Scan preceeding delimiters
86FD 1D F2 FE                                         ENCL10: LDR     R1              ; Get char from input
8700 11 00                                                    CPI     0               ; Is it <NUL>?
8702 3B 3A 87                                                 BEQ     ENCL50          ; YES: <NUL> before first non-delimiter
8705 19 FA FE                                                 CPA     R3.0            ; Is it a delimiter?
8708 3A 14 87                                                 BNE     ENCL20          ; NO: We have the start of next token
870B 2E F2 FE                                                 INW     R1              ; Bump to next char ...
870E 26 F6 FE                                                 INB     R2.0            ; ... also increase index
8711 14 FD 86                                                 JPA     ENCL10          ; Go back to look at next char
                                                              ; Start of token
8714 38 99 81                                         ENCL20: JPS     _PUSH2          ; Push result n1 (first char of token)
8717 1D F2 FE                                         ENCL30: LDR     R1              ; Get char from input
871A 11 00                                                    CPI     0               ; Is it <NUL>?
871C 3B 49 87                                                 BEQ     ENCL60          ; YES: <NUL> found
871F 19 FA FE                                                 CPA     R3.0            ; Is it a delimiter?
8722 3B 2E 87                                                 BEQ     ENCL40          ; YES: We have the end of the token
8725 2E F2 FE                                                 INW     R1              ; Bump to next char ...
8728 26 F6 FE                                                 INB     R2.0            ; ... also increase index
872B 14 17 87                                                 JPA     ENCL30          ; Go back to look at next char
                                                              ; End of token
872E 38 99 81                                         ENCL40: JPS     _PUSH2          ; Push result n2 (ending delimiter)
8731 26 F6 FE                                                 INB     R2.0            ; Also push n3 ...
8734 38 99 81                                                 JPS     _PUSH2          ; : ... (index to first non-scanned char)
8737 14 D0 84                                                 JPA     NEXT            ; Done
                                                              ; <NUL> word found
873A 38 99 81                                         ENCL50: JPS     _PUSH2          ; Push i (index to <NUL>)
873D 26 F6 FE                                                 INB     R2.0            ; Push i + 1 (a null is one character long)
8740 38 99 81                                                 JPS     _PUSH2          ; :
8743 38 99 81                                                 JPS     _PUSH2          ; :
8746 14 D0 84                                                 JPA     NEXT            ; Done
                                                              ; Token ends with a <NUL>
8749 38 99 81                                         ENCL60: JPS     _PUSH2          ; Push i twice to continue next round ...
874C 38 99 81                                                 JPS     _PUSH2          ; : ... by scanning the <NUL>
874F 14 D0 84                                                 JPA     NEXT            ; Done
                                                      
8752 84 45 4D 49 D4                                   HEMIT:  DB      ^4 "EMI" ^'T'                           ; ***** EMIT
8757 E8 86                                                    DW      HENCL
8759 5B 87                                            EMIT:   DW      EMIT0
875B 38 73 80                                         EMIT0:  JPS     _POP1           ; Get character
875E 15 F2 FE                                                 LDA     R1.0            ; Send char to terminal
8761 02                                                       OUT                     ; :
8762 0E 22                                                    LDI     34              ; OUT++
8764 16 F6 FE                                                 STA     R2.0            ; : R2 = Index to OUT
8767 38 84 83                                                 JPS     _USER           ; : R3 = Addr to OUT
876A 38 6C 82                                                 JPS     _LD16           ; : R1 = OUT
876D 2E F2 FE                                                 INW     R1              ; : R1++
8770 38 7F 82                                                 JPS     _ST16           ; : OUT = R1'
8773 14 D0 84                                                 JPA     NEXT            ; Done
                                                      
8776 83 4B 45 D9                                      HKEY:   DB      ^3 "KE" ^'Y'                            ; ***** KEY
877A 52 87                                                    DW      HEMIT
877C 7E 87                                            KEY:    DW      KEY0
877E 0A                                               KEY0:   INP                     ; Get char form terminal
877F 11 FF                                                    CPI     0xFF            ; Did we get a character?
8781 3B 7E 87                                                 BEQ     KEY0            ; NO: Try again
8784 16 F2 FE                                                 STA     R1.0            ; YES: Push character
8787 24 F3 FE                                                 CLB     R1.1            ; :
878A 14 BE 84                                                 JPA     PUSH            ; Push R1; NEXT
                                                      
878D 89 3F 54 45 52 4D 49 4E 41 CC                    HQTERM: DB      ^9 "?TERMINA" ^'L'                      ; ***** ?TERMINAL
8797 76 87                                                    DW      HKEY
8799 9B 87                                            QTERM:  DW      QTERM0
879B 2C F2 FE                                         QTERM0: CLW     R1              ; Default FALSE to return
879E 0A                                                       INP                     ; Get char from terminal
879F 11 FF                                                    CPI     0xFF            ; Did we get a character?
87A1 3B A7 87                                                 BEQ     QTER10          ; NO: Return FALSE
87A4 2F F2 FE                                                 DEW     R1              ; Make default FALSE into TRUE
87A7 14 BE 84                                         QTER10: JPA     PUSH            ; Push R1; NEXT
                                                      
87AA 85 43 4D 4F 56 C5                                HCMOVE: DB      ^5 "CMOV" ^'E'                          ; ***** CMOVE
87B0 8D 87                                                    DW      HQTERM
87B2 B4 87                                            CMOVE:  DW      CMOVE0
87B4 38 F9 80                                         CMOVE0: JPS     _POP3           ; R3 = count
87B7 38 03 81                                                 JPS     _POP21          ; R2 = dst, R1 = src
87BA 1D F2 FE                                         CMOV10: LDR     R1              ; Get byte from source
87BD 1E F6 FE                                                 STR     R2              ; Store to destination
87C0 2E F2 FE                                                 INW     R1              ; Bump source pointer
87C3 2E F6 FE                                                 INW     R2              ; Bump destination pointer
87C6 2F FA FE                                                 DEW     R3              ; Decrement count
87C9 15 FA FE                                                 LDA     R3.0            ; Low byte zero?
87CC 11 00                                                    CPI     0               ; :
87CE 3A BA 87                                                 BNE     CMOV10          ; NO: One more byte
87D1 15 FB FE                                                 LDA     R3.1            ; High byte zero?
87D4 11 00                                                    CPI     0               ; :
87D6 3A BA 87                                                 BNE     CMOV10          ; NO: One more byte
87D9 14 D0 84                                                 JPA     NEXT            ; YES: Count zero. Done.
                                                      
87DC 82 55 AA                                         HUSTAR: DB      ^2 "U" ^'*'                             ; ***** U*
87DF AA 87                                                    DW      HCMOVE
87E1 E3 87                                            USTAR:  DW      USTAR0
87E3 38 03 81                                         USTAR0: JPS     _POP21          ; R2 = oper2, R1 = oper1
87E6 38 E3 83                                                 JPS     _UMULT          ; u32 = u16 * u16
87E9 2F EC FE                                                 DEW     SP              ; -(SP) = R3X
87EC 15 FB FE                                                 LDA     R3.1            ; :
87EF 1E EC FE                                                 STR     SP              ; :
87F2 2F EC FE                                                 DEW     SP              ; :
87F5 15 FA FE                                                 LDA     R3.0            ; :
87F8 1E EC FE                                                 STR     SP              ; :
87FB 2F EC FE                                                 DEW     SP              ; :
87FE 15 FD FE                                                 LDA     R3.3            ; :
8801 1E EC FE                                                 STR     SP              ; :
8804 2F EC FE                                                 DEW     SP              ; :
8807 15 FC FE                                                 LDA     R3.2            ; :
880A 1E EC FE                                                 STR     SP              ; :
880D 14 D0 84                                                 JPA     NEXT            ; Done
                                                      
8810 82 55 AF                                         HUSLAS: DB      ^2 "U" ^'/'                             ; ***** U/
8813 DC 87                                                    DW      HUSTAR
8815 17 88                                            USLAS:  DW      USLAS0
8817 38 03 81                                         USLAS0: JPS     _POP21          ; R2 = divisor, R1 = dividend-hi
881A 15 F2 FE                                                 LDA     R1.0            ; Move high part to R1.2 and R1.3
881D 16 F4 FE                                                 STA     R1.2            ; :
8820 15 F3 FE                                                 LDA     R1.1            ; :
8823 16 F5 FE                                                 STA     R1.3            ; :
8826 38 73 80                                                 JPS     _POP1           ; dividend, low 16b
8829 38 54 84                                                 JPS     _UDIV           ; u32 / u16 --> quot_u16, rem_u16
882C 14 AC 84                                                 JPA     IPUSH           ; Push R1H; Push R1L; NEXT
                                                      
882F 83 41 4E C4                                      HAND:   DB      ^3 "AN" ^'D'                            ; ***** AND
8833 10 88                                                    DW      HUSLAS
8835 37 88                                            AND:    DW      AND0
8837 38 03 81                                         AND0:   JPS     _POP21          ; R2 = oper2, R1 = oper1
883A 38 BC 83                                                 JPS     _AND16          ; R1 = R1 & R2
883D 14 BE 84                                                 JPA     PUSH            ; Done
                                                      
8840 82 4F D2                                         HOR:    DB      ^2 "O" ^'R'                             ; ***** OR
8843 2F 88                                                    DW      HAND
8845 47 88                                            OR:     DW      OR0
8847 38 03 81                                         OR0:    JPS     _POP21          ; R2 = oper2, R1 = oper1
884A 38 C9 83                                                 JPS     _OR16           ; R1 = R1 | R2
884D 14 BE 84                                                 JPA     PUSH            ; Done
                                                      
8850 83 58 4F D2                                      HXOR:   DB      ^3 "XO" ^'R'                            ; ***** XOR
8854 40 88                                                    DW      HOR
8856 58 88                                            XOR:    DW      XOR0
8858 38 03 81                                         XOR0:   JPS     _POP21          ; R2 = oper2, R1 = oper1
885B 38 D6 83                                                 JPS     _XOR16          ; R1 = R1 ^ R2
885E 14 BE 84                                                 JPA     PUSH            ; Done
                                                      
8861 83 53 50 C0                                      HSPAT:  DB      ^3 "SP" ^'@'                            ; ***** SP@
8865 50 88                                                    DW      HXOR
8867 69 88                                            SPAT:   DW      SPAT0
8869 15 EC FE                                         SPAT0:  LDA     SP.0            ; Get stack pointer
886C 16 F2 FE                                                 STA     R1.0            ; : into R1
886F 15 ED FE                                                 LDA     SP.1            ; :
8872 16 F3 FE                                                 STA     R1.1            ; :
8875 14 BE 84                                                 JPA     PUSH            ; Push R1; NEXT
                                                      
8878 83 53 50 A1                                      HSPSTO: DB      ^3 "SP" ^'!'                            ; ***** SP!
887C 61 88                                                    DW      HSPAT
887E 80 88                                            SPSTO:  DW      SPSTO0
8880 0E 12                                            SPSTO0: LDI     18              ; Index of SP0
8882 16 F6 FE                                                 STA     R2.0            ; : in boot table
8885 38 73 83                                                 JPS     _PORIG          ; R3 = &bootTable[R2]
8888 38 6C 82                                                 JPS     _LD16           ; R1 = XSP
888B 15 F2 FE                                                 LDA     R1.0            ; SP = R1
888E 16 EC FE                                                 STA     SP.0            ; :
8891 15 F3 FE                                                 LDA     R1.1            ; :
8894 16 ED FE                                                 STA     SP.1            ; :
8897 14 D0 84                                                 JPA     NEXT            ; Done
                                                      
889A 83 52 50 A1                                      HRPSTO: DB      ^3 "RP" ^'!'                            ; ***** RP!
889E 78 88                                                    DW      HSPSTO
88A0 A2 88                                            RPSTO:  DW      RPSTO0
88A2 0E 14                                            RPSTO0: LDI     20              ; Index of SP0
88A4 16 F6 FE                                                 STA     R2.0            ; : in boot table
88A7 38 73 83                                                 JPS     _PORIG          ; R3 = &bootTable[R2]
88AA 38 6C 82                                                 JPS     _LD16           ; R1 = XRP
88AD 15 F2 FE                                                 LDA     R1.0            ; SP = R1
88B0 16 EE FE                                                 STA     RP.0            ; :
88B3 15 F3 FE                                                 LDA     R1.1            ; :
88B6 16 EF FE                                                 STA     RP.1            ; :
88B9 14 D0 84                                                 JPA     NEXT            ; Done
                                                      
88BC 83 55 50 A1                                      HUPSTO: DB      ^3 "UP" ^'!'                            ; ***** UP!
88C0 9A 88                                                    DW      HRPSTO
88C2 C4 88                                            UPSTO:  DW      UPSTO0
88C4 0E 10                                            UPSTO0: LDI     16              ; Index of UP0
88C6 16 F6 FE                                                 STA     R2.0            ; : in boot table
88C9 38 73 83                                                 JPS     _PORIG          ; R3 = &bootTable[R2]
88CC 38 6C 82                                                 JPS     _LD16           ; R1 = XUP
88CF 15 F2 FE                                                 LDA     R1.0            ; UP = R1
88D2 16 F0 FE                                                 STA     UP.0            ; :
88D5 15 F3 FE                                                 LDA     R1.1            ; :
88D8 16 F1 FE                                                 STA     UP.1            ; :
88DB 14 D0 84                                                 JPA     NEXT            ; Done
                                                      
88DE 82 3B D3                                         HSEMIS: DB      ^2 ";" ^'S'                             ; ***** ;S
88E1 9A 88                                                    DW      HRPSTO
88E3 E5 88                                            SEMIS:  DW      SEMIS0
88E5 1D EE FE                                         SEMIS0: LDR     RP              ; IP = (RP)+
88E8 16 E8 FE                                                 STA     IP.0            ; :
88EB 2E EE FE                                                 INW     RP              ; :
88EE 1D EE FE                                                 LDR     RP              ; :
88F1 16 E9 FE                                                 STA     IP.1            ; :
88F4 2E EE FE                                                 INW     RP              ; :
88F7 14 D0 84                                                 JPA     NEXT            ; Done
                                                      
88FA 85 4C 45 41 56 C5                                HLEAVE: DB      ^5 "LEAV" ^'E'                          ; ***** LEAVE
8900 DE 88                                                    DW      HSEMIS
8902 04 89                                            LEAVE:  DW      LEAVE0
8904 38 21 81                                         LEAVE0: JPS     _RPOP1          ; 2(RP) = (RP)
8907 38 CE 81                                                 JPS     _RPUT1          ; :
890A 38 D5 81                                                 JPS     _RPUSH1         ; :
890D 14 D0 84                                                 JPA     NEXT
                                                      
8910 82 3E D2                                         HTOR:   DB      ^2 ">" ^'R'                             ; ***** >R
8913 FA 88                                                    DW      HLEAVE
8915 17 89                                            TOR:    DW      TOR0
8917 38 73 80                                         TOR0:   JPS     _POP1           ; -(RP) = (SP)+
891A 38 D5 81                                                 JPS     _RPUSH1         ; :
891D 14 D0 84                                                 JPA     NEXT
                                                      
8920 82 52 BE                                         HFROMR: DB      ^2 "R" ^'>'                             ; ***** R>
8923 10 89                                                    DW      HTOR
8925 27 89                                            FROMR:  DW      FROMR0
8927 38 21 81                                         FROMR0: JPS     _RPOP1          ; -(SP) = (RP)+
892A 14 BE 84                                                 JPA     PUSH            ; :
                                                      
892D 81 D2                                            HR:     DB      ^1 ^'R'                                 ; ***** R
892F 20 89                                                    DW      HFROMR
8931 33 89                                            R:      DW      R0
8933 38 1A 81                                         R0:     JPS     _RGET1          ; -(SP) = (RP)
8936 14 BE 84                                                 JPA     PUSH            ; :
                                                      
8939 82 30 BD                                         HZEQU:  DB      ^2 "0" ^'='                             ; ***** 0=
893C 2D 89                                                    DW      HR
893E 40 89                                            ZEQU:   DW      ZEQU0
8940 1D EC FE                                         ZEQU0:  LDR     SP              ; Get low byte
8943 11 00                                                    CPI     0               ; Is it zero?
8945 3A 59 89                                                 BNE     ZEQU10          ; NO: Return FALSE
8948 2E EC FE                                                 INW     SP              ; YES: Have to inspect
894B 1D EC FE                                                 LDR     SP              ; : high byte as well
894E 11 00                                                    CPI     0               ; Is it zero?
8950 3A 5C 89                                                 BNE     ZEQU20          ; NO: Return FALSE
8953 2E EC FE                                                 INW     SP              ; Make POP complete
8956 14 F7 84                                                 JPA     PUSHT           ; YES: Return TRUE
8959 2E EC FE                                         ZEQU10: INW     SP              ; POP argument off dstack
895C 2E EC FE                                         ZEQU20: INW     SP              ; : Make POP complete
895F 14 00 85                                                 JPA     PUSHF           ; Return FALSE
                                                      
8962 82 30 BC                                         HZLESS: DB      ^2 "0" ^'<'                             ; ***** 0<
8965 39 89                                                    DW      HZEQU
8967 69 89                                            ZLESS:  DW      ZLESS0
8969 2E EC FE                                         ZLESS0: INW     SP              ; Inspect high byte only
896C 1D EC FE                                                 LDR     SP              ; Get high byte
896F 11 00                                                    CPI     0               ; Is high byte negative?
8971 3F 7A 89                                                 BMI     ZLES10          ; YES: Return TRUE
8974 2E EC FE                                                 INW     SP              ; NO: POP high byte also
8977 14 00 85                                                 JPA     PUSHF           ; Return FALSE
897A 2E EC FE                                         ZLES10: INW     SP              ; POP high byte also
897D 14 F7 84                                                 JPA     PUSHT           ; Return TRUE
                                                      
8980 81 AB                                            HPLUS:  DB      ^1 ^'+'                                 ; ***** +
8982 62 89                                                    DW      HZLESS
8984 86 89                                            PLUS:   DW      PLUS0
8986 38 03 81                                         PLUS0:  JPS     _POP21          ; R2 = oper2, R1 = oper1
8989 38 18 82                                                 JPS     _ADD16          ; R1 = R1 + R2
898C 14 BE 84                                                 JPA     PUSH            ; -(SP) = R1; NEXT
                                                      
898F 82 44 AB                                         HDPLUS: DB      ^2 "D" ^'+'                             ; ***** D+
8992 80 89                                                    DW      HPLUS
8994 96 89                                            DPLUS:  DW      DPLUS0
8996 38 BD 80                                         DPLUS0: JPS     _DPOP2          ; Get second operand
8999 38 7A 80                                                 JPS     _DPOP1          ; Get first operand
899C 38 2B 82                                                 JPS     _ADD32          ; R1X = R1X + R2X
899F 14 06 85                                                 JPA     DPUSH           ; -(SP) = R1X; NEXT
                                                      
89A2 85 4D 49 4E 55 D3                                HMINUS: DB      ^5 "MINU" ^'S'                          ; ***** MINUS
89A8 8F 89                                                    DW      HDPLUS
89AA AC 89                                            MINUS:  DW      MINUS0
89AC 38 73 80                                         MINUS0: JPS     _POP1           ; Get operand
89AF 38 28 83                                                 JPS     _NEG16          ; Negate
89B2 14 BE 84                                                 JPA     PUSH
                                                      
89B5 86 44 4D 49 4E 55 D3                             HDMINU: DB      ^6 "DMINU" ^'S'                         ; ***** DMINUS
89BC A2 89                                                    DW      HMINUS
89BE C0 89                                            DMINU:  DW      DMINU0
89C0 38 7A 80                                         DMINU0: JPS     _DPOP1          ; Get operand
89C3 38 3C 83                                                 JPS     _NEG32          ; Negate
89C6 14 06 85                                                 JPA     DPUSH
                                                      
89C9 84 4F 56 45 D2                                   HOVER:  DB      ^4 "OVE" ^'R'                           ; **** OVER
89CE B5 89                                                    DW      HDMINU
89D0 D2 89                                            OVER:   DW      OVER0
89D2 38 B6 80                                         OVER0:  JPS     _POP2           ; n1 n2 -- n1 n2 n1
89D5 38 6C 80                                                 JPS     _GET1           ; :
89D8 38 99 81                                                 JPS     _PUSH2          ; :
89DB 14 BE 84                                                 JPA     PUSH            ; :
                                                      
89DE 84 44 52 4F D0                                   HDROP:  DB      ^4 "DRO" ^'P'                           ; **** DROP
89E3 C9 89                                                    DW      HOVER
89E5 E7 89                                            DROP:   DW      DROP0
89E7 2E EC FE                                         DROP0:  INW     SP              ; n1 --
89EA 2E EC FE                                                 INW     SP              ; :
89ED 14 D0 84                                                 JPA     NEXT            ; Done
                                                      
89F0 84 53 57 41 D0                                   HSWAP:  DB      ^4 "SWA" ^'P'                           ; **** SWAP
89F5 DE 89                                                    DW      HDROP
89F7 F9 89                                            SWAP:   DW      SWAP0
89F9 38 03 81                                         SWAP0:  JPS     _POP21          ; n1 n2 -- n2 n1
89FC 38 99 81                                                 JPS     _PUSH2          ; :
89FF 14 BE 84                                                 JPA     PUSH            ; :
                                                      
8A02 83 44 55 D0                                      HDUP:   DB      ^3 "DU" ^'P'                            ; **** DUP
8A06 F0 89                                                    DW      HSWAP
8A08 0A 8A                                            DUP:    DW      DUP0
8A0A 38 6C 80                                         DUP0:   JPS     _GET1           ; n1 -- n1 n1
8A0D 14 BE 84                                                 JPA     PUSH            ; :
                                                      
8A10 82 2B A1                                         HPSTOR: DB      ^2 "+" ^'!'                             ; ***** +!
8A13 02 8A                                                    DW      HDUP
8A15 17 8A                                            PSTOR:  DW      PSTOR0
8A17 38 F9 80                                         PSTOR0: JPS     _POP3           ; R3 = addr
8A1A 38 B6 80                                                 JPS     _POP2           ; R2 = incr
8A1D 38 6C 82                                                 JPS     _LD16           ; R1 = (R3)
8A20 38 18 82                                                 JPS     _ADD16          ; R1 = R1 + R2
8A23 38 7F 82                                                 JPS     _ST16           ; (R3) = R1
8A26 14 D0 84                                                 JPA     NEXT            ; Done
                                                      
8A29 86 54 4F 47 47 4C C5                             HTOGGL: DB      ^6 "TOGGL" ^'E'                         ; ***** TOGGLE
8A30 10 8A                                                    DW      HPSTOR
8A32 34 8A                                            TOGGL:  DW      TOGGL0
8A34 38 B6 80                                         TOGGL0: JPS     _POP2           ; R2 = bit mask
8A37 38 F2 80                                                 JPS     _GET3           ; R3 = addr (leave copy on stack)
8A3A 1D FA FE                                                 LDR     R3              ; Get the byte
8A3D 16 F2 FE                                                 STA     R1.0            ; :
8A40 38 D8 82                                                 JPS     _XOR8           ; R1.0 = R1.0 ^ R2.0
8A43 38 F9 80                                                 JPS     _POP3           ; R3 = addr
8A46 15 F2 FE                                                 LDA     R1.0            ; Update the byte
8A49 1E FA FE                                                 STR     R3              ; :
8A4C 14 D0 84                                                 JPA     NEXT            ; Done
                                                      
8A4F 85 3E 42 41 4E CB                                HTBANK: DB      ^5 ">BAN" ^'K'                          ; >BANK
8A55 29 8A                                                    DW      HTOGGL
8A57 59 8A                                            TBANK:  DW      TBANK0
8A59 38 73 80                                         TBANK0: JPS     _POP1           ; Get bank number from data stack into R1
8A5C 0E 3E                                                    LDI     62              ; Get index to user variable BANK
8A5E 16 F6 FE                                                 STA     R2.0            ; : into R2.0
8A61 38 84 83                                                 JPS     _USER           ; R3 now contains absolute address of BANK
8A64 38 7F 82                                                 JPS     _ST16           ; Save the bank number in user variable BANK
8A67 15 F2 FE                                                 LDA     R1.0            ; Do the actual bank switch
8A6A 01                                                       BNK                     ; :
8A6B 14 D0 84                                                 JPA     NEXT
                                                              
8A6E 81 C0                                            HAT:    DB      ^1 ^'@'                                 ; ***** @
8A70 4F 8A                                                    DW      HTBANK
8A72 74 8A                                            AT:     DW      AT0
8A74 38 F9 80                                         AT0:    JPS     _POP3           ; R3 = addr
8A77 38 6C 82                                                 JPS     _LD16           ; R1 = (R3)
8A7A 14 BE 84                                                 JPA     PUSH            ; -(SP) = R1; NEXT
                                                      
8A7D 82 43 C0                                         HCAT:   DB      ^2 "C" ^'@'                             ; ***** C@
8A80 6E 8A                                                    DW      HAT
8A82 84 8A                                            CAT:    DW      CAT0
8A84 2C F2 FE                                         CAT0:   CLW     R1              ; R1 = 0
8A87 38 F9 80                                                 JPS     _POP3           ; R3 = addr
8A8A 1D FA FE                                                 LDR     R3              ; A = (R3)
8A8D 16 F2 FE                                                 STA     R1.0            ; R1 = A
8A90 14 BE 84                                                 JPA     PUSH            ; -(SP) = R1; NEXT
                                                      
8A93 81 A1                                            HSTORE: DB      ^1 ^'!'                                 ; ***** !
8A95 7D 8A                                                    DW      HCAT
8A97 99 8A                                            STORE:  DW      STORE0
8A99 38 F9 80                                         STORE0: JPS     _POP3           ; R3 = addr
8A9C 38 73 80                                                 JPS     _POP1           ; R1 = data
8A9F 38 7F 82                                                 JPS     _ST16           ; (R3) = R1
8AA2 14 D0 84                                                 JPA     NEXT            ; Done
                                                      
8AA5 82 43 A1                                         HCSTOR: DB      ^2 "C" ^'!'                             ; ***** C!
8AA8 93 8A                                                    DW      HSTORE
8AAA AC 8A                                            CSTOR:  DW      CSTOR0
8AAC 38 03 81                                         CSTOR0: JPS     _POP21          ; R2 = addr, R1 = data
8AAF 15 F2 FE                                                 LDA     R1.0            ; A = R1.0
8AB2 1E F6 FE                                                 STR     R2              ; (R3) = A
8AB5 14 D0 84                                                 JPA     NEXT            ; Done
                                                      
                                                      ; INCLUDE         precompiled.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; PRECOMPILED FORTH WORDS
                                                      ;
                                                      
8AB8 C1 BA                                            HCOLON: DB      ^^1 ^':'                                ; ***** :
8ABA A5 8A                                                    DW      HCSTOR
8ABC D0 8A F8 8E B3 8E 9E 8C 72 8A 90 8C 97 8A        COLON:  DW      DOCOL QEXEC SCSP CURR AT CONT STORE
8ACA 3E 94 7D 8F E4 8F                                        DW      CREAT RBRAC PSCOD
8AD0 2F EE FE                                         DOCOL:  DEW     RP              ; -(RP) = IP
8AD3 15 E9 FE                                                 LDA     IP.1            ; :
8AD6 1E EE FE                                                 STR     RP              ; :
8AD9 2F EE FE                                                 DEW     RP              ; :
8ADC 15 E8 FE                                                 LDA     IP.0            ; :
8ADF 1E EE FE                                                 STR     RP              ; :
8AE2 15 EA FE                                                 LDA     WA.0            ; IP = WA
8AE5 16 E8 FE                                                 STA     IP.0            ; :
8AE8 15 EB FE                                                 LDA     WA.1            ; :
8AEB 16 E9 FE                                                 STA     IP.1            ; :
8AEE 14 D0 84                                                 JPA     NEXT
                                                      
8AF1 C1 BB                                            HSEMI:  DB      ^^1 ^';'                                ; ***** ;
8AF3 B8 8A                                                    DW      HCOLON
8AF5 D0 8A 22 8F 59 8F E3 88 92 8F 6F 8F E3 88        SEMI:   DW      DOCOL QCSP COMP SEMIS SMUDG LBRAC SEMIS
                                                      
8B03 88 43 4F 4E 53 54 41 4E D4                       HCON:   DB      ^8 "CONSTAN" ^'T'                       ; ***** CONSTANT
8B0C F1 8A                                                    DW      HSEMI
8B0E D0 8A 3E 94 92 8F A8 8D E4 8F                    CON:    DW      DOCOL CREAT SMUDG COMMA PSCOD
8B18 1D EA FE                                         DOCON:  LDR     WA              ; -(SP) = (WA)
8B1B 16 F2 FE                                                 STA     R1.0            ; :
8B1E 2E EA FE                                                 INW     WA              ; :
8B21 1D EA FE                                                 LDR     WA              ; :
8B24 16 F3 FE                                                 STA     R1.1            ; :
8B27 2F EA FE                                                 DEW     WA              ; :
8B2A 14 BE 84                                                 JPA     PUSH            ; Done
                                                      
8B2D 88 56 41 52 49 41 42 4C C5                       HVAR:   DB      ^8 "VARIABL" ^'E'                       ; ***** VARIABLE
8B36 03 8B                                                    DW      HCON
8B38 D0 8A 0E 8B E4 8F                                VAR:    DW      DOCOL CON PSCOD
8B3E 2F EC FE                                         DOVAR:  DEW     SP              ; -(SP) = WA
8B41 15 EB FE                                                 LDA     WA.1            ; :
8B44 1E EC FE                                                 STR     SP              ; :
8B47 2F EC FE                                                 DEW     SP              ; :
8B4A 15 EA FE                                                 LDA     WA.0            ; :
8B4D 1E EC FE                                                 STR     SP              ; :
8B50 14 D0 84                                                 JPA     NEXT            ; Done
                                                      
8B53 84 55 53 45 D2                                   HUSER:  DB      ^4 "USE" ^'R'                           ; ***** USER
8B58 2D 8B                                                    DW      HVAR
8B5A D0 8A 0E 8B E4 8F                                USER:   DW      DOCOL CON PSCOD
8B60 1D EA FE                                         DOUSE:  LDR     WA              ; Compute UP[index]
8B63 17 F0 FE                                                 ADA     UP.0            ; :
8B66 16 F2 FE                                                 STA     R1.0            ; :
8B69 2E EA FE                                                 INW     WA              ; :
8B6C 1D EA FE                                                 LDR     WA              ; :
8B6F 1A F1 FE                                                 ACA     UP.1            ; :
8B72 16 F3 FE                                                 STA     R1.1            ; :
8B75 14 BE 84                                                 JPA     PUSH            ; Push address; NEXT
                                                      
                                                      ; ------------------------------
                                                      ; PRECOMPILED CONSTANTS
                                                      
8B78 82 2D B1                                         HMONE:  DB      ^2 "-" ^'1'                             ; ***** -1
8B7B 53 8B                                                    DW      HUSER
8B7D 18 8B FF FF                                      MONE:   DW      DOCON -1
                                                      
8B81 81 B0                                            HZERO:  DB      ^1 ^'0'                                 ; ***** 0
8B83 78 8B                                                    DW      HMONE
8B85 18 8B 00 00                                      ZERO:   DW      DOCON 0
                                                      
8B89 81 B1                                            HONE:   DB      ^1 ^'1'                                 ; ***** 1
8B8B 81 8B                                                    DW      HZERO
8B8D 18 8B 01 00                                      ONE:    DW      DOCON 1
                                                      
8B91 81 B2                                            HTWO:   DB      ^1 ^'2'                                 ; ***** 2
8B93 89 8B                                                    DW      HONE
8B95 18 8B 02 00                                      TWO:    DW      DOCON 2
                                                      
8B99 81 B3                                            HTHREE: DB      ^1 ^'3'                                 ; ***** 3
8B9B 91 8B                                                    DW      HTWO
8B9D 18 8B 03 00                                      THREE:  DW      DOCON 3
                                                      
8BA1 82 42 CC                                         HBL:    DB      ^2 "B" ^'L'                             ; ***** BL
8BA4 99 8B                                                    DW      HTHREE
8BA6 18 8B 20 00                                      BL:     DW      DOCON 32
                                                      
8BAA 83 43 2F CC                                      HCL:    DB      ^3 "C/" ^'L'                            ; ***** C/L
8BAE A1 8B                                                    DW      HBL
8BB0 18 8B 28 00                                      CL:     DW      DOCON 40
                                                      
8BB4 85 42 2F 42 55 C6                                HBBUF:  DB      ^5 "B/BU" ^'F'                          ; ***** B/BUF
8BBA AA 8B                                                    DW      HCL
8BBC 18 8B 00 04                                      BBUF:   DW      DOCON 1024
                                                      
8BC0 85 42 2F 53 43 D2                                HBSCR:  DB      ^5 "B/SC" ^'R'                          ; ***** B/SCR
8BC6 B4 8B                                                    DW      HBBUF
8BC8 18 8B 01 00                                      BSCR:   DW      DOCON 1
                                                      
8BCC 87 2B 4F 52 49 47 49 CE                          HPORIG: DB      ^7 "+ORIGI" ^'N'                        ; ***** +ORIGIN
8BD4 C0 8B                                                    DW      HBSCR
8BD6 D0 8A 33 85 00 80 84 89 E3 88                    PORIG:  DW      DOCOL LIT ORIGIN PLUS SEMIS
                                                      
                                                      ; ------------------------------
                                                      ; USER VARIABLES
                                                      
8BE0 82 53 B0                                         HSZERO: DB      ^2 "S" ^'0'                             ; ***** S0
8BE3 CC 8B                                                    DW      HPORIG
8BE5 60 8B 06 00                                      SZERO:  DW      DOUSE 6
                                                      
8BE9 82 52 B0                                         HRZERO: DB      ^2 "R" ^'0'                             ; ***** R0
8BEC E0 8B                                                    DW      HSZERO
8BEE 60 8B 08 00                                      RZERO:  DW      DOUSE 8
                                                      
8BF2 83 54 49 C2                                      HTIB:   DB      ^3 "TI" ^'B'                            ; ***** TIB
8BF6 E9 8B                                                    DW      HRZERO
8BF8 60 8B 0A 00                                      TIB:    DW      DOUSE 10
                                                      
8BFC 85 57 49 44 54 C8                                HWIDTH: DB      ^5 "WIDT" ^'H'                          ; ***** WIDTH
8C02 F2 8B                                                    DW      HTIB
8C04 60 8B 0C 00                                      WIDTH:  DW      DOUSE 12
                                                      
8C08 87 57 41 52 4E 49 4E C7                          HWARN:  DB      ^7 "WARNIN" ^'G'                        ; ***** WARNING
8C10 FC 8B                                                    DW      HWIDTH
8C12 60 8B 0E 00                                      WARN:   DW      DOUSE 14
                                                      
8C16 85 46 45 4E 43 C5                                HFENCE: DB      ^5 "FENC" ^'E'                          ; ***** FENCE
8C1C 08 8C                                                    DW      HWARN
8C1E 60 8B 10 00                                      FENCE:  DW      DOUSE 16
                                                      
8C22 82 44 D0                                         HDP:    DB      ^2 "D" ^'P'                             ; ***** DP
8C25 16 8C                                                    DW      HFENCE
8C27 60 8B 12 00                                      DP:     DW      DOUSE 18
                                                      
8C2B 88 56 4F 43 2D 4C 49 4E CB                       HVOCL:  DB      ^8 "VOC-LIN" ^'K'                       ; ***** VOC-LINK
8C34 22 8C                                                    DW      HDP
8C36 60 8B 14 00                                      VOCL:   DW      DOUSE 20
                                                      
8C3A 85 46 49 52 53 D4                                HFIRST: DB      ^5 "FIRS" ^'T'                          ; ***** FIRST
8C40 2B 8C                                                    DW      HVOCL
8C42 60 8B 16 00                                      FIRST:  DW      DOUSE 22
                                                      
8C46 85 4C 49 4D 49 D4                                HLIMIT: DB      ^5 "LIMI" ^'T'                          ; ***** LIMIT
8C4C 3A 8C                                                    DW      HFIRST
8C4E 60 8B 18 00                                      LIMIT:  DW      DOUSE 24
                                                      
8C52 83 42 4C CB                                      HBLK:   DB      ^3 "BL" ^'K'                            ; ***** BLK
8C56 46 8C                                                    DW      HLIMIT
8C58 60 8B 1E 00                                      BLK:    DW      DOUSE 30
                                                      
8C5C 82 49 C9                                         HIN:    DB      ^2 "I" ^'I'                             ; ***** IN
8C5F 52 8C                                                    DW      HBLK
8C61 60 8B 20 00                                      IN:     DW      DOUSE 32
                                                      
8C65 83 4F 55 D4                                      HOUT:   DB      ^3 "OU" ^'T'                            ; ***** OUT
8C69 5C 8C                                                    DW      HIN
8C6B 60 8B 22 00                                      OUT:    DW      DOUSE 34
                                                      
8C6F 83 53 43 D2                                      HSCR:   DB      ^3 "SC" ^'R'                            ; ***** SCR
8C73 65 8C                                                    DW      HOUT
8C75 60 8B 24 00                                      SCR:    DW      DOUSE 36
                                                      
8C79 86 4F 46 46 53 45 D4                             HOFFSE: DB      ^6 "OFFSE" ^'T'                         ; ***** OFFSET
8C80 6F 8C                                                    DW      HSCR
8C82 60 8B 26 00                                      OFFSE:  DW      DOUSE 38
                                                      
8C86 87 43 4F 4E 54 45 58 D4                          HCONT:  DB      ^7 "CONTEX" ^'T'                        ; ***** CONTEXT
8C8E 79 8C                                                    DW      HOFFSE
8C90 60 8B 28 00                                      CONT:   DW      DOUSE 40
                                                      
8C94 87 43 55 52 52 45 4E D4                          HCURR:  DB      ^7 "CURREN" ^'T'                        ; ***** CURRENT
8C9C 86 8C                                                    DW      HCONT
8C9E 60 8B 2A 00                                      CURR:   DW      DOUSE 42
                                                      
8CA2 85 53 54 41 54 C5                                HSTATE: DB      ^5 "STAT" ^'E'                          ; ***** STATE
8CA8 94 8C                                                    DW      HCURR
8CAA 60 8B 2C 00                                      STATE:  DW      DOUSE 44
                                                      
8CAE 84 42 41 53 C5                                   HBASE:  DB      ^4 "BAS" ^'E'                           ; ***** BASE
8CB3 A2 8C                                                    DW      HSTATE
8CB5 60 8B 2E 00                                      BASE:   DW      DOUSE 46
                                                      
8CB9 83 44 50 CC                                      HDPL:   DB      ^3 "DP" ^'L'                            ; ***** DPL
8CBD AE 8C                                                    DW      HBASE
8CBF 60 8B 32 00                                      DPL:    DW      DOUSE 50
                                                      
8CC3 83 46 4C C4                                      HFLD:   DB      ^3 "FL" ^'D'                            ; ***** FLD
8CC7 B9 8C                                                    DW      HDPL
8CC9 60 8B 34 00                                      FLD:    DW      DOUSE 52
                                                      
8CCD 83 43 53 D0                                      HCSP:   DB      ^3 "CS" ^'P'                            ; ***** CSP
8CD1 C3 8C                                                    DW      HFLD
8CD3 60 8B 34 00                                      CSP:    DW      DOUSE 52
                                                      
8CD7 82 52 A3                                         HRNUM:  DB      ^2 "R" ^'#'                             ; ***** R#
8CDA CD 8C                                                    DW      HCSP
8CDC 60 8B 36 00                                      RNUM:   DW      DOUSE 54
                                                      
8CE0 83 48 4C C4                                      HHLD:   DB      ^3 "HL" ^'D'                            ; ***** HLD
8CE4 D7 8C                                                    DW      HRNUM
8CE6 60 8B 38 00                                      HLD:    DW      DOUSE 56
                                                      
8CEA 83 55 53 C5                                      HUSE:   DB      ^3 "US" ^'E'                            ; ***** USE
8CEE E0 8C                                                    DW      HHLD
8CF0 60 8B 3A 00                                      USE:    DW      DOUSE 58
                                                      
8CF4 84 50 52 45 D6                                   HPREV:  DB      ^4 "PRE" ^'V'                           ; ***** PREV
8CF9 EA 8C                                                    DW      HUSE
8CFB 60 8B 3C 00                                      PREV:   DW      DOUSE 60
                                                      
8CFF 84 42 41 4E CB                                   HBANK:  DB      ^4 "BAN" ^'K'                           ; ***** BANK
8D04 F4 8C                                                    DW      HPREV
8D06 60 8B 3E 00                                      BANK:   DW      DOUSE 62
                                                      
                                                      ; END OF USER VARIABLES
                                                      ; ------------------------------
                                                      
8D0A 82 3E BE                                         HRSHFT: DB      ^2 ">" ^'>'                             ; ***** >>
8D0D FF 8C                                                    DW      HBANK
8D0F 11 8D                                            RSHFT:  DW      RSHFT0
8D11 38 03 81                                         RSHFT0: JPS     _POP21
8D14 15 F3 FE                                         RSHF10: LDA     R1.1
8D17 07                                                       LSR
8D18 16 F3 FE                                                 STA     R1.1
8D1B 15 F2 FE                                                 LDA     R1.0
8D1E 08                                                       ROR
8D1F 16 F2 FE                                                 STA     R1.0
8D22 27 F6 FE                                                 DEB     R2.0
8D25 3A 14 8D                                                 BNE     RSHF10
8D28 14 BE 84                                                 JPA     PUSH
                                                      
8D2B 82 3C BC                                         HLSHFT: DB      ^2 "<" ^'<'                             ; ***** <<
8D2E 0A 8D                                                    DW      HRSHFT
8D30 32 8D                                            LSHFT:  DW      LSHFT0
8D32 38 03 81                                         LSHFT0: JPS     _POP21
8D35 15 F2 FE                                         LSHF10: LDA     R1.0
8D38 05                                                       LSL
8D39 16 F2 FE                                                 STA     R1.0
8D3C 15 F3 FE                                                 LDA     R1.1
8D3F 06                                                       ROL
8D40 16 F3 FE                                                 STA     R1.1
8D43 27 F6 FE                                                 DEB     R2.0
8D46 3A 35 8D                                                 BNE     LSHF10
8D49 14 BE 84                                                 JPA     PUSH
                                                      
8D4C 82 31 AB                                         HONEP:  DB      ^2 "1" ^'+'                             ; ***** 1+
8D4F 2B 8D                                                    DW      HLSHFT
8D51 53 8D                                            ONEP:   DW      ONEP0
                                                      ONEP0:  
8D53 38 73 80                                                 JPS     _POP1
8D56 15 F2 FE                                                 LDA     R1.0
8D59 0C                                                       INC
8D5A 16 F2 FE                                                 STA     R1.0
8D5D 15 F3 FE                                                 LDA     R1.1
8D60 12 00                                                    ACI     0
8D62 16 F3 FE                                                 STA     R1.1
8D65 14 BE 84                                                 JPA     PUSH
                                                      
8D68 82 32 AB                                         HTWOP:  DB      ^2 "2" ^'+'                             ; ***** 2+
8D6B 4C 8D                                                    DW      HONEP
8D6D 6F 8D                                            TWOP:   DW      TWOP0
8D6F 38 73 80                                         TWOP0:  JPS     _POP1
8D72 15 F2 FE                                                 LDA     R1.0
8D75 0F 02                                                    ADI     2
8D77 16 F2 FE                                                 STA     R1.0
8D7A 15 F3 FE                                                 LDA     R1.1
8D7D 12 00                                                    ACI     0
8D7F 16 F3 FE                                                 STA     R1.1
8D82 14 BE 84                                                 JPA     PUSH
                                                      
8D85 84 48 45 52 C5                                   HHERE:  DB      ^4 "HER" ^'E'                           ; ***** HERE
8D8A 68 8D                                                    DW      HTWOP
8D8C D0 8A 27 8C 72 8A E3 88                          HERE:   DW      DOCOL DP AT SEMIS
                                                      
8D94 85 41 4C 4C 4F D4                                HALLOT: DB      ^5 "ALLO" ^'T'                          ; ***** ALLOT
8D9A 85 8D                                                    DW      HHERE
8D9C D0 8A 27 8C 15 8A E3 88                          ALLOT:  DW      DOCOL DP PSTOR SEMIS
                                                      
8DA4 81 AC                                            HCOMMA: DB      ^1 ^','                                 ; ***** ,
8DA6 94 8D                                                    DW      HALLOT
8DA8 D0 8A 8C 8D 97 8A 95 8B 9C 8D E3 88              COMMA:  DW      DOCOL HERE STORE TWO ALLOT SEMIS
                                                      
8DB4 81 AD                                            HSUB:   DB      ^1 ^'-'                                 ; ***** -
8DB6 A4 8D                                                    DW      HCOMMA
8DB8 D0 8A AA 89 84 89 E3 88                          SUB:    DW      DOCOL MINUS PLUS SEMIS
                                                      
8DC0 81 BD                                            HEQUAL: DB      ^1 ^'='                                 ; ***** =
8DC2 B4 8D                                                    DW      HSUB
8DC4 D0 8A B8 8D 3E 89 E3 88                          EQUAL:  DW      DOCOL SUB ZEQU SEMIS
                                                      
8DCC 81 BC                                            HLESS:  DB      ^1 ^'<'                                 ; ***** <
8DCE C0 8D                                                    DW      HEQUAL
8DD0 D0 8A B8 8D 67 89 E3 88                          LESS:   DW      DOCOL SUB ZLESS SEMIS
                                                      
8DD8 81 BE                                            HGREAT: DB      ^1 ^'>'                                 ; ***** >
8DDA CC 8D                                                    DW      HLESS
8DDC D0 8A F7 89 D0 8D E3 88                          GREAT:  DW      DOCOL SWAP LESS SEMIS
                                                      
8DE4 83 52 4F D4                                      HROT:   DB      ^3 "RO" ^'T'                            ; ***** ROT
8DE8 D8 8D                                                    DW      HGREAT
8DEA EC 8D                                            ROT:    DW      ROT0
8DEC 38 00 81                                         ROT0:   JPS     _POP321
8DEF 38 99 81                                                 JPS     _PUSH2
8DF2 38 B7 81                                                 JPS     _PUSH3
8DF5 14 BE 84                                                 JPA     PUSH
                                                      
8DF8 85 53 50 41 43 C5                                HSPACE: DB      ^5 "SPAC" ^'E'                          ; ***** SPACE
8DFE E4 8D                                                    DW      HROT
8E00 D0 8A A6 8B 59 87 E3 88                          SPACE:  DW      DOCOL BL EMIT SEMIS
                                                      
8E08 84 2D 44 55 D0                                   HDDUP:  DB      ^4 "-DU" ^'P'                           ; ***** -DUP
8E0D F8 8D                                                    DW      HSPACE
8E0F 11 8E                                            DDUP:   DW      DDUP0
8E11 38 6C 80                                         DDUP0:  JPS     _GET1
8E14 15 F2 FE                                                 LDA     R1.0
8E17 11 00                                                    CPI     0
8E19 3A 27 8E                                                 BNE     DDUP10
8E1C 15 F3 FE                                                 LDA     R1.1
8E1F 11 00                                                    CPI     0
8E21 3A 27 8E                                                 BNE     DDUP10
8E24 14 D0 84                                                 JPA     NEXT
8E27 14 BE 84                                         DDUP10: JPA     PUSH
                                                      
8E2A 88 54 52 41 56 45 52 53 C5                       HTRAV:  DB      ^8 "TRAVERS" ^'E'                       ; ***** TRAVERSE
8E33 08 8E                                                    DW      HDDUP
8E35 D0 8A F7 89                                      TRAV:   DW      DOCOL SWAP
8E39 D0 89 84 89 33 85 7F 00                          TRAV10: DW      OVER PLUS LIT 0x7F
8E41 D0 89 82 8A D0 8D 77 85 F0 FF                            DW      OVER CAT LESS ZBRAN +TRAV10
8E4B F7 89 E5 89 E3 88                                        DW      SWAP DROP SEMIS
                                                      
8E51 86 4C 41 54 45 53 D4                             HLATES: DB      ^6 "LATES" ^'T'                         ; ***** LATEST
8E58 2A 8E                                                    DW      HTRAV
8E5A D0 8A 9E 8C 72 8A 72 8A E3 88                    LATES:  DW      DOCOL CURR AT AT SEMIS
                                                      
8E64 83 4C 46 C1                                      HLFA:   DB      ^3 "LF" ^'A'                            ; ***** LFA
8E68 51 8E                                                    DW      HLATES
8E6A D0 8A 33 85 04 00 B8 8D E3 88                    LFA:    DW      DOCOL LIT 4 SUB SEMIS
                                                      
8E74 83 43 46 C1                                      HCFA:   DB      ^3 "CF" ^'A'                            ; ***** CFA
8E78 64 8E                                                    DW      HLFA
8E7A D0 8A 95 8B B8 8D E3 88                          CFA:    DW      DOCOL TWO SUB SEMIS
                                                      
8E82 83 4E 46 C1                                      HNFA:   DB      ^3 "NF" ^'A'                            ; ***** NFA
8E86 74 8E                                                    DW      HCFA
8E88 D0 8A 33 85 05 00 B8 8D 33 85 FF FF 35 8E E3 88  NFA:    DW      DOCOL LIT 5 SUB LIT -1 TRAV SEMIS
                                                      
8E98 83 50 46 C1                                      HPFA:   DB      ^3 "PF" ^'A'                            ; ***** PFA
8E9C 82 8E                                                    DW      HNFA
8E9E D0 8A 8D 8B 35 8E 33 85 05 00 84 89 E3 88        PFA:    DW      DOCOL ONE TRAV LIT 5 PLUS SEMIS
                                                      
                                                      ; ------------------------------
                                                      ; COMPILE TIME CHECKS
                                                      
8EAC 84 21 43 53 D0                                   HSCSP:  DB      ^4 "!CS" ^'P'                           ; ***** !CSP
8EB1 98 8E                                                    DW      HPFA
8EB3 D0 8A 67 88 D3 8C 97 8A E3 88                    SCSP:   DW      DOCOL SPAT CSP STORE SEMIS
                                                      
8EBD 86 3F 45 52 52 4F D2                             HQERR:  DB      ^6 "?ERRO" ^'R'                         ; ***** ?ERROR
8EC4 AC 8E                                                    DW      HSCSP
8EC6 D0 8A F7 89 77 85 08 00                          QERR:   DW      DOCOL SWAP ZBRAN +QERR10
8ECE C1 93 65 85 04 00                                        DW      ERROR BRAN +QERR20
8ED4 E5 89                                            QERR10: DW      DROP
8ED6 E3 88                                            QERR20: DW      SEMIS
                                                      
8ED8 85 3F 43 4F 4D D0                                HQCOMP: DB      ^5 "?COM" ^'P'                          ; ***** ?COMP
8EDE BD 8E                                                    DW      HQERR
8EE0 D0 8A AA 8C 72 8A 3E 89 33 85 11 00 C6 8E E3 88  QCOMP:  DW      DOCOL STATE AT ZEQU LIT 17 QERR SEMIS
                                                      
8EF0 85 3F 45 58 45 C3                                HQEXEC: DB      ^5 "?EXE" ^'C'                          ; ***** ?EXEC
8EF6 D8 8E                                                    DW      HQCOMP
8EF8 D0 8A AA 8C 72 8A 33 85 12 00 C6 8E E3 88        QEXEC:  DW      DOCOL STATE AT LIT 18 QERR SEMIS
                                                      
8F06 86 3F 50 41 49 52 D3                             HQPAIR: DB      ^6 "?PAIR" ^'S'                         ; ***** ?PAIRS
8F0D F0 8E                                                    DW      HQEXEC
8F0F D0 8A B8 8D 33 85 13 00 C6 8E E3 88              QPAIR:  DW      DOCOL SUB LIT 19 QERR SEMIS
                                                      
8F1B 84 3F 43 53 D0                                   HQCSP:  DB      ^4 "?CS" ^'P'                           ; ***** ?CSP
8F20 06 8F                                                    DW      HQPAIR
8F22 D0 8A 67 88 D3 8C 72 8A B8 8D                    QCSP:   DW      DOCOL SPAT CSP AT SUB
8F2C 33 85 14 00 C6 8E E3 88                                  DW      LIT 20 QERR SEMIS
                                                      
8F34 88 3F 4C 4F 41 44 49 4E C7                       HQLOAD: DB      ^8 "?LOADIN" ^'G'                       ; ***** ?LOADING
8F3D 1B 8F                                                    DW      HQCSP
8F3F D0 8A 58 8C 72 8A 3E 89 33 85 16 00 C6 8E E3 88  QLOAD:  DW      DOCOL BLK AT ZEQU LIT 22 QERR SEMIS
                                                      
                                                      ; ------------------------------
                                                      ; COMPILER WORDS
                                                      
8F4F 87 43 4F 4D 50 49 4C C5                          HCOMP:  DB      ^7 "COMPIL" ^'E'                        ; ***** COMPILE
8F57 34 8F                                                    DW      HQLOAD
8F59 D0 8A E0 8E 25 89 08 8A                          COMP:   DW      DOCOL QCOMP FROMR DUP
8F61 6D 8D 15 89 72 8A A8 8D E3 88                            DW      TWOP TOR AT COMMA SEMIS
                                                      
8F6B C1 DB                                            HLBRAC: DB      ^^1 ^'['                                ; ***** [
8F6D 4F 8F                                                    DW      HCOMP
8F6F D0 8A 85 8B AA 8C 97 8A E3 88                    LBRAC:  DW      DOCOL ZERO STATE STORE SEMIS
                                                      
8F79 81 DD                                            HRBRAC: DB      ^1 ^']'                                 ; ***** ]
8F7B 6B 8F                                                    DW      HLBRAC
8F7D D0 8A 33 85 C0 00 AA 8C 97 8A E3 88              RBRAC:  DW      DOCOL LIT 0xC0 STATE STORE SEMIS
                                                      
8F89 86 53 4D 55 44 47 C5                             HSMUDG: DB      ^6 "SMUDG" ^'E'                         ; ***** SMUDGE
8F90 79 8F                                                    DW      HRBRAC
8F92 D0 8A 5A 8E 33 85 20 00 32 8A E3 88              SMUDG:  DW      DOCOL LATES LIT 0x20 TOGGL SEMIS
                                                      
8F9E 83 48 45 D8                                      HHEX:   DB      ^3 "HE" ^'X'                            ; ***** HEX
8FA2 89 8F                                                    DW      HSMUDG
8FA4 D0 8A 33 85 10 00 B5 8C 97 8A E3 88              HEX:    DW      DOCOL LIT 16 BASE STORE SEMIS
                                                      
8FB0 87 44 45 43 49 4D 41 CC                          HDEC:   DB      ^7 "DECIMA" ^'L'                        ; ***** DECIMAL
8FB8 9E 8F                                                    DW      HHEX
8FBA D0 8A 33 85 0A 00 B5 8C 97 8A E3 88              DEC:    DW      DOCOL LIT 10 BASE STORE SEMIS
                                                      
8FC6 85 4F 43 54 41 CC                                HOCTAL: DB      ^5 "OCTA" ^'L'                          ; ***** OCTAL
8FCC B0 8F                                                    DW      HDEC
8FCE D0 8A 33 85 08 00 B5 8C 97 8A E3 88              OCTAL:  DW      DOCOL LIT 8 BASE STORE SEMIS
                                                      
8FDA 87 28 3B 43 4F 44 45 A9                          HPSCOD: DB      ^7 "(;CODE" ^')'                        ; ***** (;CODE)
8FE2 C6 8F                                                    DW      HOCTAL
8FE4 D0 8A 25 89 5A 8E 9E 8E 7A 8E 97 8A E3 88        PSCOD:  DW      DOCOL FROMR LATES PFA CFA STORE SEMIS
                                                      
8FF2 87 3C 42 55 49 4C 44 D3                          HBUILD: DB      ^7 "<BUILD" ^'S'                        ; ***** <BUILDS
8FFA DA 8F                                                    DW      HPSCOD
8FFC D0 8A 85 8B 0E 8B E3 88                          BUILD:  DW      DOCOL ZERO CON SEMIS
                                                      
9004 85 44 4F 45 53 BE                                HDOES:  DB      ^5 "DOES" ^'>'                          ; ***** DOES>
900A F2 8F                                                    DW      HBUILD
900C D0 8A 25 89 5A 8E 9E 8E 97 8A E4 8F              DOES:   DW      DOCOL FROMR LATES PFA STORE PSCOD
9018 2F EE FE                                         DODOE:  DEW     RP              ; -(RP) = IP
901B 15 E9 FE                                                 LDA     IP.1            ; :
901E 1E EE FE                                                 STR     RP              ; :
9021 2F EE FE                                                 DEW     RP              ; :
9024 15 E8 FE                                                 LDA     IP.0            ; :
9027 1E EE FE                                                 STR     RP              ; :
902A 1D EA FE                                                 LDR     WA              ; IP = (WA)+
902D 16 E8 FE                                                 STA     IP.0            ; :
9030 2E EA FE                                                 INW     WA              ; :
9033 1D EA FE                                                 LDR     WA              ; :
9036 16 E9 FE                                                 STA     IP.1            ; :
9039 2E EA FE                                                 INW     WA              ; :
903C 2F EC FE                                                 DEW     SP              ; -(SP) = WA
903F 15 EB FE                                                 LDA     WA.1            ; :
9042 1E EC FE                                                 STR     SP              ; :
9045 2F EC FE                                                 DEW     SP              ; :
9048 15 EA FE                                                 LDA     WA.0            ; :
904B 1E EC FE                                                 STR     SP              ; :
904E 14 D0 84                                                 JPA     NEXT            ; Done
                                                      
                                                      ; ------------------------------
                                                      ; MISC WORDS RELATED TO PRINTING
                                                      
9051 85 43 4F 55 4E D4                                HCOUNT: DB      ^5 "COUN" ^'T'                          ; ***** COUNT
9057 04 90                                                    DW      HDOES
9059 D0 8A 08 8A 51 8D F7 89 82 8A E3 88              COUNT:  DW      DOCOL DUP ONEP SWAP CAT SEMIS
                                                      
9065 84 54 59 50 C5                                   HTYPE:  DB      ^4 "TYP" ^'E'                           ; ***** TYPE
906A 51 90                                                    DW      HCOUNT
906C D0 8A 0F 8E 77 85 18 00                          TYPE:   DW      DOCOL DDUP ZBRAN +TYPE20
9074 D0 89 84 89 F7 89 0D 86                                  DW      OVER PLUS SWAP XDO
907C 1F 86 82 8A 59 87 F8 85 F8 FF                    TYPE10: DW      I CAT EMIT XLOOP +TYPE10
9086 65 85 04 00                                              DW      BRAN +TYPE30
908A E5 89                                            TYPE20: DW      DROP
908C E3 88                                            TYPE30: DW      SEMIS
                                                      
908E 89 2D 54 52 41 49 4C 49 4E C7                    HDTRAI: DB      ^9 "-TRAILIN" ^'G'                      ; ***** -TRAILING
9098 65 90                                                    DW      HTYPE
909A D0 8A 08 8A 85 8B 0D 86                          DTRAI:  DW      DOCOL DUP ZERO XDO
90A2 D0 89 D0 89 84 89 8D 8B B8 8D                    DTRA10: DW      OVER OVER PLUS ONE SUB
90AC 82 8A A6 8B B8 8D 77 85 08 00                            DW      CAT BL SUB ZBRAN +DTRA20
90B6 02 89 65 85 06 00                                        DW      LEAVE BRAN +DTRA30
90BC 8D 8B B8 8D                                      DTRA20: DW      ONE SUB
90C0 F8 85 E0 FF                                      DTRA30: DW      XLOOP +DTRA10
90C4 E3 88                                                    DW      SEMIS
                                                      
90C6 84 28 2E 22 A9                                   HPDOTQ: DB      ^4 "(." '"' ^')'                        ; ***** (.")
90CB 8E 90                                                    DW      HDTRAI
90CD D0 8A 31 89 59 90 08 8A 51 8D                    PDOTQ:  DW      DOCOL R COUNT DUP ONEP
90D7 25 89 84 89 15 89 6C 90 E3 88                            DW      FROMR PLUS TOR TYPE SEMIS
                                                      
90E1 C2 2E A2                                         HDOTQ:  DB      ^^2 "." ^'"'                            ; ***** ."
90E4 C6 90                                                    DW      HPDOTQ
90E6 D0 8A 33 85 22 00 AA 8C 72 8A 77 85 14 00        DOTQ:   DW      DOCOL LIT '"' STATE AT ZBRAN +DOTQ10
90F4 59 8F CD 90 53 92 8C 8D 82 8A 51 8D                      DW      COMP PDOTQ WORD HERE CAT ONEP
9100 9C 8D 65 85 0A 00                                        DW      ALLOT BRAN +DOTQ20
9106 53 92 8C 8D 59 90 6C 90                          DOTQ10: DW      WORD HERE COUNT TYPE
910E E3 88                                            DOTQ20: DW      SEMIS
                                                      
                                                      ; ------------------------------
                                                      ; OUTER INTERPRETER
                                                      
9110 86 45 58 50 45 43 D4                             HEXPEC: DB      ^6 "EXPEC" ^'T'                         ; ***** EXPECT
9117 E1 90                                                    DW      HDOTQ
9119 D0 8A D0 89 84 89 D0 89 0D 86                    EXPEC:  DW      DOCOL OVER PLUS OVER XDO
9123 7C 87 08 8A 33 85 0E 00 D6 8B                    EXPE10: DW      KEY DUP LIT 14 PORIG
912D 72 8A C4 8D 77 85 2A 00                                  DW      AT EQUAL ZBRAN +EXPE20
9135 E5 89 08 8A 1F 86 C4 8D 08 8A 25 89 95 8B B8 8D          DW      DROP DUP I EQUAL DUP FROMR TWO SUB
9145 84 89 15 89 77 85 0A 00                                  DW      PLUS TOR ZBRAN +EXPE60
914D 33 85 07 00 65 85 06 00                                  DW      LIT CH_BEL BRAN +EXPE70
9155 33 85 08 00                                      EXPE60: DW      LIT CH_BSP
9159 65 85 28 00                                      EXPE70: DW      BRAN +EXPE30
915D 08 8A 33 85 0A 00 C4 8D 77 85 0E 00              EXPE20: DW      DUP LIT 10 EQUAL ZBRAN +EXPE40
9169 02 89 E5 89 A6 8B 85 8B 65 85 04 00                      DW      LEAVE DROP BL ZERO BRAN +EXPE50
9175 08 8A                                            EXPE40: DW      DUP
9177 1F 86 AA 8A 85 8B 1F 86 51 8D 97 8A              EXPE50: DW      I CSTOR ZERO I ONEP STORE
9183 59 87 F8 85 9C FF                                EXPE30: DW      EMIT XLOOP +EXPE10
9189 E5 89 E3 88                                              DW      DROP SEMIS
                                                      
918D 85 51 55 45 52 D9                                HQUERY: DB      ^5 "QUER" ^'Y'                          ; ***** QUERY
9193 10 91                                                    DW      HEXPEC
9195 D0 8A F8 8B 72 8A 33 85 50 00 19 91              QUERY:  DW      DOCOL TIB AT LIT 80 EXPEC
91A1 85 8B 61 8C 97 8A E3 88                                  DW      ZERO IN STORE SEMIS
                                                      
91A9 C1 80                                            HNULL:  DB      ^^1 ^0                                  ; ***** <the NULL word>
91AB 8D 91                                                    DW      HQUERY
91AD D0 8A 58 8C 72 8A 77 85 26 00                    NULL:   DW      DOCOL BLK AT ZBRAN +NULL20
91B7 8D 8B 58 8C 15 8A 85 8B 61 8C 97 8A                      DW      ONE BLK PSTOR ZERO IN STORE
91C3 58 8C 72 8A C8 8B EB 97 3E 89 77 85 08 00                DW      BLK AT BSCR MOD ZEQU ZBRAN +NULL10
91D1 F8 8E 25 89 E5 89                                        DW      QEXEC FROMR DROP
91D7 65 85 06 00                                      NULL10: DW      BRAN +NULL30
91DB 25 89 E5 89                                      NULL20: DW      FROMR DROP
91DF E3 88                                            NULL30: DW      SEMIS
                                                      
91E1 84 46 49 4C CC                                   HFILL:  DB      ^4 "FIL" ^'L'                           ; ***** FILL
91E6 A9 91                                                    DW      HNULL
91E8 D0 8A F7 89 15 89 D0 89 AA 8A 08 8A              FILL:   DW      DOCOL SWAP TOR OVER CSTOR DUP
91F4 51 8D 25 89 8D 8B B8 8D B2 87 E3 88                      DW      ONEP FROMR ONE SUB CMOVE SEMIS
                                                      
9200 85 45 52 41 53 C5                                HERASE: DB      ^5 "ERAS" ^'E'                          ; ***** ERASE
9206 E1 91                                                    DW      HFILL
9208 D0 8A 85 8B E8 91 E3 88                          ERASE:  DW      DOCOL ZERO FILL SEMIS
                                                      
9210 86 42 4C 41 4E 4B D3                             HBLANK: DB      ^6 "BLANK" ^'S'                         ; ***** BLANKS
9217 00 92                                                    DW      HERASE
9219 D0 8A A6 8B E8 91 E3 88                          BLANK:  DW      DOCOL BL FILL SEMIS
                                                      
9221 84 48 4F 4C C4                                   HHOLD:  DB      ^4 "HOL" ^'D'                           ; ***** HOLD
9226 10 92                                                    DW      HBLANK
9228 D0 8A 33 85 FF FF E6 8C 15 8A                    HOLD:   DW      DOCOL LIT -1 HLD PSTOR
9232 E6 8C 72 8A AA 8A E3 88                                  DW      HLD AT CSTOR SEMIS
                                                      
923A 83 50 41 C4                                      HPAD:   DB      ^3 "PA" ^'D'                            ; ***** PAD
923E 21 92                                                    DW      HHOLD
9240 D0 8A 8C 8D 33 85 54 00 84 89 E3 88              PAD:    DW      DOCOL HERE LIT 84 PLUS SEMIS
                                                      
924C 84 57 4F 52 C4                                   HWORD:  DB      ^4 "WOR" ^'D'                           ; ***** WORD
9251 3A 92                                                    DW      HPAD
9253 D0 8A 58 8C 72 8A 77 85 0C 00                    WORD:   DW      DOCOL BLK AT ZBRAN +WORD10
925D 58 8C 72 8A 5F 99 65 85 06 00                            DW      BLK AT BLOCK BRAN +WORD20
9267 F8 8B 72 8A                                      WORD10: DW      TIB AT
926B 61 8C 72 8A 84 89 F7 89 F2 86                    WORD20: DW      IN AT PLUS SWAP ENCL
9275 8C 8D 33 85 22 00 19 92 61 8C                            DW      HERE LIT 34 BLANK IN
927F 15 8A D0 89 B8 8D 15 89 31 89 8C 8D AA 8A 84 89          DW      PSTOR OVER SUB TOR R HERE CSTOR PLUS
928F 8C 8D 51 8D 25 89 B2 87 E3 88                            DW      HERE ONEP FROMR CMOVE SEMIS
                                                      
9299 88 28 4E 55 4D 42 45 52 A9                       HPNUMB: DB      ^8 "(NUMBER" ^')'                       ; ***** (NUMBER)
92A2 4C 92                                                    DW      HWORD
92A4 D0 8A                                            PNUMB:  DW      DOCOL
92A6 51 8D 08 8A 15 89 82 8A                          PNUM10: DW      ONEP DUP TOR CAT
92AE B5 8C 72 8A 2F 86 77 85 2C 00                            DW      BASE AT DIGIT ZBRAN +PNUM30
92B8 F7 89 B5 8C 72 8A E1 87 E5 89 EA 8D B5 8C 72 8A          DW      SWAP BASE AT USTAR DROP ROT BASE AT
92C8 E1 87 94 89 BF 8C 72 8A 51 8D 77 85 08 00                DW      USTAR DPLUS DPL AT ONEP ZBRAN +PNUM20
92D6 8D 8B BF 8C 15 8A                                        DW      ONE DPL PSTOR
92DC 25 89 65 85 C6 FF                                PNUM20: DW      FROMR BRAN +PNUM10
92E2 25 89 E3 88                                      PNUM30: DW      FROMR SEMIS
                                                      
92E6 86 4E 55 4D 42 45 D2                             HNUMB:  DB      ^6 "NUMBE" ^'R'                         ; ***** NUMBER
92ED 99 92                                                    DW      HPNUMB
92EF D0 8A 85 8B 85 8B EA 8D 08 8A 51 8D 82 8A        NUMB:   DW      DOCOL ZERO ZERO ROT DUP ONEP CAT
92FD 33 85 2D 00 C4 8D 08 8A 15 89 B8 8D 33 85 FF FF          DW      LIT '-' EQUAL DUP TOR SUB LIT -1
930D BF 8C 97 8A A4 92 08 8A                          NUMB10: DW      DPL STORE PNUMB DUP
9315 82 8A A6 8B B8 8D 77 85 16 00                            DW      CAT BL SUB ZBRAN +NUMB20
931F 08 8A 82 8A 33 85 2E 00 B8 8D                            DW      DUP CAT LIT '.' SUB
9329 85 8B C6 8E 85 8B 65 85 DC FF                            DW      ZERO QERR ZERO BRAN +NUMB10
9333 E5 89 25 89 77 85 04 00                          NUMB20: DW      DROP FROMR ZBRAN +NUMB30
933B BE 89                                                    DW      DMINU
933D E3 88                                            NUMB30: DW      SEMIS
                                                      
933F 85 2D 46 49 4E C4                                HDFIND: DB      ^5 "-FIN" ^'D'                          ; ***** -FIND
9345 E6 92                                                    DW      HNUMB
9347 D0 8A A6 8B 53 92 8C 8D 59 90 77 93              DFIND:  DW      DOCOL BL WORD HERE COUNT UPPER
9353 8C 8D 90 8C 72 8A 72 8A 61 86                            DW      HERE CONT AT AT PFIND
935D 08 8A 3E 89 77 85 0A 00                                  DW      DUP ZEQU ZBRAN +DFIN10
9365 E5 89 8C 8D 5A 8E 61 86                                  DW      DROP HERE LATES PFIND
936D E3 88                                            DFIN10: DW      SEMIS
                                                      
936F 85 55 50 50 45 D2                                HUPPER: DB      ^5 "UPPE" ^'R'                          ; ***** UPPER
9375 3F 93                                                    DW      HDFIND
9377 D0 8A D0 89 84 89 F7 89 0D 86                    UPPER:  DW      DOCOL OVER PLUS SWAP XDO
9381 1F 86 82 8A 33 85 60 00 DC 8D                    UPPE10: DW      I CAT LIT 0x60 GREAT
938B 1F 86 82 8A 33 85 7B 00 D0 8D                            DW      I CAT LIT 0x7B LESS
9395 35 88 77 85 0A 00                                        DW      AND ZBRAN +UPPE20
939B 1F 86 33 85 20 00 32 8A                                  DW      I LIT 0x20 TOGGL
93A3 F8 85 DC FF                                      UPPE20: DW      XLOOP +UPPE10
93A7 E3 88                                                    DW      SEMIS
                                                      
93A9 87 28 41 42 4F 52 54 A9                          HPABOR: DB      ^7 "(ABORT" ^')'                        ; ***** (ABORT)
93B1 6F 93                                                    DW      HUPPER
93B3 D0 8A 27 96 E3 88                                PABOR:  DW      DOCOL ABORT SEMIS
                                                      
93B9 85 45 52 52 4F D2                                HERROR: DB      ^5 "ERRO" ^'R'                          ; ***** ERROR
93BF A9 93                                                    DW      HPABOR
93C1 D0 8A 12 8C 72 8A 67 89 77 85 04 00              ERROR:  DW      DOCOL WARN AT ZLESS ZBRAN +ERRO10
93CD B3 93                                                    DW      PABOR
93CF 8C 8D 59 90 6C 90 CD 90                          ERRO10: DW      HERE COUNT TYPE PDOTQ
93D7 03 20 3F 20                                              DB      3 32 '?' 32
93DB F4 99 7E 88 61 8C 72 8A 58 8C 72 8A F9 95 E3 88          DW      MESS SPSTO IN AT BLK AT QUIT SEMIS
                                                      
93EB 83 49 44 AE                                      HIDDOT: DB      ^3 "ID" ^'.'                            ; ***** ID.
93EF B9 93                                                    DW      HERROR
93F1 D0 8A 40 92 A6 8B 33 85 5F 00 E8 91              IDDOT:  DW      DOCOL PAD BL LIT 95 FILL
93FD 08 8A 9E 8E 6A 8E D0 89 B8 8D 40 92 F7 89 B2 87          DW      DUP PFA LFA OVER SUB PAD SWAP CMOVE
940D 40 92 59 90 33 85 1F 00 35 88                            DW      PAD COUNT LIT 31 AND
9417 D0 89 D0 89 8D 8B B8 8D 84 89 08 8A 82 8A                DW      OVER OVER ONE SUB PLUS DUP CAT
9425 33 85 7F 00 35 88 F7 89 AA 8A                            DW      LIT 0x7F AND SWAP CSTOR
942F 6C 90 00 8E E3 88                                        DW      TYPE SPACE SEMIS
                                                      
9435 86 43 52 45 41 54 C5                             HCREAT: DB      ^6 "CREAT" ^'E'                         ; ***** CREATE
943C EB 93                                                    DW      HIDDOT
943E D0 8A 47 93 77 85 10 00                          CREAT:  DW      DOCOL DFIND ZBRAN +CREA10
9446 E5 89 88 8E F1 93 33 85 04 00 F4 99 00 8E                DW      DROP NFA IDDOT LIT 4 MESS SPACE
9454 8C 8D 08 8A 82 8A 04 8C 72 8A 4A 97 51 8D 9C 8D  CREA10: DW      HERE DUP CAT WIDTH AT MIN ONEP ALLOT
9464 08 8A 33 85 A0 00 32 8A 8C 8D 8D 8B B8 8D                DW      DUP LIT 0xA0 TOGGL HERE ONE SUB
9472 33 85 80 00 32 8A 5A 8E A8 8D 9E 8C 72 8A 97 8A          DW      LIT 0x80 TOGGL LATES COMMA CURR AT STORE
9482 8C 8D 6D 8D A8 8D E3 88                                  DW      HERE TWOP COMMA SEMIS
                                                      
948A C9 5B 43 4F 4D 50 49 4C 45 DD                    HBCOMP: DB      ^^9 "[COMPILE" ^']'                     ; ***** [COMPILE]
9494 35 94                                                    DW      HCREAT
9496 D0 8A 47 93 3E 89 85 8B C6 8E                    BCOMP:  DW      DOCOL DFIND ZEQU ZERO QERR
94A0 E5 89 7A 8E A8 8D E3 88                                  DW      DROP CFA COMMA SEMIS
                                                      
94A8 C7 4C 49 54 45 52 41 CC                          HLITER: DB      ^^7 "LITERA" ^'L'                       ; ***** LITERAL
94B0 8A 94                                                    DW      HBCOMP
94B2 D0 8A AA 8C 72 8A 77 85 08 00                    LITER:  DW      DOCOL STATE AT ZBRAN +LITE10
94BC 59 8F 33 85 A8 8D                                        DW      COMP LIT COMMA
94C2 E3 88                                            LITE10: DW      SEMIS
                                                      
94C4 C8 44 4C 49 54 45 52 41 CC                       HDLITE: DB      ^^8 "DLITERA" ^'L'                      ; ***** DLITERAL
94CD A8 94                                                    DW      HLITER
94CF D0 8A AA 8C 72 8A 77 85 08 00                    DLITE:  DW      DOCOL STATE AT ZBRAN +DLIT10
94D9 F7 89 B2 94 B2 94                                        DW      SWAP LITER LITER
94DF E3 88                                            DLIT10: DW      SEMIS
                                                      
94E1 82 55 BC                                         HULESS: DB      ^2 "U" ^'<'                             ; ***** U<
94E4 C4 94                                                    DW      HDLITE
94E6 D0 8A D0 89 D0 89 56 88 67 89 77 85 0C 00        ULESS:  DW      DOCOL OVER OVER XOR ZLESS ZBRAN +ULES10
94F4 E5 89 67 89 3E 89 65 85 06 00                            DW      DROP ZLESS ZEQU BRAN +ULES20
94FE B8 8D 67 89                                      ULES10: DW      SUB ZLESS
9502 E3 88                                            ULES20: DW      SEMIS
                                                      
9504 86 3F 53 54 41 43 CB                             HQSTAC: DB      ^6 "?STAC" ^'K'                         ; ***** ?STACK
950B E1 94                                                    DW      HULESS
950D D0 8A 67 88 E5 8B 72 8A F7 89 E6 94              QSTAC:  DW      DOCOL SPAT SZERO AT SWAP ULESS
9519 8D 8B C6 8E 67 88 8C 8D 33 85 80 00                      DW      ONE QERR SPAT HERE LIT 128
9525 84 89 E6 94 95 8B C6 8E E3 88                            DW      PLUS ULESS TWO QERR SEMIS
                                                      
952F 89 49 4E 54 45 52 50 52 45 D4                    HINTER: DB      ^9 "INTERPRE" ^'T'                      ; ***** INTERPRET
9539 04 95                                                    DW      HQSTAC
953B D0 8A                                            INTER:  DW      DOCOL
953D 47 93 77 85 1E 00                                INTE10: DW      DFIND ZBRAN +INTE40
9543 AA 8C 72 8A D0 8D 77 85 0A 00                            DW      STATE AT LESS ZBRAN +INTE20
954D 7A 8E A8 8D 65 85 06 00                                  DW      CFA COMMA BRAN +INTE30
9555 7A 8E 45 85                                      INTE20: DW      CFA EXEC
9559 0D 95 65 85 1C 00                                INTE30: DW      QSTAC BRAN +INTE70
955F 8C 8D EF 92 BF 8C 72 8A 51 8D 77 85 08 00        INTE40: DW      HERE NUMB DPL AT ONEP ZBRAN +INTE50
956D CF 94 65 85 06 00                                        DW      DLITE BRAN +INTE60
9573 E5 89 B2 94                                      INTE50: DW      DROP LITER
9577 0D 95                                            INTE60: DW      QSTAC
9579 65 85 C2 FF                                      INTE70: DW      BRAN +INTE10
                                                      
957D 89 49 4D 4D 45 44 49 41 54 C5                    HIMMED: DB      ^9 "IMMEDIAT" ^'E'                      ; ***** IMMEDIATE
9587 2F 95                                                    DW      HINTER
9589 D0 8A 5A 8E 33 85 40 00 32 8A E3 88              IMMED:  DW      DOCOL LATES LIT 0x40 TOGGL SEMIS
                                                      
9595 8A 56 4F 43 41 42 55 4C 41 52 D9                 HVOCAB: DB      ^10 "VOCABULAR" ^'Y'                    ; ***** VOCABULARY
95A0 7D 95                                                    DW      HIMMED
95A2 D0 8A FC 8F 33 85 81 A0 A8 8D                    VOCAB:  DW      DOCOL BUILD LIT 0xa081 COMMA
95AC 9E 8C 72 8A 7A 8E A8 8D                                  DW      CURR AT CFA COMMA
95B4 8C 8D 36 8C 72 8A A8 8D 36 8C 97 8A 0C 90                DW      HERE VOCL AT COMMA VOCL STORE DOES
95C2 6D 8D 90 8C 97 8A E3 88                          DOVOC:  DW      TWOP CONT STORE SEMIS
                                                      
95CA 8B 44 45 46 49 4E 49 54 49 4F 4E D3              HDEFIN: DB      ^11 "DEFINITION" ^'S'                   ; ***** DEFINITIONS
95D6 95 95                                                    DW      HVOCAB
95D8 D0 8A 90 8C 72 8A 9E 8C 97 8A E3 88              DEFIN:  DW      DOCOL CONT AT CURR STORE SEMIS
                                                      
95E4 81 A8                                            HPAREN: DB      ^1 ^'('                                 ; ***** (
95E6 CA 95                                                    DW      HDEFIN
95E8 D0 8A 33 85 29 00 53 92 E3 88                    PAREN:  DW      DOCOL LIT ')' WORD SEMIS
                                                      
95F2 84 51 55 49 D4                                   HQUIT:  DB      ^4 "QUI" ^'T'                           ; ***** QUIT
95F7 E4 95                                                    DW      HPAREN
95F9 D0 8A 85 8B 58 8C 97 8A 6F 8F                    QUIT:   DW      DOCOL ZERO BLK STORE LBRAC
9603 A0 88 D3 9D 95 91 3B 95 AA 8C 72 8A              QUIT10: DW      RPSTO CR QUERY INTER STATE AT
960F 3E 89 77 85 08 00                                        DW      ZEQU ZBRAN +QUIT20
9615 CD 90                                                    DW      PDOTQ
9617 03 20 6F 6B                                              DB      3 32 "ok"
961B 65 85 E6 FF                                      QUIT20: DW      BRAN +QUIT10
                                                      
961F 85 41 42 4F 52 D4                                HABORT: DB      ^5 "ABOR" ^'T'                          ; ***** ABORT
9625 F2 95                                                    DW      HQUIT
9627 D0 8A                                            ABORT:  DW      DOCOL
9629 A0 88 7E 88 BA 8F 00 8E D3 9D CD 90              ABOR10: DW      RPSTO SPSTO DEC SPACE CR PDOTQ
9635 13 4D 69 6E 69 6D 61 6C 2D 46 4F 52 54 48                DB      19 "Minimal-FORTH"
9643 20 76 20 30 2E 31                                        DB      32 "v" 32 "0.1"
9649 04 9E D8 95 F9 95                                        DW      FORTH DEFIN QUIT
                                                      
                                                      ; INCLUDE         coldwarm.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; COLD AND WARM START ENTRY POINTS
                                                      
964F 0E FE                                            CENT:   LDI     0xFE            ; Initialize Minimal stack pointer
9651 16 FF FF                                                 STA     0xFFFF          ; :
9654 0E 7C                                                    LDI     <COLD10         ; Start by executing COLD
9656 16 E8 FE                                                 STA     IP.0            ; :
9659 0E 96                                                    LDI     >COLD10         ; :
965B 16 E9 FE                                                 STA     IP.1            ; :
965E 14 D0 84                                                 JPA     NEXT            ; ... and over to FORTH VM
                                                      
9661 0E FE                                            WENT:   LDI     0xFE            ; Initialize Minimal stack pointer
9663 16 FF FF                                                 STA     0xFFFF          ; :
9666 0E 29                                                    LDI     <ABOR10         ; Start by executing ABORT
9668 16 E8 FE                                                 STA     IP.0            ; :
966B 0E 96                                                    LDI     >ABOR10         ; :
966D 16 E9 FE                                                 STA     IP.1            ; :
9670 14 D0 84                                                 JPA     NEXT            ; ... and over to FORTH VM
                                                      
9673 84 43 4F 4C C4                                   HCOLD:  DB      ^4 "COL" ^'D'                           ; ***** COLD
9678 1F 96                                                    DW      HABORT
967A D0 8A                                            COLD:   DW      DOCOL
                                                      COLD10: ; Init FORTH registers
967C A0 88 7E 88 C2 88                                        DW      RPSTO SPSTO UPSTO
                                                              ; Set FORTH vocabulary
9682 33 85 0C 00 D6 8B 72 8A                                  DW      LIT 12 PORIG AT
968A 33 85 06 00 33 85 04 9E 84 89 97 8A                      DW      LIT 6 LIT FORTH PLUS STORE
                                                              ; Init 12 items (24 bytes) in user area ...
                                                              ; ... with values from boot table
9696 33 85 12 00 D6 8B                                        DW      LIT 18 PORIG
969C 33 85 10 00 D6 8B 72 8A 33 85 06 00 84 89                DW      LIT 16 PORIG AT LIT 6 PLUS
96AA 33 85 18 00 B2 87                                        DW      LIT 24 CMOVE
                                                              ; Erase disk buffers
96B0 33 85 22 00 D6 8B 72 8A 33 85 24 00 D6 8B 72 8A          DW      LIT 34 PORIG AT LIT 36 PORIG AT
96C0 D0 89 B8 8D 08 92                                        DW      OVER SUB ERASE
                                                              ; Initialize some of the user variables
96C6 85 8B 6B 8C 97 8A                                        DW      ZERO OUT STORE
96CC 42 8C 72 8A F0 8C 97 8A                                  DW      FIRST AT USE STORE
96D4 42 8C 72 8A FB 8C 97 8A                                  DW      FIRST AT PREV STORE
                                                              ; Continue via ABORT
96DC 27 96                                                    DW      ABORT
                                                      
                                                      ; INCLUDE         math.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; MATHEMATICS WORDS
                                                      
96DE 84 53 2D 3E C4                                   HSTOD:  DB      ^4 "S->" ^'D'                           ; ***** S->D
96E3 73 96                                                    DW      HCOLD
96E5 E7 96                                            STOD:   DW      STOD0
96E7 2C F2 FE                                         STOD0:  CLW     R1              ; Assume high word zero
96EA 2E EC FE                                                 INW     SP              ; Get operand high byte
96ED 1D EC FE                                                 LDR     SP              ; :
96F0 11 00                                                    CPI     0               ; Negative?
96F2 3F FB 96                                                 BMI     STOD10          ; YES: Push 0xFFFF
96F5 2F EC FE                                                 DEW     SP              ; :
96F8 14 BE 84                                                 JPA     PUSH            ; NO: Push 0x0000
96FB 2F EC FE                                         STOD10: DEW     SP              ; :
96FE 2F F2 FE                                                 DEW     R1              ; Make 0x0000 into 0xFFFF
9701 14 BE 84                                                 JPA     PUSH            ; Done
                                                      
9704 82 2B AD                                         HPM:    DB      ^2 "+" ^'-'                             ; ***** +-
9707 DE 96                                                    DW      HSTOD
9709 D0 8A 67 89 77 85 04 00                          PM:     DW      DOCOL ZLESS ZBRAN +PM10
9711 AA 89                                                    DW      MINUS
9713 E3 88                                            PM10:   DW      SEMIS
                                                      
9715 83 44 2B AD                                      HDPM:   DB      ^3 "D+" ^'-'                            ; ***** D+-
9719 04 97                                                    DW      HPM
971B D0 8A 67 89 77 85 04 00                          DPM:    DW      DOCOL ZLESS ZBRAN +DPM10
9723 BE 89                                                    DW      DMINU
9725 E3 88                                            DPM10:  DW      SEMIS
                                                      
9727 83 41 42 D3                                      HABS:   DB      ^3 "AB" ^'S'                            ; ***** ABS
972B 15 97                                                    DW      HDPM
972D D0 8A 08 8A 09 97 E3 88                          ABS:    DW      DOCOL DUP PM SEMIS
                                                      
9735 84 44 41 42 D3                                   HDABS:  DB      ^4 "DAB" ^'S'                           ; ***** DABS
973A 27 97                                                    DW      HABS
973C D0 8A 08 8A 1B 97 E3 88                          DABS:   DW      DOCOL DUP DPM SEMIS
                                                      
9744 83 4D 49 CE                                      HMIN:   DB      ^3 "MI" ^'N'                            ; ***** MIN
9748 35 97                                                    DW      HDABS
974A D0 8A D0 89 D0 89 DC 8D 77 85 04 00              MIN:    DW      DOCOL OVER OVER GREAT ZBRAN +MIN10
9756 F7 89                                                    DW      SWAP
9758 E5 89 E3 88                                      MIN10:  DW      DROP SEMIS
                                                      
975C 83 4D 41 D8                                      HMAX:   DB      ^3 "MA" ^'X'                            ; ***** MAX
9760 44 97                                                    DW      HMIN
9762 D0 8A D0 89 D0 89 D0 8D 77 85 04 00              MAX:    DW      DOCOL OVER OVER LESS ZBRAN +MAX10
976E F7 89                                                    DW      SWAP
9770 E5 89 E3 88                                      MAX10:  DW      DROP SEMIS
                                                      
9774 82 4D AA                                         HMSTAR: DB      ^2 "M" ^'*'                             ; ****** M*
9777 5C 97                                                    DW      HMAX
9779 D0 8A D0 89 D0 89 56 88 15 89 2D 97 F7 89 2D 97  MSTAR:  DW      DOCOL OVER OVER XOR TOR ABS SWAP ABS
9789 E1 87 25 89 1B 97 E3 88                                  DW      USTAR FROMR DPM SEMIS
                                                      
9791 82 4D AF                                         HMSLAS: DB      ^2 "M" ^'/'                             ; ***** M/
9794 74 97                                                    DW      HMSTAR
9796 D0 8A D0 89 15 89 15 89 3C 97 31 89 2D 97        MSLAS:  DW      DOCOL OVER TOR TOR DABS R ABS
97A4 15 88 25 89 31 89 56 88 09 97 F7 89                      DW      USLAS FROMR R XOR PM SWAP
97B0 25 89 09 97 F7 89 E3 88                                  DW      FROMR PM SWAP SEMIS
                                                      
97B8 81 AA                                            HSTAR:  DB      ^1 ^'*'                                 ; ***** *
97BA 91 97                                                    DW      HMSLAS
97BC D0 8A 79 97 E5 89 E3 88                          STAR:   DW      DOCOL MSTAR DROP SEMIS
                                                      
97C4 84 2F 4D 4F C4                                   HSLMOD: DB      ^4 "/MO" ^'D'                           ; ***** /MOD
97C9 B8 97                                                    DW      HSTAR
97CB D0 8A 15 89 E5 96 25 89 96 97 E3 88              SLMOD:  DW      DOCOL TOR STOD FROMR MSLAS SEMIS
                                                      
97D7 81 AF                                            HSLAS:  DB      ^1 ^'/'                                 ; ***** /
97D9 C4 97                                                    DW      HSLMOD
97DB D0 8A CB 97 F7 89 E5 89 E3 88                    SLASH:  DW      DOCOL SLMOD SWAP DROP SEMIS
                                                      
97E5 83 4D 4F C4                                      HMOD:   DB      ^3 "MO" ^'D'                            ; ***** MOD
97E9 D7 97                                                    DW      HSLAS
97EB D0 8A CB 97 E5 89 E3 88                          MOD:    DW      DOCOL SLMOD DROP SEMIS
                                                      
97F3 85 2A 2F 4D 4F C4                                HSSMOD: DB      ^5 "*/MO" ^'D'                          ; ***** */MOD
97F9 E5 97                                                    DW      HMOD
97FB D0 8A 15 89 79 97 25 89 96 97 E3 88              SSMOD:  DW      DOCOL TOR MSTAR FROMR MSLAS SEMIS
                                                      
9807 82 2A AF                                         HSSLA:  DB      ^2 "*" ^'/'                             ; ***** */
980A F3 97                                                    DW      HSSMOD
980C D0 8A FB 97 F7 89 E5 89 E3 88                    SSLA:   DW      DOCOL SSMOD SWAP DROP SEMIS
                                                      
9816 85 4D 2F 4D 4F C4                                HMSMOD: DB      ^5 "M/MO" ^'D'                          ; ***** M/MOD
981C F3 97                                                    DW      HSSMOD
981E D0 8A 15 89 85 8B 31 89 15 88 25 89              MSMOD:  DW      DOCOL TOR ZERO R USLAS FROMR
982A F7 89 15 89 15 88 25 89 E3 88                            DW      SWAP TOR USLAS FROMR SEMIS
                                                      
                                                      ; INCLUDE         diskio.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; DISK I/O
                                                      
9834 83 52 2F D7                                      HRW:    DB      ^3 "R/" ^'W'                            ; ***** R/W
9838 16 98                                                    DW      HMSMOD
983A D0 8A 15 89                                      RW:     DW      DOCOL TOR
983E 33 85 20 00 CB 97 51 8D 57 8A                            DW      LIT 32 SLMOD ONEP TBANK
9848 33 85 00 04 BC 97 25 89 77 85 04 00                      DW      LIT 1024 STAR FROMR ZBRAN +RW10
9854 F7 89                                                    DW      SWAP
9856 33 85 00 04 B2 87 E3 88                          RW10:   DW      LIT 1024 CMOVE SEMIS
                                                      
985E 84 2B 42 55 C6                                   HPBUF:  DB      ^4 "+BU" ^'F'                           ; ***** +BUF
9863 34 98                                                    DW      HRW
9865 D0 8A BC 8B 33 85 04 00 84 89 84 89              PBUF:   DW      DOCOL BBUF LIT 4 PLUS PLUS
9871 08 8A 4E 8C 72 8A C4 8D 77 85 08 00                      DW      DUP LIMIT AT EQUAL ZBRAN +PBUF10
987D E5 89 42 8C 72 8A                                        DW      DROP FIRST AT
9883 08 8A FB 8C 72 8A B8 8D E3 88                    PBUF10: DW      DUP PREV AT SUB SEMIS
                                                      
988D 86 55 50 44 41 54 C5                             HUPDAT: DB      ^6 "UPDAT" ^'E'                         ; ***** UPDATE
9894 5E 98                                                    DW      HPBUF
9896 D0 8A FB 8C 72 8A 72 8A 33 85 00 80              UPDAT:  DW      DOCOL PREV AT AT LIT 0x8000
98A2 45 88 FB 8C 72 8A 97 8A E3 88                            DW      OR PREV AT STORE SEMIS
                                                      
98AC 8D 45 4D 50 54 59 2D 42 55 46 46 45 52 D3        HMTBUF: DB      ^13 "EMPTY-BUFFER" ^'S'                 ; ***** EMPTY-BUFFERS
98BA 8D 98                                                    DW      HUPDAT
98BC D0 8A 42 8C 72 8A 4E 8C 72 8A                    MTBUF:  DW      DOCOL FIRST AT LIMIT AT
98C6 D0 89 B8 8D 08 92 E3 88                                  DW      OVER SUB ERASE SEMIS
                                                      
98CE 85 46 4C 55 53 C8                                HFLUSH: DB      ^5 "FLUS" ^'H'                          ; ***** FLUSH
98D4 AC 98                                                    DW      HMTBUF
98D6 D0 8A 4E 8C 72 8A 42 8C 72 8A 0D 86              FLUSH:  DW      DOCOL LIMIT AT FIRST AT XDO
98E2 1F 86 72 8A 67 89 77 85 14 00                    FLUS10: DW      I AT ZLESS ZBRAN +FLUS20
98EC 1F 86 6D 8D 1F 86 72 8A 33 85 FF 7F                      DW      I TWOP I AT LIT 0x7FFF
98F8 35 88 85 8B 3A 98                                        DW      AND ZERO RW
98FE BC 8B 33 85 04 00 84 89 AB 85 DA FF              FLUS20: DW      BBUF LIT 4 PLUS XPLOO +FLUS10
990A BC 98 E3 88                                              DW      MTBUF SEMIS
                                                      
990E 86 42 55 46 46 45 D2                             HBUFFE: DB      ^6 "BUFFE" ^'R'                         ; ***** BUFFER
9915 CE 98                                                    DW      HFLUSH
9917 D0 8A F0 8C 72 8A 08 8A 15 89                    BUFFE:  DW      DOCOL USE AT DUP TOR
9921 65 98 77 85 FC FF                                BUFF10: DW      PBUF ZBRAN +BUFF10
9927 F0 8C 97 8A 31 89 72 8A 67 89 77 85 14 00                DW      USE STORE R AT ZLESS ZBRAN +BUFF20
9935 31 89 6D 8D 31 89 72 8A 33 85 FF 7F                      DW      R TWOP R AT LIT 0x7FFF
9941 35 88 85 8B 3A 98                                        DW      AND ZERO RW
9947 31 89 97 8A 31 89 FB 8C 97 8A 25 89 6D 8D E3 88  BUFF20: DW      R STORE R PREV STORE FROMR TWOP SEMIS
                                                      
9957 85 42 4C 4F 43 CB                                HBLOCK: DB      ^5 "BLOC" ^'K'                          ; ***** BLOCK
995D 0E 99                                                    DW      HBUFFE
995F D0 8A 15 89 FB 8C 72 8A 08 8A 72 8A              BLOCK:  DW      DOCOL TOR PREV AT DUP AT
996B 33 85 FF 7F 35 88 31 89 B8 8D 77 85 36 00                DW      LIT 0x7FFF AND R SUB ZBRAN +BLOC30
9979 65 98 3E 89 77 85 14 00                          BLOC10: DW      PBUF ZEQU ZBRAN +BLOC20
9981 E5 89 31 89 17 99 08 8A 31 89                            DW      DROP R BUFFE DUP R
998B 8D 8B 3A 98 95 8B B8 8D                                  DW      ONE RW TWO SUB
9993 08 8A 72 8A 33 85 FF 7F 35 88 31 89              BLOC20: DW      DUP AT LIT 0x7FFF AND R
999F B8 8D 3E 89 77 85 D4 FF                                  DW      SUB ZEQU ZBRAN +BLOC10
99A7 08 8A FB 8C 97 8A                                        DW      DUP PREV STORE
99AD 25 89 E5 89 6D 8D E3 88                          BLOC30: DW      FROMR DROP TWOP SEMIS
                                                      
99B5 86 28 4C 49 4E 45 A9                             HPLINE: DB      ^6 "(LINE" ^')'                         ; ***** (LINE)
99BC 57 99                                                    DW      HBLOCK
99BE D0 8A 15 89 B0 8B BC 8B FB 97 25 89 C8 8B        PLINE:  DW      DOCOL TOR CL BBUF SSMOD FROMR BSCR
99CC BC 97 84 89 5F 99 84 89 B0 8B E3 88                      DW      STAR PLUS BLOCK PLUS CL SEMIS
                                                      
99D8 85 2E 4C 49 4E C5                                HDLINE: DB      ^5 ".LIN" ^'E'                          ; ***** .LINE
99DE B5 99                                                    DW      HPLINE
99E0 D0 8A BE 99 9A 90 6C 90 E3 88                    DLINE:  DW      DOCOL PLINE DTRAI TYPE SEMIS
                                                      
99EA 87 4D 45 53 53 41 47 C5                          HMESS:  DB      ^7 "MESSAG" ^'E'                        ; ***** MESSAGE
99F2 D8 99                                                    DW      HDLINE
99F4 D0 8A 12 8C 72 8A 77 85 1A 00                    MESS:   DW      DOCOL WARN AT ZBRAN +MESS20
99FE 0F 8E 77 85 10 00                                        DW      DDUP ZBRAN +MESS10
9A04 33 85 10 00 CB 97 33 85 04 00 84 89 E0 99                DW      LIT 16 SLMOD LIT 4 PLUS DLINE
9A12 65 85 0D 00                                      MESS10: DW      BRAN +MESS30
9A16 CD 90                                            MESS20: DW      PDOTQ
9A18 06 4D 53 47 20 23 20                                     DB      6 "MSG" 32 '#' 32
9A1F DD 9C                                                    DW      DOT
9A21 E3 88                                            MESS30: DW      SEMIS
                                                      
9A23 84 4C 4F 41 C4                                   HLOAD:  DB      ^4 "LOA" ^'D'                           ; ***** LOAD
9A28 EA 99                                                    DW      HMESS
9A2A D0 8A 58 8C 72 8A 15 89 61 8C 72 8A 15 89 85 8B  LOAD:   DW      DOCOL BLK AT TOR IN AT TOR ZERO IN
9A3A 61 8C 97 8A C8 8B BC 97 58 8C 97 8A 3B 95 25 89          DW      STORE BSCR STAR BLK STORE INTER FROMR
9A4A 61 8C 97 8A 25 89 58 8C 97 8A E3 88                      DW      IN STORE FROMR BLK STORE SEMIS
                                                      
9A56 C3 2D 2D BE                                      HARROW: DB      ^^3 "--" ^'>'                           ; ***** -->
9A5A 23 9A                                                    DW      HLOAD
9A5C D0 8A 3F 8F 85 8B 61 8C 97 8A C8 8B 58 8C 72 8A  ARROW:  DW      DOCOL QLOAD ZERO IN STORE BSCR BLK AT
9A6C D0 89 EB 97 B8 8D 58 8C 15 8A E3 88                      DW      OVER MOD SUB BLK PSTOR SEMIS
                                                      
                                                      ; INCLUDE         misc.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; MISCELLANEOUS HIGHER LEVEL
                                                      
9A78 C1 A7                                            HTICK:  DB      ^^1 ^39                                 ; ***** '
9A7A 56 9A                                                    DW      HARROW
9A7C D0 8A 47 93 3E 89 85 8B C6 8E E5 89 B2 94 E3 88  TICK:   DW      DOCOL DFIND ZEQU ZERO QERR DROP LITER SEMIS
                                                      
9A8C 86 46 4F 52 47 45 D4                             HFORGE: DB      ^6 "FORGE" ^'T'                         ; ***** FORGET
9A93 78 9A                                                    DW      HTICK
9A95 D0 8A 9E 8C 72 8A 90 8C 72 8A B8 8D 33 85 18 00  FORGE:  DW      DOCOL CURR AT CONT AT SUB LIT 24
9AA5 C6 8E 7C 9A 08 8A 1E 8C 72 8A D0 8D 33 85 15 00          DW      QERR TICK DUP FENCE AT LESS LIT 21
9AB5 C6 8E 08 8A 88 8E 27 8C 97 8A 6A 8E 72 8A 90 8C          DW      QERR DUP NFA DP STORE LFA AT CONT
9AC5 72 8A 97 8A E3 88                                        DW      AT STORE SEMIS
                                                      
9ACB 84 42 41 43 CB                                   HBACK:  DB      ^4 "BAC" ^'K'                           ; ***** BACK
9AD0 8C 9A                                                    DW      HFORGE
9AD2 D0 8A 8C 8D B8 8D A8 8D E3 88                    BACK:   DW      DOCOL HERE SUB COMMA SEMIS
                                                      
9ADC C5 42 45 47 49 CE                                HBEGIN: DB      ^^5 "BEGI" ^'N'                         ; ***** BEGIN
9AE2 CB 9A                                                    DW      HBACK
9AE4 D0 8A E0 8E 8C 8D 8D 8B E3 88                    BEGIN:  DW      DOCOL QCOMP HERE ONE SEMIS
                                                      
9AEE C5 45 4E 44 49 C6                                HENDIF: DB      ^^5 "ENDI" ^'F'                         ; ***** ENDIF
9AF4 DC 9A                                                    DW      HBEGIN
9AF6 D0 8A E0 8E 95 8B 0F 8F 8C 8D                    ENDIF:  DW      DOCOL QCOMP TWO QPAIR HERE
9B00 D0 89 B8 8D F7 89 97 8A E3 88                            DW      OVER SUB SWAP STORE SEMIS
                                                      
9B0A C4 54 48 45 CE                                   HTHEN:  DB      ^^4 "THE" ^'N'                          ; ***** THEN
9B0F EE 9A                                                    DW      HENDIF
9B11 D0 8A F6 9A E3 88                                THEN:   DW      DOCOL ENDIF SEMIS
                                                      
9B17 C2 44 CF                                         HDO:    DB      ^^2 "D" ^'O'                            ; ***** DO
9B1A 0A 9B                                                    DW      HTHEN
9B1C D0 8A 59 8F 0D 86 8C 8D 33 85 03 00 E3 88        DO:     DW      DOCOL COMP XDO HERE LIT 3 SEMIS
                                                      
9B2A C4 4C 4F 4F D0                                   HLOOP:  DB      ^^4 "LOO" ^'P'                          ; ***** LOOP
9B2F 17 9B                                                    DW      HDO
9B31 D0 8A 33 85 03 00 0F 8F 59 8F F8 85 D2 9A E3 88  LOOP:   DW      DOCOL LIT 3 QPAIR COMP XLOOP BACK SEMIS
                                                      
9B41 C5 2B 4C 4F 4F D0                                HPLOOP: DB      ^^5 "+LOO" ^'P'                         ; ***** +LOOP
9B47 2A 9B                                                    DW      HLOOP
9B49 D0 8A 33 85 03 00 0F 8F 59 8F AB 85 D2 9A E3 88  PLOOP:  DW      DOCOL LIT 3 QPAIR COMP XPLOO BACK SEMIS
                                                      
9B59 C5 55 4E 54 49 CC                                HUNTIL: DB      ^^5 "UNTI" ^'L'                         ; ***** UNTIL
9B5F 41 9B                                                    DW      HPLOOP
9B61 D0 8A 8D 8B 0F 8F 59 8F 77 85 D2 9A E3 88        UNTIL:  DW      DOCOL ONE QPAIR COMP ZBRAN BACK SEMIS
                                                      
9B6F C3 45 4E C4                                      HEND:   DB      ^^3 "EN" ^'D'                           ; ***** ENDI
9B73 59 9B                                                    DW      HUNTIL
9B75 D0 8A 61 9B E3 88                                END:    DW      DOCOL UNTIL SEMIS
                                                      
9B7B C5 41 47 41 49 CE                                HAGAIN: DB      ^^5 "AGAI" ^'N'                         ; ***** AGAIN
9B81 6F 9B                                                    DW      HEND
9B83 D0 8A 8D 8B 0F 8F 59 8F 65 85 D2 9A E3 88        AGAIN:  DW      DOCOL ONE QPAIR COMP BRAN BACK SEMIS
                                                      
9B91 C6 52 45 50 45 41 D4                             HREPEA: DB      ^^6 "REPEA" ^'T'                        ; ***** REPEAT
9B98 7B 9B                                                    DW      HAGAIN
9B9A D0 8A 15 89 15 89 83 9B 25 89 25 89              REPEA:  DW      DOCOL TOR TOR AGAIN FROMR FROMR
9BA6 95 8B B8 8D F6 9A E3 88                                  DW      TWO SUB ENDIF SEMIS
                                                      
9BAE C2 49 C6                                         HIF:    DB      ^^2 "I" ^'F'                            ; ***** IF
9BB1 91 9B                                                    DW      HREPEA
9BB3 D0 8A 59 8F 77 85 8C 8D 85 8B A8 8D 95 8B E3 88  IF:     DW      DOCOL COMP ZBRAN HERE ZERO COMMA TWO SEMIS
                                                      
9BC3 C4 45 4C 53 C5                                   HELSE:  DB      ^^4 "ELS" ^'E'                          ; ***** ELSE
9BC8 AE 9B                                                    DW      HIF
9BCA D0 8A 95 8B 0F 8F 59 8F 65 85 8C 8D 95 8B A8 8D  ELSE:   DW      DOCOL TWO QPAIR COMP BRAN HERE TWO COMMA
9BDA F7 89 95 8B F6 9A 95 8B E3 88                            DW      SWAP TWO ENDIF TWO SEMIS
                                                      
9BE4 C5 57 48 49 4C C5                                HWHILE: DB      ^^5 "WHIL" ^'E'                         ; ***** WHILE
9BEA C3 9B                                                    DW      HELSE
9BEC D0 8A B3 9B 6D 8D E3 88                          WHILE:  DW      DOCOL IF TWOP SEMIS
                                                      
9BF4 86 53 50 41 43 45 D3                             HSPACS: DB      ^6 "SPACE" ^'S'                         ; ***** SPACES
9BFB E4 9B                                                    DW      HWHILE
9BFD D0 8A 85 8B 62 97 0F 8E 77 85 0C 00              SPACS:  DW      DOCOL ZERO MAX DDUP ZBRAN +SPAC20
9C09 85 8B 0D 86                                              DW      ZERO XDO
9C0D 00 8E F8 85 FC FF                                SPAC10: DW      SPACE XLOOP +SPAC10
9C13 E3 88                                            SPAC20: DW      SEMIS
                                                      
9C15 82 3C A3                                         HBDIGS: DB      ^2 "<" ^'#'                             ; ***** <#
9C18 F4 9B                                                    DW      HSPACS
9C1A D0 8A 40 92 E6 8C 97 8A E3 88                    BDIGS:  DW      DOCOL PAD HLD STORE SEMIS
                                                      
9C24 82 23 BE                                         HEDIGS: DB      ^2 "#" ^'>'                             ; ***** #>
9C27 15 9C                                                    DW      HBDIGS
9C29 D0 8A E5 89 E5 89 E6 8C 72 8A                    EDIGS:  DW      DOCOL DROP DROP HLD AT
9C33 40 92 D0 89 B8 8D E3 88                                  DW      PAD OVER SUB SEMIS
                                                      
9C3B 84 53 49 47 CE                                   HSIGN:  DB      ^4 "SIG" ^'N'                           ; ***** SIGN
9C40 24 9C                                                    DW      HEDIGS
9C42 D0 8A EA 8D 67 89 77 85 08 00                    SIGN:   DW      DOCOL ROT ZLESS ZBRAN +SIGN10
9C4C 33 85 2D 00 28 92                                        DW      LIT '-' HOLD
9C52 E3 88                                            SIGN10: DW      SEMIS
                                                      
9C54 81 A3                                            HDIG:   DB      ^1 ^'#'                                 ; ***** #
9C56 3B 9C                                                    DW      HSIGN
9C58 D0 8A B5 8C 72 8A 1E 98 EA 8D                    DIG:    DW      DOCOL BASE AT MSMOD ROT
9C62 33 85 09 00 D0 89 D0 8D 77 85 08 00                      DW      LIT 9 OVER LESS ZBRAN +DIG10
9C6E 33 85 07 00 84 89                                        DW      LIT 7 PLUS
9C74 33 85 30 00 84 89 28 92 E3 88                    DIG10:  DW      LIT '0' PLUS HOLD SEMIS
                                                      
9C7E 82 23 D3                                         HDIGS:  DB      ^2 "#" ^'S'                             ; ***** #S
9C81 54 9C                                                    DW      HDIG
9C83 D0 8A                                            DIGS:   DW      DOCOL
9C85 58 9C D0 89 D0 89 45 88 3E 89 77 85 F4 FF        DIGS10: DW      DIG OVER OVER OR ZEQU ZBRAN +DIGS10
9C93 E3 88                                                    DW      SEMIS
                                                      
9C95 83 44 2E D2                                      HDDOTR: DB      ^3 "D." ^'R'                            ; ***** D.R
9C99 7E 9C                                                    DW      HDIGS
9C9B D0 8A 15 89 F7 89 D0 89 3C 97                    DDOTR:  DW      DOCOL TOR SWAP OVER DABS
9CA5 1A 9C 83 9C 42 9C 29 9C                                  DW      BDIGS DIGS SIGN EDIGS
9CAD 25 89 D0 89 B8 8D FD 9B 6C 90 E3 88                      DW      FROMR OVER SUB SPACS TYPE SEMIS
                                                      
9CB9 82 2E D2                                         HDOTR:  DB      ^2 "." ^'R'                             ; ***** .R
9CBC 95 9C                                                    DW      HDDOTR
9CBE D0 8A 15 89 E5 96 25 89 9B 9C E3 88              DOTR:   DW      DOCOL TOR STOD FROMR DDOTR SEMIS
                                                      
9CCA 82 44 AE                                         HDDOT:  DB      ^2 "D" ^'.'                             ; ***** D.
9CCD B9 9C                                                    DW      HDOTR
9CCF D0 8A 85 8B 9B 9C 00 8E E3 88                    DDOT:   DW      DOCOL ZERO DDOTR SPACE SEMIS
                                                      
9CD9 81 AE                                            HDOT:   DB      ^1 ^'.'                                 ; ***** .
9CDB CA 9C                                                    DW      HDDOT
9CDD D0 8A E5 96 CF 9C E3 88                          DOT:    DW      DOCOL STOD DDOT SEMIS
                                                      
9CE5 81 BF                                            HQUEST: DB      ^1 ^'?'                                 ; ***** ?
9CE7 D9 9C                                                    DW      HDOT
9CE9 D0 8A 72 8A DD 9C E3 88                          QUEST:  DW      DOCOL AT DOT SEMIS
                                                      
9CF1 82 55 AE                                         HUDOT:  DB      ^2 "U" ^'.'                             ; ***** U.
9CF4 E5 9C                                                    DW      HQUEST
9CF6 D0 8A 85 8B CF 9C E3 88                          UDOT:   DW      DOCOL ZERO DDOT SEMIS
                                                      
                                                      ; ----------------------------------
                                                      ; UTILITY WORDS
                                                      
9CFE 84 4C 49 53 D4                                   HLIST:  DB      ^4 "LIS" ^'T'                           ; ***** LIST
9D03 F1 9C                                                    DW      HUDOT
9D05 D0 8A BA 8F D3 9D 08 8A 75 8C 97 8A CD 90        LIST:   DW      DOCOL DEC CR DUP SCR STORE PDOTQ
9D13 06 53 43 52 20 23 20                                     DB      6 "SCR" 32 "#" 32
9D1A DD 9C 33 85 10 00 85 8B 0D 86                            DW      DOT LIT 16 ZERO XDO
9D24 D3 9D 1F 86 9D 8B BE 9C 00 8E                    LIST10: DW      CR I THREE DOTR SPACE
9D2E 1F 86 75 8C 72 8A E0 99 F8 85 EC FF                      DW      I SCR AT DLINE XLOOP +LIST10
9D3A D3 9D E3 88                                              DW      CR SEMIS
                                                      
9D3E 85 49 4E 44 45 D8                                HINDEX: DB      ^5 "INDE" ^'X'                          ; ***** INDEX
9D44 FE 9C                                                    DW      HLIST
9D46 D0 8A D3 9D 51 8D F7 89 0D 86                    INDEX:  DW      DOCOL CR ONEP SWAP XDO
9D50 D3 9D 1F 86 9D 8B BE 9C 00 8E 85 8B 1F 86 E0 99  INDE10: DW      CR I THREE DOTR SPACE ZERO I DLINE
9D60 99 87 77 85 04 00                                        DW      QTERM ZBRAN +INDE20
9D66 02 89                                                    DW      LEAVE
9D68 F8 85 E6 FF                                      INDE20: DW      XLOOP +INDE10
9D6C E3 88                                                    DW      SEMIS
                                                      
9D6E 85 56 4C 49 53 D4                                HVLIST: DB      ^5 "VLIS" ^'T'                          ; ***** VLIST
9D74 3E 9D                                                    DW      HINDEX
9D76 D0 8A 33 85 80 00 6B 8C 97 8A 90 8C 72 8A 72 8A  VLIST:  DW      DOCOL LIT 128 OUT STORE CONT AT AT
9D86 6B 8C 72 8A 33 85 1C 00 DC 8D 77 85 0A 00        VLIS10: DW      OUT AT LIT 28 GREAT ZBRAN +VLIS20
9D94 D3 9D 85 8B 6B 8C 97 8A                                  DW      CR ZERO OUT STORE
9D9C 08 8A F1 93 00 8E 9E 8E 6A 8E 72 8A              VLIS20: DW      DUP IDDOT SPACE PFA LFA AT
9DA8 08 8A 3E 89 99 87 45 88 77 85 D4 FF                      DW      DUP ZEQU QTERM OR ZBRAN +VLIS10
9DB4 E5 89 E3 88                                              DW      DROP SEMIS
                                                      
9DB8 C5 3B 43 4F 44 C5                                HSCODE: DB      ^^5 ";COD" ^'E'                         ; ***** ;CODE
9DBE 6E 9D                                                    DW      HVLIST
9DC0 D0 8A 22 8F 59 8F E4 8F 6F 8F 92 8F E3 88        SCODE:  DW      DOCOL QCSP COMP PSCOD LBRAC SMUDG SEMIS
                                                      
9DCE 82 43 D2                                         HCR:    DB      ^2 "C" ^'R'                             ; ***** CR
9DD1 B8 9D                                                    DW      HSCODE
9DD3 D0 8A 33 85 0D 00 59 87 33 85 0A 00 59 87 E3 88  CR:     DW      DOCOL LIT 13 EMIT LIT 10 EMIT SEMIS
                                                      
9DE3 84 4E 4F 4F D0                                   HNOOP:  DB      ^4 "NOO" ^'P'                           ; ***** NOOP
9DE8 CE 9D                                                    DW      HCR
9DEA D0 8A E3 88                                      NOOP:   DW      DOCOL SEMIS
                                                      
9DEE 83 42 59 C5                                      HBYE:   DB      ^3 "BY" ^'E'                            ; ***** BYE
9DF2 E3 9D                                                    DW      HNOOP
9DF4 F6 9D                                            BYE:    DW      BYE0
9DF6 0E 00                                            BYE0:   LDI     0               ; Select EEPROM bank 0
9DF8 01                                                       BNK                     ; :
9DF9 14 00 00                                                 JPA     0               ; Re-start monitor
                                                      
9DFC C5 46 4F 52 54 C8                                HFORTH: DB      ^^5 "FORT" ^'H'                         ; ***** FORTH
9E02 EE 9D                                                    DW      HBYE
9E04 18 90 C2 95 81 A0 FC 9D                          FORTH:  DW      DODOE DOVOC 0xA081 HFORTH
9E0C 00 00                                            XXVOC:  DW      0
                                                      
9E0E 00                                               XDP:    DB      0
                                                      
                                                      ; INCLUDE         uppermem.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; UPPER MEMORY AREA
                                                      
                                                              ORG     0xF5B9
                                                      
F5B9 00                                               XSP:    DB      0
F5BA 00                                               XTIB:   DB      0
                                                              DS      210             ; TIB:      84
F68D 00                                               XRP:    DB      0               ; RSTACK:  128
F68E 00                                               XUP:    DB      0
                                                              DS      80              ; Room for 40 variables
F6DF 00                                               DSKBF:  DB      0
                                                              DS      2055            ; 2 * 1028 bytes
FEE7 00                                               ENDBF:  DB      0
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; THE VIRTUAL FORTH MACHINE REGISTERS
                                                      
                                                      IP:                             ; Instruction Pointer
FEE8 00                                               IP.0:   DB      0
FEE9 00                                               IP.1:   DB      0
                                                      
                                                      WA:                             ; Word Address Register
FEEA 00                                               WA.0:   DB      0
FEEB 00                                               WA.1:   DB      0
                                                      
                                                      SP:                             ; Data stack pointer
FEEC 00                                               SP.0:   DB      0
FEED 00                                               SP.1:   DB      0
                                                      
                                                      RP:                             ; Return stack pointer
FEEE 00                                               RP.0:   DB      0
FEEF 00                                               RP.1:   DB      0
                                                      
                                                      UP:                             ; User area pointer
FEF0 00                                               UP.0:   DB      0
FEF1 00                                               UP.1:   DB      0
                                                      
                                                      R1:                             ; Working register R1
FEF2 00                                               R1.0:   DB      0
FEF3 00                                               R1.1:   DB      0
                                                      R1H:
FEF4 00                                               R1.2:   DB      0
FEF5 00                                               R1.3:   DB      0
                                                      
                                                      R2:                             ; Working register R2
FEF6 00                                               R2.0:   DB      0
FEF7 00                                               R2.1:   DB      0
                                                      R2H:
FEF8 00                                               R2.2:   DB      0
FEF9 00                                               R2.3:   DB      0
                                                      
                                                      R3:                             ; Working register R3
FEFA 00                                               R3.0:   DB      0
FEFB 00                                               R3.1:   DB      0
                                                      R3H:
FEFC 00                                               R3.2:   DB      0
FEFD 00                                               R3.3:   DB      0
                                                      
FEFE 00                                               BC:     DB      0               ; "Hidden" registers
FEFF 00                                               TMP:    DB      0               ; (used by _AND8 _OR8 _XOR8)
