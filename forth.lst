                                                      ; ----------------------------------------------------------------------
                                                      ; M i n i m a l - F O R T H
                                                      ;
                                                      ; A minimal FORTH for the Minimal-CPU.
                                                      ;
                                                      ; Date:         2021-03-24
                                                      ; Version:      0.1
                                                      ; Adaptation:   Nils "slowcorners" Kullberg
                                                      ; License:      MIT Open Source Initiative
                                                      ;
                                                      ;
                                                      ; FIG-FORTH WAS ORIGINALLY DEVELOPED BY:
                                                      ; FORTH INTEREST GROUP / FORTH IMPLEMENTATION TEAM
                                                      ; P.O.BOX 1105
                                                      ; SAN CARLOS, CA. 94701
                                                      ;
                                                      ; THIS COMPILER EXISTS THANKS TO ALL THE WONDERFUL PEOPLE OF THE
                                                      ; FORTH INTEREST GROUP. IT IS THEIR DEDICATION AND GENEROSITY WHICH
                                                      ; STILL TODAY MAKES THESE NEW ADAPTATIONS POSSIBLE.
                                                      ;
                                                      ; MAY THIS COMPILER BE A SMALL TRIBUTE TO ALL THOSE INDIVIDUALS OF THE
                                                      ; FORTH INTEREST GROUP AS WELL AS SLU4 WHOSE COUNTLESS HOURS AND
                                                      ; INGENIOUS DETAILS HAVE MADE THE MINIMAL-CPU COME INTO EXISTENCE.
                                                      ;
                                                      ; NILS "SLOWCORNERS" KULLBERG
                                                      ; LUND, SWEDEN
                                                      ; MARCH 2021, IN THE MIDDLE OF THE COVID-19 PANDEMIC
                                                      ;
                                                      ; ----------------------------------------------------------------------
                                                      
                                                              ORG     0x8000
                                                              
                                                      
                                                      ; INCLUDE         defs.asm
                                                      
                                                      CH_BEL  EQU     7
                                                      CH_BSP  EQU     8
                                                      CH_LF   EQU     10
                                                      CH_CR   EQU     13
                                                      CH_ESC  EQU     27
                                                      CH_BL   EQU     32
                                                      CH_DEL  EQU     127
                                                      
                                                      ; INCLUDE         boot-table.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; BOOT TABLE
                                                      
8000 14 7C 97                                         ORIGIN: JPA     CENT            ;  0: COLD start
8003 00                                                       NOP
8004 14 8E 97                                                 JPA     WENT            ;  4: WARM start
8007 00                                                       NOP
8008 00 00                                                    DW      0               ;  8: Processor type in radix 36
800A 00 00                                                    DW      0               ; 10: Revision
800C F2 9E                                                    DW      HFORTH          ; 12: Pointer to latest word defined
800E 08 00                                                    DW      CH_BSP          ; 14: Backspace character
8010 8E F6                                                    DW      XUP             ; 16: Pointer to initial user area
8012 B9 F5                                                    DW      XSP             ; 18: Initial data stack pointer
8014 8D F6                                                    DW      XRP             ; 20: Initial return stack pointer
8016 BA F5                                                    DW      XTIB            ; 22: Pointer to terminal input buffer
8018 1F 00                                                    DW      31              ; 24: Maximum FORTH word name length
801A 00 00                                                    DW      0               ; 26: Initial WARNING mode
801C 04 9F                                                    DW      XDP             ; 28: Initial FENCE
801E 04 9F                                                    DW      XDP             ; 30: Initial HERE
8020 02 9F                                                    DW      XXVOC           ; 32: Pointer to initial VOC-LINK
8022 DF F6                                                    DW      DSKBF           ; 34: Initial FIRST
8024 E7 FE                                                    DW      ENDBF           ; 36: Initial LIMIT
8026 00 00                                                    DW      0               ; 38: unused
8028 00 00                                                    DW      0               ; 40: unused
                                                      
                                                      ; INCLUDE         helpers.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; HELPER FUNCTIONS
                                                      ;
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (IP)+
                                                      
802A 1D E8 FE                                         _LIT:   LDR     IP
802D 16 F2 FE                                                 STA     R1.0
8030 2E E8 FE                                                 INW     IP
8033 1D E8 FE                                                 LDR     IP
8036 16 F3 FE                                                 STA     R1.1
8039 2E E8 FE                                                 INW     IP
803C 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       IP = IP + (IP)+
                                                      
803D 1D E8 FE                                         _BRAN:  LDR     IP
8040 16 F2 FE                                                 STA     R1.0
8043 2E E8 FE                                                 INW     IP
8046 1D E8 FE                                                 LDR     IP
8049 16 F3 FE                                                 STA     R1.1
804C 2F E8 FE                                                 DEW     IP
804F 15 F2 FE                                                 LDA     R1.0
8052 28 E8 FE                                                 ADB     IP.0
8055 15 F3 FE                                                 LDA     R1.1
8058 2A E9 FE                                                 ACB     IP.1
805B 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (SP) "half function"
                                                      
805C 1D EC FE                                         _GET1_: LDR     SP
805F 16 F2 FE                                                 STA     R1.0
8062 2E EC FE                                                 INW     SP
8065 1D EC FE                                                 LDR     SP
8068 16 F3 FE                                                 STA     R1.1
806B 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (SP)
                                                      
806C 38 5C 80                                         _GET1:  JPS     _GET1_
806F 2F EC FE                                                 DEW     SP
8072 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (SP)+
                                                      
8073 38 5C 80                                         _POP1:  JPS     _GET1_
8076 2E EC FE                                                 INW     SP
8079 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1X = (SP)+
                                                      
807A 1D EC FE                                         _DPOP1: LDR     SP
807D 16 F4 FE                                                 STA     R1.2
8080 2E EC FE                                                 INW     SP
8083 1D EC FE                                                 LDR     SP
8086 16 F5 FE                                                 STA     R1.3
8089 2E EC FE                                                 INW     SP
808C 1D EC FE                                                 LDR     SP
808F 16 F2 FE                                                 STA     R1.0
8092 2E EC FE                                                 INW     SP
8095 1D EC FE                                                 LDR     SP
8098 16 F3 FE                                                 STA     R1.1
809B 2E EC FE                                                 INW     SP
809E 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R2 = (SP) "half function"
                                                      
809F 1D EC FE                                         _GET2_: LDR     SP
80A2 16 F6 FE                                                 STA     R2.0
80A5 2E EC FE                                                 INW     SP
80A8 1D EC FE                                                 LDR     SP
80AB 16 F7 FE                                                 STA     R2.1
80AE 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R2 = (SP)
                                                      
80AF 38 9F 80                                         _GET2:  JPS     _GET2_
80B2 2F EC FE                                                 DEW     SP
80B5 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (SP)+
                                                      
80B6 38 9F 80                                         _POP2:  JPS     _GET2_
80B9 2E EC FE                                                 INW     SP
80BC 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R2X = (SP)+
                                                      
80BD 1D EC FE                                         _DPOP2: LDR     SP
80C0 16 F8 FE                                                 STA     R2.2
80C3 2E EC FE                                                 INW     SP
80C6 1D EC FE                                                 LDR     SP
80C9 16 F9 FE                                                 STA     R2.3
80CC 2E EC FE                                                 INW     SP
80CF 1D EC FE                                                 LDR     SP
80D2 16 F6 FE                                                 STA     R2.0
80D5 2E EC FE                                                 INW     SP
80D8 1D EC FE                                                 LDR     SP
80DB 16 F7 FE                                                 STA     R2.1
80DE 2E EC FE                                                 INW     SP
80E1 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3 = (SP) "half function"
                                                      
80E2 1D EC FE                                         _GET3_: LDR     SP
80E5 16 FA FE                                                 STA     R3.0
80E8 2E EC FE                                                 INW     SP
80EB 1D EC FE                                                 LDR     SP
80EE 16 FB FE                                                 STA     R3.1
80F1 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3 = (SP)
                                                      
80F2 38 E2 80                                         _GET3:  JPS     _GET3_
80F5 2F EC FE                                                 DEW     SP
80F8 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3 = (SP)+
                                                      
80F9 38 E2 80                                         _POP3:  JPS     _GET3_
80FC 2E EC FE                                                 INW     SP
80FF 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R2 = (SP)+
                                                      ;       R1 = (SP)+
                                                      
8100 38 B6 80                                         _POP21: JPS     _POP2
8103 38 73 80                                                 JPS     _POP1
8106 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (RP) "half function"
                                                      
8107 1D EE FE                                         _RGET1_: LDR    RP
810A 16 F2 FE                                                 STA     R1.0
810D 2E EE FE                                                 INW     RP
8110 1D EE FE                                                 LDR     RP
8113 16 F3 FE                                                 STA     R1.1
8116 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (RP)
                                                      
8117 38 07 81                                         _RGET1: JPS     _RGET1_
811A 2F EE FE                                                 DEW     RP
811D 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (RP)+
                                                      
811E 38 07 81                                         _RPOP1: JPS     _RGET1_
8121 2E EE FE                                                 INW     RP
8124 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R2 = (RP) "half function"
                                                      
8125 1D EE FE                                         _RGET2_: LDR    RP
8128 16 F6 FE                                                 STA     R2.0
812B 2E EE FE                                                 INW     RP
812E 1D EE FE                                                 LDR     RP
8131 16 F7 FE                                                 STA     R2.1
8134 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R2 = (RP)
                                                      
8135 38 25 81                                         _RGET2: JPS     _RGET2_
8138 2F EE FE                                                 DEW     RP
813B 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (RP)
                                                      
813C 38 25 81                                         _RPOP2: JPS     _RGET2_
813F 2E EE FE                                                 INW     RP
8142 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3 = (RP) "half function"
                                                      
8143 1D EE FE                                         _RGET3_: LDR    RP
8146 16 FA FE                                                 STA     R3.0
8149 2E EE FE                                                 INW     RP
814C 1D EE FE                                                 LDR     RP
814F 16 FB FE                                                 STA     R3.1
8152 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3 = (RP)
                                                      
8153 38 43 81                                         _RGET3: JPS     _RGET3_
8156 2F EE FE                                                 DEW     RP
8159 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3 = (RP)
                                                      
815A 38 43 81                                         _RPOP3: JPS     _RGET3_
815D 2E EE FE                                                 INW     RP
8160 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (SP) = R1 "half function"
                                                      
8161 15 F3 FE                                         _PUT1_: LDA     R1.1
8164 1E EC FE                                                 STR     SP
8167 2F EC FE                                                 DEW     SP
816A 15 F2 FE                                                 LDA     R1.0
816D 1E EC FE                                                 STR     SP
8170 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (SP) = R1
                                                      
8171 2E EC FE                                         _PUT1:  INW     SP
8174 38 61 81                                                 JPS     _PUT1_
8177 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       -(SP) = R1
                                                      
8178 2F EC FE                                         _PUSH1: DEW     SP
817B 38 61 81                                                 JPS     _PUT1_
817E 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (SP) = R2 "half function"
                                                      
817F 15 F7 FE                                         _PUT2_: LDA     R2.1
8182 1E EC FE                                                 STR     SP
8185 2F EC FE                                                 DEW     SP
8188 15 F6 FE                                                 LDA     R2.0
818B 1E EC FE                                                 STR     SP
818E 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (SP) = R2
                                                      
818F 2E EC FE                                         _PUT2:  INW     SP
8192 38 7F 81                                                 JPS     _PUT2_
8195 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       -(SP) = R2
                                                      
8196 2F EC FE                                         _PUSH2: DEW     SP
8199 38 7F 81                                                 JPS     _PUT2_
819C 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (SP) = R3 "half function"
                                                      
819D 15 FB FE                                         _PUT3_: LDA     R3.1
81A0 1E EC FE                                                 STR     SP
81A3 2F EC FE                                                 DEW     SP
81A6 15 FA FE                                                 LDA     R3.0
81A9 1E EC FE                                                 STR     SP
81AC 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (SP) = R3
                                                      
81AD 2E EC FE                                         _PUT3:  INW     SP
81B0 38 9D 81                                                 JPS     _PUT3_
81B3 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       -(SP) = R3
                                                      
81B4 2F EC FE                                         _PUSH3: DEW     SP
81B7 38 9D 81                                                 JPS     _PUT3_
81BA 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (RP) = R1 "half function"
                                                      
81BB 15 F3 FE                                         _RPUT1_: LDA    R1.1
81BE 1E EE FE                                                 STR     RP
81C1 2F EE FE                                                 DEW     RP
81C4 15 F2 FE                                                 LDA     R1.0
81C7 1E EE FE                                                 STR     RP
81CA 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (RP) = R1
                                                      
81CB 2E EE FE                                         _RPUT1: INW     RP
81CE 38 BB 81                                                 JPS     _RPUT1_
81D1 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       -(RP) = R1
                                                      
81D2 2F EE FE                                         _RPUSH1: DEW    RP
81D5 38 BB 81                                                 JPS     _RPUT1_
81D8 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (RP) = R2 "half function"
                                                      
81D9 15 F7 FE                                         _RPUT2_: LDA    R2.1
81DC 1E EE FE                                                 STR     RP
81DF 2F EE FE                                                 DEW     RP
81E2 15 F6 FE                                                 LDA     R2.0
81E5 1E EE FE                                                 STR     RP
81E8 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (RP) = R2
                                                      
81E9 2E EE FE                                         _RPUT2: INW     RP
81EC 38 D9 81                                                 JPS     _RPUT2_
81EF 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       -(RP) = R2
                                                      
81F0 2F EE FE                                         _RPUSH2: DEW    RP
81F3 38 D9 81                                                 JPS     _RPUT2_
81F6 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (RP) = R3 "half function"
                                                      
81F7 15 FB FE                                         _RPUT3_: LDA    R3.1
81FA 1E EE FE                                                 STR     RP
81FD 2F EE FE                                                 DEW     RP
8200 15 FA FE                                                 LDA     R3.0
8203 1E EE FE                                                 STR     RP
8206 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (RP) = R3
                                                      
8207 2E EE FE                                         _RPUT3: INW     RP
820A 38 F7 81                                                 JPS     _RPUT3_
820D 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       -(RP) = R3
                                                      
820E 2F EE FE                                         _RPUSH3: DEW    RP
8211 38 F7 81                                                 JPS     _RPUT3_
8214 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = R1 + R2
                                                      
8215 15 F2 FE                                         _ADD16: LDA     R1.0
8218 17 F6 FE                                                 ADA     R2.0
821B 16 F2 FE                                                 STA     R1.0
821E 15 F3 FE                                                 LDA     R1.1
8221 1A F7 FE                                                 ACA     R2.1
8224 16 F3 FE                                                 STA     R1.1
8227 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1X = R1X + R2X
                                                      
8228 15 F2 FE                                         _ADD32: LDA     R1.0
822B 17 F6 FE                                                 ADA     R2.0
822E 16 F2 FE                                                 STA     R1.0
8231 15 F3 FE                                                 LDA     R1.1
8234 1A F7 FE                                                 ACA     R2.1
8237 16 F3 FE                                                 STA     R1.1
823A 15 F4 FE                                                 LDA     R1.2
823D 1A F8 FE                                                 ACA     R2.2
8240 16 F4 FE                                                 STA     R1.2
8243 15 F5 FE                                                 LDA     R1.3
8246 1A F9 FE                                                 ACA     R2.3
8249 16 F5 FE                                                 STA     R1.3
824C 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (R1)
                                                      
824D 1D F2 FE                                         _AT:    LDR     R1              ; Get LSB
8250 16 F4 FE                                                 STA     R1.2            ; ... Store temp
8253 2E F2 FE                                                 INW     R1              ; Bump
8256 1D F2 FE                                                 LDR     R1              ; Get MSB
8259 16 F5 FE                                                 STA     R1.3            ; ... Store temp
825C 15 F4 FE                                                 LDA     R1.2            ; Get temp LSB
825F 16 F2 FE                                                 STA     R1.0            ; ... Store
8262 15 F5 FE                                                 LDA     R1.3            ; Get temp MSB
8265 16 F3 FE                                                 STA     R1.1            ; ... Store
8268 39                                                       RTS                     ; Done
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = (R3)
                                                      
8269 1D FA FE                                         _LD16:  LDR     R3
826C 16 F2 FE                                                 STA     R1.0
826F 2E FA FE                                                 INW     R3
8272 1D FA FE                                                 LDR     R3
8275 16 F3 FE                                                 STA     R1.1
8278 2F FA FE                                                 DEW     R3
827B 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       (R3) = R1
                                                      
827C 15 F2 FE                                         _ST16:  LDA     R1.0
827F 1E FA FE                                                 STR     R3
8282 2E FA FE                                                 INW     R3
8285 15 F3 FE                                                 LDA     R1.1
8288 1E FA FE                                                 STR     R3
828B 2F FA FE                                                 DEW     R3
828E 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1.0 = R1.0 & R2.0
                                                      
828F 0E 08                                            _AND8:  LDI     8               ; Load bit counter
8291 16 FE FE                                                 STA     BC              ; :
8294 15 F6 FE                                         _AND81: LDA     R2.0            ; Load second operand
8297 05                                                       LSL                     ; Shift 2b7 into C
8298 16 F6 FE                                                 STA     R2.0            ; Store shifted second operand
829B 15 F2 FE                                                 LDA     R1.0            ; Load first operand
829E 3C A7 82                                                 BCC     _AND82          ; If C is clear: Shift in a zero
                                                              ; 2b7 is set
82A1 11 00                                                    CPI     0               ; Is first operand < 0, i.e. is 1b7 set?
82A3 3F A7 82                                                 BMI     _AND82           ; N is set: 1b7 is set
                                                              ; 1b7 is clear
82A6 03                                                       CLC                     ; 1b7 is clear: Clear C
82A7 06                                               _AND82: ROL                     ; Shift C into result
82A8 16 F2 FE                                                 STA     R1.0            ; Store first operand/result
82AB 27 FE FE                                                 DEB     BC              ; All bits done?
82AE 3A 94 82                                                 BNE     _AND81          ;   NO: Do one more
82B1 39                                                       RTS                     ;   YES: All done
                                                      
                                                      ; ------------------------------
                                                      ;       R1.0 = R1.0 | R2.0
                                                      
82B2 0E 08                                            _OR8:   LDI     8               ; Load bit counter
82B4 16 FE FE                                                 STA     BC              ; :
82B7 15 F6 FE                                         _OR810: LDA     R2.0            ; Load second operand
82BA 05                                                       LSL                     ; Shift 2b7 into C
82BB 16 F6 FE                                                 STA     R2.0            ; Store shifted second operand
82BE 15 F2 FE                                                 LDA     R1.0            ; Load first operand
82C1 3D CA 82                                                 BCS     _OR820          ; If C is set, shift it into result
                                                              ; 2b7 is clear
82C4 11 00                                                    CPI     0               ; Is first operand < 0, i.e. is 1b7 set?
82C6 3F CA 82                                                 BMI     _OR820          ; N is clear: 1b7 is clear
                                                              ; 1b7 is clear
82C9 03                                                       CLC                     ; Neither bit is set: Clear C 
82CA 06                                               _OR820: ROL                     ; Shift C into result
82CB 16 F2 FE                                                 STA     R1.0            ; Store first operand/result
82CE 27 FE FE                                                 DEB     BC              ; All bits done?
82D1 3A B7 82                                                 BNE     _OR810          ;   NO: Do one more
82D4 39                                                       RTS                     ;   YES: All done
                                                      
                                                      ; ------------------------------
                                                      ;       R1.0 = R1.0 ^ R2.0
                                                      
82D5 0E 08                                            _XOR8:  LDI     8               ; Load bit counter
82D7 16 FE FE                                                 STA     BC              ; :
82DA 15 F6 FE                                         _XOR81: LDA     R2.0            ; Get second operand
82DD 05                                                       LSL                     ; Shift b7 into C
82DE 16 F6 FE                                                 STA     R2.0            ; Store shifted second operand
82E1 15 F2 FE                                                 LDA     R1.0            ; Load first operand
82E4 3D EF 82                                                 BCS     _XOR82          ; C is set, check 1b7 for zero
                                                              ; 2b7 is clear
82E7 11 00                                                    CPI     0               ; Is first operand < 0, i.e. is b7 set?
82E9 3F F5 82                                                 BMI     _XOR84          ; 1b7 is set and 2b7 is clear, shift in C which is set
82EC 14 F4 82                                                 JPA     _XOR83          ; 1b7 and 2b7 are both zero, clear C and shift in 
                                                              ; 2b7 is set, check 1b7 for zero
82EF 11 00                                            _XOR82: CPI     0
82F1 3E F5 82                                                 BPL     _XOR84          ; If 1b7 is zero, shift in C which is set
82F4 03                                               _XOR83: CLC                     ; 1b7 and 2b7 are equal, shift in a zero
82F5 06                                               _XOR84: ROL                     ; Shift whatever is in C into result
82F6 16 F2 FE                                                 STA     R1.0            ; Store first operand/result
82F9 27 FE FE                                                 DEB     BC              ; All bits done?
82FC 3A DA 82                                                 BNE     _XOR81          ;   NO: Do one more
82FF 39                                                       RTS                     ;   YES: All done
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = ~R1
                                                      
8300 15 F5 FE                                         _NOT32: LDA     R1.3            ; Negate MSB
8303 0B                                                       NEG                     ; Two-complement negation
8304 10 01                                                    SBI     1               ; Adjust to bitwise not
8306 16 F5 FE                                                 STA     R1.3            ; Store negated MSB
8309 15 F4 FE                                                 LDA     R1.2            ; Negate byte2
830C 0B                                                       NEG                     ; Two-complement negation
830D 10 01                                                    SBI     1               ; Adjust to bitwise not
830F 16 F4 FE                                                 STA     R1.2            ; Store negated byte2
8312 15 F3 FE                                         _NOT16: LDA     R1.1            ; Negate byte1
8315 0B                                                       NEG                     ; Two-complement negation
8316 10 01                                                    SBI     1               ; Adjust to bitwise not
8318 16 F3 FE                                                 STA     R1.1            ; Store negated byte1
831B 15 F2 FE                                                 LDA     R1.0            ; Negate LSB
831E 0B                                                       NEG                     ; Two-complement negation
831F 10 01                                                    SBI     1               ; Adjust to bitwise not
8321 16 F2 FE                                                 STA     R1.0            ; Store negated LSB
8324 39                                                       RTS                     ; Done
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = -R1
                                                      
8325 38 12 83                                         _NEG16: JPS     _NOT16          ; Bitwise NOT R1
8328 15 F2 FE                                                 LDA     R1.0            ; Add one to make it 2-complement
832B 0F 01                                                    ADI     1               ; :
832D 16 F2 FE                                                 STA     R1.0            ; :
8330 15 F3 FE                                                 LDA     R1.1            ; :
8333 12 00                                                    ACI     0               ; :
8335 16 F3 FE                                                 STA     R1.1            ; :
8338 39                                                       RTS                     ; Done
                                                      
                                                      ; ------------------------------
                                                      ;       R1X = -R1X
                                                      
8339 38 00 83                                         _NEG32: JPS     _NOT32          ; Bitwise NOT R1X
833C 15 F2 FE                                                 LDA     R1.0            ; Add one to make it 2-complement
833F 0F 01                                                    ADI     1               ; :
8341 16 F2 FE                                                 STA     R1.0            ; :
8344 15 F3 FE                                                 LDA     R1.1            ; :
8347 12 00                                                    ACI     0               ; :
8349 16 F3 FE                                                 STA     R1.1            ; :
834C 15 F4 FE                                                 LDA     R1.2            ; :
834F 12 00                                                    ACI     0               ; :
8351 16 F4 FE                                                 STA     R1.2            ; :
8354 15 F5 FE                                                 LDA     R1.3            ; :
8357 12 00                                                    ACI     0               ; :
8359 16 F5 FE                                                 STA     R1.3            ; :
835C 39                                                       RTS                     ; Done
                                                      
                                                      ; ------------------------------
                                                      ;       R1 <-> R2
                                                      
835D 38 78 81                                         _XCH16: JPS     _PUSH1          ; Temp = R1
8360 15 F6 FE                                                 LDA     R2.0            ; R1 = R2
8363 16 F2 FE                                                 STA     R1.0            ; :
8366 15 F7 FE                                                 LDA     R2.1            ; :
8369 16 F3 FE                                                 STA     R1.1            ; :
836C 38 B6 80                                                 JPS     _POP2           ; R2 = Temp
836F 39                                                       RTS                     ; Done
                                                      
                                                      ; ------------------------------
                                                      ;       +ORIGIN
                                                      ; NOTE: Index number in R2
                                                      
8370 0E 00                                            _PORIG: LDI     <ORIGIN         ; R1 = ORIGIN address
8372 16 FA FE                                                 STA     R3.0            ; :
8375 0E 80                                                    LDI     >ORIGIN         ; :
8377 16 FB FE                                                 STA     R3.1            ; :
837A 15 F6 FE                                                 LDA     R2.0            ; Get index number
837D 30 FA FE                                                 ADW     R3              ; Compute addr
8380 39                                                       RTS                     ; Done
                                                      
                                                      ; ------------------------------
                                                      ;       _USER
                                                      ; NOTE: Index number in R2
                                                      
8381 15 F0 FE                                         _USER:  LDA     UP.0            ; R1 = UP
8384 16 FA FE                                                 STA     R3.0            ; :
8387 15 F1 FE                                                 LDA     UP.1            ; :
838A 16 FB FE                                                 STA     R3.1            ; :
838D 15 F6 FE                                                 LDA     R2.0            ; Get index number
8390 30 FA FE                                                 ADW     R3              ; Compute addr
8393 39                                                       RTS                     ; Done
                                                      
                                                      ; ------------------------------
                                                      ;       _SWAP8
                                                      ; Swaps R1.1 <-> R1.0
                                                      ;       R2.1 <-> R2.0
                                                      
8394 15 F2 FE                                         _SWAP8: LDA     R1.0
8397 16 FF FE                                                 STA     TMP
839A 15 F3 FE                                                 LDA     R1.1
839D 16 F2 FE                                                 STA     R1.0
83A0 15 FF FE                                                 LDA     TMP
83A3 16 F3 FE                                                 STA     R1.1
83A6 15 F6 FE                                                 LDA     R2.0
83A9 16 FF FE                                                 STA     TMP
83AC 15 F7 FE                                                 LDA     R2.1
83AF 16 F6 FE                                                 STA     R2.0
83B2 15 FF FE                                                 LDA     TMP
83B5 16 F7 FE                                                 STA     R2.1
83B8 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = R1 & R2
                                                      
83B9 38 8F 82                                         _AND16: JPS     _AND8
83BC 38 94 83                                                 JPS     _SWAP8
83BF 38 8F 82                                                 JPS     _AND8
83C2 38 94 83                                                 JPS     _SWAP8
83C5 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = R1 | R2
                                                      
83C6 38 B2 82                                         _OR16:  JPS     _OR8
83C9 38 94 83                                                 JPS     _SWAP8
83CC 38 B2 82                                                 JPS     _OR8
83CF 38 94 83                                                 JPS     _SWAP8
83D2 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1 = R1 ^ R2
                                                      
83D3 38 D5 82                                         _XOR16: JPS     _XOR8
83D6 38 94 83                                                 JPS     _SWAP8
83D9 38 D5 82                                                 JPS     _XOR8
83DC 38 94 83                                                 JPS     _SWAP8
83DF 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R3X = R1X * R2X
                                                      
83E0 0E 10                                            _UMULT: LDI     16              ; Set bit counter
83E2 16 FE FE                                                 STA     BC
83E5 0E 00                                                    LDI     0               ; R3X = 0
83E7 16 FA FE                                                 STA     R3.0            ; :
83EA 16 FB FE                                                 STA     R3.1            ; :
83ED 16 FC FE                                                 STA     R3.2            ; :
83F0 16 FD FE                                                 STA     R3.3            ; :
83F3 16 F4 FE                                                 STA     R1.2            ; R1H = 0
83F6 16 F5 FE                                                 STA     R1.3            ; :
83F9 15 F7 FE                                         _UMU10: LDA     R2.1            ; R2 >> 1
83FC 07                                                       LSR                     ; :
83FD 16 F7 FE                                                 STA     R2.1            ; :
8400 15 F6 FE                                                 LDA     R2.0            ; :
8403 08                                                       ROR                     ; :
8404 16 F6 FE                                                 STA     R2.0            ; :
8407 3C 2E 84                                                 BCC     _UMU20          ; No carry, no add
840A 15 FA FE                                                 LDA     R3.0            ; R3X = R3X + R1X
840D 17 F2 FE                                                 ADA     R1.0            ; :
8410 16 FA FE                                                 STA     R3.0            ; :
8413 15 FB FE                                                 LDA     R3.1            ; :
8416 1A F3 FE                                                 ACA     R1.1            ; :
8419 16 FB FE                                                 STA     R3.1            ; :
841C 15 FC FE                                                 LDA     R3.2            ; :
841F 1A F4 FE                                                 ACA     R1.2            ; :
8422 16 FC FE                                                 STA     R3.2            ; :
8425 15 FD FE                                                 LDA     R3.3            ; :
8428 1A F5 FE                                                 ACA     R1.3            ; :
842B 16 FD FE                                                 STA     R3.3            ; :
842E 15 F2 FE                                         _UMU20: LDA     R1.0            ; R1X << 1
8431 05                                                       LSL                     ; :
8432 16 F2 FE                                                 STA     R1.0            ; :
8435 15 F3 FE                                                 LDA     R1.1            ; :
8438 06                                                       ROL                     ; :
8439 16 F3 FE                                                 STA     R1.1            ; :
843C 15 F4 FE                                                 LDA     R1.2            ; :
843F 06                                                       ROL                     ; :
8440 16 F4 FE                                                 STA     R1.2            ; :
8443 15 F5 FE                                                 LDA     R1.3            ; :
8446 06                                                       ROL                     ; :
8447 16 F5 FE                                                 STA     R1.3            ; :
844A 27 FE FE                                                 DEB     BC              ; Decrement bit counter
844D 3A F9 83                                                 BNE     _UMU10          ; Not zero, more bits to go
8450 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       R1X / R2L
                                                      ;       R1H: Quotient
                                                      ;       R1L: Remainder
                                                      
8451 0E 10                                            _UDIV:  LDI     16              ; Set bit counter
8453 16 FE FE                                                 STA     BC              ; :
                                                              
8456 15 F2 FE                                         _UDI10: LDA     R1.0            ; R1X = R1X << 1
8459 05                                                       LSL                     ; :
845A 16 F2 FE                                                 STA     R1.0            ; :
845D 15 F3 FE                                                 LDA     R1.1            ; :
8460 06                                                       ROL                     ; :
8461 16 F3 FE                                                 STA     R1.1            ; :
8464 15 F4 FE                                                 LDA     R1.2            ; :
8467 06                                                       ROL                     ; :
8468 16 F4 FE                                                 STA     R1.2            ; :
846B 15 F5 FE                                                 LDA     R1.3            ; :
846E 06                                                       ROL                     ; :
846F 16 F5 FE                                                 STA     R1.3            ; :
                                                      
8472 15 F4 FE                                                 LDA     R1.2            ; R3H = R1H
8475 16 FC FE                                                 STA     R3.2            ; :
8478 15 F5 FE                                                 LDA     R1.3            ; :
847B 16 FD FE                                                 STA     R3.3            ; :
                                                              
847E 15 FC FE                                                 LDA     R3.2            ; R3H = R3H - R2L
8481 18 F6 FE                                                 SBA     R2.0            ; :
8484 16 FC FE                                                 STA     R3.2            ; :
8487 15 FD FE                                                 LDA     R3.3            ; :
848A 1B F7 FE                                                 SCA     R2.1            ; :
848D 16 FD FE                                                 STA     R3.3            ; :
                                                              
8490 3C A2 84                                                 BCC     _UDI20
                                                              
8493 15 FC FE                                                 LDA     R3.2            ; R1H = R3H
8496 16 F4 FE                                                 STA     R1.2            ; :
8499 15 FD FE                                                 LDA     R3.3            ; :
849C 16 F5 FE                                                 STA     R1.3            ; :
                                                              
849F 2E F2 FE                                                 INW     R1.0            ; R1L++
                                                              
84A2 27 FE FE                                         _UDI20: DEB     BC              ; All bits done?
84A5 3A 56 84                                                 BNE     _UDI10          ; NO: Loop again
                                                              
84A8 39                                                       RTS
                                                      
                                                      ; INCLUDE         debug.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; TEMP DEBUG FUNCTIONS FOR BRINGING UP THE SYSTEM
                                                      ;
                                                      
84A9 00                                               DBG:    DB      0
84AA 00                                               OUTC:   DB      0
                                                      
84AB 15 AA 84                                         _LNYB:  LDA     OUTC
84AE 05                                                       LSL
84AF 05                                                       LSL
84B0 05                                                       LSL
84B1 05                                                       LSL
84B2 14 B8 84                                                 JPA     _HNYB1
84B5 15 AA 84                                         _HNYB:  LDA     OUTC
84B8 07                                               _HNYB1: LSR
84B9 07                                                       LSR
84BA 07                                                       LSR
84BB 07                                                       LSR
84BC 16 AA 84                                                 STA     OUTC
84BF 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       "COUT"
                                                      
84C0 15 AA 84                                         _COUT:  LDA     OUTC
84C3 02                                                       OUT
84C4 00                                               _OWAIT: NOP
84C5 00                                                       NOP
84C6 00                                                       NOP
84C7 00                                                       NOP
84C8 00                                                       NOP
84C9 00                                                       NOP
84CA 00                                                       NOP
84CB 00                                                       NOP
84CC 00                                                       NOP
84CD 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       "OUTHX"
                                                      
84CE 15 AA 84                                         _OUTHX: LDA     OUTC
84D1 11 0A                                                    CPI     10
84D3 3F E0 84                                                 BMI     _OUTH1
84D6 10 0A                                                    SBI     10
84D8 0F 41                                                    ADI     'A'
84DA 16 AA 84                                                 STA     OUTC
84DD 14 C0 84                                                 JPA     _COUT
84E0 0F 30                                            _OUTH1: ADI     '0'
84E2 16 AA 84                                                 STA     OUTC
84E5 14 C0 84                                                 JPA     _COUT
                                                      
                                                      ; ------------------------------
                                                      ;       "DUMP"
                                                      
84E8 15 F6 FE                                         _DUMP:  LDA     R2.0
84EB 11 00                                                    CPI     0
84ED 3A F1 84                                                 BNE     _DUMP1
84F0 39                                                       RTS
                                                              ;
                                                      _DUMP1:
84F1 2F F2 FE                                                 DEW     R1
84F4 1D F2 FE                                                 LDR     R1
84F7 16 AA 84                                                 STA     OUTC
84FA 38 B5 84                                                 JPS     _HNYB
84FD 38 CE 84                                                 JPS     _OUTHX
8500 1D F2 FE                                                 LDR     R1
8503 16 AA 84                                                 STA     OUTC
8506 38 AB 84                                                 JPS     _LNYB
8509 38 CE 84                                                 JPS     _OUTHX
                                                      
850C 2F F2 FE                                                 DEW     R1
850F 1D F2 FE                                                 LDR     R1
8512 16 AA 84                                                 STA     OUTC
8515 38 B5 84                                                 JPS     _HNYB
8518 38 CE 84                                                 JPS     _OUTHX
851B 1D F2 FE                                                 LDR     R1
851E 16 AA 84                                                 STA     OUTC
8521 38 AB 84                                                 JPS     _LNYB
8524 38 CE 84                                                 JPS     _OUTHX
                                                      
8527 0E 20                                                    LDI     32
8529 16 AA 84                                                 STA     OUTC
852C 38 C0 84                                                 JPS     _COUT
                                                      
852F 27 F6 FE                                                 DEB     R2.0
8532 27 F6 FE                                                 DEB     R2.0
8535 3A F1 84                                                 BNE     _DUMP1
8538 39                                                       RTS
                                                      
8539 0E 02                                            _REG:   LDI     2
853B 16 F6 FE                                                 STA     R2.0
853E 2E F2 FE                                                 INW     R1              ; High byte first
8541 1D F2 FE                                         _REG10: LDR     R1
8544 16 AA 84                                                 STA     OUTC
8547 38 B5 84                                                 JPS     _HNYB
854A 38 CE 84                                                 JPS     _OUTHX
854D 1D F2 FE                                                 LDR     R1
8550 16 AA 84                                                 STA     OUTC
8553 38 AB 84                                                 JPS     _LNYB
8556 38 CE 84                                                 JPS     _OUTHX
8559 2F F2 FE                                                 DEW     R1
855C 27 F6 FE                                                 DEB     R2.0
855F 3A 41 85                                                 BNE     _REG10
8562 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       "CRLF"
                                                      
8563 0E 0D                                            _CRLF:  LDI     0x0D
8565 16 AA 84                                                 STA     OUTC
8568 38 C0 84                                                 JPS     _COUT
856B 0E 0A                                                    LDI     0x0A
856D 16 AA 84                                                 STA     OUTC
8570 38 C0 84                                                 JPS     _COUT
8573 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       "DDST" "DRST"
                                                      
8574 0E EC                                            _DDST:  LDI     <SP
8576 16 F2 FE                                                 STA     R1.0
8579 0E FE                                                    LDI     >SP
857B 16 F3 FE                                                 STA     R1.1
857E 38 39 85                                                 JPS     _REG
8581 0E 53                                                    LDI     'S'
8583 16 AA 84                                                 STA     OUTC
8586 38 C0 84                                                 JPS     _COUT
8589 0E 20                                                    LDI     32
858B 16 AA 84                                                 STA     OUTC
858E 38 C0 84                                                 JPS     _COUT
                                                              ;
8591 0E B9                                                    LDI     <XSP
8593 16 F2 FE                                                 STA     R1.0
8596 0E F5                                                    LDI     >XSP
8598 16 F3 FE                                                 STA     R1.1
859B 0E B9                                                    LDI     <XSP
859D 18 EC FE                                                 SBA     SP.0
85A0 16 F6 FE                                                 STA     R2.0
85A3 0E F5                                                    LDI     >XSP
85A5 1B ED FE                                                 SCA     SP.1
85A8 16 F7 FE                                                 STA     R2.1
85AB 38 E8 84                                                 JPS     _DUMP
85AE 39                                                       RTS
                                                      
85AF 0E EE                                            _DRST:  LDI     <RP
85B1 16 F2 FE                                                 STA     R1.0
85B4 0E FE                                                    LDI     >RP
85B6 16 F3 FE                                                 STA     R1.1
85B9 38 39 85                                                 JPS     _REG
85BC 0E 52                                                    LDI     'R'
85BE 16 AA 84                                                 STA     OUTC
85C1 38 C0 84                                                 JPS     _COUT
85C4 0E 20                                                    LDI     32
85C6 16 AA 84                                                 STA     OUTC
85C9 38 C0 84                                                 JPS     _COUT
                                                              ;
85CC 0E 8D                                                    LDI     <XRP
85CE 16 F2 FE                                                 STA     R1.0
85D1 0E F6                                                    LDI     >XRP
85D3 16 F3 FE                                                 STA     R1.1
85D6 0E 8D                                                    LDI     <XRP
85D8 18 EE FE                                                 SBA     RP.0
85DB 16 F6 FE                                                 STA     R2.0
85DE 0E F6                                                    LDI     >XRP
85E0 1B EF FE                                                 SCA     RP.1
85E3 16 F7 FE                                                 STA     R2.1
85E6 38 E8 84                                                 JPS     _DUMP
85E9 39                                                       RTS
                                                      
                                                      ; ------------------------------
                                                      ;       "DEBUG"
                                                      
                                                      DEBUG:
85EA 38 63 85                                                 JPS     _CRLF
85ED 38 AF 85                                                 JPS     _DRST
85F0 38 63 85                                                 JPS     _CRLF
85F3 38 74 85                                                 JPS     _DDST
85F6 38 63 85                                                 JPS     _CRLF
85F9 0E E8                                                    LDI     <IP
85FB 16 F2 FE                                                 STA     R1.0
85FE 0E FE                                                    LDI     >IP
8600 16 F3 FE                                                 STA     R1.1
8603 38 39 85                                                 JPS     _REG
8606 0E 3E                                                    LDI     '>'
8608 16 AA 84                                                 STA     OUTC
860B 38 C0 84                                                 JPS     _COUT
860E 0E 20                                                    LDI     32
8610 16 AA 84                                                 STA     OUTC
8613 38 C0 84                                                 JPS     _COUT
8616 0A                                               KWAIT:  INP
8617 11 FF                                                    CPI     0xFF
8619 3B 16 86                                                 BEQ     KWAIT
861C 11 20                                                    CPI     CH_BL
861E 3B 2E 86                                                 BEQ     KWAI10
8621 11 08                                                    CPI     CH_BSP
8623 3A 33 86                                                 BNE     KWAI20
8626 0E 00                                                    LDI     0
8628 16 A9 84                                                 STA     DBG
862B 14 00 00                                                 JPA     0
862E 0E 00                                            KWAI10: LDI     0
8630 16 A9 84                                                 STA     DBG
8633 39                                               KWAI20: RTS
                                                      
                                                      ; ------------------------------
                                                      ;
                                                      
8634 36 86                                            _DEBON: DW      _DEBO0
8636 0E 01                                            _DEBO0: LDI     1
8638 16 A9 84                                                 STA     DBG
863B 14 71 86                                                 JPA     NEXT
                                                      
863E 40 86                                            _DEBOF: DW      _DEBF0
8640 0E 00                                            _DEBF0: LDI     0
8642 16 A9 84                                                 STA     DBG
8645 14 71 86                                                 JPA     NEXT
                                                      
8648 4A 86                                            _HALT:  DW      _HALT0
864A 14 4A 86                                         _HALT0: JPA     _HALT0
                                                      
                                                      ; INCLUDE         inner.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; INNER INTERPRETER
                                                      
864D 2F EC FE                                         IPUSH:  DEW     SP              ; -(SP) = R1H
8650 15 F5 FE                                                 LDA     R1.3
8653 1E EC FE                                                 STR     SP
8656 2F EC FE                                                 DEW     SP
8659 15 F4 FE                                                 LDA     R1.2
865C 1E EC FE                                                 STR     SP
865F 2F EC FE                                         PUSH:   DEW     SP              ; -(SP) = R1L
8662 15 F3 FE                                                 LDA     R1.1
8665 1E EC FE                                                 STR     SP
8668 2F EC FE                                                 DEW     SP
866B 15 F2 FE                                                 LDA     R1.0
866E 1E EC FE                                                 STR     SP
8671 1D E8 FE                                         NEXT:   LDR     IP              ; WA = (IP)+
8674 16 EA FE                                                 STA     WA.0
8677 2E E8 FE                                                 INW     IP
867A 1D E8 FE                                                 LDR     IP
867D 16 EB FE                                                 STA     WA.1
8680 2E E8 FE                                                 INW     IP
8683 1D EA FE                                         NEXT10: LDR     WA              ; BC/TMP = (WA)+
8686 16 FE FE                                                 STA     BC
8689 2E EA FE                                                 INW     WA
868C 1D EA FE                                                 LDR     WA
868F 16 FF FE                                                 STA     TMP
8692 2E EA FE                                                 INW     WA
8695 15 A9 84                                                 LDA     DBG
8698 11 00                                                    CPI     0
869A 3B A0 86                                                 BEQ     NEXT11
869D 38 EA 85                                                 JPS     DEBUG
86A0 1C FE FE                                         NEXT11: JPR     BC              ; jump @(BC/TMP)
                                                      
                                                      ; ------------------------------
                                                      ;       Push TRUE and FALSE
                                                      
86A3 2C F2 FE                                         PUSHT:  CLW     R1              ; A zero
86A6 2F F2 FE                                                 DEW     R1              ; Make it into a -1 i.e. TRUE flag
86A9 14 5F 86                                                 JPA     PUSH
                                                      
86AC 2C F2 FE                                         PUSHF:  CLW     R1              ; A zero
86AF 14 5F 86                                                 JPA     PUSH
                                                      
                                                      ; ------------------------------
                                                      ;       Push R1X, MSB as TOS
                                                      
86B2 2F EC FE                                         DPUSH:  DEW     SP              ; -(SP) = R1X
86B5 15 F3 FE                                                 LDA     R1.1
86B8 1E EC FE                                                 STR     SP
86BB 2F EC FE                                                 DEW     SP
86BE 15 F2 FE                                                 LDA     R1.0
86C1 1E EC FE                                                 STR     SP
86C4 2F EC FE                                                 DEW     SP
86C7 15 F5 FE                                                 LDA     R1.3
86CA 1E EC FE                                                 STR     SP
86CD 2F EC FE                                                 DEW     SP
86D0 15 F4 FE                                                 LDA     R1.2
86D3 1E EC FE                                                 STR     SP
86D6 14 71 86                                                 JPA     NEXT
                                                      
                                                      ; INCLUDE         primaries.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; FORTH PRIMARIES
                                                      ;
                                                      
86D9 83 4C 49 D4                                      HLIT:   DB      ^3 "LI" ^'T'                            ; ***** LIT
86DD 00 00                                                    DW      0
86DF E1 86                                            LIT:    DW      LIT0
86E1 38 2A 80                                         LIT0:   JPS     _LIT            ; R1 = (IP)+
86E4 14 5F 86                                                 JPA     PUSH            ; -(SP) = R1; NEXT
                                                      
86E7 87 45 58 45 43 55 54 C5                          HEXEC:  DB      ^7 "EXECUT" ^'E'                        ; ***** EXECUTE
86EF D9 86                                                    DW      HLIT
86F1 F3 86                                            EXEC:   DW      EXEC0
86F3 1D EC FE                                         EXEC0:  LDR     SP              ; WA = (SP)+
86F6 16 EA FE                                                 STA     WA.0
86F9 2E EC FE                                                 INW     SP
86FC 1D EC FE                                                 LDR     SP
86FF 16 EB FE                                                 STA     WA.1
8702 2E EC FE                                                 INW     SP
8705 14 83 86                                                 JPA     NEXT10          ; jump @(WA)+
                                                      
8708 86 42 52 41 4E 43 C8                             HBRAN:  DB      ^6 "BRANC" ^'H'                         ; ***** BRANCH
870F E7 86                                                    DW      HEXEC
8711 13 87                                            BRAN:   DW      BRAN0
8713 38 3D 80                                         BRAN0:  JPS     _BRAN           ; IP = IP + (IP)
8716 14 71 86                                                 JPA     NEXT
                                                      
8719 87 30 42 52 41 4E 43 C8                          HZBRAN: DB      ^7 "0BRANC" ^'H'                        ; ***** 0BRANCH
8721 08 87                                                    DW      HBRAN
8723 25 87                                            ZBRAN:  DW      ZBRAN0
8725 1D EC FE                                         ZBRAN0: LDR     SP
8728 11 00                                                    CPI     0               ; Low byte non-zero?
872A 3A 3E 87                                                 BNE     ZBRA10          ; YES: Do not branch
872D 2E EC FE                                                 INW     SP
8730 1D EC FE                                                 LDR     SP
8733 11 00                                                    CPI     0               ; High byte non-zero?
8735 3A 41 87                                                 BNE     ZBRA20          ; YES: Do not branch
8738 2E EC FE                                                 INW     SP
873B 14 13 87                                                 JPA     BRAN0           ; IP = IP + (IP); NEXT
873E 2E EC FE                                         ZBRA10: INW     SP
8741 2E EC FE                                         ZBRA20: INW     SP
8744 2E E8 FE                                                 INW     IP              ; Just skip jump offset
8747 2E E8 FE                                                 INW     IP
874A 14 71 86                                                 JPA     NEXT
                                                      
874D 87 28 2B 4C 4F 4F 50 A9                          HXPLOO: DB      ^7 "(+LOOP" ^')'                        ; ***** (+LOOP)
8755 19 87                                                    DW      HZBRAN
8757 59 87                                            XPLOO:  DW      XPLOO0
8759 38 AF 80                                         XPLOO0: JPS     _GET2           ; R2 = (SP) [only copying increment]
875C 38 1E 81                                                 JPS     _RPOP1          ; R1 = (RP)+
875F 38 15 82                                                 JPS     _ADD16          ; R1 = counter'
8762 38 35 81                                                 JPS     _RGET2          ; R2 = limit
8765 38 D2 81                                                 JPS     _RPUSH1         ; -(RP) = R1'
8768 38 F9 80                                                 JPS     _POP3           ; R3 = (SP)+ [now popping incr]
876B 15 FB FE                                                 LDA     R3.1            ; Is increment negative?
876E 11 00                                                    CPI     0               ; :
8770 3E 76 87                                                 BPL     XPLO10
                                                              ; Handle negative increment
8773 38 5D 83                                                 JPS     _XCH16          ; R1 <-> R2
                                                              ; Compare counter to limit
8776 15 F3 FE                                         XPLO10: LDA     R1.1            ; Compare MSB
8779 19 F7 FE                                                 CPA     R2.1            ; :
877C 3F 13 87                                                 BMI     BRAN0           ; R2 is greater, continue looping
877F 3B 85 87                                                 BEQ     XPLO20          ; MSBs are equal, check LSBs
8782 14 8E 87                                                 JPA     XPLO30          ; R1 is greater, stop looping
                                                              ; MSBs are equal
8785 15 F2 FE                                         XPLO20: LDA     R1.0            ; Compare LSB
8788 19 F6 FE                                                 CPA     R2.0            
878B 3F 13 87                                                 BMI     BRAN0           ; R2 is greater, continue looping
                                                              ; Limit reached, cleanup rstack and stop looping
878E 0E 04                                            XPLO30: LDI     4               ; Drop loop counter ...
8790 30 EE FE                                                 ADW     RP              ; ... and loop limit
8793 0E 02                                                    LDI     2               ; Skip branch offset
8795 30 E8 FE                                                 ADW     IP              ; :
8798 14 71 86                                                 JPA     NEXT
                                                      
879B 86 28 4C 4F 4F 50 A9                             HXLOOP: DB      ^6 "(LOOP" ^')'                         ; ***** (LOOP)
87A2 4D 87                                                    DW      HXPLOO
87A4 A6 87                                            XLOOP:  DW      XLOOP0
87A6 2C F2 FE                                         XLOOP0: CLW     R1              ; Push a one
87A9 2E F2 FE                                                 INW     R1              ; :
87AC 38 78 81                                                 JPS     _PUSH1          ; :
87AF 14 59 87                                                 JPA     XPLOO0          ; (+LOOP)
                                                      
87B2 84 28 44 4F A9                                   HXDO:   DB      ^4 "(DO" ^')'                           ; ***** (DO)
87B7 9B 87                                                    DW      HXLOOP
87B9 BB 87                                            XDO:    DW      XDO0
87BB 38 00 81                                         XDO0:   JPS     _POP21          ; Loop counter, limit
87BE 38 D2 81                                                 JPS     _RPUSH1         ; Push limit onto rstack
87C1 38 F0 81                                                 JPS     _RPUSH2         ; Push loop counter onto rstack
87C4 14 71 86                                                 JPA     NEXT
                                                      
87C7 81 C9                                            HI:     DB      ^1 ^'I'                                 ; ***** I
87C9 B2 87                                                    DW      HXDO
87CB CD 87                                            I:      DW      I0
87CD 38 17 81                                         I0:     JPS     _RGET1          ; Get loop counter
87D0 14 5F 86                                                 JPA     PUSH            ; Push it onto dstack
                                                      
87D3 85 44 49 47 49 D4                                HDIGIT: DB      ^5 "DIGI" ^'T'                          ; ***** DIGIT
87D9 C7 87                                                    DW      HI
87DB DD 87                                            DIGIT:  DW      DIGIT0
87DD 38 00 81                                         DIGIT0: JPS     _POP21          ; R2 = base, R1 = char
87E0 15 F2 FE                                                 LDA     R1.0            ; Get character into A
87E3 10 30                                                    SBI     '0'             ; Assume '0' - '9'
87E5 3F 01 88                                                 BMI     DIGI88          ; Oops! Negative
87E8 11 0A                                                    CPI     10              ; Greater than 9?
87EA 3F EF 87                                                 BMI     DIGI10          ; No, it is 0 - 9
                                                              ; 'A' - 'Z' case
87ED 10 07                                                    SBI     7               ; ch -= ('A' - '0') + 10
87EF 19 F6 FE                                         DIGI10: CPA     R2.0            ; Greater than base?
87F2 3F F8 87                                                 BMI     DIGI77
87F5 14 01 88                                                 JPA     DIGI88
87F8 16 F2 FE                                         DIGI77: STA     R1.0            ; Store binary value
87FB 38 78 81                                                 JPS     _PUSH1          ; Push the value
87FE 14 A3 86                                                 JPA     PUSHT           ; Push TRUE; NEXT
8801 14 AC 86                                         DIGI88: JPA     PUSHF           ; Push FALSE; NEXT
                                                      
8804 86 28 46 49 4E 44 A9                             HPFIND: DB      ^6 "(FIND" ^')'                         ; ***** (FIND)
880B D3 87                                                    DW      HDIGIT
880D 0F 88                                            PFIND:  DW      PFIND0
880F 38 73 80                                         PFIND0: JPS     _POP1           ; NFA
8812 38 F9 80                                                 JPS     _POP3           ; String address
8815 15 FA FE                                         PFIN10: LDA     R3.0            ; R2 = R3 (string address)
8818 16 F6 FE                                                 STA     R2.0            ; :
881B 15 FB FE                                                 LDA     R3.1            ; :
881E 16 F7 FE                                                 STA     R2.1            ; :
                                                              ; Fast comparison of length bytes
8821 1D F2 FE                                                 LDR     R1              ; Get lByte
8824 16 F4 FE                                                 STA     R1.2            ; ... Store as potential result
8827 05                                                       LSL                     ; lByte &= 0x3F
8828 05                                                       LSL                     ; :
8829 07                                                       LSR                     ; :
882A 07                                                       LSR                     ; :
882B 16 F8 FE                                                 STA     R2.2            ; R2.2 is counter for string match
882E 21 F6 FE                                                 CPR     R2              ; lByte == string length?
8831 3A 50 88                                                 BNE     PFIN25          ; NO: Move over to next header
                                                              ; Length bytes match, check names
8834 2E F2 FE                                         PFIN20: INW     R1              ; Bump pointers
8837 2E F6 FE                                                 INW     R2              ; :
883A 1D F2 FE                                                 LDR     R1              ; Get char from dictionary
883D 05                                                       LSL                     ; char &= 0x7F
883E 07                                                       LSR                     ; :
883F 21 F6 FE                                                 CPR     R2              ; Is it a match with search string?
8842 3A 5C 88                                                 BNE     PFIN30          ; NO: Look at next header in dictionary
8845 27 F8 FE                                                 DEB     R2.2            ; YES: Decrement character counter
8848 11 00                                                    CPI     0               ; At end of string?
884A 3B 7D 88                                                 BEQ     PFIN77          ; YES: This is the word we are looking for
884D 14 34 88                                                 JPA     PFIN20          ; Match so far, try next char
                                                              ; Step to next header in dictionary
8850 05                                               PFIN25: LSL                     ; Eliminate potential smudge bit
8851 05                                                       LSL                     ; A = A & 0x1F
8852 05                                                       LSL                     ; lByte consists of [^ISnnnnn]
8853 07                                                       LSR                     ; :
8854 07                                                       LSR                     ; :
8855 07                                                       LSR                     ; :
8856 16 F8 FE                                                 STA     R2.2            ; : also update char counter
8859 2E F2 FE                                                 INW     R1              ; Bump NFA pointer to actual characters
885C 2E F2 FE                                         PFIN30: INW     R1              ; Bump NFA pointer
885F 27 F8 FE                                                 DEB     R2.2            ; Decrement character counter
8862 11 00                                                    CPI     0               ; End of name field?
8864 3A 5C 88                                                 BNE     PFIN30          ; NO: Step to next char
8867 38 4D 82                                                 JPS     _AT             ; YES: R1 = (R1)
886A 15 F3 FE                                                 LDA     R1.1            ; At end of dictionary?
886D 11 00                                                    CPI     0               ; :
886F 3A 15 88                                                 BNE     PFIN10          ; NO: Try this word for match
8872 15 F2 FE                                                 LDA     R1.0            ; :
8875 11 00                                                    CPI     0               ; :
8877 3A 15 88                                                 BNE     PFIN10          ; NO: Try this word for match
                                                              ; Word not found, return a single FALSE
887A 14 AC 86                                         PFIN88: JPA     PUSHF           ; Done
                                                              ; Word found, return PFA, lByte, TRUE
887D 0E 05                                            PFIN77: LDI     5               ; Bump ptr to PFA
887F 30 F2 FE                                                 ADW     R1              ; :
8882 38 78 81                                                 JPS     _PUSH1          ; Push PFA
8885 15 F4 FE                                                 LDA     R1.2            ; Get stored length byte
8888 16 F2 FE                                                 STA     R1.0            ; :
888B 24 F3 FE                                                 CLB     R1.1            ; Clear MSB
888E 38 78 81                                                 JPS     _PUSH1          ; Push length byte
8891 14 A3 86                                                 JPA     PUSHT           ; Done
                                                      
8894 87 45 4E 43 4C 4F 53 C5                          HENCL:  DB      ^7 "ENCLOS" ^'E'                        ; ***** ENCLOSE
889C 04 88                                                    DW      HPFIND
889E A0 88                                            ENCL:   DW      ENCL0
88A0 38 F9 80                                         ENCL0:  JPS     _POP3           ; Get delimiter char
88A3 38 6C 80                                                 JPS     _GET1           ; Get addr of input
88A6 2C F6 FE                                                 CLW     R2              ; Initialize char index
                                                              ; Scan preceeding delimiters
88A9 1D F2 FE                                         ENCL10: LDR     R1              ; Get char from input
88AC 11 00                                                    CPI     0               ; Is it <NUL>?
88AE 3B E6 88                                                 BEQ     ENCL50          ; YES: <NUL> before first non-delimiter
88B1 19 FA FE                                                 CPA     R3.0            ; Is it a delimiter?
88B4 3A C0 88                                                 BNE     ENCL20          ; NO: We have the start of next token
88B7 2E F2 FE                                                 INW     R1              ; Bump to next char ...
88BA 26 F6 FE                                                 INB     R2.0            ; ... also increase index
88BD 14 A9 88                                                 JPA     ENCL10          ; Go back to look at next char
                                                              ; Start of token
88C0 38 96 81                                         ENCL20: JPS     _PUSH2          ; Push result n1 (first char of token)
88C3 1D F2 FE                                         ENCL30: LDR     R1              ; Get char from input
88C6 11 00                                                    CPI     0               ; Is it <NUL>?
88C8 3B F5 88                                                 BEQ     ENCL60          ; YES: <NUL> found
88CB 19 FA FE                                                 CPA     R3.0            ; Is it a delimiter?
88CE 3B DA 88                                                 BEQ     ENCL40          ; YES: We have the end of the token
88D1 2E F2 FE                                                 INW     R1              ; Bump to next char ...
88D4 26 F6 FE                                                 INB     R2.0            ; ... also increase index
88D7 14 C3 88                                                 JPA     ENCL30          ; Go back to look at next char
                                                              ; End of token
88DA 38 96 81                                         ENCL40: JPS     _PUSH2          ; Push result n2 (ending delimiter)
88DD 26 F6 FE                                                 INB     R2.0            ; Also push n3 ...
88E0 38 96 81                                                 JPS     _PUSH2          ; : ... (index to first non-scanned char)
88E3 14 71 86                                                 JPA     NEXT            ; Done
                                                              ; <NUL> word found
88E6 38 96 81                                         ENCL50: JPS     _PUSH2          ; Push i (index to <NUL>)
88E9 26 F6 FE                                                 INB     R2.0            ; Push i + 1 (a null is one character long)
88EC 38 96 81                                                 JPS     _PUSH2          ; :
88EF 38 96 81                                                 JPS     _PUSH2          ; :
88F2 14 71 86                                                 JPA     NEXT            ; Done
                                                              ; Token ends with a <NUL>
88F5 38 96 81                                         ENCL60: JPS     _PUSH2          ; Push i twice to continue next round ...
88F8 38 96 81                                                 JPS     _PUSH2          ; : ... by scanning the <NUL>
88FB 14 71 86                                                 JPA     NEXT            ; Done
                                                      
88FE 84 45 4D 49 D4                                   HEMIT:  DB      ^4 "EMI" ^'T'                           ; ***** EMIT
8903 94 88                                                    DW      HENCL
8905 07 89                                            EMIT:   DW      EMIT0
8907 38 73 80                                         EMIT0:  JPS     _POP1           ; Get character
890A 15 F2 FE                                                 LDA     R1.0            ; Send char to terminal
890D 02                                                       OUT                     ; :
890E 0E 22                                                    LDI     34              ; OUT++
8910 16 F6 FE                                                 STA     R2.0            ; : R2 = Index to OUT
8913 38 81 83                                                 JPS     _USER           ; : R3 = Addr to OUT
8916 38 69 82                                                 JPS     _LD16           ; : R1 = OUT
8919 2E F2 FE                                                 INW     R1              ; : R1++
891C 38 7C 82                                                 JPS     _ST16           ; : OUT = R1'
891F 14 71 86                                                 JPA     NEXT            ; Done
                                                      
8922 83 4B 45 D9                                      HKEY:   DB      ^3 "KE" ^'Y'                            ; ***** KEY
8926 FE 88                                                    DW      HEMIT
8928 2A 89                                            KEY:    DW      KEY0
892A 0A                                               KEY0:   INP                     ; Get char form terminal
892B 11 FF                                                    CPI     0xFF            ; Did we get a character?
892D 3B 2A 89                                                 BEQ     KEY0            ; NO: Try again
8930 16 F2 FE                                                 STA     R1.0            ; YES: Push character
8933 24 F3 FE                                                 CLB     R1.1            ; :
8936 14 5F 86                                                 JPA     PUSH            ; Push R1; NEXT
                                                      
8939 89 3F 54 45 52 4D 49 4E 41 CC                    HQTERM: DB      ^9 "?TERMINA" ^'L'                      ; ***** ?TERMINAL
8943 22 89                                                    DW      HKEY
8945 47 89                                            QTERM:  DW      QTERM0
8947 2C F2 FE                                         QTERM0: CLW     R1              ; Default FALSE to return
894A 0A                                                       INP                     ; Get char from terminal
894B 11 FF                                                    CPI     0xFF            ; Did we get a character?
894D 3B 53 89                                                 BEQ     QTER10          ; NO: Return FALSE
8950 2F F2 FE                                                 DEW     R1              ; Make default FALSE into TRUE
8953 14 5F 86                                         QTER10: JPA     PUSH            ; Push R1; NEXT
                                                      
8956 82 43 D2                                         HCR:    DB      ^2 "C" ^'R'                             ; ***** CR
8959 39 89                                                    DW      HQTERM
895B 83 8C DF 86 0D 00 05 89 DF 86 0A 00 05 89 B5 8A  CR:     DW      DOCOL LIT 13 EMIT LIT 10 EMIT SEMIS
                                                      
896B 83 52 2F D7                                      HRW:    DB      ^3 "R/" ^'W'                            ; ***** R/W
896F 56 89                                                    DW      HCR
8971 73 89                                            RW:     DW      RW0
8973 38 F9 80                                         RW0:    JPS     _POP3           ; 1:read 0:write
8976 38 00 81                                                 JPS     _POP21          ; R2:block# R1:addr
8979 14 71 86                                                 JPA     NEXT
                                                      
897C 85 43 4D 4F 56 C5                                HCMOVE: DB      ^5 "CMOV" ^'E'                          ; ***** CMOVE
8982 6B 89                                                    DW      HRW
8984 86 89                                            CMOVE:  DW      CMOVE0
8986 38 F9 80                                         CMOVE0: JPS     _POP3           ; R3 = count
8989 38 00 81                                                 JPS     _POP21          ; R2 = dst, R1 = src
898C 1D F2 FE                                         CMOV10: LDR     R1              ; Get byte from source
898F 1E F6 FE                                                 STR     R2              ; Store to destination
8992 2E F2 FE                                                 INW     R1              ; Bump source pointer
8995 2E F6 FE                                                 INW     R2              ; Bump destination pointer
8998 2F FA FE                                                 DEW     R3              ; Decrement count
899B 15 FA FE                                                 LDA     R3.0            ; Low byte zero?
899E 11 00                                                    CPI     0               ; :
89A0 3A 8C 89                                                 BNE     CMOV10          ; NO: One more byte
89A3 15 FB FE                                                 LDA     R3.1            ; High byte zero?
89A6 11 00                                                    CPI     0               ; :
89A8 3A 8C 89                                                 BNE     CMOV10          ; NO: One more byte
89AB 14 71 86                                                 JPA     NEXT            ; YES: Count zero. Done.
                                                      
89AE 82 55 AA                                         HUSTAR: DB      ^2 "U" ^'*'                             ; ***** U*
89B1 7C 89                                                    DW      HCMOVE
89B3 B5 89                                            USTAR:  DW      USTAR0
89B5 38 00 81                                         USTAR0: JPS     _POP21          ; R2 = oper2, R1 = oper1
89B8 38 E0 83                                                 JPS     _UMULT          ; u32 = u16 * u16
89BB 2F EC FE                                                 DEW     SP              ; -(SP) = R3X
89BE 15 FB FE                                                 LDA     R3.1            ; :
89C1 1E EC FE                                                 STR     SP              ; :
89C4 2F EC FE                                                 DEW     SP              ; :
89C7 15 FA FE                                                 LDA     R3.0            ; :
89CA 1E EC FE                                                 STR     SP              ; :
89CD 2F EC FE                                                 DEW     SP              ; :
89D0 15 FD FE                                                 LDA     R3.3            ; :
89D3 1E EC FE                                                 STR     SP              ; :
89D6 2F EC FE                                                 DEW     SP              ; :
89D9 15 FC FE                                                 LDA     R3.2            ; :
89DC 1E EC FE                                                 STR     SP              ; :
89DF 14 71 86                                                 JPA     NEXT            ; Done
                                                      
89E2 82 55 AF                                         HUSLAS: DB      ^2 "U" ^'/'                             ; ***** U/
89E5 AE 89                                                    DW      HUSTAR
89E7 E9 89                                            USLAS:  DW      USLAS0
89E9 38 00 81                                         USLAS0: JPS     _POP21          ; R2 = divisor, R1 = dividend-hi
89EC 15 F2 FE                                                 LDA     R1.0            ; Move high part to R1.2 and R1.3
89EF 16 F4 FE                                                 STA     R1.2            ; :
89F2 15 F3 FE                                                 LDA     R1.1            ; :
89F5 16 F5 FE                                                 STA     R1.3            ; :
89F8 38 73 80                                                 JPS     _POP1           ; dividend, low 16b
89FB 38 51 84                                                 JPS     _UDIV           ; u32 / u16 --> quot_u16, rem_u16
89FE 14 4D 86                                                 JPA     IPUSH           ; Push R1H; Push R1L; NEXT
                                                      
8A01 83 41 4E C4                                      HAND:   DB      ^3 "AN" ^'D'                            ; ***** AND
8A05 E2 89                                                    DW      HUSLAS
8A07 09 8A                                            AND:    DW      AND0
8A09 38 00 81                                         AND0:   JPS     _POP21          ; R2 = oper2, R1 = oper1
8A0C 38 B9 83                                                 JPS     _AND16          ; R1 = R1 & R2
8A0F 14 5F 86                                                 JPA     PUSH            ; Done
                                                      
8A12 82 4F D2                                         HOR:    DB      ^2 "O" ^'R'                             ; ***** OR
8A15 01 8A                                                    DW      HAND
8A17 19 8A                                            OR:     DW      OR0
8A19 38 00 81                                         OR0:    JPS     _POP21          ; R2 = oper2, R1 = oper1
8A1C 38 C6 83                                                 JPS     _OR16           ; R1 = R1 | R2
8A1F 14 5F 86                                                 JPA     PUSH            ; Done
                                                      
8A22 83 58 4F D2                                      HXOR:   DB      ^3 "XO" ^'R'                            ; ***** XOR
8A26 12 8A                                                    DW      HOR
8A28 2A 8A                                            XOR:    DW      XOR0
8A2A 38 00 81                                         XOR0:   JPS     _POP21          ; R2 = oper2, R1 = oper1
8A2D 38 D3 83                                                 JPS     _XOR16          ; R1 = R1 ^ R2
8A30 14 5F 86                                                 JPA     PUSH            ; Done
                                                      
8A33 83 53 50 C0                                      HSPAT:  DB      ^3 "SP" ^'@'                            ; ***** SP@
8A37 22 8A                                                    DW      HXOR
8A39 3B 8A                                            SPAT:   DW      SPAT0
8A3B 15 EC FE                                         SPAT0:  LDA     SP.0            ; Get stack pointer
8A3E 16 F2 FE                                                 STA     R1.0            ; : into R1
8A41 15 ED FE                                                 LDA     SP.1            ; :
8A44 16 F3 FE                                                 STA     R1.1            ; :
8A47 14 5F 86                                                 JPA     PUSH            ; Push R1; NEXT
                                                      
8A4A 83 53 50 A1                                      HSPSTO: DB      ^3 "SP" ^'!'                            ; ***** SP!
8A4E 33 8A                                                    DW      HSPAT
8A50 52 8A                                            SPSTO:  DW      SPSTO0
8A52 0E 12                                            SPSTO0: LDI     18              ; Index of SP0
8A54 16 F6 FE                                                 STA     R2.0            ; : in boot table
8A57 38 70 83                                                 JPS     _PORIG          ; R3 = &bootTable[R2]
8A5A 38 69 82                                                 JPS     _LD16           ; R1 = XSP
8A5D 15 F2 FE                                                 LDA     R1.0            ; SP = R1
8A60 16 EC FE                                                 STA     SP.0            ; :
8A63 15 F3 FE                                                 LDA     R1.1            ; :
8A66 16 ED FE                                                 STA     SP.1            ; :
8A69 14 71 86                                                 JPA     NEXT            ; Done
                                                      
8A6C 83 52 50 A1                                      HRPSTO: DB      ^3 "RP" ^'!'                            ; ***** RP!
8A70 4A 8A                                                    DW      HSPSTO
8A72 74 8A                                            RPSTO:  DW      RPSTO0
8A74 0E 14                                            RPSTO0: LDI     20              ; Index of SP0
8A76 16 F6 FE                                                 STA     R2.0            ; : in boot table
8A79 38 70 83                                                 JPS     _PORIG          ; R3 = &bootTable[R2]
8A7C 38 69 82                                                 JPS     _LD16           ; R1 = XRP
8A7F 15 F2 FE                                                 LDA     R1.0            ; SP = R1
8A82 16 EE FE                                                 STA     RP.0            ; :
8A85 15 F3 FE                                                 LDA     R1.1            ; :
8A88 16 EF FE                                                 STA     RP.1            ; :
8A8B 14 71 86                                                 JPA     NEXT            ; Done
                                                      
8A8E 83 55 50 A1                                      HUPSTO: DB      ^3 "UP" ^'!'                            ; ***** UP!
8A92 6C 8A                                                    DW      HRPSTO
8A94 96 8A                                            UPSTO:  DW      UPSTO0
8A96 0E 10                                            UPSTO0: LDI     16              ; Index of UP0
8A98 16 F6 FE                                                 STA     R2.0            ; : in boot table
8A9B 38 70 83                                                 JPS     _PORIG          ; R3 = &bootTable[R2]
8A9E 38 69 82                                                 JPS     _LD16           ; R1 = XUP
8AA1 15 F2 FE                                                 LDA     R1.0            ; UP = R1
8AA4 16 F0 FE                                                 STA     UP.0            ; :
8AA7 15 F3 FE                                                 LDA     R1.1            ; :
8AAA 16 F1 FE                                                 STA     UP.1            ; :
8AAD 14 71 86                                                 JPA     NEXT            ; Done
                                                      
8AB0 82 3B D3                                         HSEMIS: DB      ^2 ";" ^'S'                             ; ***** ;S
8AB3 6C 8A                                                    DW      HRPSTO
8AB5 B7 8A                                            SEMIS:  DW      SEMIS0
8AB7 1D EE FE                                         SEMIS0: LDR     RP              ; IP = (RP)+
8ABA 16 E8 FE                                                 STA     IP.0            ; :
8ABD 2E EE FE                                                 INW     RP              ; :
8AC0 1D EE FE                                                 LDR     RP              ; :
8AC3 16 E9 FE                                                 STA     IP.1            ; :
8AC6 2E EE FE                                                 INW     RP              ; :
8AC9 14 71 86                                                 JPA     NEXT            ; Done
                                                      
8ACC 85 4C 45 41 56 C5                                HLEAVE: DB      ^5 "LEAV" ^'E'                          ; ***** LEAVE
8AD2 B0 8A                                                    DW      HSEMIS
8AD4 D6 8A                                            LEAVE:  DW      LEAVE0
8AD6 38 1E 81                                         LEAVE0: JPS     _RPOP1          ; 2(RP) = (RP)
8AD9 38 CB 81                                                 JPS     _RPUT1          ; :
8ADC 38 D2 81                                                 JPS     _RPUSH1         ; :
8ADF 14 71 86                                                 JPA     NEXT
                                                      
8AE2 82 3E D2                                         HTOR:   DB      ^2 ">" ^'R'                             ; ***** >R
8AE5 CC 8A                                                    DW      HLEAVE
8AE7 E9 8A                                            TOR:    DW      TOR0
8AE9 38 73 80                                         TOR0:   JPS     _POP1           ; -(RP) = (SP)+
8AEC 38 D2 81                                                 JPS     _RPUSH1         ; :
8AEF 14 71 86                                                 JPA     NEXT
                                                      
8AF2 82 52 BE                                         HFROMR: DB      ^2 "R" ^'>'                             ; ***** R>
8AF5 E2 8A                                                    DW      HTOR
8AF7 F9 8A                                            FROMR:  DW      FROMR0
8AF9 38 1E 81                                         FROMR0: JPS     _RPOP1          ; -(SP) = (RP)+
8AFC 14 5F 86                                                 JPA     PUSH            ; :
                                                      
8AFF 81 D2                                            HR:     DB      ^1 ^'R'                                 ; ***** R
8B01 F2 8A                                                    DW      HFROMR
8B03 05 8B                                            R:      DW      R0
8B05 38 17 81                                         R0:     JPS     _RGET1          ; -(SP) = (RP)
8B08 14 5F 86                                                 JPA     PUSH            ; :
                                                      
8B0B 82 30 BD                                         HZEQU:  DB      ^2 "0" ^'='                             ; ***** 0=
8B0E FF 8A                                                    DW      HR
8B10 12 8B                                            ZEQU:   DW      ZEQU0
8B12 1D EC FE                                         ZEQU0:  LDR     SP              ; Get low byte
8B15 11 00                                                    CPI     0               ; Is it zero?
8B17 3A 2B 8B                                                 BNE     ZEQU10          ; NO: Return FALSE
8B1A 2E EC FE                                                 INW     SP              ; YES: Have to inspect
8B1D 1D EC FE                                                 LDR     SP              ; : high byte as well
8B20 11 00                                                    CPI     0               ; Is it zero?
8B22 3A 2E 8B                                                 BNE     ZEQU20          ; NO: Return FALSE
8B25 2E EC FE                                                 INW     SP              ; Make POP complete
8B28 14 A3 86                                                 JPA     PUSHT           ; YES: Return TRUE
8B2B 2E EC FE                                         ZEQU10: INW     SP              ; POP argument off dstack
8B2E 2E EC FE                                         ZEQU20: INW     SP              ; : Make POP complete
8B31 14 AC 86                                                 JPA     PUSHF           ; Return FALSE
                                                      
8B34 82 30 BC                                         HZLESS: DB      ^2 "0" ^'<'                             ; ***** 0<
8B37 0B 8B                                                    DW      HZEQU
8B39 3B 8B                                            ZLESS:  DW      ZLESS0
8B3B 2E EC FE                                         ZLESS0: INW     SP              ; Inspect high byte only
8B3E 1D EC FE                                                 LDR     SP              ; Get high byte
8B41 11 00                                                    CPI     0               ; Is high byte negative?
8B43 3F 4C 8B                                                 BMI     ZLES10          ; YES: Return TRUE
8B46 2E EC FE                                                 INW     SP              ; NO: POP high byte also
8B49 14 AC 86                                                 JPA     PUSHF           ; Return FALSE
8B4C 2E EC FE                                         ZLES10: INW     SP              ; POP high byte also
8B4F 14 A3 86                                                 JPA     PUSHT           ; Return TRUE
                                                      
8B52 81 AB                                            HPLUS:  DB      ^1 ^'+'                                 ; ***** +
8B54 34 8B                                                    DW      HZLESS
8B56 58 8B                                            PLUS:   DW      PLUS0
8B58 38 00 81                                         PLUS0:  JPS     _POP21          ; R2 = oper2, R1 = oper1
8B5B 38 15 82                                                 JPS     _ADD16          ; R1 = R1 + R2
8B5E 14 5F 86                                                 JPA     PUSH            ; -(SP) = R1; NEXT
                                                      
8B61 82 44 AB                                         HDPLUS: DB      ^2 "D" ^'+'                             ; ***** D+
8B64 52 8B                                                    DW      HPLUS
8B66 68 8B                                            DPLUS:  DW      DPLUS0
8B68 38 BD 80                                         DPLUS0: JPS     _DPOP2          ; Get second operand
8B6B 38 7A 80                                                 JPS     _DPOP1          ; Get first operand
8B6E 38 28 82                                                 JPS     _ADD32          ; R1X = R1X + R2X
8B71 14 B2 86                                                 JPA     DPUSH           ; -(SP) = R1X; NEXT
                                                      
8B74 85 4D 49 4E 55 D3                                HMINUS: DB      ^5 "MINU" ^'S'                          ; ***** MINUS
8B7A 61 8B                                                    DW      HDPLUS
8B7C 7E 8B                                            MINUS:  DW      MINUS0
8B7E 38 73 80                                         MINUS0: JPS     _POP1           ; Get operand
8B81 38 25 83                                                 JPS     _NEG16          ; Negate
8B84 14 5F 86                                                 JPA     PUSH
                                                      
8B87 86 44 4D 49 4E 55 D3                             HDMINU: DB      ^6 "DMINU" ^'S'                         ; ***** DMINUS
8B8E 74 8B                                                    DW      HMINUS
8B90 92 8B                                            DMINU:  DW      DMINU0
8B92 38 7A 80                                         DMINU0: JPS     _DPOP1          ; Get operand
8B95 38 39 83                                                 JPS     _NEG32          ; Negate
8B98 14 B2 86                                                 JPA     DPUSH
                                                      
8B9B 84 4F 56 45 D2                                   HOVER:  DB      ^4 "OVE" ^'R'                           ; **** OVER
8BA0 87 8B                                                    DW      HDMINU
8BA2 A4 8B                                            OVER:   DW      OVER0
8BA4 38 B6 80                                         OVER0:  JPS     _POP2           ; n1 n2 -- n1 n2 n1
8BA7 38 6C 80                                                 JPS     _GET1           ; :
8BAA 38 96 81                                                 JPS     _PUSH2          ; :
8BAD 14 5F 86                                                 JPA     PUSH            ; :
                                                      
8BB0 84 44 52 4F D0                                   HDROP:  DB      ^4 "DRO" ^'P'                           ; **** DROP
8BB5 9B 8B                                                    DW      HOVER
8BB7 B9 8B                                            DROP:   DW      DROP0
8BB9 2E EC FE                                         DROP0:  INW     SP              ; n1 --
8BBC 2E EC FE                                                 INW     SP              ; :
8BBF 14 71 86                                                 JPA     NEXT            ; Done
                                                      
8BC2 84 53 57 41 D0                                   HSWAP:  DB      ^4 "SWA" ^'P'                           ; **** SWAP
8BC7 B0 8B                                                    DW      HDROP
8BC9 CB 8B                                            SWAP:   DW      SWAP0
8BCB 38 00 81                                         SWAP0:  JPS     _POP21          ; n1 n2 -- n2 n1
8BCE 38 96 81                                                 JPS     _PUSH2          ; :
8BD1 14 5F 86                                                 JPA     PUSH            ; :
                                                      
8BD4 83 44 55 D0                                      HDUP:   DB      ^3 "DU" ^'P'                            ; **** DUP
8BD8 C2 8B                                                    DW      HSWAP
8BDA DC 8B                                            DUP:    DW      DUP0
8BDC 38 6C 80                                         DUP0:   JPS     _GET1           ; n1 -- n1 n1
8BDF 14 5F 86                                                 JPA     PUSH            ; :
                                                      
8BE2 82 2B A1                                         HPSTOR: DB      ^2 "+" ^'!'                             ; ***** +!
8BE5 D4 8B                                                    DW      HDUP
8BE7 E9 8B                                            PSTOR:  DW      PSTOR0
8BE9 38 F9 80                                         PSTOR0: JPS     _POP3           ; R3 = addr
8BEC 38 B6 80                                                 JPS     _POP2           ; R2 = incr
8BEF 38 69 82                                                 JPS     _LD16           ; R1 = (R3)
8BF2 38 15 82                                                 JPS     _ADD16          ; R1 = R1 + R2
8BF5 38 7C 82                                                 JPS     _ST16           ; (R3) = R1
8BF8 14 71 86                                                 JPA     NEXT            ; Done
                                                      
8BFB 86 54 4F 47 47 4C C5                             HTOGGL: DB      ^6 "TOGGL" ^'E'                         ; ***** TOGGLE
8C02 E2 8B                                                    DW      HPSTOR
8C04 06 8C                                            TOGGL:  DW      TOGGL0
8C06 38 B6 80                                         TOGGL0: JPS     _POP2           ; R2 = bit mask
8C09 38 F2 80                                                 JPS     _GET3           ; R3 = addr (leave copy on stack)
8C0C 1D FA FE                                                 LDR     R3              ; Get the byte
8C0F 16 F2 FE                                                 STA     R1.0            ; :
8C12 38 D5 82                                                 JPS     _XOR8           ; R1.0 = R1.0 ^ R2.0
8C15 38 F9 80                                                 JPS     _POP3           ; R3 = addr
8C18 15 F2 FE                                                 LDA     R1.0            ; Update the byte
8C1B 1E FA FE                                                 STR     R3              ; :
8C1E 14 71 86                                                 JPA     NEXT            ; Done
                                                      
8C21 81 C0                                            HAT:    DB      ^1 ^'@'                                 ; ***** @
8C23 FB 8B                                                    DW      HTOGGL
8C25 27 8C                                            AT:     DW      AT0
8C27 38 F9 80                                         AT0:    JPS     _POP3           ; R3 = addr
8C2A 38 69 82                                                 JPS     _LD16           ; R1 = (R3)
8C2D 14 5F 86                                                 JPA     PUSH            ; -(SP) = R1; NEXT
                                                      
8C30 82 43 C0                                         HCAT:   DB      ^2 "C" ^'@'                             ; ***** C@
8C33 21 8C                                                    DW      HAT
8C35 37 8C                                            CAT:    DW      CAT0
8C37 2C F2 FE                                         CAT0:   CLW     R1              ; R1 = 0
8C3A 38 F9 80                                                 JPS     _POP3           ; R3 = addr
8C3D 1D FA FE                                                 LDR     R3              ; A = (R3)
8C40 16 F2 FE                                                 STA     R1.0            ; R1 = A
8C43 14 5F 86                                                 JPA     PUSH            ; -(SP) = R1; NEXT
                                                      
8C46 81 A1                                            HSTORE: DB      ^1 ^'!'                                 ; ***** !
8C48 30 8C                                                    DW      HCAT
8C4A 4C 8C                                            STORE:  DW      STORE0
8C4C 38 F9 80                                         STORE0: JPS     _POP3           ; R3 = addr
8C4F 38 73 80                                                 JPS     _POP1           ; R1 = data
8C52 38 7C 82                                                 JPS     _ST16           ; (R3) = R1
8C55 14 71 86                                                 JPA     NEXT            ; Done
                                                      
8C58 82 43 A1                                         HCSTOR: DB      ^2 "C" ^'!'                             ; ***** C!
8C5B 46 8C                                                    DW      HSTORE
8C5D 5F 8C                                            CSTOR:  DW      CSTOR0
8C5F 38 00 81                                         CSTOR0: JPS     _POP21          ; R2 = addr, R1 = data
8C62 15 F2 FE                                                 LDA     R1.0            ; A = R1.0
8C65 1E F6 FE                                                 STR     R2              ; (R3) = A
8C68 14 71 86                                                 JPA     NEXT            ; Done
                                                      
                                                      ; INCLUDE         precompiled.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; PRECOMPILED FORTH WORDS
                                                      ;
                                                      
8C6B C1 BA                                            HCOLON: DB      ^^1 ^':'                                ; ***** :
8C6D 58 8C                                                    DW      HCSTOR
8C6F 83 8C 25 90 E0 8F 48 8E 25 8C 3A 8E 4A 8C        COLON:  DW      DOCOL QEXEC SCSP CURR AT CONT STORE
8C7D 6B 95 AA 90 11 91                                        DW      CREAT RBRAC PSCOD
8C83 2F EE FE                                         DOCOL:  DEW     RP              ; -(RP) = IP
8C86 15 E9 FE                                                 LDA     IP.1            ; :
8C89 1E EE FE                                                 STR     RP              ; :
8C8C 2F EE FE                                                 DEW     RP              ; :
8C8F 15 E8 FE                                                 LDA     IP.0            ; :
8C92 1E EE FE                                                 STR     RP              ; :
8C95 15 EA FE                                                 LDA     WA.0            ; IP = WA
8C98 16 E8 FE                                                 STA     IP.0            ; :
8C9B 15 EB FE                                                 LDA     WA.1            ; :
8C9E 16 E9 FE                                                 STA     IP.1            ; :
8CA1 14 71 86                                                 JPA     NEXT
                                                      
8CA4 C1 BB                                            HSEMI:  DB      ^^1 ^';'                                ; ***** ;
8CA6 6B 8C                                                    DW      HCOLON
8CA8 83 8C 4F 90 86 90 B5 8A BF 90 9C 90 B5 8A        SEMI:   DW      DOCOL QCSP COMP SEMIS SMUDG LBRAC SEMIS
                                                      
8CB6 88 43 4F 4E 53 54 41 4E D4                       HCON:   DB      ^8 "CONSTAN" ^'T'                       ; ***** CONSTANT
8CBF A4 8C                                                    DW      HSEMI
8CC1 83 8C 6B 95 BF 90 E6 8E 11 91                    CON:    DW      DOCOL CREAT SMUDG COMMA PSCOD
8CCB 1D EA FE                                         DOCON:  LDR     WA              ; -(SP) = (WA)
8CCE 16 F2 FE                                                 STA     R1.0            ; :
8CD1 2E EA FE                                                 INW     WA              ; :
8CD4 1D EA FE                                                 LDR     WA              ; :
8CD7 16 F3 FE                                                 STA     R1.1            ; :
8CDA 2F EA FE                                                 DEW     WA              ; :
8CDD 14 5F 86                                                 JPA     PUSH            ; Done
                                                      
8CE0 88 56 41 52 49 41 42 4C C5                       HVAR:   DB      ^8 "VARIABL" ^'E'                       ; ***** VARIABLE
8CE9 B6 8C                                                    DW      HCON
8CEB 83 8C C1 8C 11 91                                VAR:    DW      DOCOL CON PSCOD
8CF1 2F EC FE                                         DOVAR:  DEW     SP              ; -(SP) = WA
8CF4 15 EB FE                                                 LDA     WA.1            ; :
8CF7 1E EC FE                                                 STR     SP              ; :
8CFA 2F EC FE                                                 DEW     SP              ; :
8CFD 15 EA FE                                                 LDA     WA.0            ; :
8D00 1E EC FE                                                 STR     SP              ; :
8D03 14 71 86                                                 JPA     NEXT            ; Done
                                                      
8D06 84 55 53 45 D2                                   HUSER:  DB      ^4 "USE" ^'R'                           ; ***** USER
8D0B E0 8C                                                    DW      HVAR
8D0D 83 8C C1 8C 11 91                                USER:   DW      DOCOL CON PSCOD
8D13 1D EA FE                                         DOUSE:  LDR     WA              ; Compute UP[index]
8D16 17 F0 FE                                                 ADA     UP.0            ; :
8D19 16 F2 FE                                                 STA     R1.0            ; :
8D1C 2E EA FE                                                 INW     WA              ; :
8D1F 1D EA FE                                                 LDR     WA              ; :
8D22 1A F1 FE                                                 ACA     UP.1            ; :
8D25 16 F3 FE                                                 STA     R1.1            ; :
8D28 14 5F 86                                                 JPA     PUSH            ; Push address; NEXT
                                                      
                                                      ; ------------------------------
                                                      ; PRECOMPILED CONSTANTS
                                                      
8D2B 81 B0                                            HZERO:  DB      ^1 ^'0'                                 ; ***** 0
8D2D 06 8D                                                    DW      HUSER
8D2F CB 8C 00 00                                      ZERO:   DW      DOCON 0
                                                      
8D33 81 B1                                            HONE:   DB      ^1 ^'1'                                 ; ***** 1
8D35 2B 8D                                                    DW      HZERO
8D37 CB 8C 01 00                                      ONE:    DW      DOCON 1
                                                      
8D3B 81 B2                                            HTWO:   DB      ^1 ^'2'                                 ; ***** 2
8D3D 33 8D                                                    DW      HONE
8D3F CB 8C 02 00                                      TWO:    DW      DOCON 2
                                                      
8D43 81 B3                                            HTHREE: DB      ^1 ^'3'                                 ; ***** 3
8D45 3B 8D                                                    DW      HTWO
8D47 CB 8C 03 00                                      THREE:  DW      DOCON 3
                                                      
8D4B 82 42 CC                                         HBL:    DB      ^2 "B" ^'L'                             ; ***** BL
8D4E 43 8D                                                    DW      HTHREE
8D50 CB 8C 20 00                                      BL:     DW      DOCON 32
                                                      
8D54 83 43 2F CC                                      HCL:    DB      ^3 "C/" ^'L'                            ; ***** C/L
8D58 4B 8D                                                    DW      HBL
8D5A CB 8C 50 00                                      CL:     DW      DOCON 80
                                                      
8D5E 85 42 2F 42 55 C6                                HBBUF:  DB      ^5 "B/BU" ^'F'                          ; ***** B/BUF
8D64 54 8D                                                    DW      HCL
8D66 CB 8C 00 04                                      BBUF:   DW      DOCON 1024
                                                      
8D6A 85 42 2F 53 43 D2                                HBSCR:  DB      ^5 "B/SC" ^'R'                          ; ***** B/SCR
8D70 5E 8D                                                    DW      HBBUF
8D72 CB 8C 01 00                                      BSCR:   DW      DOCON 1
                                                      
8D76 87 2B 4F 52 49 47 49 CE                          HPORIG: DB      ^7 "+ORIGI" ^'N'                        ; ***** +ORIGIN
8D7E 6A 8D                                                    DW      HBSCR
8D80 83 8C DF 86 00 80 56 8B B5 8A                    PORIG:  DW      DOCOL LIT ORIGIN PLUS SEMIS
                                                      
                                                      ; ------------------------------
                                                      ; USER VARIABLES
                                                      
8D8A 82 53 B0                                         HSZERO: DB      ^2 "S" ^'0'                             ; ***** S0
8D8D 76 8D                                                    DW      HPORIG
8D8F 13 8D 06 00                                      SZERO:  DW      DOUSE 6
                                                      
8D93 82 52 B0                                         HRZERO: DB      ^2 "R" ^'0'                             ; ***** R0
8D96 8A 8D                                                    DW      HSZERO
8D98 13 8D 08 00                                      RZERO:  DW      DOUSE 8
                                                      
8D9C 83 54 49 C2                                      HTIB:   DB      ^3 "TI" ^'B'                            ; ***** TIB
8DA0 93 8D                                                    DW      HRZERO
8DA2 13 8D 0A 00                                      TIB:    DW      DOUSE 10
                                                      
8DA6 85 57 49 44 54 C8                                HWIDTH: DB      ^5 "WIDT" ^'H'                          ; ***** WIDTH
8DAC 9C 8D                                                    DW      HTIB
8DAE 13 8D 0C 00                                      WIDTH:  DW      DOUSE 12
                                                      
8DB2 87 57 41 52 4E 49 4E C7                          HWARN:  DB      ^7 "WARNIN" ^'G'                        ; ***** WARNING
8DBA A6 8D                                                    DW      HWIDTH
8DBC 13 8D 0E 00                                      WARN:   DW      DOUSE 14
                                                      
8DC0 85 46 45 4E 43 C5                                HFENCE: DB      ^5 "FENC" ^'E'                          ; ***** FENCE
8DC6 B2 8D                                                    DW      HWARN
8DC8 13 8D 10 00                                      FENCE:  DW      DOUSE 16
                                                      
8DCC 82 44 D0                                         HDP:    DB      ^2 "D" ^'P'                             ; ***** DP
8DCF C0 8D                                                    DW      HFENCE
8DD1 13 8D 12 00                                      DP:     DW      DOUSE 18
                                                      
8DD5 88 56 4F 43 2D 4C 49 4E CB                       HVOCL:  DB      ^8 "VOC-LIN" ^'K'                       ; ***** VOC-LINK
8DDE CC 8D                                                    DW      HDP
8DE0 13 8D 14 00                                      VOCL:   DW      DOUSE 20
                                                      
8DE4 85 46 49 52 53 D4                                HFIRST: DB      ^5 "FIRS" ^'T'                          ; ***** FIRST
8DEA D5 8D                                                    DW      HVOCL
8DEC 13 8D 16 00                                      FIRST:  DW      DOUSE 22
                                                      
8DF0 85 4C 49 4D 49 D4                                HLIMIT: DB      ^5 "LIMI" ^'T'                          ; ***** LIMIT
8DF6 E4 8D                                                    DW      HFIRST
8DF8 13 8D 18 00                                      LIMIT:  DW      DOUSE 24
                                                      
8DFC 83 42 4C CB                                      HBLK:   DB      ^3 "BL" ^'K'                            ; ***** BLK
8E00 F0 8D                                                    DW      HLIMIT
8E02 13 8D 1E 00                                      BLK:    DW      DOUSE 30
                                                      
8E06 82 49 C9                                         HIN:    DB      ^2 "I" ^'I'                             ; ***** IN
8E09 FC 8D                                                    DW      HBLK
8E0B 13 8D 20 00                                      IN:     DW      DOUSE 32
                                                      
8E0F 83 4F 55 D4                                      HOUT:   DB      ^3 "OU" ^'T'                            ; ***** OUT
8E13 06 8E                                                    DW      HIN
8E15 13 8D 22 00                                      OUT:    DW      DOUSE 34
                                                      
8E19 83 53 43 D2                                      HSCR:   DB      ^3 "SC" ^'R'                            ; ***** SCR
8E1D 0F 8E                                                    DW      HOUT
8E1F 13 8D 24 00                                      SCR:    DW      DOUSE 36
                                                      
8E23 86 4F 46 46 53 45 D4                             HOFFSE: DB      ^6 "OFFSE" ^'T'                         ; ***** OFFSET
8E2A 19 8E                                                    DW      HSCR
8E2C 13 8D 26 00                                      OFFSE:  DW      DOUSE 38
                                                      
8E30 87 43 4F 4E 54 45 58 D4                          HCONT:  DB      ^7 "CONTEX" ^'T'                        ; ***** CONTEXT
8E38 23 8E                                                    DW      HOFFSE
8E3A 13 8D 28 00                                      CONT:   DW      DOUSE 40
                                                      
8E3E 87 43 55 52 52 45 4E D4                          HCURR:  DB      ^7 "CURREN" ^'T'                        ; ***** CURRENT
8E46 30 8E                                                    DW      HCONT
8E48 13 8D 2A 00                                      CURR:   DW      DOUSE 42
                                                      
8E4C 85 53 54 41 54 C5                                HSTATE: DB      ^5 "STAT" ^'E'                          ; ***** STATE
8E52 3E 8E                                                    DW      HCURR
8E54 13 8D 2C 00                                      STATE:  DW      DOUSE 44
                                                      
8E58 84 42 41 53 C5                                   HBASE:  DB      ^4 "BAS" ^'E'                           ; ***** BASE
8E5D 4C 8E                                                    DW      HSTATE
8E5F 13 8D 2E 00                                      BASE:   DW      DOUSE 46
                                                      
8E63 83 44 50 CC                                      HDPL:   DB      ^3 "DP" ^'L'                            ; ***** DPL
8E67 58 8E                                                    DW      HBASE
8E69 13 8D 32 00                                      DPL:    DW      DOUSE 50
                                                      
8E6D 83 46 4C C4                                      HFLD:   DB      ^3 "FL" ^'D'                            ; ***** FLD
8E71 63 8E                                                    DW      HDPL
8E73 13 8D 34 00                                      FLD:    DW      DOUSE 52
                                                      
8E77 83 43 53 D0                                      HCSP:   DB      ^3 "CS" ^'P'                            ; ***** CSP
8E7B 6D 8E                                                    DW      HFLD
8E7D 13 8D 34 00                                      CSP:    DW      DOUSE 52
                                                      
8E81 82 52 A3                                         HRNUM:  DB      ^2 "R" ^'#'                             ; ***** R#
8E84 77 8E                                                    DW      HCSP
8E86 13 8D 36 00                                      RNUM:   DW      DOUSE 54
                                                      
8E8A 83 48 4C C4                                      HHLD:   DB      ^3 "HL" ^'D'                            ; ***** HLD
8E8E 81 8E                                                    DW      HRNUM
8E90 13 8D 38 00                                      HLD:    DW      DOUSE 56
                                                      
8E94 83 55 53 C5                                      HUSE:   DB      ^3 "US" ^'E'                            ; ***** USE
8E98 8A 8E                                                    DW      HHLD
8E9A 13 8D 3A 00                                      USE:    DW      DOUSE 58
                                                      
8E9E 84 50 52 45 D6                                   HPREV:  DB      ^4 "PRE" ^'V'                           ; ***** PREV
8EA3 94 8E                                                    DW      HUSE
8EA5 13 8D 3C 00                                      PREV:   DW      DOUSE 60
                                                      
                                                      ; END OF USER VARIABLES
                                                      ; ------------------------------
                                                      
8EA9 82 31 AB                                         HONEP:  DB      ^2 "1" ^'+'                             ; ***** 1+
8EAC 9E 8E                                                    DW      HPREV
8EAE 83 8C 37 8D 56 8B B5 8A                          ONEP:   DW      DOCOL ONE PLUS SEMIS
                                                      ; ONEP0:  LDR     SP
                                                      ; ADI     1
                                                      ; STR     SP
                                                      ; INW     SP
                                                      ; LDR     SP
                                                      ; ACI     0
                                                      ; STR     SP
                                                      ; DEW     SP
                                                      ; JPA     NEXT
                                                      
8EB6 82 32 AB                                         HTWOP:  DB      ^2 "2" ^'+'                             ; ***** 2+
8EB9 9E 8E                                                    DW      HPREV
8EBB 83 8C 3F 8D 56 8B B5 8A                          TWOP:   DW      DOCOL TWO PLUS SEMIS
                                                      ; TWOP0:  LDR     SP
                                                      ;        ADI     2
                                                      ;        STR     SP
                                                      ;        INW     SP
                                                      ;        LDR     SP
                                                      ;        ACI     0
                                                      ;        STR     SP
                                                      ;        DEW     SP
                                                      ;        JPA     NEXT
                                                      
8EC3 84 48 45 52 C5                                   HHERE:  DB      ^4 "HER" ^'E'                           ; ***** HERE
8EC8 B6 8E                                                    DW      HTWOP
8ECA 83 8C D1 8D 25 8C B5 8A                          HERE:   DW      DOCOL DP AT SEMIS
                                                      
8ED2 85 41 4C 4C 4F D4                                HALLOT: DB      ^5 "ALLO" ^'T'                          ; ***** ALLOT
8ED8 C3 8E                                                    DW      HHERE
8EDA 83 8C D1 8D E7 8B B5 8A                          ALLOT:  DW      DOCOL DP PSTOR SEMIS
                                                      
8EE2 81 AC                                            HCOMMA: DB      ^1 ^','                                 ; ***** ,
8EE4 D2 8E                                                    DW      HALLOT
8EE6 83 8C CA 8E 4A 8C 3F 8D DA 8E B5 8A              COMMA:  DW      DOCOL HERE STORE TWO ALLOT SEMIS
                                                      
8EF2 81 AD                                            HSUB:   DB      ^1 ^'-'                                 ; ***** -
8EF4 E2 8E                                                    DW      HCOMMA
8EF6 83 8C 7C 8B 56 8B B5 8A                          SUB:    DW      DOCOL MINUS PLUS SEMIS
                                                      
8EFE 81 BD                                            HEQUAL: DB      ^1 ^'='                                 ; ***** =
8F00 F2 8E                                                    DW      HSUB
8F02 83 8C F6 8E 10 8B B5 8A                          EQUAL:  DW      DOCOL SUB ZEQU SEMIS
                                                      
8F0A 81 BC                                            HLESS:  DB      ^1 ^'<'                                 ; ***** <
8F0C FE 8E                                                    DW      HEQUAL
8F0E 83 8C F6 8E 39 8B B5 8A                          LESS:   DW      DOCOL SUB ZLESS SEMIS
                                                      
8F16 81 BE                                            HGREAT: DB      ^1 ^'>'                                 ; ***** >
8F18 0A 8F                                                    DW      HLESS
8F1A 83 8C C9 8B 0E 8F B5 8A                          GREAT:  DW      DOCOL SWAP LESS SEMIS
                                                      
8F22 83 52 4F D4                                      HROT:   DB      ^3 "RO" ^'T'                            ; ***** ROT
8F26 16 8F                                                    DW      HGREAT
8F28 83 8C E7 8A C9 8B F7 8A C9 8B B5 8A              ROT:    DW      DOCOL TOR SWAP FROMR SWAP SEMIS
                                                      
8F34 85 53 50 41 43 C5                                HSPACE: DB      ^5 "SPAC" ^'E'                          ; ***** SPACE
8F3A 22 8F                                                    DW      HROT
8F3C 83 8C 50 8D 05 89 B5 8A                          SPACE:  DW      DOCOL BL EMIT SEMIS
                                                      
8F44 84 2D 44 55 D0                                   HDDUP:  DB      ^4 "-DU" ^'P'                           ; ***** -DUP
8F49 34 8F                                                    DW      HSPACE
8F4B 83 8C DA 8B 23 87 04 00                          DDUP:   DW      DOCOL DUP ZBRAN +DDU10
8F53 DA 8B                                                    DW      DUP
8F55 B5 8A                                            DDU10:  DW      SEMIS
                                                      
8F57 88 54 52 41 56 45 52 53 C5                       HTRAV:  DB      ^8 "TRAVERS" ^'E'                       ; ***** TRAVERSE
8F60 44 8F                                                    DW      HDDUP
8F62 83 8C C9 8B                                      TRAV:   DW      DOCOL SWAP
8F66 A2 8B 56 8B DF 86 7F 00                          TRAV10: DW      OVER PLUS LIT 0x7F
8F6E A2 8B 35 8C 0E 8F 23 87 F0 FF                            DW      OVER CAT LESS ZBRAN +TRAV10
8F78 C9 8B B7 8B B5 8A                                        DW      SWAP DROP SEMIS
                                                      
8F7E 86 4C 41 54 45 53 D4                             HLATES: DB      ^6 "LATES" ^'T'                         ; ***** LATEST
8F85 57 8F                                                    DW      HTRAV
8F87 83 8C 48 8E 25 8C 25 8C B5 8A                    LATES:  DW      DOCOL CURR AT AT SEMIS
                                                      
8F91 83 4C 46 C1                                      HLFA:   DB      ^3 "LF" ^'A'                            ; ***** LFA
8F95 7E 8F                                                    DW      HLATES
8F97 83 8C DF 86 04 00 F6 8E B5 8A                    LFA:    DW      DOCOL LIT 4 SUB SEMIS
                                                      
8FA1 83 43 46 C1                                      HCFA:   DB      ^3 "CF" ^'A'                            ; ***** CFA
8FA5 91 8F                                                    DW      HLFA
8FA7 83 8C 3F 8D F6 8E B5 8A                          CFA:    DW      DOCOL TWO SUB SEMIS
                                                      
8FAF 83 4E 46 C1                                      HNFA:   DB      ^3 "NF" ^'A'                            ; ***** NFA
8FB3 A1 8F                                                    DW      HCFA
8FB5 83 8C DF 86 05 00 F6 8E DF 86 FF FF 62 8F B5 8A  NFA:    DW      DOCOL LIT 5 SUB LIT -1 TRAV SEMIS
                                                      
8FC5 83 50 46 C1                                      HPFA:   DB      ^3 "PF" ^'A'                            ; ***** PFA
8FC9 AF 8F                                                    DW      HNFA
8FCB 83 8C 37 8D 62 8F DF 86 05 00 56 8B B5 8A        PFA:    DW      DOCOL ONE TRAV LIT 5 PLUS SEMIS
                                                      
                                                      ; ------------------------------
                                                      ; COMPILE TIME CHECKS
                                                      
8FD9 84 21 43 53 D0                                   HSCSP:  DB      ^4 "!CS" ^'P'                           ; ***** !CSP
8FDE C5 8F                                                    DW      HPFA
8FE0 83 8C 39 8A 7D 8E 4A 8C B5 8A                    SCSP:   DW      DOCOL SPAT CSP STORE SEMIS
                                                      
8FEA 86 3F 45 52 52 4F D2                             HQERR:  DB      ^6 "?ERRO" ^'R'                         ; ***** ?ERROR
8FF1 D9 8F                                                    DW      HSCSP
8FF3 83 8C C9 8B 23 87 08 00                          QERR:   DW      DOCOL SWAP ZBRAN +QERR10
8FFB EE 94 11 87 04 00                                        DW      ERROR BRAN +QERR20
9001 B7 8B                                            QERR10: DW      DROP
9003 B5 8A                                            QERR20: DW      SEMIS
                                                      
9005 85 3F 43 4F 4D D0                                HQCOMP: DB      ^5 "?COM" ^'P'                          ; ***** ?COMP
900B EA 8F                                                    DW      HQERR
900D 83 8C 54 8E 25 8C 10 8B DF 86 11 00 F3 8F B5 8A  QCOMP:  DW      DOCOL STATE AT ZEQU LIT 17 QERR SEMIS
                                                      
901D 85 3F 45 58 45 C3                                HQEXEC: DB      ^5 "?EXE" ^'C'                          ; ***** ?EXEC
9023 05 90                                                    DW      HQCOMP
9025 83 8C 54 8E 25 8C DF 86 12 00 F3 8F B5 8A        QEXEC:  DW      DOCOL STATE AT LIT 18 QERR SEMIS
                                                      
9033 86 3F 50 41 49 52 D3                             HQPAIR: DB      ^6 "?PAIR" ^'S'                         ; ***** ?PAIRS
903A 1D 90                                                    DW      HQEXEC
903C 83 8C F6 8E DF 86 13 00 F3 8F B5 8A              QPAIR:  DW      DOCOL SUB LIT 19 QERR SEMIS
                                                      
9048 84 3F 43 53 D0                                   HQCSP:  DB      ^4 "?CS" ^'P'                           ; ***** ?CSP
904D 33 90                                                    DW      HQPAIR
904F 83 8C 39 8A 7D 8E 25 8C F6 8E                    QCSP:   DW      DOCOL SPAT CSP AT SUB
9059 DF 86 14 00 F3 8F B5 8A                                  DW      LIT 20 QERR SEMIS
                                                      
9061 88 3F 4C 4F 41 44 49 4E C7                       HQLOAD: DB      ^8 "?LOADIN" ^'G'                       ; ***** ?LOADING
906A 48 90                                                    DW      HQCSP
906C 83 8C 02 8E 25 8C 10 8B DF 86 16 00 F3 8F B5 8A  QLOAD:  DW      DOCOL BLK AT ZEQU LIT 22 QERR SEMIS
                                                      
                                                      ; ------------------------------
                                                      ; COMPILER WORDS
                                                      
907C 87 43 4F 4D 50 49 4C C5                          HCOMP:  DB      ^7 "COMPIL" ^'E'                        ; ***** COMPILE
9084 61 90                                                    DW      HQLOAD
9086 83 8C 0D 90 F7 8A DA 8B                          COMP:   DW      DOCOL QCOMP FROMR DUP
908E BB 8E E7 8A 25 8C E6 8E B5 8A                            DW      TWOP TOR AT COMMA SEMIS
                                                      
9098 C1 DB                                            HLBRAC: DB      ^^1 ^'['                                ; ***** [
909A 7C 90                                                    DW      HCOMP
909C 83 8C 2F 8D 54 8E 4A 8C B5 8A                    LBRAC:  DW      DOCOL ZERO STATE STORE SEMIS
                                                      
90A6 81 DD                                            HRBRAC: DB      ^1 ^']'                                 ; ***** ]
90A8 98 90                                                    DW      HLBRAC
90AA 83 8C DF 86 C0 00 54 8E 4A 8C B5 8A              RBRAC:  DW      DOCOL LIT 0xC0 STATE STORE SEMIS
                                                      
90B6 86 53 4D 55 44 47 C5                             HSMUDG: DB      ^6 "SMUDG" ^'E'                         ; ***** SMUDGE
90BD A6 90                                                    DW      HRBRAC
90BF 83 8C 87 8F DF 86 20 00 04 8C B5 8A              SMUDG:  DW      DOCOL LATES LIT 0x20 TOGGL SEMIS
                                                      
90CB 83 48 45 D8                                      HHEX:   DB      ^3 "HE" ^'X'                            ; ***** HEX
90CF B6 90                                                    DW      HSMUDG
90D1 83 8C DF 86 10 00 5F 8E 4A 8C B5 8A              HEX:    DW      DOCOL LIT 16 BASE STORE SEMIS
                                                      
90DD 87 44 45 43 49 4D 41 CC                          HDEC:   DB      ^7 "DECIMA" ^'L'                        ; ***** DECIMAL
90E5 CB 90                                                    DW      HHEX
90E7 83 8C DF 86 0A 00 5F 8E 4A 8C B5 8A              DEC:    DW      DOCOL LIT 10 BASE STORE SEMIS
                                                      
90F3 85 4F 43 54 41 CC                                HOCTAL: DB      ^5 "OCTA" ^'L'                          ; ***** OCTAL
90F9 DD 90                                                    DW      HDEC
90FB 83 8C DF 86 08 00 5F 8E 4A 8C B5 8A              OCTAL:  DW      DOCOL LIT 8 BASE STORE SEMIS
                                                      
9107 87 28 3B 43 4F 44 45 A9                          HPSCOD: DB      ^7 "(;CODE" ^')'                        ; ***** (;CODE)
910F F3 90                                                    DW      HOCTAL
9111 83 8C F7 8A 87 8F CB 8F A7 8F 4A 8C B5 8A        PSCOD:  DW      DOCOL FROMR LATES PFA CFA STORE SEMIS
                                                      
911F 87 3C 42 55 49 4C 44 D3                          HBUILD: DB      ^7 "<BUILD" ^'S'                        ; ***** <BUILDS
9127 07 91                                                    DW      HPSCOD
9129 83 8C 2F 8D C1 8C B5 8A                          BUILD:  DW      DOCOL ZERO CON SEMIS
                                                      
9131 85 44 4F 45 53 BE                                HDOES:  DB      ^5 "DOES" ^'>'                          ; ***** DOES>
9137 1F 91                                                    DW      HBUILD
9139 83 8C F7 8A 87 8F CB 8F 4A 8C 11 91              DOES:   DW      DOCOL FROMR LATES PFA STORE PSCOD
9145 2F EE FE                                         DODOE:  DEW     RP              ; -(RP) = IP
9148 15 E9 FE                                                 LDA     IP.1            ; :
914B 1E EE FE                                                 STR     RP              ; :
914E 2F EE FE                                                 DEW     RP              ; :
9151 15 E8 FE                                                 LDA     IP.0            ; :
9154 1E EE FE                                                 STR     RP              ; :
9157 1D EA FE                                                 LDR     WA              ; IP = (WA)+
915A 16 E8 FE                                                 STA     IP.0            ; :
915D 2E EA FE                                                 INW     WA              ; :
9160 1D EA FE                                                 LDR     WA              ; :
9163 16 E9 FE                                                 STA     IP.1            ; :
9166 2E EA FE                                                 INW     WA              ; :
9169 2F EC FE                                                 DEW     SP              ; -(SP) = WA
916C 15 EB FE                                                 LDA     WA.1            ; :
916F 1E EC FE                                                 STR     SP              ; :
9172 2F EC FE                                                 DEW     SP              ; :
9175 15 EA FE                                                 LDA     WA.0            ; :
9178 1E EC FE                                                 STR     SP              ; :
917B 14 71 86                                                 JPA     NEXT            ; Done
                                                      
                                                      ; ------------------------------
                                                      ; MISC WORDS RELATED TO PRINTING
                                                      
917E 85 43 4F 55 4E D4                                HCOUNT: DB      ^5 "COUN" ^'T'                          ; ***** COUNT
9184 31 91                                                    DW      HDOES
9186 83 8C DA 8B AE 8E C9 8B 35 8C B5 8A              COUNT:  DW      DOCOL DUP ONEP SWAP CAT SEMIS
                                                      
9192 84 54 59 50 C5                                   HTYPE:  DB      ^4 "TYP" ^'E'                           ; ***** TYPE
9197 7E 91                                                    DW      HCOUNT
9199 83 8C 4B 8F 23 87 18 00                          TYPE:   DW      DOCOL DDUP ZBRAN +TYPE20
91A1 A2 8B 56 8B C9 8B B9 87                                  DW      OVER PLUS SWAP XDO
91A9 CB 87 35 8C 05 89 A4 87 F8 FF                    TYPE10: DW      I CAT EMIT XLOOP +TYPE10
91B3 11 87 04 00                                              DW      BRAN +TYPE30
91B7 B7 8B                                            TYPE20: DW      DROP
91B9 B5 8A                                            TYPE30: DW      SEMIS
                                                      
91BB 89 2D 54 52 41 49 4C 49 4E C7                    HDTRAI: DB      ^9 "-TRAILIN" ^'G'                      ; ***** -TRAILING
91C5 92 91                                                    DW      HTYPE
91C7 83 8C DA 8B 2F 8D B9 87                          DTRAI:  DW      DOCOL DUP ZERO XDO
91CF A2 8B A2 8B 56 8B 37 8D F6 8E                    DTRA10: DW      OVER OVER PLUS ONE SUB
91D9 35 8C 50 8D F6 8E 23 87 08 00                            DW      CAT BL SUB ZBRAN +DTRA20
91E3 D4 8A 11 87 06 00                                        DW      LEAVE BRAN +DTRA30
91E9 37 8D F6 8E                                      DTRA20: DW      ONE SUB
91ED A4 87 E0 FF                                      DTRA30: DW      XLOOP +DTRA10
91F1 B5 8A                                                    DW      SEMIS
                                                      
91F3 84 28 2E 22 A9                                   HPDOTQ: DB      ^4 "(." '"' ^')'                        ; ***** (.")
91F8 BB 91                                                    DW      HDTRAI
91FA 83 8C 03 8B 86 91 DA 8B AE 8E                    PDOTQ:  DW      DOCOL R COUNT DUP ONEP
9204 F7 8A 56 8B E7 8A 99 91 B5 8A                            DW      FROMR PLUS TOR TYPE SEMIS
                                                      
920E C2 2E A2                                         HDOTQ:  DB      ^^2 "." ^'"'                            ; ***** ."
9211 F3 91                                                    DW      HPDOTQ
9213 83 8C DF 86 22 00 54 8E 25 8C 23 87 14 00        DOTQ:   DW      DOCOL LIT '"' STATE AT ZBRAN +DOTQ10
9221 86 90 FA 91 80 93 CA 8E 35 8C AE 8E                      DW      COMP PDOTQ WORD HERE CAT ONEP
922D DA 8E 11 87 0A 00                                        DW      ALLOT BRAN +DOTQ20
9233 80 93 CA 8E 86 91 99 91                          DOTQ10: DW      WORD HERE COUNT TYPE
923B B5 8A                                            DOTQ20: DW      SEMIS
                                                      
                                                      ; ------------------------------
                                                      ; OUTER INTERPRETER
                                                      
923D 86 45 58 50 45 43 D4                             HEXPEC: DB      ^6 "EXPEC" ^'T'                         ; ***** EXPECT
9244 0E 92                                                    DW      HDOTQ
9246 83 8C A2 8B 56 8B A2 8B B9 87                    EXPEC:  DW      DOCOL OVER PLUS OVER XDO
9250 28 89 DA 8B DF 86 0E 00 80 8D                    EXPE10: DW      KEY DUP LIT 14 PORIG
925A 25 8C 02 8F 23 87 2A 00                                  DW      AT EQUAL ZBRAN +EXPE20
9262 B7 8B DA 8B CB 87 02 8F DA 8B F7 8A 3F 8D F6 8E          DW      DROP DUP I EQUAL DUP FROMR TWO SUB
9272 56 8B E7 8A 23 87 0A 00                                  DW      PLUS TOR ZBRAN +EXPE60
927A DF 86 07 00 11 87 06 00                                  DW      LIT CH_BEL BRAN +EXPE70
9282 DF 86 08 00                                      EXPE60: DW      LIT CH_BSP
9286 11 87 28 00                                      EXPE70: DW      BRAN +EXPE30
928A DA 8B DF 86 0A 00 02 8F 23 87 0E 00              EXPE20: DW      DUP LIT 10 EQUAL ZBRAN +EXPE40
9296 D4 8A B7 8B 50 8D 2F 8D 11 87 04 00                      DW      LEAVE DROP BL ZERO BRAN +EXPE50
92A2 DA 8B                                            EXPE40: DW      DUP
92A4 CB 87 5D 8C 2F 8D CB 87 AE 8E 4A 8C              EXPE50: DW      I CSTOR ZERO I ONEP STORE
92B0 05 89 A4 87 9C FF                                EXPE30: DW      EMIT XLOOP +EXPE10
92B6 B7 8B B5 8A                                              DW      DROP SEMIS
                                                      
92BA 85 51 55 45 52 D9                                HQUERY: DB      ^5 "QUER" ^'Y'                          ; ***** QUERY
92C0 3D 92                                                    DW      HEXPEC
92C2 83 8C A2 8D 25 8C DF 86 50 00 46 92              QUERY:  DW      DOCOL TIB AT LIT 80 EXPEC
92CE 2F 8D 0B 8E 4A 8C B5 8A                                  DW      ZERO IN STORE SEMIS
                                                      
92D6 C1 80                                            HNULL:  DB      ^^1 ^0                                  ; ***** <the NULL word>
92D8 BA 92                                                    DW      HQUERY
92DA 83 8C 02 8E 25 8C 23 87 26 00                    NULL:   DW      DOCOL BLK AT ZBRAN +NULL20
92E4 37 8D 02 8E E7 8B 2F 8D 0B 8E 4A 8C                      DW      ONE BLK PSTOR ZERO IN STORE
92F0 02 8E 25 8C 72 8D 0F 99 10 8B 23 87 08 00                DW      BLK AT BSCR MOD ZEQU ZBRAN +NULL10
92FE 25 90 F7 8A B7 8B                                        DW      QEXEC FROMR DROP
9304 11 87 06 00                                      NULL10: DW      BRAN +NULL30
9308 F7 8A B7 8B                                      NULL20: DW      FROMR DROP
930C B5 8A                                            NULL30: DW      SEMIS
                                                      
930E 84 46 49 4C CC                                   HFILL:  DB      ^4 "FIL" ^'L'                           ; ***** FILL
9313 D6 92                                                    DW      HNULL
9315 83 8C C9 8B E7 8A A2 8B 5D 8C DA 8B              FILL:   DW      DOCOL SWAP TOR OVER CSTOR DUP
9321 AE 8E F7 8A 37 8D F6 8E 84 89 B5 8A                      DW      ONEP FROMR ONE SUB CMOVE SEMIS
                                                      
932D 85 45 52 41 53 C5                                HERASE: DB      ^5 "ERAS" ^'E'                          ; ***** ERASE
9333 0E 93                                                    DW      HFILL
9335 83 8C 2F 8D 15 93 B5 8A                          ERASE:  DW      DOCOL ZERO FILL SEMIS
                                                      
933D 86 42 4C 41 4E 4B D3                             HBLANK: DB      ^6 "BLANK" ^'S'                         ; ***** BLANKS
9344 2D 93                                                    DW      HERASE
9346 83 8C 50 8D 15 93 B5 8A                          BLANK:  DW      DOCOL BL FILL SEMIS
                                                      
934E 84 48 4F 4C C4                                   HHOLD:  DB      ^4 "HOL" ^'D'                           ; ***** HOLD
9353 3D 93                                                    DW      HBLANK
9355 83 8C DF 86 FF FF 90 8E E7 8B                    HOLD:   DW      DOCOL LIT -1 HLD PSTOR
935F 90 8E 25 8C 5D 8C B5 8A                                  DW      HLD AT CSTOR SEMIS
                                                      
9367 83 50 41 C4                                      HPAD:   DB      ^3 "PA" ^'D'                            ; ***** PAD
936B 4E 93                                                    DW      HHOLD
936D 83 8C CA 8E DF 86 54 00 56 8B B5 8A              PAD:    DW      DOCOL HERE LIT 84 PLUS SEMIS
                                                      
9379 84 57 4F 52 C4                                   HWORD:  DB      ^4 "WOR" ^'D'                           ; ***** WORD
937E 67 93                                                    DW      HPAD
9380 83 8C 02 8E 25 8C 23 87 0C 00                    WORD:   DW      DOCOL BLK AT ZBRAN +WORD10
938A 02 8E 25 8C 57 9A 11 87 06 00                            DW      BLK AT BLOCK BRAN +WORD20
9394 A2 8D 25 8C                                      WORD10: DW      TIB AT
9398 0B 8E 25 8C 56 8B C9 8B 9E 88                    WORD20: DW      IN AT PLUS SWAP ENCL
93A2 CA 8E DF 86 22 00 46 93 0B 8E                            DW      HERE LIT 34 BLANK IN
93AC E7 8B A2 8B F6 8E E7 8A 03 8B CA 8E 5D 8C 56 8B          DW      PSTOR OVER SUB TOR R HERE CSTOR PLUS
93BC CA 8E AE 8E F7 8A 84 89 B5 8A                            DW      HERE ONEP FROMR CMOVE SEMIS
                                                      
93C6 88 28 4E 55 4D 42 45 52 A9                       HPNUMB: DB      ^8 "(NUMBER" ^')'                       ; ***** (NUMBER)
93CF 79 93                                                    DW      HWORD
93D1 83 8C                                            PNUMB:  DW      DOCOL
93D3 AE 8E DA 8B E7 8A 35 8C                          PNUM10: DW      ONEP DUP TOR CAT
93DB 5F 8E 25 8C DB 87 23 87 2C 00                            DW      BASE AT DIGIT ZBRAN +PNUM30
93E5 C9 8B 5F 8E 25 8C B3 89 B7 8B 28 8F 5F 8E 25 8C          DW      SWAP BASE AT USTAR DROP ROT BASE AT
93F5 B3 89 66 8B 69 8E 25 8C AE 8E 23 87 08 00                DW      USTAR DPLUS DPL AT ONEP ZBRAN +PNUM20
9403 37 8D 69 8E E7 8B                                        DW      ONE DPL PSTOR
9409 F7 8A 11 87 C6 FF                                PNUM20: DW      FROMR BRAN +PNUM10
940F F7 8A B5 8A                                      PNUM30: DW      FROMR SEMIS
                                                      
9413 86 4E 55 4D 42 45 D2                             HNUMB:  DB      ^6 "NUMBE" ^'R'                         ; ***** NUMBER
941A C6 93                                                    DW      HPNUMB
941C 83 8C 2F 8D 2F 8D 28 8F DA 8B AE 8E 35 8C        NUMB:   DW      DOCOL ZERO ZERO ROT DUP ONEP CAT
942A DF 86 2D 00 02 8F DA 8B E7 8A F6 8E DF 86 FF FF          DW      LIT '-' EQUAL DUP TOR SUB LIT -1
943A 69 8E 4A 8C D1 93 DA 8B                          NUMB10: DW      DPL STORE PNUMB DUP
9442 35 8C 50 8D F6 8E 23 87 16 00                            DW      CAT BL SUB ZBRAN +NUMB20
944C DA 8B 35 8C DF 86 2E 00 F6 8E                            DW      DUP CAT LIT '.' SUB
9456 2F 8D F3 8F 2F 8D 11 87 DC FF                            DW      ZERO QERR ZERO BRAN +NUMB10
9460 B7 8B F7 8A 23 87 04 00                          NUMB20: DW      DROP FROMR ZBRAN +NUMB30
9468 90 8B                                                    DW      DMINU
946A B5 8A                                            NUMB30: DW      SEMIS
                                                      
946C 85 2D 46 49 4E C4                                HDFIND: DB      ^5 "-FIN" ^'D'                          ; ***** -FIND
9472 13 94                                                    DW      HNUMB
9474 83 8C 50 8D 80 93 CA 8E 86 91 A4 94              DFIND:  DW      DOCOL BL WORD HERE COUNT UPPER
9480 CA 8E 3A 8E 25 8C 25 8C 0D 88                            DW      HERE CONT AT AT PFIND
948A DA 8B 10 8B 23 87 0A 00                                  DW      DUP ZEQU ZBRAN +DFIN10
9492 B7 8B CA 8E 87 8F 0D 88                                  DW      DROP HERE LATES PFIND
949A B5 8A                                            DFIN10: DW      SEMIS
                                                      
949C 85 55 50 50 45 D2                                HUPPER: DB      ^5 "UPPE" ^'R'                          ; ***** UPPER
94A2 6C 94                                                    DW      HDFIND
94A4 83 8C A2 8B 56 8B C9 8B B9 87                    UPPER:  DW      DOCOL OVER PLUS SWAP XDO
94AE CB 87 35 8C DF 86 60 00 1A 8F                    UPPE10: DW      I CAT LIT 0x60 GREAT
94B8 CB 87 35 8C DF 86 7B 00 0E 8F                            DW      I CAT LIT 0x7B LESS
94C2 07 8A 23 87 0A 00                                        DW      AND ZBRAN +UPPE20
94C8 CB 87 DF 86 20 00 04 8C                                  DW      I LIT 0x20 TOGGL
94D0 A4 87 DC FF                                      UPPE20: DW      XLOOP +UPPE10
94D4 B5 8A                                                    DW      SEMIS
                                                      
94D6 87 28 41 42 4F 52 54 A9                          HPABOR: DB      ^7 "(ABORT" ^')'                        ; ***** (ABORT)
94DE 9C 94                                                    DW      HUPPER
94E0 83 8C 54 97 B5 8A                                PABOR:  DW      DOCOL ABORT SEMIS
                                                      
94E6 85 45 52 52 4F D2                                HERROR: DB      ^5 "ERRO" ^'R'                          ; ***** ERROR
94EC D6 94                                                    DW      HPABOR
94EE 83 8C BC 8D 25 8C 39 8B 23 87 04 00              ERROR:  DW      DOCOL WARN AT ZLESS ZBRAN +ERRO10
94FA E0 94                                                    DW      PABOR
94FC CA 8E 86 91 99 91 FA 91                          ERRO10: DW      HERE COUNT TYPE PDOTQ
9504 03 20 3F 20                                              DB      3 32 '?' 32
9508 EC 9A 50 8A 0B 8E 25 8C 02 8E 25 8C 26 97 B5 8A          DW      MESS SPSTO IN AT BLK AT QUIT SEMIS
                                                      
9518 83 49 44 AE                                      HIDDOT: DB      ^3 "ID" ^'.'                            ; ***** ID.
951C E6 94                                                    DW      HERROR
951E 83 8C 6D 93 50 8D DF 86 5F 00 15 93              IDDOT:  DW      DOCOL PAD BL LIT 95 FILL
952A DA 8B CB 8F 97 8F A2 8B F6 8E 6D 93 C9 8B 84 89          DW      DUP PFA LFA OVER SUB PAD SWAP CMOVE
953A 6D 93 86 91 DF 86 1F 00 07 8A                            DW      PAD COUNT LIT 31 AND
9544 A2 8B A2 8B 37 8D F6 8E 56 8B DA 8B 35 8C                DW      OVER OVER ONE SUB PLUS DUP CAT
9552 DF 86 7F 00 07 8A C9 8B 5D 8C                            DW      LIT 0x7F AND SWAP CSTOR
955C 99 91 3C 8F B5 8A                                        DW      TYPE SPACE SEMIS
                                                      
9562 86 43 52 45 41 54 C5                             HCREAT: DB      ^6 "CREAT" ^'E'                         ; ***** CREATE
9569 18 95                                                    DW      HIDDOT
956B 83 8C 74 94 23 87 10 00                          CREAT:  DW      DOCOL DFIND ZBRAN +CREA10
9573 B7 8B B5 8F 1E 95 DF 86 04 00 EC 9A 3C 8F                DW      DROP NFA IDDOT LIT 4 MESS SPACE
9581 CA 8E DA 8B 35 8C AE 8D 25 8C 6E 98 AE 8E DA 8E  CREA10: DW      HERE DUP CAT WIDTH AT MIN ONEP ALLOT
9591 DA 8B DF 86 A0 00 04 8C CA 8E 37 8D F6 8E                DW      DUP LIT 0xA0 TOGGL HERE ONE SUB
959F DF 86 80 00 04 8C 87 8F E6 8E 48 8E 25 8C 4A 8C          DW      LIT 0x80 TOGGL LATES COMMA CURR AT STORE
95AF CA 8E BB 8E E6 8E B5 8A                                  DW      HERE TWOP COMMA SEMIS
                                                      
95B7 C9 5B 43 4F 4D 50 49 4C 45 DD                    HBCOMP: DB      ^^9 "[COMPILE" ^']'                     ; ***** [COMPILE]
95C1 62 95                                                    DW      HCREAT
95C3 83 8C 74 94 10 8B 2F 8D F3 8F                    BCOMP:  DW      DOCOL DFIND ZEQU ZERO QERR
95CD B7 8B A7 8F E6 8E B5 8A                                  DW      DROP CFA COMMA SEMIS
                                                      
95D5 C7 4C 49 54 45 52 41 CC                          HLITER: DB      ^^7 "LITERA" ^'L'                       ; ***** LITERAL
95DD B7 95                                                    DW      HBCOMP
95DF 83 8C 54 8E 25 8C 23 87 08 00                    LITER:  DW      DOCOL STATE AT ZBRAN +LITE10
95E9 86 90 DF 86 E6 8E                                        DW      COMP LIT COMMA
95EF B5 8A                                            LITE10: DW      SEMIS
                                                      
95F1 C8 44 4C 49 54 45 52 41 CC                       HDLITE: DB      ^^8 "DLITERA" ^'L'                      ; ***** DLITERAL
95FA D5 95                                                    DW      HLITER
95FC 83 8C 54 8E 25 8C 23 87 08 00                    DLITE:  DW      DOCOL STATE AT ZBRAN +DLIT10
9606 C9 8B DF 95 DF 95                                        DW      SWAP LITER LITER
960C B5 8A                                            DLIT10: DW      SEMIS
                                                      
960E 82 55 BC                                         HULESS: DB      ^2 "U" ^'<'                             ; ***** U<
9611 F1 95                                                    DW      HDLITE
9613 83 8C A2 8B A2 8B 28 8A 39 8B 23 87 0C 00        ULESS:  DW      DOCOL OVER OVER XOR ZLESS ZBRAN +ULES10
9621 B7 8B 39 8B 10 8B 11 87 06 00                            DW      DROP ZLESS ZEQU BRAN +ULES20
962B F6 8E 39 8B                                      ULES10: DW      SUB ZLESS
962F B5 8A                                            ULES20: DW      SEMIS
                                                      
9631 86 3F 53 54 41 43 CB                             HQSTAC: DB      ^6 "?STAC" ^'K'                         ; ***** ?STACK
9638 0E 96                                                    DW      HULESS
963A 83 8C 39 8A 8F 8D 25 8C C9 8B 13 96              QSTAC:  DW      DOCOL SPAT SZERO AT SWAP ULESS
9646 37 8D F3 8F 39 8A CA 8E DF 86 80 00                      DW      ONE QERR SPAT HERE LIT 128
9652 56 8B 13 96 3F 8D F3 8F B5 8A                            DW      PLUS ULESS TWO QERR SEMIS
                                                      
965C 89 49 4E 54 45 52 50 52 45 D4                    HINTER: DB      ^9 "INTERPRE" ^'T'                      ; ***** INTERPRET
9666 31 96                                                    DW      HQSTAC
9668 83 8C                                            INTER:  DW      DOCOL
966A 74 94 23 87 1E 00                                INTE10: DW      DFIND ZBRAN +INTE40
9670 54 8E 25 8C 0E 8F 23 87 0A 00                            DW      STATE AT LESS ZBRAN +INTE20
967A A7 8F E6 8E 11 87 06 00                                  DW      CFA COMMA BRAN +INTE30
9682 A7 8F F1 86                                      INTE20: DW      CFA EXEC
9686 3A 96 11 87 1C 00                                INTE30: DW      QSTAC BRAN +INTE70
968C CA 8E 1C 94 69 8E 25 8C AE 8E 23 87 08 00        INTE40: DW      HERE NUMB DPL AT ONEP ZBRAN +INTE50
969A FC 95 11 87 06 00                                        DW      DLITE BRAN +INTE60
96A0 B7 8B DF 95                                      INTE50: DW      DROP LITER
96A4 3A 96                                            INTE60: DW      QSTAC
96A6 11 87 C2 FF                                      INTE70: DW      BRAN +INTE10
                                                      
96AA 89 49 4D 4D 45 44 49 41 54 C5                    HIMMED: DB      ^9 "IMMEDIAT" ^'E'                      ; ***** IMMEDIATE
96B4 5C 96                                                    DW      HINTER
96B6 83 8C 87 8F DF 86 40 00 04 8C B5 8A              IMMED:  DW      DOCOL LATES LIT 0x40 TOGGL SEMIS
                                                      
96C2 8A 56 4F 43 41 42 55 4C 41 52 D9                 HVOCAB: DB      ^10 "VOCABULAR" ^'Y'                    ; ***** VOCABULARY
96CD AA 96                                                    DW      HIMMED
96CF 83 8C 29 91 DF 86 81 A0 E6 8E                    VOCAB:  DW      DOCOL BUILD LIT 0xa081 COMMA
96D9 48 8E 25 8C A7 8F E6 8E                                  DW      CURR AT CFA COMMA
96E1 CA 8E E0 8D 25 8C E6 8E E0 8D 4A 8C 39 91                DW      HERE VOCL AT COMMA VOCL STORE DOES
96EF BB 8E 3A 8E 4A 8C B5 8A                          DOVOC:  DW      TWOP CONT STORE SEMIS
                                                      
96F7 8B 44 45 46 49 4E 49 54 49 4F 4E D3              HDEFIN: DB      ^11 "DEFINITION" ^'S'                   ; ***** DEFINITIONS
9703 C2 96                                                    DW      HVOCAB
9705 83 8C 3A 8E 25 8C 48 8E 4A 8C B5 8A              DEFIN:  DW      DOCOL CONT AT CURR STORE SEMIS
                                                      
9711 81 A8                                            HPAREN: DB      ^1 ^'('                                 ; ***** (
9713 F7 96                                                    DW      HDEFIN
9715 83 8C DF 86 29 00 80 93 B5 8A                    PAREN:  DW      DOCOL LIT ')' WORD SEMIS
                                                      
971F 84 51 55 49 D4                                   HQUIT:  DB      ^4 "QUI" ^'T'                           ; ***** QUIT
9724 11 97                                                    DW      HPAREN
9726 83 8C 2F 8D 02 8E 4A 8C 9C 90                    QUIT:   DW      DOCOL ZERO BLK STORE LBRAC
9730 72 8A 5B 89 C2 92 68 96 54 8E 25 8C              QUIT10: DW      RPSTO CR QUERY INTER STATE AT
973C 10 8B 23 87 08 00                                        DW      ZEQU ZBRAN +QUIT20
9742 FA 91                                                    DW      PDOTQ
9744 03 20 6F 6B                                              DB      3 32 "ok"
9748 11 87 E6 FF                                      QUIT20: DW      BRAN +QUIT10
                                                      
974C 85 41 42 4F 52 D4                                HABORT: DB      ^5 "ABOR" ^'T'                          ; ***** ABORT
9752 1F 97                                                    DW      HQUIT
9754 83 8C                                            ABORT:  DW      DOCOL
9756 72 8A 50 8A E7 90 3C 8F 5B 89 FA 91              ABOR10: DW      RPSTO SPSTO DEC SPACE CR PDOTQ
9762 13 4D 69 6E 69 6D 61 6C 2D 46 4F 52 54 48                DB      19 "Minimal-FORTH"
9770 20 76 20 30 2E 31                                        DB      32 "v" 32 "0.1"
9776 FA 9E 05 97 26 97                                        DW      FORTH DEFIN QUIT
                                                      
                                                      ; INCLUDE         coldwarm.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; COLD AND WARM START ENTRY POINTS
                                                      
977C 0E FE                                            CENT:   LDI     0xFE            ; Initialize Minimal stack pointer
977E 16 FF FF                                                 STA     0xFFFF          ; :
9781 0E A9                                                    LDI     <COLD10         ; Start by executing COLD
9783 16 E8 FE                                                 STA     IP.0            ; :
9786 0E 97                                                    LDI     >COLD10         ; :
9788 16 E9 FE                                                 STA     IP.1            ; :
978B 14 71 86                                                 JPA     NEXT            ; ... and over to FORTH VM
                                                      
978E 0E FE                                            WENT:   LDI     0xFE            ; Initialize Minimal stack pointer
9790 16 FF FF                                                 STA     0xFFFF          ; :
9793 0E 56                                                    LDI     <ABOR10         ; Start by executing ABORT
9795 16 E8 FE                                                 STA     IP.0            ; :
9798 0E 97                                                    LDI     >ABOR10         ; :
979A 16 E9 FE                                                 STA     IP.1            ; :
979D 14 71 86                                                 JPA     NEXT            ; ... and over to FORTH VM
                                                      
97A0 84 43 4F 4C C4                                   HCOLD:  DB      ^4 "COL" ^'D'                           ; ***** COLD
97A5 4C 97                                                    DW      HABORT
97A7 83 8C                                            COLD:   DW      DOCOL
                                                      COLD10: ; Init FORTH registers
97A9 72 8A 50 8A 94 8A                                        DW      RPSTO SPSTO UPSTO
                                                              ; Set FORTH vocabulary
97AF DF 86 0C 00 80 8D 25 8C                                  DW      LIT 12 PORIG AT
97B7 DF 86 06 00 DF 86 FA 9E 56 8B 4A 8C                      DW      LIT 6 LIT FORTH PLUS STORE
                                                              ; Init 12 items (24 bytes) in user area ...
                                                              ; ... with values from boot table
97C3 DF 86 12 00 80 8D                                        DW      LIT 18 PORIG
97C9 DF 86 10 00 80 8D 25 8C DF 86 06 00 56 8B                DW      LIT 16 PORIG AT LIT 6 PLUS
97D7 DF 86 18 00 84 89                                        DW      LIT 24 CMOVE
                                                              ; Erase disk buffers
97DD DF 86 22 00 80 8D 25 8C DF 86 24 00 80 8D 25 8C          DW      LIT 34 PORIG AT LIT 36 PORIG AT
97ED A2 8B F6 8E 35 93                                        DW      OVER SUB ERASE
                                                              ; Initialize some of the user variables
97F3 2F 8D 15 8E 4A 8C                                        DW      ZERO OUT STORE
97F9 EC 8D 25 8C 9A 8E 4A 8C                                  DW      FIRST AT USE STORE
9801 EC 8D 25 8C A5 8E 4A 8C                                  DW      FIRST AT PREV STORE
                                                              ; Continue via ABORT
9809 54 97                                                    DW      ABORT
                                                      
                                                      ; INCLUDE         math.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; MATHEMATICS WORDS
                                                      
980B 84 53 2D 3E C4                                   HSTOD:  DB      ^4 "S->" ^'D'                           ; ***** S->D
9810 A0 97                                                    DW      HCOLD
9812 83 8C DA 8B 39 8B 23 87 0A 00                    STOD:   DW      DOCOL DUP ZLESS ZBRAN +STOD10
981C DF 86 FF FF 11 87 04 00                                  DW      LIT -1 BRAN +STOD20
9824 2F 8D                                            STOD10: DW      ZERO
9826 B5 8A                                            STOD20: DW      SEMIS
                                                      ; STOD0:  CLW     R1              ; Assume high word zero
                                                      ;        INW     SP              ; Get operand high byte
                                                      ;        LDR     SP              ; :
                                                      ;        DEW     SP              ; :
                                                      ;        CPI     0               ; Negative?
                                                      ;        BMI     STOD10          ; YES: Push 0xFFFF
                                                      ;        JPA     PUSH            ; NO: Push 0x0000
                                                      ; STOD10: DEW     R1              ; Make 0x0000 into 0xFFFF
                                                      ;        JPA     PUSH            ; Done
                                                      
9828 82 2B AD                                         HPM:    DB      ^2 "+" ^'-'                             ; ***** +-
982B 0B 98                                                    DW      HSTOD
982D 83 8C 39 8B 23 87 04 00                          PM:     DW      DOCOL ZLESS ZBRAN +PM10
9835 7C 8B                                                    DW      MINUS
9837 B5 8A                                            PM10:   DW      SEMIS
                                                      
9839 83 44 2B AD                                      HDPM:   DB      ^3 "D+" ^'-'                            ; ***** D+-
983D 28 98                                                    DW      HPM
983F 83 8C 39 8B 23 87 04 00                          DPM:    DW      DOCOL ZLESS ZBRAN +DPM10
9847 90 8B                                                    DW      DMINU
9849 B5 8A                                            DPM10:  DW      SEMIS
                                                      
984B 83 41 42 D3                                      HABS:   DB      ^3 "AB" ^'S'                            ; ***** ABS
984F 39 98                                                    DW      HDPM
9851 83 8C DA 8B 2D 98 B5 8A                          ABS:    DW      DOCOL DUP PM SEMIS
                                                      
9859 84 44 41 42 D3                                   HDABS:  DB      ^4 "DAB" ^'S'                           ; ***** DABS
985E 4B 98                                                    DW      HABS
9860 83 8C DA 8B 3F 98 B5 8A                          DABS:   DW      DOCOL DUP DPM SEMIS
                                                      
9868 83 4D 49 CE                                      HMIN:   DB      ^3 "MI" ^'N'                            ; ***** MIN
986C 59 98                                                    DW      HDABS
986E 83 8C A2 8B A2 8B 1A 8F 23 87 04 00              MIN:    DW      DOCOL OVER OVER GREAT ZBRAN +MIN10
987A C9 8B                                                    DW      SWAP
987C B7 8B B5 8A                                      MIN10:  DW      DROP SEMIS
                                                      
9880 83 4D 41 D8                                      HMAX:   DB      ^3 "MA" ^'X'                            ; ***** MAX
9884 68 98                                                    DW      HMIN
9886 83 8C A2 8B A2 8B 0E 8F 23 87 04 00              MAX:    DW      DOCOL OVER OVER LESS ZBRAN +MAX10
9892 C9 8B                                                    DW      SWAP
9894 B7 8B B5 8A                                      MAX10:  DW      DROP SEMIS
                                                      
9898 82 4D AA                                         HMSTAR: DB      ^2 "M" ^'*'                             ; ****** M*
989B 80 98                                                    DW      HMAX
989D 83 8C A2 8B A2 8B 28 8A E7 8A 51 98 C9 8B 51 98  MSTAR:  DW      DOCOL OVER OVER XOR TOR ABS SWAP ABS
98AD B3 89 F7 8A 3F 98 B5 8A                                  DW      USTAR FROMR DPM SEMIS
                                                      
98B5 82 4D AF                                         HMSLAS: DB      ^2 "M" ^'/'                             ; ***** M/
98B8 98 98                                                    DW      HMSTAR
98BA 83 8C A2 8B E7 8A E7 8A 60 98 03 8B 51 98        MSLAS:  DW      DOCOL OVER TOR TOR DABS R ABS
98C8 E7 89 F7 8A 03 8B 28 8A 2D 98 C9 8B                      DW      USLAS FROMR R XOR PM SWAP
98D4 F7 8A 2D 98 C9 8B B5 8A                                  DW      FROMR PM SWAP SEMIS
                                                      
98DC 81 AA                                            HSTAR:  DB      ^1 ^'*'                                 ; ***** *
98DE B5 98                                                    DW      HMSLAS
98E0 83 8C 9D 98 B7 8B B5 8A                          STAR:   DW      DOCOL MSTAR DROP SEMIS
                                                      
98E8 84 2F 4D 4F C4                                   HSLMOD: DB      ^4 "/MO" ^'D'                           ; ***** /MOD
98ED DC 98                                                    DW      HSTAR
98EF 83 8C E7 8A 12 98 F7 8A BA 98 B5 8A              SLMOD:  DW      DOCOL TOR STOD FROMR MSLAS SEMIS
                                                      
98FB 81 AF                                            HSLAS:  DB      ^1 ^'/'                                 ; ***** /
98FD E8 98                                                    DW      HSLMOD
98FF 83 8C EF 98 C9 8B B7 8B B5 8A                    SLASH:  DW      DOCOL SLMOD SWAP DROP SEMIS
                                                      
9909 83 4D 4F C4                                      HMOD:   DB      ^3 "MO" ^'D'                            ; ***** MOD
990D FB 98                                                    DW      HSLAS
990F 83 8C EF 98 B7 8B B5 8A                          MOD:    DW      DOCOL SLMOD DROP SEMIS
                                                      
9917 85 2A 2F 4D 4F C4                                HSSMOD: DB      ^5 "*/MO" ^'D'                          ; ***** */MOD
991D 09 99                                                    DW      HMOD
991F 83 8C E7 8A 9D 98 F7 8A BA 98 B5 8A              SSMOD:  DW      DOCOL TOR MSTAR FROMR MSLAS SEMIS
                                                      
992B 82 2A AF                                         HSSLA:  DB      ^2 "*" ^'/'                             ; ***** */
992E 17 99                                                    DW      HSSMOD
9930 83 8C 1F 99 C9 8B B7 8B B5 8A                    SSLA:   DW      DOCOL SSMOD SWAP DROP SEMIS
                                                      
993A 85 4D 2F 4D 4F C4                                HMSMOD: DB      ^5 "M/MO" ^'D'                          ; ***** M/MOD
9940 17 99                                                    DW      HSSMOD
9942 83 8C E7 8A 2F 8D 03 8B E7 89 F7 8A              MSMOD:  DW      DOCOL TOR ZERO R USLAS FROMR
994E C9 8B E7 8A E7 89 F7 8A B5 8A                            DW      SWAP TOR USLAS FROMR SEMIS
                                                      
                                                      ; INCLUDE         diskio.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; DISK I/O
                                                      
9958 84 2B 42 55 C6                                   HPBUF:  DB      ^4 "+BU" ^'F'                           ; ***** +BUF
995D 3A 99                                                    DW      HMSMOD
995F 83 8C 66 8D DF 86 04 00 56 8B                    PBUF:   DW      DOCOL BBUF LIT 4 PLUS
9969 DA 8B F8 8D 25 8C 02 8F 23 87 08 00                      DW      DUP LIMIT AT EQUAL ZBRAN +PBUF10
9975 B7 8B EC 8D 25 8C                                        DW      DROP FIRST AT
997B DA 8B A5 8E 25 8C F6 8E B5 8A                    PBUF10: DW      DUP PREV AT SUB SEMIS
                                                      
9985 86 55 50 44 41 54 C5                             HUPDAT: DB      ^6 "UPDAT" ^'E'                         ; ***** UPDATE
998C 58 99                                                    DW      HPBUF
998E 83 8C A5 8E 25 8C 25 8C DF 86 00 80              UPDAT:  DW      DOCOL PREV AT AT LIT 0x8000
999A 17 8A A5 8E 25 8C 4A 8C B5 8A                            DW      OR PREV AT STORE SEMIS
                                                      
99A4 8D 45 4D 50 54 59 2D 42 55 46 46 45 52 D3        HMTBUF: DB      ^13 "EMPTY-BUFFER" ^'S'                 ; ***** EMPTY-BUFFERS
99B2 85 99                                                    DW      HUPDAT
99B4 83 8C EC 8D 25 8C F8 8D 25 8C                    MTBUF:  DW      DOCOL FIRST AT LIMIT AT
99BE A2 8B F6 8E 35 93 B5 8A                                  DW      OVER SUB ERASE SEMIS
                                                      
99C6 85 46 4C 55 53 C8                                HFLUSH: DB      ^5 "FLUS" ^'H'                          ; ***** FLUSH
99CC A4 99                                                    DW      HMTBUF
99CE 83 8C F8 8D 25 8C EC 8D 25 8C B9 87              FLUSH:  DW      DOCOL LIMIT AT FIRST AT XDO
99DA CB 87 25 8C 39 8B 23 87 14 00                    FLUS10: DW      I AT ZLESS ZBRAN +FLUS20
99E4 CB 87 BB 8E CB 87 25 8C DF 86 FF 7F                      DW      I TWOP I AT LIT 0x7FFF
99F0 07 8A 2F 8D 71 89                                        DW      AND ZERO RW
99F6 66 8D DF 86 04 00 56 8B 57 87 DA FF              FLUS20: DW      BBUF LIT 4 PLUS XPLOO +FLUS10
9A02 B4 99 B5 8A                                              DW      MTBUF SEMIS
                                                      
9A06 86 42 55 46 46 45 D2                             HBUFFE: DB      ^6 "BUFFE" ^'R'                         ; ***** BUFFER
9A0D C6 99                                                    DW      HFLUSH
9A0F 83 8C 9A 8E 25 8C DA 8B E7 8A                    BUFFE:  DW      DOCOL USE AT DUP TOR
9A19 5F 99 23 87 FC FF                                BUFF10: DW      PBUF ZBRAN +BUFF10
9A1F 9A 8E 4A 8C 03 8B 25 8C 0E 8F 23 87 14 00                DW      USE STORE R AT LESS ZBRAN +BUFF20
9A2D 03 8B BB 8E 03 8B 25 8C DF 86 FF 7F                      DW      R TWOP R AT LIT 0x7FFF
9A39 07 8A 2F 8D 71 89                                        DW      AND ZERO RW
9A3F 03 8B 4A 8C 03 8B A5 8E 4A 8C F7 8A BB 8E B5 8A  BUFF20: DW      R STORE R PREV STORE FROMR TWOP SEMIS
                                                      
9A4F 85 42 4C 4F 43 CB                                HBLOCK: DB      ^5 "BLOC" ^'K'                          ; ***** BLOCK
9A55 06 9A                                                    DW      HBUFFE
9A57 83 8C E7 8A A5 8E 25 8C DA 8B                    BLOCK:  DW      DOCOL TOR PREV AT DUP
9A61 25 8C DF 86 FF 7F 07 8A 03 8B F6 8E 23 87 36 00          DW      AT LIT 0x7FFF AND R SUB ZBRAN +BLOC30
9A71 5F 99 10 8B 23 87 14 00                          BLOC10: DW      PBUF ZEQU ZBRAN +BLOC20
9A79 B7 8B 03 8B 0F 9A DA 8B 03 8B                            DW      DROP R BUFFE DUP R
9A83 37 8D 71 89 3F 8D F6 8E                                  DW      ONE RW TWO SUB
9A8B DA 8B 25 8C DF 86 FF 7F 07 8A 03 8B              BLOC20: DW      DUP AT LIT 0x7FFF AND R
9A97 F6 8E 10 8B 23 87 D4 FF                                  DW      SUB ZEQU ZBRAN +BLOC10
9A9F DA 8B A5 8E 4A 8C                                        DW      DUP PREV STORE
9AA5 F7 8A B7 8B BB 8E B5 8A                          BLOC30: DW      FROMR DROP TWOP SEMIS
                                                      
9AAD 86 28 4C 49 4E 45 A9                             HPLINE: DB      ^6 "(LINE" ^')'                         ; ***** (LINE)
9AB4 4F 9A                                                    DW      HBLOCK
9AB6 83 8C E7 8A 5A 8D 66 8D 1F 99 F7 8A 72 8D        PLINE:  DW      DOCOL TOR CL BBUF SSMOD FROMR BSCR
9AC4 E0 98 56 8B 57 9A 56 8B 5A 8D B5 8A                      DW      STAR PLUS BLOCK PLUS CL SEMIS
                                                      
9AD0 85 2E 4C 49 4E C5                                HDLINE: DB      ^5 ".LIN" ^'E'                          ; ***** .LINE
9AD6 AD 9A                                                    DW      HPLINE
9AD8 83 8C B6 9A C7 91 99 91 B5 8A                    DLINE:  DW      DOCOL PLINE DTRAI TYPE SEMIS
                                                      
9AE2 87 4D 45 53 53 41 47 C5                          HMESS:  DB      ^7 "MESSAG" ^'E'                        ; ***** MESSAGE
9AEA D0 9A                                                    DW      HDLINE
9AEC 83 8C BC 8D 25 8C 23 87 1A 00                    MESS:   DW      DOCOL WARN AT ZBRAN +MESS20
9AF6 4B 8F 23 87 10 00                                        DW      DDUP ZBRAN +MESS10
9AFC DF 86 10 00 EF 98 DF 86 04 00 56 8B D8 9A                DW      LIT 16 SLMOD LIT 4 PLUS DLINE
9B0A 11 87 0D 00                                      MESS10: DW      BRAN +MESS30
9B0E FA 91                                            MESS20: DW      PDOTQ
9B10 06 4D 53 47 20 23 20                                     DB      6 "MSG" 32 '#' 32
9B17 D5 9D                                                    DW      DOT
9B19 B5 8A                                            MESS30: DW      SEMIS
                                                      
9B1B 84 4C 4F 41 C4                                   HLOAD:  DB      ^4 "LOA" ^'D'                           ; ***** LOAD
9B20 E2 9A                                                    DW      HMESS
9B22 83 8C 02 8E 25 8C E7 8A 0B 8E 25 8C E7 8A 2F 8D  LOAD:   DW      DOCOL BLK AT TOR IN AT TOR ZERO IN
9B32 0B 8E 4A 8C 72 8D E0 98 02 8E 4A 8C 68 96 F7 8A          DW      STORE BSCR STAR BLK STORE INTER FROMR
9B42 0B 8E 4A 8C F7 8A 02 8E 4A 8C B5 8A                      DW      IN STORE FROMR BLK STORE SEMIS
                                                      
9B4E C3 2D 2D BE                                      HARROW: DB      ^^3 "--" ^'>'                           ; ***** -->
9B52 1B 9B                                                    DW      HLOAD
9B54 83 8C 6C 90 2F 8D 0B 8E 4A 8C 72 8D 02 8E 25 8C  ARROW:  DW      DOCOL QLOAD ZERO IN STORE BSCR BLK AT
9B64 A2 8B 0F 99 F6 8E 02 8E E7 8B B5 8A                      DW      OVER MOD SUB BLK PSTOR SEMIS
                                                      
                                                      ; INCLUDE         misc.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; MISCELLANEOUS HIGHER LEVEL
                                                      
9B70 C1 A7                                            HTICK:  DB      ^^1 ^39                                 ; ***** '
9B72 4E 9B                                                    DW      HARROW
9B74 83 8C 74 94 10 8B 2F 8D F3 8F B7 8B DF 95 B5 8A  TICK:   DW      DOCOL DFIND ZEQU ZERO QERR DROP LITER SEMIS
                                                      
9B84 86 46 4F 52 47 45 D4                             HFORGE: DB      ^6 "FORGE" ^'T'                         ; ***** FORGET
9B8B 70 9B                                                    DW      HTICK
9B8D 83 8C 48 8E 25 8C 3A 8E 25 8C F6 8E DF 86 18 00  FORGE:  DW      DOCOL CURR AT CONT AT SUB LIT 24
9B9D F3 8F 74 9B DA 8B C8 8D 25 8C 0E 8F DF 86 15 00          DW      QERR TICK DUP FENCE AT LESS LIT 21
9BAD F3 8F DA 8B B5 8F D1 8D 4A 8C 97 8F 25 8C 3A 8E          DW      QERR DUP NFA DP STORE LFA AT CONT
9BBD 25 8C 4A 8C B5 8A                                        DW      AT STORE SEMIS
                                                      
9BC3 84 42 41 43 CB                                   HBACK:  DB      ^4 "BAC" ^'K'                           ; ***** BACK
9BC8 84 9B                                                    DW      HFORGE
9BCA 83 8C CA 8E F6 8E E6 8E B5 8A                    BACK:   DW      DOCOL HERE SUB COMMA SEMIS
                                                      
9BD4 C5 42 45 47 49 CE                                HBEGIN: DB      ^^5 "BEGI" ^'N'                         ; ***** BEGIN
9BDA C3 9B                                                    DW      HBACK
9BDC 83 8C 0D 90 CA 8E 37 8D B5 8A                    BEGIN:  DW      DOCOL QCOMP HERE ONE SEMIS
                                                      
9BE6 C5 45 4E 44 49 C6                                HENDIF: DB      ^^5 "ENDI" ^'F'                         ; ***** ENDIF
9BEC D4 9B                                                    DW      HBEGIN
9BEE 83 8C 0D 90 3F 8D 3C 90 CA 8E                    ENDIF:  DW      DOCOL QCOMP TWO QPAIR HERE
9BF8 A2 8B F6 8E C9 8B 4A 8C B5 8A                            DW      OVER SUB SWAP STORE SEMIS
                                                      
9C02 C4 54 48 45 CE                                   HTHEN:  DB      ^^4 "THE" ^'N'                          ; ***** THEN
9C07 E6 9B                                                    DW      HENDIF
9C09 83 8C EE 9B B5 8A                                THEN:   DW      DOCOL ENDIF SEMIS
                                                      
9C0F C2 44 CF                                         HDO:    DB      ^^2 "D" ^'O'                            ; ***** DO
9C12 02 9C                                                    DW      HTHEN
9C14 83 8C 86 90 B9 87 CA 8E DF 86 03 00 B5 8A        DO:     DW      DOCOL COMP XDO HERE LIT 3 SEMIS
                                                      
9C22 C4 4C 4F 4F D0                                   HLOOP:  DB      ^^4 "LOO" ^'P'                          ; ***** LOOP
9C27 0F 9C                                                    DW      HDO
9C29 83 8C DF 86 03 00 3C 90 86 90 A4 87 CA 9B B5 8A  LOOP:   DW      DOCOL LIT 3 QPAIR COMP XLOOP BACK SEMIS
                                                      
9C39 C5 2B 4C 4F 4F D0                                HPLOOP: DB      ^^5 "+LOO" ^'P'                         ; ***** +LOOP
9C3F 22 9C                                                    DW      HLOOP
9C41 83 8C DF 86 03 00 3C 90 86 90 57 87 CA 9B B5 8A  PLOOP:  DW      DOCOL LIT 3 QPAIR COMP XPLOO BACK SEMIS
                                                      
9C51 C5 55 4E 54 49 CC                                HUNTIL: DB      ^^5 "UNTI" ^'L'                         ; ***** UNTIL
9C57 39 9C                                                    DW      HPLOOP
9C59 83 8C 37 8D 3C 90 86 90 23 87 CA 9B B5 8A        UNTIL:  DW      DOCOL ONE QPAIR COMP ZBRAN BACK SEMIS
                                                      
9C67 C3 45 4E C4                                      HEND:   DB      ^^3 "EN" ^'D'                           ; ***** ENDI
9C6B 51 9C                                                    DW      HUNTIL
9C6D 83 8C 59 9C B5 8A                                END:    DW      DOCOL UNTIL SEMIS
                                                      
9C73 C5 41 47 41 49 CE                                HAGAIN: DB      ^^5 "AGAI" ^'N'                         ; ***** AGAIN
9C79 67 9C                                                    DW      HEND
9C7B 83 8C 37 8D 3C 90 86 90 11 87 CA 9B B5 8A        AGAIN:  DW      DOCOL ONE QPAIR COMP BRAN BACK SEMIS
                                                      
9C89 C6 52 45 50 45 41 D4                             HREPEA: DB      ^^6 "REPEA" ^'T'                        ; ***** REPEAT
9C90 73 9C                                                    DW      HAGAIN
9C92 83 8C E7 8A E7 8A 7B 9C F7 8A F7 8A              REPEA:  DW      DOCOL TOR TOR AGAIN FROMR FROMR
9C9E 3F 8D F6 8E EE 9B B5 8A                                  DW      TWO SUB ENDIF SEMIS
                                                      
9CA6 C2 49 C6                                         HIF:    DB      ^^2 "I" ^'F'                            ; ***** IF
9CA9 89 9C                                                    DW      HREPEA
9CAB 83 8C 86 90 23 87 CA 8E 2F 8D E6 8E 3F 8D B5 8A  IF:     DW      DOCOL COMP ZBRAN HERE ZERO COMMA TWO SEMIS
                                                      
9CBB C4 45 4C 53 C5                                   HELSE:  DB      ^^4 "ELS" ^'E'                          ; ***** ELSE
9CC0 A6 9C                                                    DW      HIF
9CC2 83 8C 3F 8D 3C 90 86 90 11 87 CA 8E 3F 8D E6 8E  ELSE:   DW      DOCOL TWO QPAIR COMP BRAN HERE TWO COMMA
9CD2 C9 8B 3F 8D EE 9B 3F 8D B5 8A                            DW      SWAP TWO ENDIF TWO SEMIS
                                                      
9CDC C5 57 48 49 4C C5                                HWHILE: DB      ^^5 "WHIL" ^'E'                         ; ***** WHILE
9CE2 BB 9C                                                    DW      HELSE
9CE4 83 8C AB 9C BB 8E B5 8A                          WHILE:  DW      DOCOL IF TWOP SEMIS
                                                      
9CEC 86 53 50 41 43 45 D3                             HSPACS: DB      ^6 "SPACE" ^'S'                         ; ***** SPACES
9CF3 DC 9C                                                    DW      HWHILE
9CF5 83 8C 2F 8D 86 98 4B 8F 23 87 0C 00              SPACS:  DW      DOCOL ZERO MAX DDUP ZBRAN +SPAC20
9D01 2F 8D B9 87                                              DW      ZERO XDO
9D05 3C 8F A4 87 FC FF                                SPAC10: DW      SPACE XLOOP +SPAC10
9D0B B5 8A                                            SPAC20: DW      SEMIS
                                                      
9D0D 82 3C A3                                         HBDIGS: DB      ^2 "<" ^'#'                             ; ***** <#
9D10 EC 9C                                                    DW      HSPACS
9D12 83 8C 6D 93 90 8E 4A 8C B5 8A                    BDIGS:  DW      DOCOL PAD HLD STORE SEMIS
                                                      
9D1C 82 23 BE                                         HEDIGS: DB      ^2 "#" ^'>'                             ; ***** #>
9D1F 0D 9D                                                    DW      HBDIGS
9D21 83 8C B7 8B B7 8B 90 8E 25 8C                    EDIGS:  DW      DOCOL DROP DROP HLD AT
9D2B 6D 93 A2 8B F6 8E B5 8A                                  DW      PAD OVER SUB SEMIS
                                                      
9D33 84 53 49 47 CE                                   HSIGN:  DB      ^4 "SIG" ^'N'                           ; ***** SIGN
9D38 1C 9D                                                    DW      HEDIGS
9D3A 83 8C 28 8F 39 8B 23 87 08 00                    SIGN:   DW      DOCOL ROT ZLESS ZBRAN +SIGN10
9D44 DF 86 2D 00 55 93                                        DW      LIT '-' HOLD
9D4A B5 8A                                            SIGN10: DW      SEMIS
                                                      
9D4C 81 A3                                            HDIG:   DB      ^1 ^'#'                                 ; ***** #
9D4E 33 9D                                                    DW      HSIGN
9D50 83 8C 5F 8E 25 8C 42 99 28 8F                    DIG:    DW      DOCOL BASE AT MSMOD ROT
9D5A DF 86 09 00 A2 8B 0E 8F 23 87 08 00                      DW      LIT 9 OVER LESS ZBRAN +DIG10
9D66 DF 86 07 00 56 8B                                        DW      LIT 7 PLUS
9D6C DF 86 30 00 56 8B 55 93 B5 8A                    DIG10:  DW      LIT '0' PLUS HOLD SEMIS
                                                      
9D76 82 23 D3                                         HDIGS:  DB      ^2 "#" ^'S'                             ; ***** #S
9D79 4C 9D                                                    DW      HDIG
9D7B 83 8C                                            DIGS:   DW      DOCOL
9D7D 50 9D A2 8B A2 8B 17 8A 10 8B 23 87 F4 FF        DIGS10: DW      DIG OVER OVER OR ZEQU ZBRAN +DIGS10
9D8B B5 8A                                                    DW      SEMIS
                                                      
9D8D 83 44 2E D2                                      HDDOTR: DB      ^3 "D." ^'R'                            ; ***** D.R
9D91 76 9D                                                    DW      HDIGS
9D93 83 8C E7 8A C9 8B A2 8B 60 98                    DDOTR:  DW      DOCOL TOR SWAP OVER DABS
9D9D 12 9D 7B 9D 3A 9D 21 9D                                  DW      BDIGS DIGS SIGN EDIGS
9DA5 F7 8A A2 8B F6 8E F5 9C 99 91 B5 8A                      DW      FROMR OVER SUB SPACS TYPE SEMIS
                                                      
9DB1 82 2E D2                                         HDOTR:  DB      ^2 "." ^'R'                             ; ***** .R
9DB4 8D 9D                                                    DW      HDDOTR
9DB6 83 8C E7 8A 12 98 F7 8A 93 9D B5 8A              DOTR:   DW      DOCOL TOR STOD FROMR DDOTR SEMIS
                                                      
9DC2 82 44 AE                                         HDDOT:  DB      ^2 "D" ^'.'                             ; ***** D.
9DC5 B1 9D                                                    DW      HDOTR
9DC7 83 8C 2F 8D 93 9D 3C 8F B5 8A                    DDOT:   DW      DOCOL ZERO DDOTR SPACE SEMIS
                                                      
9DD1 81 AE                                            HDOT:   DB      ^1 ^'.'                                 ; ***** .
9DD3 C2 9D                                                    DW      HDDOT
9DD5 83 8C 12 98 C7 9D B5 8A                          DOT:    DW      DOCOL STOD DDOT SEMIS
                                                      
9DDD 81 BF                                            HQUEST: DB      ^1 ^'?'                                 ; ***** ?
9DDF D1 9D                                                    DW      HDOT
9DE1 83 8C 25 8C D5 9D B5 8A                          QUEST:  DW      DOCOL AT DOT SEMIS
                                                      
9DE9 82 55 AE                                         HUDOT:  DB      ^2 "U" ^'.'                             ; ***** U.
9DEC DD 9D                                                    DW      HQUEST
9DEE 83 8C 2F 8D C7 9D B5 8A                          UDOT:   DW      DOCOL ZERO DDOT SEMIS
                                                      
                                                      ; ----------------------------------
                                                      ; UTILITY WORDS
                                                      
9DF6 84 4C 49 53 D4                                   HLIST:  DB      ^4 "LIS" ^'T'                           ; ***** LIST
9DFB E9 9D                                                    DW      HUDOT
9DFD 83 8C E7 90 5B 89 DA 8B 1F 8E 4A 8C FA 91        LIST:   DW      DOCOL DEC CR DUP SCR STORE PDOTQ
9E0B 06 53 43 52 20 23 20                                     DB      6 "SCR" 32 "#" 32
9E12 D5 9D DF 86 10 00 2F 8D B9 87                            DW      DOT LIT 16 ZERO XDO
9E1C 5B 89 CB 87 47 8D B6 9D 3C 8F                    LIST10: DW      CR I THREE DOTR SPACE
9E26 CB 87 1F 8E 25 8C D8 9A A4 87 EC FF                      DW      I SCR AT DLINE XLOOP +LIST10
9E32 5B 89 B5 8A                                              DW      CR SEMIS
                                                      
9E36 85 49 4E 44 45 D8                                HINDEX: DB      ^5 "INDE" ^'X'                          ; ***** INDEX
9E3C F6 9D                                                    DW      HLIST
9E3E 83 8C 5B 89 AE 8E C9 8B B9 87                    INDEX:  DW      DOCOL CR ONEP SWAP XDO
9E48 5B 89 CB 87 47 8D B6 9D 3C 8F 2F 8D CB 87 D8 9A  INDE10: DW      CR I THREE DOTR SPACE ZERO I DLINE
9E58 45 89 23 87 04 00                                        DW      QTERM ZBRAN +INDE20
9E5E D4 8A                                                    DW      LEAVE
9E60 A4 87 E6 FF                                      INDE20: DW      XLOOP +INDE10
9E64 B5 8A                                                    DW      SEMIS
                                                      
9E66 85 56 4C 49 53 D4                                HVLIST: DB      ^5 "VLIS" ^'T'                          ; ***** VLIST
9E6C 36 9E                                                    DW      HINDEX
9E6E 83 8C DF 86 80 00 15 8E 4A 8C 3A 8E 25 8C 25 8C  VLIST:  DW      DOCOL LIT 128 OUT STORE CONT AT AT
9E7E 15 8E 25 8C DF 86 1C 00 1A 8F 23 87 0A 00        VLIS10: DW      OUT AT LIT 28 GREAT ZBRAN +VLIS20
9E8C 5B 89 2F 8D 15 8E 4A 8C                                  DW      CR ZERO OUT STORE
9E94 DA 8B 1E 95 3C 8F CB 8F 97 8F 25 8C              VLIS20: DW      DUP IDDOT SPACE PFA LFA AT
9EA0 DA 8B 10 8B 45 89 17 8A 23 87 D4 FF                      DW      DUP ZEQU QTERM OR ZBRAN +VLIS10
9EAC B7 8B B5 8A                                              DW      DROP SEMIS
                                                      
9EB0 C5 3B 43 4F 44 C5                                HSCODE: DB      ^^5 ";COD" ^'E'                         ; ***** ;CODE
9EB6 66 9E                                                    DW      HVLIST
9EB8 83 8C 4F 90 86 90 11 91 9C 90 BF 90 B5 8A        SCODE:  DW      DOCOL QCSP COMP PSCOD LBRAC SMUDG SEMIS
                                                      
9EC6 84 54 45 53 D4                                   HTEST:  DB      ^4 "TES" ^'T'                           ; ***** TEST (temporary)
9ECB B0 9E                                                    DW      HSCODE
9ECD 83 8C FA 91                                      TEST:   DW      DOCOL PDOTQ
9ED1 04 43 48 4B 21                                           DB      4 "CHK!"
9ED6 5B 89 B5 8A                                              DW      CR SEMIS
                                                      
9EDA 83 4E 4F D0                                      HNOOP:  DB      ^3 "NO" ^'P'                            ; ***** NOP
9EDE C6 9E                                                    DW      HTEST
9EE0 83 8C B5 8A                                      NOOP:   DW      DOCOL SEMIS
                                                      
9EE4 83 42 59 C5                                      HBYE:   DB      ^3 "BY" ^'E'                            ; ***** BYE
9EE8 DA 9E                                                    DW      HNOOP
9EEA EC 9E                                            BYE:    DW      BYE0
9EEC 0E 00                                            BYE0:   LDI     0               ; Select EEPROM bank 0
9EEE 01                                                       BNK                     ; :
9EEF 14 00 00                                                 JPA     0               ; Re-start monitor
                                                      
9EF2 C5 46 4F 52 54 C8                                HFORTH: DB      ^^5 "FORT" ^'H'                         ; ***** FORTH
9EF8 E4 9E                                                    DW      HBYE
9EFA 45 91 EF 96 81 A0 F2 9E                          FORTH:  DW      DODOE DOVOC 0xA081 HFORTH
9F02 00 00                                            XXVOC:  DW      0
                                                      
9F04 00                                               XDP:    DB      0
                                                      
                                                      ; INCLUDE         uppermem.asm
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; UPPER MEMORY AREA
                                                      
                                                              ORG     0xF5B9
                                                      
F5B9 00                                               XSP:    DB      0
F5BA 00                                               XTIB:   DB      0
                                                              DS      210             ; TIB:      84
F68D 00                                               XRP:    DB      0               ; RSTACK:  128
F68E 00                                               XUP:    DB      0
                                                              DS      80              ; Room for 40 variables
F6DF 00                                               DSKBF:  DB      0
                                                              DS      2055            ; 2 * 1028 bytes
FEE7 00                                               ENDBF:  DB      0
                                                      
                                                      ; ----------------------------------------------------------------------
                                                      ; THE VIRTUAL FORTH MACHINE REGISTERS
                                                      
                                                      IP:                             ; Instruction Pointer
FEE8 00                                               IP.0:   DB      0
FEE9 00                                               IP.1:   DB      0
                                                      
                                                      WA:                             ; Word Address Register
FEEA 00                                               WA.0:   DB      0
FEEB 00                                               WA.1:   DB      0
                                                      
                                                      SP:                             ; Data stack pointer
FEEC 00                                               SP.0:   DB      0
FEED 00                                               SP.1:   DB      0
                                                      
                                                      RP:                             ; Return stack pointer
FEEE 00                                               RP.0:   DB      0
FEEF 00                                               RP.1:   DB      0
                                                      
                                                      UP:                             ; User area pointer
FEF0 00                                               UP.0:   DB      0
FEF1 00                                               UP.1:   DB      0
                                                      
                                                      R1:                             ; Working register R1
FEF2 00                                               R1.0:   DB      0
FEF3 00                                               R1.1:   DB      0
                                                      R1H:
FEF4 00                                               R1.2:   DB      0
FEF5 00                                               R1.3:   DB      0
                                                      
                                                      R2:                             ; Working register R2
FEF6 00                                               R2.0:   DB      0
FEF7 00                                               R2.1:   DB      0
                                                      R2H:
FEF8 00                                               R2.2:   DB      0
FEF9 00                                               R2.3:   DB      0
                                                      
                                                      R3:                             ; Working register R3
FEFA 00                                               R3.0:   DB      0
FEFB 00                                               R3.1:   DB      0
                                                      R3H:
FEFC 00                                               R3.2:   DB      0
FEFD 00                                               R3.3:   DB      0
                                                      
FEFE 00                                               BC:     DB      0               ; "Hidden" registers
FEFF 00                                               TMP:    DB      0               ; (used by _AND8 _OR8 _XOR8)
